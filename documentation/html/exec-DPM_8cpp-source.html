<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>IRIS: exec-DPM.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_014faa727c0b2aaba2cbdd8f326de4f6.html">source</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_4516642e80adc9bf50ea604a2fbf2492.html">zesto</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_7a2611989c34d5da73826c22291ea719.html">ZPIPE-exec</a>
  </div>
</div>
<div class="contents">
<h1>exec-DPM.cpp</h1><a href="exec-DPM_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* exec-DPM.cpp - Detailed Pipeline Model */</span>
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * __COPYRIGHT__ GT</span>
<a name="l00004"></a>00004 <span class="comment"> */</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#ifdef EXEC</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span><span class="preprocessor">#define PRINT_EXEC(x)   fprintf(x)</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 <span class="preprocessor">#ifdef ZESTO_PARSE_ARGS</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(!strcasecmp(exec_opt_string,<span class="stringliteral">"DPM"</span>))
<a name="l00012"></a>00012     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>(core);
<a name="l00013"></a>00013 <span class="preprocessor">#else</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span>
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="classcore__exec__DPM__t.html">00016</a> <span class="keyword">class </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>:<span class="keyword">public</span> <a class="code" href="classcore__exec__t.html">core_exec_t</a>
<a name="l00017"></a>00017 {
<a name="l00018"></a>00018   <span class="comment">/* readyQ for scheduling */</span>
<a name="l00019"></a><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">00019</a>   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> {
<a name="l00020"></a><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#b3f3a53da6ddc6d01c10a7c4ee968f2c">00020</a>     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#b3f3a53da6ddc6d01c10a7c4ee968f2c">uop</a>;
<a name="l00021"></a><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#211d0b02c5ae04ec2034cf4be925469e">00021</a>     <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#211d0b02c5ae04ec2034cf4be925469e">uop_seq</a>; <span class="comment">/* seq id of uop when inserted - for proper sorting even after uop recycled */</span>
<a name="l00022"></a><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#5538521f28949dfa480704b9ef236be5">00022</a>     <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#5538521f28949dfa480704b9ef236be5">action_id</a>;
<a name="l00023"></a><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#256395ddefdb2a4678c27bc02e6c6303">00023</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#256395ddefdb2a4678c27bc02e6c6303">when_assigned</a>;
<a name="l00024"></a><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">00024</a>     <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a>;
<a name="l00025"></a>00025   };
<a name="l00026"></a>00026 
<a name="l00027"></a>00027   <span class="comment">/* struct for a squashable in-flight uop (for example, a uop making its way</span>
<a name="l00028"></a>00028 <span class="comment">     down an ALU pipeline).  Changing the original uop's tag will make the tags</span>
<a name="l00029"></a>00029 <span class="comment">     no longer match, thereby invalidating the in-flight action. */</span>
<a name="l00030"></a><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">00030</a>   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">uop_action_t</a> {
<a name="l00031"></a><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">00031</a>     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a>;
<a name="l00032"></a><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#0adcd9ccf128d31dd9c5b3f122a63010">00032</a>     <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#0adcd9ccf128d31dd9c5b3f122a63010">action_id</a>;
<a name="l00033"></a>00033   };
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   <span class="comment">/* struct for a generic pipelined ALU */</span>
<a name="l00036"></a><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">00036</a>   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">ALU_t</a> {
<a name="l00037"></a><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">00037</a>     <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">uop_action_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>;
<a name="l00038"></a><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#048592627a2d37afb4cc0c20d0910cd8">00038</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#048592627a2d37afb4cc0c20d0910cd8">occupancy</a>;
<a name="l00039"></a><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">00039</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">latency</a>;    <span class="comment">/* number of cycles from start of execution to end */</span>
<a name="l00040"></a><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a565898e067059987f9836d533bffbe9">00040</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a565898e067059987f9836d533bffbe9">issue_rate</a>; <span class="comment">/* number of cycles between issuing independent instructions on this ALU */</span>
<a name="l00041"></a><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#97be489796e116184c659aca796374d4">00041</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#97be489796e116184c659aca796374d4">when_scheduleable</a>; <span class="comment">/* cycle when next instruction can be scheduled for this ALU */</span>
<a name="l00042"></a><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#48cab98e064f120d1679f120f852518c">00042</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#48cab98e064f120d1679f120f852518c">when_executable</a>; <span class="comment">/* cycle when next instruction can actually start executing on this ALU */</span>
<a name="l00043"></a>00043   };
<a name="l00044"></a>00044 
<a name="l00045"></a>00045   <span class="keyword">public</span>:
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <a class="code" href="classcore__exec__DPM__t.html#4d93e45d3abdeee798dde29f81d060ef">core_exec_DPM_t</a>(<span class="keyword">struct</span> <a class="code" href="classcore__t.html">core_t</a> * <span class="keyword">const</span> <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>);
<a name="l00048"></a>00048   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#a91990c6b68df8151ad572381551c204">reg_stats</a>(<span class="keyword">struct</span> <a class="code" href="structstat__sdb__t.html">stat_sdb_t</a> * <span class="keyword">const</span> sdb);
<a name="l00049"></a>00049   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#0bd262cf902ac7ce2f03e713a73be273">freeze_stats</a>(<span class="keywordtype">void</span>);
<a name="l00050"></a>00050   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#3e2b3d9545dfa9554736df7a3b27e413">update_occupancy</a>(<span class="keywordtype">void</span>);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#7275a99b63b767196f8a0ff94acac19f">ALU_exec</a>(<span class="keywordtype">void</span>);
<a name="l00053"></a>00053   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#23c9e1a684a28d4dacd9eb9ba2365d84">LDST_exec</a>(<span class="keywordtype">void</span>);
<a name="l00054"></a>00054   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#8151e39fd37a59e7616c15a7ba80d101">RS_schedule</a>(<span class="keywordtype">void</span>);
<a name="l00055"></a>00055   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#3abf667bd2a370573ac2d255e8a0738b">LDQ_schedule</a>(<span class="keywordtype">void</span>);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#5814929b0ccda77afa4554df6b990783">recover</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structMop__t.html">Mop_t</a> * <span class="keyword">const</span> Mop);
<a name="l00058"></a>00058   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#5814929b0ccda77afa4554df6b990783">recover</a>(<span class="keywordtype">void</span>);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">insert_ready_uop</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#2b2575b1ba3174ced4e7bed8b17689d6">RS_available</a>(<span class="keywordtype">void</span>);
<a name="l00063"></a>00063   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#8e9ca9566f37da702b6e2f14ead41fad">RS_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00064"></a>00064   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#06bdb518d429ece3311d878968432bc9">RS_fuse_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00065"></a>00065   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#91a1a6eefe2b90d3c4d786f688b116d4">RS_deallocate</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#9b7fef0c453e1980ff612a7e0181ed03">LDQ_available</a>(<span class="keywordtype">void</span>);
<a name="l00068"></a>00068   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#3df4995363c8fe7593800e13315bd14c">LDQ_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00069"></a>00069   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#78f6cdc56b22df9d7d26ed6a59edd762">LDQ_deallocate</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00070"></a>00070   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#61bee8b6575679752ff99b170f09fec7">LDQ_squash</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> dead_uop);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#cd2ed4a962da699b47dda3abc24d256a">STQ_available</a>(<span class="keywordtype">void</span>);
<a name="l00073"></a>00073   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#0c23a1b1e2f0c81600467c544aa1a6b3">STQ_insert_sta</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00074"></a>00074   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#f8766fda83629cd750d7b41ed7ea7a95">STQ_insert_std</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00075"></a>00075   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#92a5d237405f5a04e466d1f023dcd4fa">STQ_deallocate_sta</a>(<span class="keywordtype">void</span>);
<a name="l00076"></a>00076   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#4593c06b9cd20d697033cfd948837df6">STQ_deallocate_std</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00077"></a>00077   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#3d53b2fdf7a7417775826ba647ee0b7d">STQ_deallocate_senior</a>(<span class="keywordtype">void</span>);
<a name="l00078"></a>00078   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#579b2933ffc0634a765926c8accab187">STQ_squash_sta</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> dead_uop);
<a name="l00079"></a>00079   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#877aa84541b1cdaec526a14aaa890c05">STQ_squash_std</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> dead_uop);
<a name="l00080"></a>00080   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#be6f5af1f9348805b6582a768885201b">STQ_squash_senior</a>(<span class="keywordtype">void</span>);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#f51f86602b423d4367ad2a7f74e77cac">recover_check_assertions</a>(<span class="keywordtype">void</span>);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="keyword">protected</span>:
<a name="l00085"></a><a class="code" href="classcore__exec__DPM__t.html#b2ef8c59f6ac4dfeebd8bbbd538bdf03">00085</a>   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * <a class="code" href="classcore__exec__DPM__t.html#b2ef8c59f6ac4dfeebd8bbbd538bdf03">readyQ_free_pool</a>; <span class="comment">/* for scheduling readyQ's */</span>
<a name="l00086"></a>00086 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>  <span class="keywordtype">int</span> readyQ_free_pool_debt; <span class="comment">/* for debugging memory leaks */</span>
<a name="l00088"></a>00088 <span class="preprocessor">#endif</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a><a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">00090</a>   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> ** <a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">RS</a>;
<a name="l00091"></a><a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">00091</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a>;
<a name="l00092"></a><a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">00092</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a>;
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html">00094</a>   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html">LDQ_t</a> {
<a name="l00095"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">00095</a>     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>;
<a name="l00096"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a4e96c4d36187d57b55b3ca3720475d6">00096</a>     <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a4e96c4d36187d57b55b3ca3720475d6">virt_addr</a>;
<a name="l00097"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#825f78f49795f0acfb2457adf7513477">00097</a>     <a class="code" href="machine_8h.html#1283325781575bd7f116553a4cd7efd5">md_paddr_t</a> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#825f78f49795f0acfb2457adf7513477">phys_addr</a>;
<a name="l00098"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9849939f8fb88ebf561452aeb67cb445">00098</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9849939f8fb88ebf561452aeb67cb445">first_byte_requested</a>;
<a name="l00099"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a6b521d057414fe8ea6ed3bed4e51e22">00099</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a6b521d057414fe8ea6ed3bed4e51e22">last_byte_requested</a>;
<a name="l00100"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">00100</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">first_byte_arrived</a>;
<a name="l00101"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">00101</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a>;
<a name="l00102"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#10d6df15476a7ae3fd8524ee7ba8de04">00102</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#10d6df15476a7ae3fd8524ee7ba8de04">mem_size</a>;
<a name="l00103"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#f6227d585f433401f9eb299684cf5ea7">00103</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#f6227d585f433401f9eb299684cf5ea7">addr_valid</a>;
<a name="l00104"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1f4a7cd8f60161109737d9722f60d6fc">00104</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1f4a7cd8f60161109737d9722f60d6fc">store_color</a>;   <span class="comment">/* STQ index of most recent store before this load */</span>
<a name="l00105"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">00105</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a>;    <span class="comment">/* received value from STQ */</span>
<a name="l00106"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">00106</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a>; <span class="comment">/* when load actually issued */</span>
<a name="l00107"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">00107</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a>; <span class="comment">/* made a speculative tag broadcast */</span>
<a name="l00108"></a><a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#15375f9fa16ccc59fde7402fb43d487a">00108</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#15375f9fa16ccc59fde7402fb43d487a">partial_forward</a>; <span class="comment">/* true if blocked on an earlier partially matching store */</span>
<a name="l00109"></a>00109   } * <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>;
<a name="l00110"></a><a class="code" href="classcore__exec__DPM__t.html#22cff5744d7616c8b1a7eafb409ae62a">00110</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#22cff5744d7616c8b1a7eafb409ae62a">LDQ_head</a>;
<a name="l00111"></a><a class="code" href="classcore__exec__DPM__t.html#eeb8e9d2ac0d5f0da9ef92cf4617b2bb">00111</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#eeb8e9d2ac0d5f0da9ef92cf4617b2bb">LDQ_tail</a>;
<a name="l00112"></a><a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">00112</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a>;
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html">00114</a>   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html">STQ_t</a> {
<a name="l00115"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">00115</a>     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a>;
<a name="l00116"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#e0344449b4f8eef6b241aa620f0ae4ec">00116</a>     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#e0344449b4f8eef6b241aa620f0ae4ec">std</a>;
<a name="l00117"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#f75e13d26a4ebba3da425d142902811c">00117</a>     <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#f75e13d26a4ebba3da425d142902811c">uop_seq</a>;
<a name="l00118"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#68434b699cc17dac41c332e7ebaf015a">00118</a>     <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#68434b699cc17dac41c332e7ebaf015a">virt_addr</a>;
<a name="l00119"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#d66e6e08df9aa85a0798a2532e463bcb">00119</a>     <a class="code" href="machine_8h.html#1283325781575bd7f116553a4cd7efd5">md_paddr_t</a> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#d66e6e08df9aa85a0798a2532e463bcb">phys_addr</a>;
<a name="l00120"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#9bcbb2b9abc5c2f3efe77419f003796b">00120</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#9bcbb2b9abc5c2f3efe77419f003796b">first_byte_requested</a>;
<a name="l00121"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#6dc334ad05d9160f08b81e1ffa2898ea">00121</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#6dc334ad05d9160f08b81e1ffa2898ea">last_byte_requested</a>;
<a name="l00122"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#d90106f07a571dbfecd4586aa92d0838">00122</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#d90106f07a571dbfecd4586aa92d0838">first_byte_written</a>;
<a name="l00123"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b7e912e72db5bc04e0c5a1bece119286">00123</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b7e912e72db5bc04e0c5a1bece119286">last_byte_written</a>;
<a name="l00124"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">00124</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">mem_size</a>;
<a name="l00125"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#35a655b6baeb594e50ec6df0dbadaa1d">00125</a>     <span class="keyword">union </span><a class="code" href="unionval__t.html">val_t</a> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#35a655b6baeb594e50ec6df0dbadaa1d">value</a>;
<a name="l00126"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#467417274abd61110c78ce4b279e924e">00126</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#467417274abd61110c78ce4b279e924e">addr_valid</a>;
<a name="l00127"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#8f487108e9e9fef004abc9b617bf604d">00127</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#8f487108e9e9fef004abc9b617bf604d">value_valid</a>;
<a name="l00128"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#10592474b3cce4f112cd6c4e8a4bd4b0">00128</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#10592474b3cce4f112cd6c4e8a4bd4b0">next_load</a>; <span class="comment">/* LDQ index of next load in program order */</span>
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <span class="comment">/* for commit */</span>
<a name="l00131"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#877df377f0f978281a76644e31f9fd96">00131</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#877df377f0f978281a76644e31f9fd96">translation_complete</a>; <span class="comment">/* dtlb access finished */</span>
<a name="l00132"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8a0d483ae23caa1cca70f2636c48109">00132</a>     <span class="keywordtype">bool</span> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8a0d483ae23caa1cca70f2636c48109">write_complete</a>; <span class="comment">/* write access finished */</span>
<a name="l00133"></a><a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">00133</a>     <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a>; <span class="comment">/* need to squash commits when a core resets (multi-core mode only) */</span>
<a name="l00134"></a>00134   } * <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>;
<a name="l00135"></a><a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">00135</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>;
<a name="l00136"></a><a class="code" href="classcore__exec__DPM__t.html#dd9d11161fa5063c1c4a42010100c4ad">00136</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#dd9d11161fa5063c1c4a42010100c4ad">STQ_tail</a>;
<a name="l00137"></a><a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">00137</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a>;
<a name="l00138"></a><a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">00138</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a>;
<a name="l00139"></a><a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">00139</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a>;
<a name="l00140"></a><a class="code" href="classcore__exec__DPM__t.html#27fea483684987dd8def0fa02ae8c08c">00140</a>   <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#27fea483684987dd8def0fa02ae8c08c">partial_forward_throttle</a>; <span class="comment">/* used to control load-issuing in the presence of partial-matching stores */</span>
<a name="l00141"></a>00141 
<a name="l00142"></a><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html">00142</a>   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html">exec_port_t</a> {
<a name="l00143"></a><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">00143</a>     <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">uop_action_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>;
<a name="l00144"></a><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#aa00af896d341748fc352988cb528ce7">00144</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#aa00af896d341748fc352988cb528ce7">occupancy</a>;
<a name="l00145"></a><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">00145</a>     <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">ALU_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97da49fe5b0d01f8dfc89086f720a6bb807">NUM_FU_CLASSES</a>];
<a name="l00146"></a><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#46f43b948280321c354268669a523565">00146</a>     <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#46f43b948280321c354268669a523565">readyQ</a>;
<a name="l00147"></a><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">00147</a>     <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">ALU_t</a> * <a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>; <span class="comment">/* store-queue lookup/search pipeline for load execution */</span>
<a name="l00148"></a><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#7b2f7ee0f5ef4e237188bbbbf6c48459">00148</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#7b2f7ee0f5ef4e237188bbbbf6c48459">when_bypass_used</a>; <span class="comment">/* to make sure only one inst writes back per cycle, which</span>
<a name="l00149"></a>00149 <span class="comment">                                could happen due to insts with different latencies */</span>
<a name="l00150"></a><a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#2447d80ac9daa272dc0d2c5af375cf8e">00150</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#2447d80ac9daa272dc0d2c5af375cf8e">num_FU_types</a>; <span class="comment">/* the number of FU's bound to this port */</span>
<a name="l00151"></a>00151     <span class="keyword">enum</span> <a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d">md_fu_class</a> * FU_types; <span class="comment">/* the corresponding types of those FUs */</span>
<a name="l00152"></a>00152   } * <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>;
<a name="l00153"></a><a class="code" href="classcore__exec__DPM__t.html#1481184b99dd1dca8a0e570980bf1abc">00153</a>   <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#1481184b99dd1dca8a0e570980bf1abc">check_for_work</a>; <span class="comment">/* used to skip ALU exec when there's no uops */</span>
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">00155</a>   <span class="keyword">struct </span><a class="code" href="classmemdep__t.html">memdep_t</a> * <a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">memdep</a>;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158   <span class="comment">/* various exec utility functions */</span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * <a class="code" href="classcore__exec__DPM__t.html#e34af919bd9180e611be4b5a34e8bc07">get_readyQ_node</a>(<span class="keywordtype">void</span>);
<a name="l00161"></a>00161   <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#4fa6c3d9f286a7aa26305e2049ebcc14">return_readyQ_node</a>(<span class="keyword">struct</span> <a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * <span class="keyword">const</span> p);
<a name="l00162"></a>00162   <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#15810e9312609410063d8ee3de5e681c">check_load_issue_conditions</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00163"></a>00163   <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">snatch_back</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> replayed_uop);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#b07c4d1f245b656e14be9138c5a6070e">load_writeback</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   <span class="comment">/* callbacks need to be static */</span>
<a name="l00168"></a>00168   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#109d24bd6ea7ae6180264e1cbc763748">DL1_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00169"></a>00169   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#d5d17ca90be424042d6c5051903537d2">DL1_split_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00170"></a>00170   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#4e14cd7a5104eceeb931ef5498cc6a78">DTLB_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00171"></a>00171   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#f000198904efa0b681cafd05b331c376">translated_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op,<span class="keyword">const</span> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a>);
<a name="l00172"></a>00172   <span class="keyword">static</span> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">get_uop_action_id</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00173"></a>00173   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#c18400df36d37f24fcb9c47cb356700a">load_miss_reschedule</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op, <span class="keyword">const</span> <span class="keywordtype">int</span> new_pred_latency);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="comment">/* callbacks used by commit for stores */</span>
<a name="l00176"></a>00176   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#e5b9da15ba0b9b90d68793c6dcf6e5a4">store_dl1_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00177"></a>00177   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#1ebb3bdb6783434b0ff5857ab17ea8ff">store_dl1_split_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00178"></a>00178   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#e44b1534550acdb1621aea03f5de7011">store_dtlb_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00179"></a>00179   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#d61bb8f33057037b8d0d9b20270352b5">store_translated_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op,<span class="keyword">const</span> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a>);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 };
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">/*******************/</span>
<a name="l00184"></a>00184 <span class="comment">/* SETUP FUNCTIONS */</span>
<a name="l00185"></a>00185 <span class="comment">/*******************/</span>
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="classcore__exec__DPM__t.html#4d93e45d3abdeee798dde29f81d060ef">00187</a> <a class="code" href="classcore__exec__DPM__t.html#4d93e45d3abdeee798dde29f81d060ef">core_exec_DPM_t::core_exec_DPM_t</a>(<span class="keyword">struct</span> <a class="code" href="classcore__t.html">core_t</a> * <span class="keyword">const</span> arg_core):
<a name="l00188"></a>00188   readyQ_free_pool(NULL),
<a name="l00189"></a>00189 #ifdef <a class="code" href="mc__constants_8h.html#d72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>
<a name="l00190"></a>00190   readyQ_free_pool_debt(0),
<a name="l00191"></a>00191 #endif
<a name="l00192"></a>00192   RS_num(0), RS_eff_num(0), LDQ_head(0), LDQ_tail(0), LDQ_num(0),
<a name="l00193"></a>00193   STQ_head(0), STQ_tail(0), STQ_num(0), STQ_senior_num(0),
<a name="l00194"></a>00194   STQ_senior_head(0), partial_forward_throttle(false)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = arg_core-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00197"></a>00197   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a> = arg_core;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   <a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">RS</a> = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>**) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">RS</a>));
<a name="l00200"></a>00200   <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">RS</a>)
<a name="l00201"></a>00201     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc RS"</span>);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a> = (<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html">core_exec_DPM_t::LDQ_t</a>*) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>));
<a name="l00204"></a>00204   <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>)
<a name="l00205"></a>00205     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc LDQ"</span>);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a> = (<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html">core_exec_DPM_t::STQ_t</a>*) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>));
<a name="l00208"></a>00208   <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>)
<a name="l00209"></a>00209     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc STQ"</span>);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <span class="keywordtype">int</span> i;
<a name="l00212"></a>00212   <span class="comment">/* This shouldn't be necessary, but I threw it in because valgrind (memcheck)</span>
<a name="l00213"></a>00213 <span class="comment">     was reporting that STQ[i].sta was being used uninitialized. -GL */</span>
<a name="l00214"></a>00214   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>;i++)
<a name="l00215"></a>00215     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].sta = NULL;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   <span class="comment">/*********************************************************/</span>
<a name="l00218"></a>00218   <span class="comment">/* Data cache parsing first, functional units after this */</span>
<a name="l00219"></a>00219   <span class="comment">/*********************************************************/</span>
<a name="l00220"></a>00220   <span class="keywordtype">char</span> name[256];
<a name="l00221"></a>00221   <span class="keywordtype">int</span> sets, assoc, linesize, latency, banks, bank_width, MSHR_entries, WBB_entries;
<a name="l00222"></a>00222   <span class="keywordtype">char</span> rp, ap, wp, wc;
<a name="l00223"></a>00223   
<a name="l00224"></a>00224   <span class="comment">/* note: caches must be instantiated from the level furthest from the core first (e.g., L2) */</span>
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="comment">/* per-core DL2 */</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   <span class="comment">/* per-core L2 bus (between L1 and L2) */</span>
<a name="l00229"></a>00229   <span class="keywordflow">if</span>(!strcasecmp(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#a3392e4aae5350aba828cc2eb860bdc0">DL2_opt_str</a>,<span class="stringliteral">"none"</span>))
<a name="l00230"></a>00230   {
<a name="l00231"></a>00231     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a> = NULL;
<a name="l00232"></a>00232     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#8924d67219e4fbf56363be1d20d57d87">DL2_bus</a> = NULL;
<a name="l00233"></a>00233   }
<a name="l00234"></a>00234   <span class="keywordflow">else</span>
<a name="l00235"></a>00235   {
<a name="l00236"></a>00236     <span class="keywordflow">if</span>(sscanf(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#a3392e4aae5350aba828cc2eb860bdc0">DL2_opt_str</a>,<span class="stringliteral">"%[^:]:%d:%d:%d:%d:%d:%d:%c:%c:%c:%d:%d:%c"</span>,
<a name="l00237"></a>00237         name,&amp;sets,&amp;assoc,&amp;linesize,&amp;banks,&amp;bank_width,&amp;latency,&amp;rp,&amp;ap,&amp;wp, &amp;MSHR_entries, &amp;WBB_entries, &amp;wc) != 13)
<a name="l00238"></a>00238       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"invalid DL2 options: &lt;name:sets:assoc:linesize:banks:bank-width:latency:repl-policy:alloc-policy:write-policy:num-MSHR:WB-buffers:write-combining&gt;\n\t(%s)"</span>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#a3392e4aae5350aba828cc2eb860bdc0">DL2_opt_str</a>);
<a name="l00239"></a>00239     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa1d22ad1643074e988a0af228750966eb4">CACHE_READWRITE</a>,sets,assoc,linesize,
<a name="l00240"></a>00240                              rp,ap,wp,wc,banks,bank_width,latency,
<a name="l00241"></a>00241                              WBB_entries,MSHR_entries,1,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#d6b074e9f80776c006cf1d399219d111">LLC_bus</a>);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="keywordflow">if</span>(!knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#af0904c8498e9f7a6e5bbcf4f2de8d44">DL2_MSHR_cmd</a> || !strcasecmp(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#af0904c8498e9f7a6e5bbcf4f2de8d44">DL2_MSHR_cmd</a>,<span class="stringliteral">"fcfs"</span>))
<a name="l00244"></a>00244       <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;MSHR_cmd_order = NULL;
<a name="l00245"></a>00245     <span class="keywordflow">else</span>
<a name="l00246"></a>00246     {
<a name="l00247"></a>00247       <span class="keywordflow">if</span>(strlen(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#af0904c8498e9f7a6e5bbcf4f2de8d44">DL2_MSHR_cmd</a>) != 4)
<a name="l00248"></a>00248         <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"-dl1:mshr_cmd must either be \"fcfs\" or contain all four of [RWBP]"</span>);
<a name="l00249"></a>00249       <span class="keywordtype">bool</span> R_seen = <span class="keyword">false</span>;
<a name="l00250"></a>00250       <span class="keywordtype">bool</span> W_seen = <span class="keyword">false</span>;
<a name="l00251"></a>00251       <span class="keywordtype">bool</span> B_seen = <span class="keyword">false</span>;
<a name="l00252"></a>00252       <span class="keywordtype">bool</span> P_seen = <span class="keyword">false</span>;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254       <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;MSHR_cmd_order = (<span class="keyword">enum</span> <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255">cache_command</a>*)calloc(4,<span class="keyword">sizeof</span>(<span class="keyword">enum</span> <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255">cache_command</a>));
<a name="l00255"></a>00255       <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;MSHR_cmd_order)
<a name="l00256"></a>00256         <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc MSHR_cmd_order array for DL2"</span>);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;4;c++)
<a name="l00259"></a>00259       {
<a name="l00260"></a>00260         <span class="keywordflow">switch</span>(<a class="code" href="misc_8h.html#e9332e6ace7e2352b856c2a76bd9ef43">mytoupper</a>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#af0904c8498e9f7a6e5bbcf4f2de8d44">DL2_MSHR_cmd</a>[c]))
<a name="l00261"></a>00261         {
<a name="l00262"></a>00262           <span class="keywordflow">case</span> <span class="charliteral">'R'</span>: <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;MSHR_cmd_order[c] = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>; R_seen = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l00263"></a>00263           <span class="keywordflow">case</span> <span class="charliteral">'W'</span>: <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;MSHR_cmd_order[c] = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255f31232fbf9e45b41922cf68b09a4a201">CACHE_WRITE</a>; W_seen = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l00264"></a>00264           <span class="keywordflow">case</span> <span class="charliteral">'B'</span>: <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;MSHR_cmd_order[c] = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb25532d220872fec4028b8b25e094c84837c">CACHE_WRITEBACK</a>; B_seen = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l00265"></a>00265           <span class="keywordflow">case</span> <span class="charliteral">'P'</span>: <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;MSHR_cmd_order[c] = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb25537348416545a4253a253b1a4371e6ccf">CACHE_PREFETCH</a>; P_seen = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l00266"></a>00266           <span class="keywordflow">default</span>: <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"unknown cache operation '%c' for -dl1:mshr_cmd; must be one of [RWBP]"</span>);
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268       }
<a name="l00269"></a>00269       <span class="keywordflow">if</span>(!R_seen || !W_seen || !B_seen || !P_seen)
<a name="l00270"></a>00270         <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"-dl1:mshr_cmd must contain *each* of [RWBP]"</span>);
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a> = (<span class="keyword">struct </span><a class="code" href="classprefetch__t.html">prefetch_t</a>**) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#e34ca10986e72600bcd62707dff6fd99">DL2_num_PF</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>));
<a name="l00274"></a>00274     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#9c4419121e831734dd6e738ddddb4d2e">num_prefetchers</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#e34ca10986e72600bcd62707dff6fd99">DL2_num_PF</a>;
<a name="l00275"></a>00275     <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>)
<a name="l00276"></a>00276       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc %s's prefetcher array"</span>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#b2a2c8eeb48b5f98cbd0265cce07aa6e">name</a>);
<a name="l00277"></a>00277     <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#e34ca10986e72600bcd62707dff6fd99">DL2_num_PF</a>;i++)
<a name="l00278"></a>00278       <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>[i] = <a class="code" href="zesto-prefetch_8cpp.html#3d85e6268083839e3f4f31e038f204a8">prefetch_create</a>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#992e7058ad0a77e99b9e454d67d48c16">DL2PF_opt_str</a>[i],<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>);
<a name="l00279"></a>00279     <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>[0] == NULL)
<a name="l00280"></a>00280       <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#9c4419121e831734dd6e738ddddb4d2e">num_prefetchers</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#e34ca10986e72600bcd62707dff6fd99">DL2_num_PF</a> = 0;
<a name="l00281"></a>00281     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#c9dbdd85b01ac41d232da64808bf70e5">prefetch_on_miss</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#41533c60a994d26ca8f1416e9d97e0fa">DL2_PF_on_miss</a>;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#33b4c70f19ea323d92f12d023e14f8ec">PFF_size</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#7bed9bef873af10719a4f7612db00824">DL2_PFFsize</a>;
<a name="l00284"></a>00284     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a> = (<a class="code" href="structcache__t_1_1PFF__t.html">cache_t::PFF_t</a>*) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#7bed9bef873af10719a4f7612db00824">DL2_PFFsize</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a>));
<a name="l00285"></a>00285     <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a>)
<a name="l00286"></a>00286       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc %s's prefetch FIFO"</span>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#b2a2c8eeb48b5f98cbd0265cce07aa6e">name</a>);
<a name="l00287"></a>00287     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#e7e8e385030eeff779f3286a13294045">prefetch_threshold</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#f8779dabfec7256680389be34001e97a">DL2_PFthresh</a>;
<a name="l00288"></a>00288     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#639a7ac5ea0206cfa35c8c86235bf7a4">prefetch_max</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#77aa906953a0ad27700ce772153e0a01">DL2_PFmax</a>;
<a name="l00289"></a>00289     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#a8c59fd868757f089f1c64b4fd962974">PF_low_watermark</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#ea62434debe2c605e5df42b24d8a2690">DL2_low_watermark</a>;
<a name="l00290"></a>00290     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#aa1cd32fa5467078fd28379cf03dd676">PF_high_watermark</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#f4104b47b939c9ba3524fc427e116520">DL2_high_watermark</a>;
<a name="l00291"></a>00291     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#53667e6a8c60a9c09eb66f41ecf7146d">PF_sample_interval</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#b8be3cd539aa8106287a59794c98b2e2">DL2_WMinterval</a>;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#8924d67219e4fbf56363be1d20d57d87">DL2_bus</a> = <a class="code" href="config_2zesto-cache_8cpp.html#cf58fdfdf1939cc2b0b05b50ac0eedd8">bus_create</a>(<span class="stringliteral">"DL2_bus"</span>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#788c5a8fba04b7d38c39e3e94879d454">linesize</a>,1);
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <span class="comment">/* per-core DL1 */</span>
<a name="l00297"></a>00297   <span class="keywordflow">if</span>(sscanf(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#6bba6cdbf4da0735e0d2fcb62abd267a">DL1_opt_str</a>,<span class="stringliteral">"%[^:]:%d:%d:%d:%d:%d:%d:%c:%c:%c:%d:%d:%c"</span>,
<a name="l00298"></a>00298       name,&amp;sets,&amp;assoc,&amp;linesize,&amp;banks,&amp;bank_width,&amp;latency,&amp;rp,&amp;ap,&amp;wp, &amp;MSHR_entries, &amp;WBB_entries, &amp;wc) != 13)
<a name="l00299"></a>00299     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"invalid DL1 options: &lt;name:sets:assoc:linesize:banks:bank-width:latency:repl-policy:alloc-policy:write-policy:num-MSHR:WB-buffers:write-combining&gt;\n\t(%s)"</span>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#6bba6cdbf4da0735e0d2fcb62abd267a">DL1_opt_str</a>);
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>)
<a name="l00302"></a>00302     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa1d22ad1643074e988a0af228750966eb4">CACHE_READWRITE</a>,sets,assoc,linesize,
<a name="l00303"></a>00303                              rp,ap,wp,wc,banks,bank_width,latency,
<a name="l00304"></a>00304                              WBB_entries,MSHR_entries,1,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#8924d67219e4fbf56363be1d20d57d87">DL2_bus</a>);
<a name="l00305"></a>00305   <span class="keywordflow">else</span>
<a name="l00306"></a>00306     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa1d22ad1643074e988a0af228750966eb4">CACHE_READWRITE</a>,sets,assoc,linesize,
<a name="l00307"></a>00307                              rp,ap,wp,wc,banks,bank_width,latency,
<a name="l00308"></a>00308                              WBB_entries,MSHR_entries,1,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#d6b074e9f80776c006cf1d399219d111">LLC_bus</a>);
<a name="l00309"></a>00309   <span class="keywordflow">if</span>(!knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#c424ee99e6a7cbba14b0ebd96f47b82b">DL1_MSHR_cmd</a> || !strcasecmp(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#c424ee99e6a7cbba14b0ebd96f47b82b">DL1_MSHR_cmd</a>,<span class="stringliteral">"fcfs"</span>))
<a name="l00310"></a>00310     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;MSHR_cmd_order = NULL;
<a name="l00311"></a>00311   <span class="keywordflow">else</span>
<a name="l00312"></a>00312   {
<a name="l00313"></a>00313     <span class="keywordflow">if</span>(strlen(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#c424ee99e6a7cbba14b0ebd96f47b82b">DL1_MSHR_cmd</a>) != 4)
<a name="l00314"></a>00314       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"-dl1:mshr_cmd must either be \"fcfs\" or contain all four of [RWBP]"</span>);
<a name="l00315"></a>00315     <span class="keywordtype">bool</span> R_seen = <span class="keyword">false</span>;
<a name="l00316"></a>00316     <span class="keywordtype">bool</span> W_seen = <span class="keyword">false</span>;
<a name="l00317"></a>00317     <span class="keywordtype">bool</span> B_seen = <span class="keyword">false</span>;
<a name="l00318"></a>00318     <span class="keywordtype">bool</span> P_seen = <span class="keyword">false</span>;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;MSHR_cmd_order = (<span class="keyword">enum</span> <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255">cache_command</a>*)calloc(4,<span class="keyword">sizeof</span>(<span class="keyword">enum</span> <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255">cache_command</a>));
<a name="l00321"></a>00321     <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;MSHR_cmd_order)
<a name="l00322"></a>00322       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc MSHR_cmd_order array for DL1"</span>);
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0;c&lt;4;c++)
<a name="l00325"></a>00325     {
<a name="l00326"></a>00326       <span class="keywordflow">switch</span>(<a class="code" href="misc_8h.html#e9332e6ace7e2352b856c2a76bd9ef43">mytoupper</a>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#c424ee99e6a7cbba14b0ebd96f47b82b">DL1_MSHR_cmd</a>[c]))
<a name="l00327"></a>00327       {
<a name="l00328"></a>00328         <span class="keywordflow">case</span> <span class="charliteral">'R'</span>: <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;MSHR_cmd_order[c] = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>; R_seen = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l00329"></a>00329         <span class="keywordflow">case</span> <span class="charliteral">'W'</span>: <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;MSHR_cmd_order[c] = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255f31232fbf9e45b41922cf68b09a4a201">CACHE_WRITE</a>; W_seen = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l00330"></a>00330         <span class="keywordflow">case</span> <span class="charliteral">'B'</span>: <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;MSHR_cmd_order[c] = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb25532d220872fec4028b8b25e094c84837c">CACHE_WRITEBACK</a>; B_seen = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l00331"></a>00331         <span class="keywordflow">case</span> <span class="charliteral">'P'</span>: <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;MSHR_cmd_order[c] = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb25537348416545a4253a253b1a4371e6ccf">CACHE_PREFETCH</a>; P_seen = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l00332"></a>00332         <span class="keywordflow">default</span>: <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"unknown cache operation '%c' for -dl1:mshr_cmd; must be one of [RWBP]"</span>);
<a name="l00333"></a>00333       }
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335     <span class="keywordflow">if</span>(!R_seen || !W_seen || !B_seen || !P_seen)
<a name="l00336"></a>00336       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"-dl1:mshr_cmd must contain *each* of [RWBP]"</span>);
<a name="l00337"></a>00337   }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a> = (<span class="keyword">struct </span><a class="code" href="classprefetch__t.html">prefetch_t</a>**) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#d2e3e855a3211975e29bcfc575ecc9c1">DL1_num_PF</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>));
<a name="l00340"></a>00340   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#9c4419121e831734dd6e738ddddb4d2e">num_prefetchers</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#d2e3e855a3211975e29bcfc575ecc9c1">DL1_num_PF</a>;
<a name="l00341"></a>00341   <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>)
<a name="l00342"></a>00342     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc %s's prefetcher array"</span>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#b2a2c8eeb48b5f98cbd0265cce07aa6e">name</a>);
<a name="l00343"></a>00343   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#d2e3e855a3211975e29bcfc575ecc9c1">DL1_num_PF</a>;i++)
<a name="l00344"></a>00344     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>[i] = <a class="code" href="zesto-prefetch_8cpp.html#3d85e6268083839e3f4f31e038f204a8">prefetch_create</a>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#35a66a170baf0e1b69bd3d531150b14a">DL1PF_opt_str</a>[i],<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>);
<a name="l00345"></a>00345   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>[0] == NULL)
<a name="l00346"></a>00346     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#9c4419121e831734dd6e738ddddb4d2e">num_prefetchers</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#d2e3e855a3211975e29bcfc575ecc9c1">DL1_num_PF</a> = 0;
<a name="l00347"></a>00347   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#c9dbdd85b01ac41d232da64808bf70e5">prefetch_on_miss</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#e30cc01edd035359b3ba3e5aaa3591ff">DL1_PF_on_miss</a>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#33b4c70f19ea323d92f12d023e14f8ec">PFF_size</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#20cc172363c48ad386a7f7f42300df02">DL1_PFFsize</a>;
<a name="l00350"></a>00350   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a> = (<a class="code" href="structcache__t_1_1PFF__t.html">cache_t::PFF_t</a>*) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#20cc172363c48ad386a7f7f42300df02">DL1_PFFsize</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a>));
<a name="l00351"></a>00351   <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a>)
<a name="l00352"></a>00352     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc %s's prefetch FIFO"</span>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#b2a2c8eeb48b5f98cbd0265cce07aa6e">name</a>);
<a name="l00353"></a>00353   <a class="code" href="config_2zesto-cache_8cpp.html#16dacff1f1e08b2a7fe82d35f3733f91">prefetch_buffer_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#a69d601f13eb0da6ccd2f71a1fe75386">DL1_PF_buffer_size</a>);
<a name="l00354"></a>00354   <a class="code" href="config_2zesto-cache_8cpp.html#81be4d7fbc22a3d9f3fcaa52715c22e9">prefetch_filter_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#bc3707a7222d850e58d39e39548758dd">DL1_PF_filter_size</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#33cea2b9906773001218a0f31f78190b">DL1_PF_filter_reset</a>);
<a name="l00355"></a>00355   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#e7e8e385030eeff779f3286a13294045">prefetch_threshold</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#7403e7f5317b6f4e5c803b34e1fde836">DL1_PFthresh</a>;
<a name="l00356"></a>00356   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#639a7ac5ea0206cfa35c8c86235bf7a4">prefetch_max</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#3a9c99e092f8473fd91c1428f39ed344">DL1_PFmax</a>;
<a name="l00357"></a>00357   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#a8c59fd868757f089f1c64b4fd962974">PF_low_watermark</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#bddaa0dfa1d78c33e2b11ae26acffe7c">DL1_low_watermark</a>;
<a name="l00358"></a>00358   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#aa1cd32fa5467078fd28379cf03dd676">PF_high_watermark</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#2a93ace0d23a13f282dd982945d58f4d">DL1_high_watermark</a>;
<a name="l00359"></a>00359   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#53667e6a8c60a9c09eb66f41ecf7146d">PF_sample_interval</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#99ea66c8d39b0341339324532e76f913">DL1_WMinterval</a>;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>)
<a name="l00362"></a>00362   {
<a name="l00363"></a>00363         <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#1e23c1c031a25966dd96bd54c3862c2e">prev_level</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>;
<a name="l00364"></a>00364         <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>-&gt;<a class="code" href="structcache__t.html#1e23c1c031a25966dd96bd54c3862c2e">prev_level</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>;
<a name="l00365"></a>00365   }<span class="keywordflow">else</span> <span class="comment">//TODO this works for single core per tile, for multiple cores we need to do this for every core</span>
<a name="l00366"></a>00366   {
<a name="l00367"></a>00367         <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>-&gt;<a class="code" href="structcache__t.html#1e23c1c031a25966dd96bd54c3862c2e">prev_level</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>;
<a name="l00368"></a>00368   }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <span class="comment">/* DTLBs */</span>
<a name="l00371"></a>00371 
<a name="l00372"></a>00372   <span class="comment">/* DTLB2 */</span>
<a name="l00373"></a>00373   <span class="keywordflow">if</span>(!strcasecmp(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#da62853f63953881b5459167a9c5737b">DTLB2_opt_str</a>,<span class="stringliteral">"none"</span>))
<a name="l00374"></a>00374   {
<a name="l00375"></a>00375     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a> = NULL;
<a name="l00376"></a>00376     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5c59f3f4dafe66ce402afea3b3b73b59">DTLB_bus</a> = NULL;
<a name="l00377"></a>00377   }
<a name="l00378"></a>00378   <span class="keywordflow">else</span>
<a name="l00379"></a>00379   {
<a name="l00380"></a>00380     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5c59f3f4dafe66ce402afea3b3b73b59">DTLB_bus</a> = <a class="code" href="config_2zesto-cache_8cpp.html#cf58fdfdf1939cc2b0b05b50ac0eedd8">bus_create</a>(<span class="stringliteral">"DTLB_bus"</span>,1,1);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="keywordflow">if</span>(sscanf(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#da62853f63953881b5459167a9c5737b">DTLB2_opt_str</a>,<span class="stringliteral">"%[^:]:%d:%d:%d:%d:%c:%d"</span>,
<a name="l00383"></a>00383         name,&amp;sets,&amp;assoc,&amp;banks,&amp;latency, &amp;rp, &amp;MSHR_entries) != 7)
<a name="l00384"></a>00384       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"invalid DTLB2 options: &lt;name:sets:assoc:banks:latency:repl-policy:num-MSHR&gt;"</span>);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>)
<a name="l00387"></a>00387       <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa139ba0426a3586969e21ebb44709e8de3">CACHE_READONLY</a>,sets,assoc,1,rp,<span class="charliteral">'w'</span>,<span class="charliteral">'t'</span>,<span class="charliteral">'n'</span>,banks,1,latency,4,MSHR_entries,1,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#8924d67219e4fbf56363be1d20d57d87">DL2_bus</a>); <span class="comment">/* on a complete TLB miss, go to the L2 cache to simulate the traffic from a HW page-table walker */</span>
<a name="l00388"></a>00388     <span class="keywordflow">else</span>
<a name="l00389"></a>00389       <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa139ba0426a3586969e21ebb44709e8de3">CACHE_READONLY</a>,sets,assoc,1,rp,<span class="charliteral">'w'</span>,<span class="charliteral">'t'</span>,<span class="charliteral">'n'</span>,banks,1,latency,4,MSHR_entries,1,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#d6b074e9f80776c006cf1d399219d111">LLC_bus</a>); <span class="comment">/* on a complete TLB miss, go to the LLC to simulate the traffic from a HW page-table walker */</span>
<a name="l00390"></a>00390     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>-&gt;MSHR_cmd_order = NULL;
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393   <span class="comment">/* DTLB */</span>
<a name="l00394"></a>00394   <span class="keywordflow">if</span>(sscanf(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#3c4cb1fda100504efeec7a6559ccad90">DTLB_opt_str</a>,<span class="stringliteral">"%[^:]:%d:%d:%d:%d:%c:%d"</span>,
<a name="l00395"></a>00395       name,&amp;sets,&amp;assoc,&amp;banks,&amp;latency, &amp;rp, &amp;MSHR_entries) != 7)
<a name="l00396"></a>00396     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"invalid DTLB options: &lt;name:sets:assoc:banks:latency:repl-policy:num-MSHR&gt;"</span>);
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>)
<a name="l00399"></a>00399   {
<a name="l00400"></a>00400     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa139ba0426a3586969e21ebb44709e8de3">CACHE_READONLY</a>,sets,assoc,1,rp,<span class="charliteral">'w'</span>,<span class="charliteral">'t'</span>,<span class="charliteral">'n'</span>,banks,1,latency,4,MSHR_entries,1,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5c59f3f4dafe66ce402afea3b3b73b59">DTLB_bus</a>);
<a name="l00401"></a>00401     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>-&gt;MSHR_cmd_order = NULL;
<a name="l00402"></a>00402   }
<a name="l00403"></a>00403   <span class="keywordflow">else</span>
<a name="l00404"></a>00404   {
<a name="l00405"></a>00405     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa139ba0426a3586969e21ebb44709e8de3">CACHE_READONLY</a>,sets,assoc,1,rp,<span class="charliteral">'w'</span>,<span class="charliteral">'t'</span>,<span class="charliteral">'n'</span>,banks,1,latency,4,MSHR_entries,1,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#d6b074e9f80776c006cf1d399219d111">LLC_bus</a>);
<a name="l00406"></a>00406     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>-&gt;MSHR_cmd_order = NULL;
<a name="l00407"></a>00407   }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="comment">/************************************/</span>
<a name="l00411"></a>00411   <span class="comment">/* execution port payload pipelines */</span>
<a name="l00412"></a>00412   <span class="comment">/************************************/</span>
<a name="l00413"></a>00413   <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a> = (<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html">core_exec_DPM_t::exec_port_t</a>*) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>));
<a name="l00414"></a>00414   <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>)
<a name="l00415"></a>00415     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc exec ports"</span>);
<a name="l00416"></a>00416   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>;i++)
<a name="l00417"></a>00417   {
<a name="l00418"></a>00418     <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a> = (<span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">uop_action_t</a>*) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#9d2834576ea4ae6471d9538548107973">payload_depth</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>));
<a name="l00419"></a>00419     <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].payload_pipe)
<a name="l00420"></a>00420       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc payload pipe"</span>);
<a name="l00421"></a>00421   }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   <span class="comment">/***************************/</span>
<a name="l00424"></a>00424   <span class="comment">/* execution port bindings */</span>
<a name="l00425"></a>00425   <span class="comment">/***************************/</span>
<a name="l00426"></a>00426   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97da49fe5b0d01f8dfc89086f720a6bb807">NUM_FU_CLASSES</a>;i++)
<a name="l00427"></a>00427   {
<a name="l00428"></a>00428     <span class="keywordtype">int</span> j;
<a name="l00429"></a>00429     knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[i].ports = (<span class="keywordtype">int</span>*) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[i].num_FUs,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00430"></a>00430     <span class="keywordflow">if</span>(!knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[i].ports) <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc %s ports"</span>,<a class="code" href="machine_8h.html#cf467ef6d9acd36a197e6af289afdf00">MD_FU_NAME</a>(i));
<a name="l00431"></a>00431     <span class="keywordflow">for</span>(j=0;j&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[i].num_FUs;j++)
<a name="l00432"></a>00432     {
<a name="l00433"></a>00433       <span class="keywordflow">if</span>((knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[i][j] &lt; 0) || (knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[i][j] &gt;= knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>))
<a name="l00434"></a>00434         <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"port binding for %s is negative or exceeds the execution width (should be &gt; 0 and &lt; %d)"</span>,<a class="code" href="machine_8h.html#cf467ef6d9acd36a197e6af289afdf00">MD_FU_NAME</a>(i),knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>);
<a name="l00435"></a>00435       knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[i].ports[j] = knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[i][j];
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437   }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439   <span class="comment">/***************************************/</span>
<a name="l00440"></a>00440   <span class="comment">/* functional unit execution pipelines */</span>
<a name="l00441"></a>00441   <span class="comment">/***************************************/</span>
<a name="l00442"></a>00442   <span class="keywordflow">for</span>(i=0;i&lt;NUM_FU_CLASSES;i++)
<a name="l00443"></a>00443   {
<a name="l00444"></a>00444     <span class="keywordtype">int</span> j;
<a name="l00445"></a>00445     <span class="keywordflow">for</span>(j=0;j&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[i].num_FUs;j++)
<a name="l00446"></a>00446     {
<a name="l00447"></a>00447       <span class="keywordtype">int</span> port_num = knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[i].ports[j];
<a name="l00448"></a>00448       <span class="keywordtype">int</span> latency = knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[i];
<a name="l00449"></a>00449       <span class="keywordtype">int</span> issue_rate = knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[i];
<a name="l00450"></a>00450       <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[i] = (<span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">ALU_t</a>*) calloc(1,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">ALU_t</a>));
<a name="l00451"></a>00451       <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].FU[i])
<a name="l00452"></a>00452         <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc IEU"</span>);
<a name="l00453"></a>00453       <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[i]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">latency</a> = latency;
<a name="l00454"></a>00454       <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[i]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a565898e067059987f9836d533bffbe9">issue_rate</a> = issue_rate;
<a name="l00455"></a>00455       <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[i]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a> = (<span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">uop_action_t</a>*) calloc(latency,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">uop_action_t</a>));
<a name="l00456"></a>00456       <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].FU[i]-&gt;pipe)
<a name="l00457"></a>00457         <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc %s function unit execution pipeline"</span>,<a class="code" href="machine_8h.html#cf467ef6d9acd36a197e6af289afdf00">MD_FU_NAME</a>(i));
<a name="l00458"></a>00458 
<a name="l00459"></a>00459       <span class="keywordflow">if</span>(i==<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>) <span class="comment">/* load has AGEN and STQ access pipelines */</span>
<a name="l00460"></a>00460       {
<a name="l00461"></a>00461         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a> = (<span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">ALU_t</a>*) calloc(1,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">ALU_t</a>));
<a name="l00462"></a>00462         latency = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#85aa054d657c7a242147602cb1fff479">latency</a>; <span class="comment">/* assume STQ latency matched to DL1's */</span>
<a name="l00463"></a>00463         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">latency</a> = latency;
<a name="l00464"></a>00464         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a565898e067059987f9836d533bffbe9">issue_rate</a> = issue_rate;
<a name="l00465"></a>00465         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a> = (<span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">uop_action_t</a>*) calloc(latency,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html">uop_action_t</a>));
<a name="l00466"></a>00466         <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>-&gt;pipe)
<a name="l00467"></a>00467           <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc load's STQ exec pipe on port %d"</span>,j);
<a name="l00468"></a>00468       }
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470   }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472   <span class="comment">/* shortened list of the FU's available on each port (to speed up FU loop in ALU_exec) */</span>
<a name="l00473"></a>00473   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>;i++)
<a name="l00474"></a>00474   {
<a name="l00475"></a>00475     <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#2447d80ac9daa272dc0d2c5af375cf8e">num_FU_types</a> = 0;
<a name="l00476"></a>00476     <span class="keywordtype">int</span> j;
<a name="l00477"></a>00477     <span class="keywordflow">for</span>(j=0;j&lt;NUM_FU_CLASSES;j++)
<a name="l00478"></a>00478       <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].FU[j])
<a name="l00479"></a>00479         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#2447d80ac9daa272dc0d2c5af375cf8e">num_FU_types</a>++;
<a name="l00480"></a>00480     <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].FU_types = (<span class="keyword">enum</span> <a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d">md_fu_class</a> *)calloc(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].num_FU_types,<span class="keyword">sizeof</span>(<span class="keyword">enum</span> <a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d">md_fu_class</a>));
<a name="l00481"></a>00481     <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].FU_types)
<a name="l00482"></a>00482       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc FU_types array on port %d"</span>,i);
<a name="l00483"></a>00483     <span class="keywordtype">int</span> k=0;
<a name="l00484"></a>00484     <span class="keywordflow">for</span>(j=0;j&lt;NUM_FU_CLASSES;j++)
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486       <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].FU[j])
<a name="l00487"></a>00487       {
<a name="l00488"></a>00488         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].FU_types[k] = (<span class="keyword">enum</span> <a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d">md_fu_class</a>)j;
<a name="l00489"></a>00489         k++;
<a name="l00490"></a>00490       }
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492   }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495   <a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">memdep</a> = <a class="code" href="zesto-memdep_8cpp.html#0dd797035955474899f1ead13d08ddc0">memdep_create</a>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#925b29ffee0615d4f8f59f66ada01eaa">memdep_opt_str</a>);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <a class="code" href="classcore__exec__DPM__t.html#1481184b99dd1dca8a0e570980bf1abc">check_for_work</a> = <span class="keyword">true</span>;
<a name="l00498"></a>00498 }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500 <span class="keywordtype">void</span>
<a name="l00501"></a><a class="code" href="classcore__exec__DPM__t.html#a91990c6b68df8151ad572381551c204">00501</a> <a class="code" href="classcore__exec__DPM__t.html#a91990c6b68df8151ad572381551c204">core_exec_DPM_t::reg_stats</a>(<span class="keyword">struct</span> <a class="code" href="structstat__sdb__t.html">stat_sdb_t</a> * <span class="keyword">const</span> sdb)
<a name="l00502"></a>00502 {
<a name="l00503"></a>00503   <span class="keywordtype">char</span> buf[1024];
<a name="l00504"></a>00504   <span class="keywordtype">char</span> buf2[1024];
<a name="l00505"></a>00505   <span class="keyword">struct </span><a class="code" href="structthread__t.html">thread_t</a> * arch = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   <a class="code" href="zesto_2stats_8h.html#ed9b9c4535e4fc2e59a090d6e8157d4f">stat_reg_note</a>(sdb,<span class="stringliteral">"#### EXEC STATS ####"</span>);
<a name="l00508"></a>00508   sprintf(buf,<span class="stringliteral">"c%d.exec_uops_issued"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00509"></a>00509   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"number of uops issued"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#104d279c5246d5f2c940f18dfcdb3908">exec_uops_issued</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#104d279c5246d5f2c940f18dfcdb3908">exec_uops_issued</a>, NULL);
<a name="l00510"></a>00510   sprintf(buf,<span class="stringliteral">"c%d.exec_uPC"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00511"></a>00511   sprintf(buf2,<span class="stringliteral">"c%d.exec_uops_issued/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00512"></a>00512   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"average number of uops executed per cycle"</span>, buf2, NULL);
<a name="l00513"></a>00513   sprintf(buf,<span class="stringliteral">"c%d.exec_uops_replayed"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00514"></a>00514   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"number of uops replayed"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#b005a5cbe605689ec13b19d653471fcf">exec_uops_replayed</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#b005a5cbe605689ec13b19d653471fcf">exec_uops_replayed</a>, NULL);
<a name="l00515"></a>00515   sprintf(buf,<span class="stringliteral">"c%d.exec_avg_replays"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00516"></a>00516   sprintf(buf2,<span class="stringliteral">"c%d.exec_uops_replayed/c%d.exec_uops_issued"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00517"></a>00517   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"average replays per uop"</span>, buf2, NULL);
<a name="l00518"></a>00518   sprintf(buf,<span class="stringliteral">"c%d.exec_uops_snatched"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00519"></a>00519   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"number of uops snatched-back"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#4236da8517eb44a608d141215bdf23cc">exec_uops_snatched_back</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#4236da8517eb44a608d141215bdf23cc">exec_uops_snatched_back</a>, NULL);
<a name="l00520"></a>00520   sprintf(buf,<span class="stringliteral">"c%d.exec_avg_snatched"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00521"></a>00521   sprintf(buf2,<span class="stringliteral">"c%d.exec_uops_snatched/c%d.exec_uops_issued"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00522"></a>00522   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"average snatch-backs per uop"</span>, buf2, NULL);
<a name="l00523"></a>00523   sprintf(buf,<span class="stringliteral">"c%d.num_jeclear"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00524"></a>00524   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"number of branch mispredictions"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e6a4a159e00e9d5b93db9544015f98f7">num_jeclear</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e6a4a159e00e9d5b93db9544015f98f7">num_jeclear</a>, NULL);
<a name="l00525"></a>00525   sprintf(buf,<span class="stringliteral">"c%d.num_wp_jeclear"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00526"></a>00526   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"number of branch mispredictions in the shadow of an earlier mispred"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#33a60de88faadccd45eacdf575271002">num_wp_jeclear</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#33a60de88faadccd45eacdf575271002">num_wp_jeclear</a>, NULL);
<a name="l00527"></a>00527   sprintf(buf,<span class="stringliteral">"c%d.load_nukes"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00528"></a>00528   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"num pipeflushes due to load-store order violation"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#39d7d4fa63d61b57d7b92c14827c0704">load_nukes</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#39d7d4fa63d61b57d7b92c14827c0704">load_nukes</a>, NULL);
<a name="l00529"></a>00529   sprintf(buf,<span class="stringliteral">"c%d.wp_load_nukes"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00530"></a>00530   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"num pipeflushes due to load-store order violation on wrong-path"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#285541b5146d15da412fb1475e647123">wp_load_nukes</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#285541b5146d15da412fb1475e647123">wp_load_nukes</a>, NULL);
<a name="l00531"></a>00531   sprintf(buf,<span class="stringliteral">"c%d.DL1_load_split_accesses"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00532"></a>00532   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"number of loads requiring split accesses"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#bb877e542f5f8d359cdf905408babf06">DL1_load_split_accesses</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#bb877e542f5f8d359cdf905408babf06">DL1_load_split_accesses</a>, NULL);
<a name="l00533"></a>00533   sprintf(buf,<span class="stringliteral">"c%d.DL1_load_split_frac"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00534"></a>00534   sprintf(buf2,<span class="stringliteral">"c%d.DL1_load_split_accesses/(c%d.DL1.load_lookups-c%d.DL1_load_split_accesses)"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>); <span class="comment">/* need to subtract since each split access generated two load accesses */</span>
<a name="l00535"></a>00535   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of loads requiring split accesses"</span>, buf2, NULL);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537   sprintf(buf,<span class="stringliteral">"c%d.RS_occupancy"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00538"></a>00538   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">false</span>, buf, <span class="stringliteral">"total RS occupancy"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e60b98f996e4dbbb1b186dbe35c1e234">RS_occupancy</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e60b98f996e4dbbb1b186dbe35c1e234">RS_occupancy</a>, NULL);
<a name="l00539"></a>00539   sprintf(buf,<span class="stringliteral">"c%d.RS_eff_occupancy"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00540"></a>00540   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">false</span>, buf, <span class="stringliteral">"total RS effective occupancy"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#95b31bd7f27932f8fe38fccbdda7ba38">RS_eff_occupancy</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#95b31bd7f27932f8fe38fccbdda7ba38">RS_eff_occupancy</a>, NULL);
<a name="l00541"></a>00541   sprintf(buf,<span class="stringliteral">"c%d.RS_empty"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00542"></a>00542   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">false</span>, buf, <span class="stringliteral">"total cycles RS was empty"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e8a8753db2b224c53929e248798f601b">RS_empty_cycles</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e8a8753db2b224c53929e248798f601b">RS_empty_cycles</a>, NULL);
<a name="l00543"></a>00543   sprintf(buf,<span class="stringliteral">"c%d.RS_full"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00544"></a>00544   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">false</span>, buf, <span class="stringliteral">"total cycles RS was full"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#23382493b536f19ec3983eca2a0ba39a">RS_full_cycles</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#23382493b536f19ec3983eca2a0ba39a">RS_full_cycles</a>, NULL);
<a name="l00545"></a>00545   sprintf(buf,<span class="stringliteral">"c%d.RS_avg"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00546"></a>00546   sprintf(buf2,<span class="stringliteral">"c%d.RS_occupancy/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00547"></a>00547   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"average RS occupancy"</span>, buf2, NULL);
<a name="l00548"></a>00548   sprintf(buf,<span class="stringliteral">"c%d.RS_eff_avg"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00549"></a>00549   sprintf(buf2,<span class="stringliteral">"c%d.RS_eff_occupancy/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00550"></a>00550   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"effective average RS occupancy"</span>, buf2, NULL);
<a name="l00551"></a>00551   sprintf(buf,<span class="stringliteral">"c%d.RS_frac_empty"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00552"></a>00552   sprintf(buf2,<span class="stringliteral">"c%d.RS_empty/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00553"></a>00553   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of cycles RS was empty"</span>, buf2, NULL);
<a name="l00554"></a>00554   sprintf(buf,<span class="stringliteral">"c%d.RS_frac_full"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00555"></a>00555   sprintf(buf2,<span class="stringliteral">"c%d.RS_full/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00556"></a>00556   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of cycles RS was full"</span>, buf2, NULL);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558   sprintf(buf,<span class="stringliteral">"c%d.LDQ_occupancy"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00559"></a>00559   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total LDQ occupancy"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e1d79fd0bb4a1ed80afb00241258a6a2">LDQ_occupancy</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e1d79fd0bb4a1ed80afb00241258a6a2">LDQ_occupancy</a>, NULL);
<a name="l00560"></a>00560   sprintf(buf,<span class="stringliteral">"c%d.LDQ_empty"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00561"></a>00561   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total cycles LDQ was empty"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#4371248c98020ddd54dcf55af58c2711">LDQ_empty_cycles</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#4371248c98020ddd54dcf55af58c2711">LDQ_empty_cycles</a>, NULL);
<a name="l00562"></a>00562   sprintf(buf,<span class="stringliteral">"c%d.LDQ_full"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00563"></a>00563   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total cycles LDQ was full"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#b0b5be3619f63b56564dcc8bd071498c">LDQ_full_cycles</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#b0b5be3619f63b56564dcc8bd071498c">LDQ_full_cycles</a>, NULL);
<a name="l00564"></a>00564   sprintf(buf,<span class="stringliteral">"c%d.LDQ_avg"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00565"></a>00565   sprintf(buf2,<span class="stringliteral">"c%d.LDQ_occupancy/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00566"></a>00566   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"average LDQ occupancy"</span>, buf2, NULL);
<a name="l00567"></a>00567   sprintf(buf,<span class="stringliteral">"c%d.LDQ_frac_empty"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00568"></a>00568   sprintf(buf2,<span class="stringliteral">"c%d.LDQ_empty/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00569"></a>00569   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of cycles LDQ was empty"</span>, buf2, NULL);
<a name="l00570"></a>00570   sprintf(buf,<span class="stringliteral">"c%d.LDQ_frac_full"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00571"></a>00571   sprintf(buf2,<span class="stringliteral">"c%d.LDQ_full/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00572"></a>00572   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of cycles LDQ was full"</span>, buf2, NULL);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574   sprintf(buf,<span class="stringliteral">"c%d.STQ_occupancy"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00575"></a>00575   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total STQ occupancy"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#f3d2158ddddc0b2516fa0ffb92a21aad">STQ_occupancy</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#f3d2158ddddc0b2516fa0ffb92a21aad">STQ_occupancy</a>, NULL);
<a name="l00576"></a>00576   sprintf(buf,<span class="stringliteral">"c%d.STQ_empty"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00577"></a>00577   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total cycles STQ was empty"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#06d788186a25803ec4a760efceee91dd">STQ_empty_cycles</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#06d788186a25803ec4a760efceee91dd">STQ_empty_cycles</a>, NULL);
<a name="l00578"></a>00578   sprintf(buf,<span class="stringliteral">"c%d.STQ_full"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00579"></a>00579   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total cycles STQ was full"</span>, &amp;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#ff713272c88f24d8fd792c082fa9e22b">STQ_full_cycles</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#ff713272c88f24d8fd792c082fa9e22b">STQ_full_cycles</a>, NULL);
<a name="l00580"></a>00580   sprintf(buf,<span class="stringliteral">"c%d.STQ_avg"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00581"></a>00581   sprintf(buf2,<span class="stringliteral">"c%d.STQ_occupancy/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00582"></a>00582   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"average STQ occupancy"</span>, buf2, NULL);
<a name="l00583"></a>00583   sprintf(buf,<span class="stringliteral">"c%d.STQ_frac_empty"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00584"></a>00584   sprintf(buf2,<span class="stringliteral">"c%d.STQ_empty/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00585"></a>00585   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of cycles STQ was empty"</span>, buf2, NULL);
<a name="l00586"></a>00586   sprintf(buf,<span class="stringliteral">"c%d.STQ_frac_full"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00587"></a>00587   sprintf(buf2,<span class="stringliteral">"c%d.STQ_full/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00588"></a>00588   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of cycles STQ was full"</span>, buf2, NULL);
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   <a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">memdep</a>-&gt;<a class="code" href="classmemdep__t.html#a1a98010c0e6d4008ae372469db6888b">reg_stats</a>(sdb, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>);
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <a class="code" href="zesto_2stats_8h.html#ed9b9c4535e4fc2e59a090d6e8157d4f">stat_reg_note</a>(sdb,<span class="stringliteral">"\n#### DATA CACHE STATS ####"</span>);
<a name="l00593"></a>00593   <a class="code" href="config_2zesto-cache_8cpp.html#80141f1bc8f06e0805162cdd6936c5d8">cache_reg_stats</a>(sdb, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>);
<a name="l00594"></a>00594   <a class="code" href="config_2zesto-cache_8cpp.html#80141f1bc8f06e0805162cdd6936c5d8">cache_reg_stats</a>(sdb, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>);
<a name="l00595"></a>00595   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>)
<a name="l00596"></a>00596     <a class="code" href="config_2zesto-cache_8cpp.html#80141f1bc8f06e0805162cdd6936c5d8">cache_reg_stats</a>(sdb, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>);
<a name="l00597"></a>00597   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>)
<a name="l00598"></a>00598     <a class="code" href="config_2zesto-cache_8cpp.html#80141f1bc8f06e0805162cdd6936c5d8">cache_reg_stats</a>(sdb, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>, <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>);
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a><a class="code" href="classcore__exec__DPM__t.html#0bd262cf902ac7ce2f03e713a73be273">00601</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#0bd262cf902ac7ce2f03e713a73be273">core_exec_DPM_t::freeze_stats</a>(<span class="keywordtype">void</span>)
<a name="l00602"></a>00602 {
<a name="l00603"></a>00603   <a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">memdep</a>-&gt;<a class="code" href="classmemdep__t.html#6a645b6566c350c8a76febb44b63d861">freeze_stats</a>();
<a name="l00604"></a>00604 }
<a name="l00605"></a>00605 
<a name="l00606"></a><a class="code" href="classcore__exec__DPM__t.html#3e2b3d9545dfa9554736df7a3b27e413">00606</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#3e2b3d9545dfa9554736df7a3b27e413">core_exec_DPM_t::update_occupancy</a>(<span class="keywordtype">void</span>)
<a name="l00607"></a>00607 {
<a name="l00608"></a>00608     <span class="comment">/* RS */</span>
<a name="l00609"></a>00609   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e60b98f996e4dbbb1b186dbe35c1e234">RS_occupancy</a> += <a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a>;
<a name="l00610"></a>00610   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#95b31bd7f27932f8fe38fccbdda7ba38">RS_eff_occupancy</a> += <a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a>;
<a name="l00611"></a>00611   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a> &gt;= <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a>)
<a name="l00612"></a>00612     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#23382493b536f19ec3983eca2a0ba39a">RS_full_cycles</a>++;
<a name="l00613"></a>00613   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a> &lt;= 0)
<a name="l00614"></a>00614     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e8a8753db2b224c53929e248798f601b">RS_empty_cycles</a>++;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     <span class="comment">/* LDQ */</span>
<a name="l00617"></a>00617   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e1d79fd0bb4a1ed80afb00241258a6a2">LDQ_occupancy</a> += <a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a>;
<a name="l00618"></a>00618   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a> &gt;= <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>)
<a name="l00619"></a>00619     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#b0b5be3619f63b56564dcc8bd071498c">LDQ_full_cycles</a>++;
<a name="l00620"></a>00620   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a> &lt;= 0)
<a name="l00621"></a>00621     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#4371248c98020ddd54dcf55af58c2711">LDQ_empty_cycles</a>++;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="comment">/* STQ */</span>
<a name="l00624"></a>00624   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#f3d2158ddddc0b2516fa0ffb92a21aad">STQ_occupancy</a> += <a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a>;
<a name="l00625"></a>00625   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a> &gt;= <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>)
<a name="l00626"></a>00626     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#ff713272c88f24d8fd792c082fa9e22b">STQ_full_cycles</a>++;
<a name="l00627"></a>00627   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a> &lt;= 0)
<a name="l00628"></a>00628     <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#06d788186a25803ec4a760efceee91dd">STQ_empty_cycles</a>++;
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 <span class="comment">/* Functions to support dependency tracking </span>
<a name="l00632"></a>00632 <span class="comment">   NOTE: "Ready" Queue is somewhat of a misnomer... uops are placed in the</span>
<a name="l00633"></a>00633 <span class="comment">   readyQ when all of their data-flow parents have issued (although not</span>
<a name="l00634"></a>00634 <span class="comment">   necessarily executed).  However, that doesn't necessarily mean that the</span>
<a name="l00635"></a>00635 <span class="comment">   corresponding input *values* are "ready" due to non-zero schedule-to-</span>
<a name="l00636"></a>00636 <span class="comment">   execute latencies. */</span>
<a name="l00637"></a><a class="code" href="classcore__exec__DPM__t.html#e34af919bd9180e611be4b5a34e8bc07">00637</a> <a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">core_exec_DPM_t::readyQ_node_t</a> * <a class="code" href="classcore__exec__DPM__t.html#e34af919bd9180e611be4b5a34e8bc07">core_exec_DPM_t::get_readyQ_node</a>(<span class="keywordtype">void</span>)
<a name="l00638"></a>00638 {
<a name="l00639"></a>00639   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * p = NULL;
<a name="l00640"></a>00640   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#b2ef8c59f6ac4dfeebd8bbbd538bdf03">readyQ_free_pool</a>)
<a name="l00641"></a>00641   {
<a name="l00642"></a>00642     p = <a class="code" href="classcore__exec__DPM__t.html#b2ef8c59f6ac4dfeebd8bbbd538bdf03">readyQ_free_pool</a>;
<a name="l00643"></a>00643     <a class="code" href="classcore__exec__DPM__t.html#b2ef8c59f6ac4dfeebd8bbbd538bdf03">readyQ_free_pool</a> = p-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a>;
<a name="l00644"></a>00644   }
<a name="l00645"></a>00645   <span class="keywordflow">else</span>
<a name="l00646"></a>00646   {
<a name="l00647"></a>00647     p = (<span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a>*) calloc(1,<span class="keyword">sizeof</span>(*p));
<a name="l00648"></a>00648     <span class="keywordflow">if</span>(!p)
<a name="l00649"></a>00649       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc a readyQ node"</span>);
<a name="l00650"></a>00650   }
<a name="l00651"></a>00651   assert(p);
<a name="l00652"></a>00652   p-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a> = NULL;
<a name="l00653"></a>00653   p-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#256395ddefdb2a4678c27bc02e6c6303">when_assigned</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00654"></a>00654 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00655"></a>00655 <span class="preprocessor"></span>  readyQ_free_pool_debt++;
<a name="l00656"></a>00656 <span class="preprocessor">#endif</span>
<a name="l00657"></a>00657 <span class="preprocessor"></span>  <span class="keywordflow">return</span> p;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a><a class="code" href="classcore__exec__DPM__t.html#4fa6c3d9f286a7aa26305e2049ebcc14">00660</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#4fa6c3d9f286a7aa26305e2049ebcc14">core_exec_DPM_t::return_readyQ_node</a>(<span class="keyword">struct</span> <a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * <span class="keyword">const</span> p)
<a name="l00661"></a>00661 {
<a name="l00662"></a>00662   assert(p);
<a name="l00663"></a>00663   assert(p-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#b3f3a53da6ddc6d01c10a7c4ee968f2c">uop</a>);
<a name="l00664"></a>00664   p-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a> = <a class="code" href="classcore__exec__DPM__t.html#b2ef8c59f6ac4dfeebd8bbbd538bdf03">readyQ_free_pool</a>;
<a name="l00665"></a>00665   <a class="code" href="classcore__exec__DPM__t.html#b2ef8c59f6ac4dfeebd8bbbd538bdf03">readyQ_free_pool</a> = p;
<a name="l00666"></a>00666   p-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#b3f3a53da6ddc6d01c10a7c4ee968f2c">uop</a> = NULL;
<a name="l00667"></a>00667   p-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#256395ddefdb2a4678c27bc02e6c6303">when_assigned</a> = -1;
<a name="l00668"></a>00668 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00669"></a>00669 <span class="preprocessor"></span>  readyQ_free_pool_debt--;
<a name="l00670"></a>00670 <span class="preprocessor">#endif</span>
<a name="l00671"></a>00671 <span class="preprocessor"></span>}
<a name="l00672"></a>00672 
<a name="l00673"></a>00673 <span class="comment">/* Add the uop to the corresponding readyQ (based on port binding - we maintain</span>
<a name="l00674"></a>00674 <span class="comment">   one readyQ per execution port) */</span>
<a name="l00675"></a><a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">00675</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">core_exec_DPM_t::insert_ready_uop</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l00676"></a>00676 {
<a name="l00677"></a>00677   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00678"></a>00678   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>),(<span class="keywordtype">void</span>)0);
<a name="l00679"></a>00679   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l00680"></a>00680   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6a823830b3496618e63ce4486f60fe8c">when_exec</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l00681"></a>00681   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l00682"></a>00682   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(!uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a>,(<span class="keywordtype">void</span>)0);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> ** RQ = &amp;<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#46f43b948280321c354268669a523565">readyQ</a>;
<a name="l00685"></a>00685   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * new_node = <a class="code" href="classcore__exec__DPM__t.html#e34af919bd9180e611be4b5a34e8bc07">get_readyQ_node</a>();
<a name="l00686"></a>00686   new_node-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#b3f3a53da6ddc6d01c10a7c4ee968f2c">uop</a> = uop;
<a name="l00687"></a>00687   new_node-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#211d0b02c5ae04ec2034cf4be925469e">uop_seq</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>;
<a name="l00688"></a>00688   uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a> = <span class="keyword">true</span>;
<a name="l00689"></a>00689   uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l00690"></a>00690   new_node-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#5538521f28949dfa480704b9ef236be5">action_id</a> = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   <span class="keywordflow">if</span>(!*RQ) <span class="comment">/* empty ready queue */</span>
<a name="l00693"></a>00693   {
<a name="l00694"></a>00694     *RQ = new_node;
<a name="l00695"></a>00695     <span class="keywordflow">return</span>;
<a name="l00696"></a>00696   }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698   <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * current = *RQ, * prev = NULL;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700   <span class="comment">/* insert in age order: first find insertion point */</span>
<a name="l00701"></a>00701   <span class="keywordflow">while</span>(current &amp;&amp; (current-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#211d0b02c5ae04ec2034cf4be925469e">uop_seq</a> &lt; uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>))
<a name="l00702"></a>00702   {
<a name="l00703"></a>00703     prev = current;
<a name="l00704"></a>00704     current = current-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a>;
<a name="l00705"></a>00705   }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707   <span class="keywordflow">if</span>(!prev) <span class="comment">/* uop is oldest */</span>
<a name="l00708"></a>00708   {
<a name="l00709"></a>00709     new_node-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a> = *RQ;
<a name="l00710"></a>00710     *RQ = new_node;
<a name="l00711"></a>00711   }
<a name="l00712"></a>00712   <span class="keywordflow">else</span>
<a name="l00713"></a>00713   {
<a name="l00714"></a>00714     new_node-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a> = current;
<a name="l00715"></a>00715     prev-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a> = new_node;
<a name="l00716"></a>00716   }
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="comment">/*****************************/</span>
<a name="l00720"></a>00720 <span class="comment">/* MAIN SCHED/EXEC FUNCTIONS */</span>
<a name="l00721"></a>00721 <span class="comment">/*****************************/</span>
<a name="l00722"></a>00722 
<a name="l00723"></a><a class="code" href="classcore__exec__DPM__t.html#8151e39fd37a59e7616c15a7ba80d101">00723</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#8151e39fd37a59e7616c15a7ba80d101">core_exec_DPM_t::RS_schedule</a>(<span class="keywordtype">void</span>) <span class="comment">/* for uops in the RS */</span>
<a name="l00724"></a>00724 {
<a name="l00725"></a>00725   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00726"></a>00726   <span class="keywordtype">int</span> i;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   <span class="comment">/* select/pick from ready instructions and send to exec ports */</span>
<a name="l00729"></a>00729   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>;i++)
<a name="l00730"></a>00730   {
<a name="l00731"></a>00731     <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * rq = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#46f43b948280321c354268669a523565">readyQ</a>;
<a name="l00732"></a>00732     <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * prev = NULL;
<a name="l00733"></a>00733     <span class="keywordtype">int</span> issued = <span class="keyword">false</span>;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].payload_pipe[0].uop == NULL) <span class="comment">/* port is free */</span>
<a name="l00736"></a>00736       <span class="keywordflow">while</span>(rq) <span class="comment">/* if anyone's waiting to issue to this port */</span>
<a name="l00737"></a>00737       {
<a name="l00738"></a>00738         <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = rq-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#b3f3a53da6ddc6d01c10a7c4ee968f2c">uop</a>;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l00741"></a>00741 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> == <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>)
<a name="l00742"></a>00742           ztrace_print(uop,<span class="stringliteral">"e|ready|uop ready for scheduling"</span>);
<a name="l00743"></a>00743 <span class="preprocessor">#endif</span>
<a name="l00744"></a>00744 <span class="preprocessor"></span>
<a name="l00745"></a>00745         <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> != rq-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#5538521f28949dfa480704b9ef236be5">action_id</a>) <span class="comment">/* RQ entry has been squashed */</span>
<a name="l00746"></a>00746         {
<a name="l00747"></a>00747           <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * next = rq-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a>;
<a name="l00748"></a>00748           <span class="comment">/* remove from readyQ */</span>
<a name="l00749"></a>00749           <span class="keywordflow">if</span>(prev)
<a name="l00750"></a>00750             prev-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a> = next;
<a name="l00751"></a>00751           <span class="keywordflow">else</span>
<a name="l00752"></a>00752             <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#46f43b948280321c354268669a523565">readyQ</a> = next;
<a name="l00753"></a>00753           <a class="code" href="classcore__exec__DPM__t.html#4fa6c3d9f286a7aa26305e2049ebcc14">return_readyQ_node</a>(rq);
<a name="l00754"></a>00754           <span class="comment">/* and go on to next node */</span>
<a name="l00755"></a>00755           rq = next;
<a name="l00756"></a>00756         }
<a name="l00757"></a>00757         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>) &amp;&amp;
<a name="l00758"></a>00758                 !issued &amp;&amp;
<a name="l00759"></a>00759                 (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#156195a0d0889db67681f0900c044423">FU_class</a>]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#97be489796e116184c659aca796374d4">when_scheduleable</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>) &amp;&amp;
<a name="l00760"></a>00760                 ((!uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#831dde25d8ef14de7a0c73bc3a5fa3c9">in_fusion</a>) || uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#430e0f4aeb84fac91fc04ae7d31b5329">fusion_head</a>-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#c7b59f0c9f5dd616855772ccd50554ad">full_fusion_allocated</a>))
<a name="l00761"></a>00761         {
<a name="l00762"></a>00762           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a> == i,(<span class="keywordtype">void</span>)0);
<a name="l00763"></a>00763 
<a name="l00764"></a>00764           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = uop;
<a name="l00765"></a>00765           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#0adcd9ccf128d31dd9c5b3f122a63010">action_id</a> = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>;
<a name="l00766"></a>00766           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#aa00af896d341748fc352988cb528ce7">occupancy</a>++;
<a name="l00767"></a>00767           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].occupancy &lt;= knobs-&gt;exec.payload_depth,(<span class="keywordtype">void</span>)0);
<a name="l00768"></a>00768           uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00769"></a>00769           <a class="code" href="classcore__exec__DPM__t.html#1481184b99dd1dca8a0e570980bf1abc">check_for_work</a> = <span class="keyword">true</span>;
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l00772"></a>00772 <span class="preprocessor"></span>          ztrace_print(uop,<span class="stringliteral">"e|RS-issue|uop issued to payload RAM"</span>);
<a name="l00773"></a>00773 <span class="preprocessor">#endif</span>
<a name="l00774"></a>00774 <span class="preprocessor"></span>
<a name="l00775"></a>00775           <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>)
<a name="l00776"></a>00776           {
<a name="l00777"></a>00777             <span class="keywordtype">int</span> fp_penalty = <a class="code" href="machine_8h.html#68982a77353744eb45beec6d4075bb4b">REG_IS_FPR</a>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#6b25418271a661494d1ddd662cd1ecf8">odep_name</a>)?knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#1e0a19a190d0ecb6eb4fabb1a9b32d2d">fp_penalty</a>:0;
<a name="l00778"></a>00778             uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> + <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#156195a0d0889db67681f0900c044423">FU_class</a>]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">latency</a> + <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#85aa054d657c7a242147602cb1fff479">latency</a> + fp_penalty;
<a name="l00779"></a>00779           }
<a name="l00780"></a>00780           <span class="keywordflow">else</span>
<a name="l00781"></a>00781           {
<a name="l00782"></a>00782             <span class="keywordtype">int</span> fp_penalty = ((<a class="code" href="machine_8h.html#68982a77353744eb45beec6d4075bb4b">REG_IS_FPR</a>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#6b25418271a661494d1ddd662cd1ecf8">odep_name</a>) &amp;&amp; !(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#049e7e1cae99e04134e75e9f7f300a7b">opflags</a> &amp; <a class="code" href="machine_8h.html#96492ad3766dc5f2ef84c5ef6a197e11">F_FCOMP</a>)) ||
<a name="l00783"></a>00783                              (!<a class="code" href="machine_8h.html#68982a77353744eb45beec6d4075bb4b">REG_IS_FPR</a>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#6b25418271a661494d1ddd662cd1ecf8">odep_name</a>) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#049e7e1cae99e04134e75e9f7f300a7b">opflags</a> &amp; <a class="code" href="machine_8h.html#96492ad3766dc5f2ef84c5ef6a197e11">F_FCOMP</a>)))?knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#1e0a19a190d0ecb6eb4fabb1a9b32d2d">fp_penalty</a>:0;
<a name="l00784"></a>00784             uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> + <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#156195a0d0889db67681f0900c044423">FU_class</a>]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">latency</a> + fp_penalty;
<a name="l00785"></a>00785           }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#156195a0d0889db67681f0900c044423">FU_class</a>]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#97be489796e116184c659aca796374d4">when_scheduleable</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> + <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#156195a0d0889db67681f0900c044423">FU_class</a>]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a565898e067059987f9836d533bffbe9">issue_rate</a>;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789           <span class="comment">/* tag broadcast to dependents */</span>
<a name="l00790"></a>00790           <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l00791"></a>00791           <span class="keywordflow">while</span>(odep)
<a name="l00792"></a>00792           {
<a name="l00793"></a>00793             <span class="keywordtype">int</span> j;
<a name="l00794"></a>00794             <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> when_ready = 0;
<a name="l00795"></a>00795             odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a>;
<a name="l00796"></a>00796             <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;j++)
<a name="l00797"></a>00797             {
<a name="l00798"></a>00798               <span class="keywordflow">if</span>(when_ready &lt; odep-&gt;uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j])
<a name="l00799"></a>00799                 when_ready = odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j];
<a name="l00800"></a>00800             }
<a name="l00801"></a>00801             odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> = when_ready;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803             <span class="keywordflow">if</span>(when_ready &lt; <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00804"></a>00804               <a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">insert_ready_uop</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806             odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l00807"></a>00807           }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809           <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>)
<a name="l00810"></a>00810           {
<a name="l00811"></a>00811             <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l00812"></a>00812             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a> = <span class="keyword">true</span>;
<a name="l00813"></a>00813           }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815           <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html">readyQ_node_t</a> * next = rq-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a>;
<a name="l00816"></a>00816           <span class="comment">/* remove from readyQ */</span>
<a name="l00817"></a>00817           <span class="keywordflow">if</span>(prev)
<a name="l00818"></a>00818             prev-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a> = next;
<a name="l00819"></a>00819           <span class="keywordflow">else</span>
<a name="l00820"></a>00820             <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#46f43b948280321c354268669a523565">readyQ</a> = next;
<a name="l00821"></a>00821           <a class="code" href="classcore__exec__DPM__t.html#4fa6c3d9f286a7aa26305e2049ebcc14">return_readyQ_node</a>(rq);
<a name="l00822"></a>00822           uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a> = <span class="keyword">false</span>;
<a name="l00823"></a>00823           <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#104d279c5246d5f2c940f18dfcdb3908">exec_uops_issued</a>++;)
<a name="l00824"></a>00824 
<a name="l00825"></a>00825           <span class="comment">/* only one uop schedules from an issue port per cycle */</span>
<a name="l00826"></a>00826           issued = <span class="keyword">true</span>;
<a name="l00827"></a>00827           rq = next;
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829         <span class="keywordflow">else</span>
<a name="l00830"></a>00830         {
<a name="l00831"></a>00831           <span class="comment">/* node valid, but not ready; skip over it */</span>
<a name="l00832"></a>00832           prev = rq;
<a name="l00833"></a>00833           rq = rq-&gt;<a class="code" href="structcore__exec__DPM__t_1_1readyQ__node__t.html#e6f3f80b57654bd5643e29db316f745c">next</a>;
<a name="l00834"></a>00834         }
<a name="l00835"></a>00835       }
<a name="l00836"></a>00836   }
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 <span class="comment">/* returns true if load is allowed to issue (or is predicted to be ok) */</span>
<a name="l00840"></a><a class="code" href="classcore__exec__DPM__t.html#15810e9312609410063d8ee3de5e681c">00840</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#15810e9312609410063d8ee3de5e681c">core_exec_DPM_t::check_load_issue_conditions</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l00841"></a>00841 {
<a name="l00842"></a>00842   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00843"></a>00843   <span class="comment">/* are all previous STA's known? If there's a match, is the STD ready? */</span>
<a name="l00844"></a>00844   <span class="keywordtype">bool</span> sta_unknown = <span class="keyword">false</span>;
<a name="l00845"></a>00845   <span class="keywordtype">bool</span> regular_match = <span class="keyword">false</span>;
<a name="l00846"></a>00846   <span class="keywordtype">bool</span> partial_match = <span class="keyword">false</span>;
<a name="l00847"></a>00847   <span class="keywordtype">bool</span> oracle_regular_match = <span class="keyword">false</span>;
<a name="l00848"></a>00848   <span class="keywordtype">bool</span> oracle_partial_match = <span class="keyword">false</span>;
<a name="l00849"></a>00849   <span class="keywordtype">int</span> i;
<a name="l00850"></a>00850   <span class="keywordtype">int</span> match_index = -1;
<a name="l00851"></a>00851   <span class="keywordtype">int</span> oracle_index = -1;
<a name="l00852"></a>00852   <span class="keywordtype">int</span> num_stores = 0; <span class="comment">/* need this extra condition because STQ could be full with all stores older than the load we're considering */</span>
<a name="l00853"></a>00853 
<a name="l00854"></a>00854   <span class="comment">/* don't reissue someone who's already issued */</span>
<a name="l00855"></a>00855   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>),<span class="keyword">false</span>);
<a name="l00856"></a>00856   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00857"></a>00857     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> ld_addr1 = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>;
<a name="l00860"></a>00860   <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> ld_addr2 = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a4e96c4d36187d57b55b3ca3720475d6">virt_addr</a> + uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a> - 1;
<a name="l00861"></a>00861 
<a name="l00862"></a>00862   <span class="comment">/* this searches the senior STQ as well. */</span>
<a name="l00863"></a>00863   <span class="keywordflow">for</span>(i=<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1f4a7cd8f60161109737d9722f60d6fc">store_color</a>;
<a name="l00864"></a>00864       ((<a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(i,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>)) != <a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a>) &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#f75e13d26a4ebba3da425d142902811c">uop_seq</a> &lt; uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>) &amp;&amp; (num_stores &lt; <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a>);
<a name="l00865"></a>00865       i=<a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(i,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>) )
<a name="l00866"></a>00866   {
<a name="l00867"></a>00867     <span class="comment">/* check addr match */</span>
<a name="l00868"></a>00868     <span class="keywordtype">int</span> st_mem_size = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">mem_size</a>;
<a name="l00869"></a>00869     <span class="keywordtype">int</span> ld_mem_size = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>;
<a name="l00870"></a>00870     <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> st_addr1, st_addr2;
<a name="l00871"></a>00871     
<a name="l00872"></a>00872     
<a name="l00873"></a>00873     <span class="comment">//if(uop-&gt;Mop-&gt;fetch.inst.code[0]==0xce)</span>
<a name="l00874"></a>00874     <span class="comment">//{</span>
<a name="l00875"></a>00875     <span class="comment">// fprintf(stdout,"\n[%lld]Exec.check_load_conditions ld_mem_size %d str_mem_size %d uop-&gt;decode.is_load %d",sim_cycle,ld_mem_size,st_mem_size,uop-&gt;decode.is_load);</span>
<a name="l00876"></a>00876     <span class="comment">//fprintf(stdout,"\n[%lld]Exec. Faulty Load: 0x%llx   ",sim_cycle,uop-&gt;Mop-&gt;fetch.inst.vaddr);</span>
<a name="l00877"></a>00877     <span class="comment">//  for (int tyu = 0; tyu &lt; uop-&gt;Mop-&gt;fetch.inst.qemu_len; tyu++) </span>
<a name="l00878"></a>00878     <span class="comment">//          fprintf(stdout,"%x ", uop-&gt;Mop-&gt;fetch.inst.code[tyu]);</span>
<a name="l00879"></a>00879     <span class="comment">//}</span>
<a name="l00880"></a>00880     <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].addr_valid)
<a name="l00881"></a>00881       st_addr1 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#68434b699cc17dac41c332e7ebaf015a">virt_addr</a>; <span class="comment">/* addr of first byte */</span>
<a name="l00882"></a>00882     <span class="keywordflow">else</span>
<a name="l00883"></a>00883     {
<a name="l00884"></a>00884       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].sta,<span class="keyword">false</span>);
<a name="l00885"></a>00885       st_addr1 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a>-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>; <span class="comment">/* addr of first byte */</span>
<a name="l00886"></a>00886       sta_unknown = <span class="keyword">true</span>;
<a name="l00887"></a>00887     }
<a name="l00888"></a>00888     st_addr2 = st_addr1 + st_mem_size - 1; <span class="comment">/* addr of last byte */</span>
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(st_mem_size,<span class="keyword">false</span>);
<a name="l00891"></a>00891     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(ld_mem_size,<span class="keyword">false</span>);
<a name="l00892"></a>00892     <span class="comment">/* XXX: The following assert should be used, but under RHEL5-compiled binaries,</span>
<a name="l00893"></a>00893 <span class="comment">       there seems to be some weird thing going on where the GS segment register is</span>
<a name="l00894"></a>00894 <span class="comment">       getting zeroed out somewhere which later leads to a null-pointer dereference.</span>
<a name="l00895"></a>00895 <span class="comment">       On some test programs, this didn't seem to cause any problems, so for now</span>
<a name="l00896"></a>00896 <span class="comment">       we're just leaving it this way. */</span>
<a name="l00897"></a>00897     <span class="comment">//zesto_assert(uop-&gt;Mop-&gt;oracle.spec_mode || (ld_addr1 &amp;&amp; ld_addr2),false);</span>
<a name="l00898"></a>00898     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((st_addr1 &amp;&amp; st_addr2) || (<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].sta &amp;&amp; <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].sta-&gt;Mop-&gt;oracle.spec_mode),<span class="keyword">false</span>);
<a name="l00899"></a>00899 
<a name="l00900"></a>00900     <span class="keywordflow">if</span>((st_addr1 &lt;= ld_addr1) &amp;&amp; (st_addr2 &gt;= ld_addr2)) <span class="comment">/* store write fully overlaps the load address range */</span>
<a name="l00901"></a>00901     {
<a name="l00902"></a>00902       <span class="keywordflow">if</span>((match_index == -1) &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].addr_valid))
<a name="l00903"></a>00903       {
<a name="l00904"></a>00904         match_index = i;
<a name="l00905"></a>00905         regular_match = <span class="keyword">true</span>;
<a name="l00906"></a>00906       }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908       <span class="keywordflow">if</span>(oracle_index == -1)
<a name="l00909"></a>00909       {
<a name="l00910"></a>00910         oracle_index = i;
<a name="l00911"></a>00911         oracle_regular_match = <span class="keyword">true</span>;
<a name="l00912"></a>00912       }
<a name="l00913"></a>00913     }
<a name="l00914"></a>00914     <span class="keywordflow">else</span> <span class="keywordflow">if</span>((st_addr2 &lt; ld_addr1) || (st_addr1 &gt; ld_addr2)) <span class="comment">/* store addr is completely before or after the load */</span>
<a name="l00915"></a>00915     {
<a name="l00916"></a>00916       <span class="comment">/* no conflict here */</span>
<a name="l00917"></a>00917     }
<a name="l00918"></a>00918     <span class="keywordflow">else</span> <span class="comment">/* partial store */</span>
<a name="l00919"></a>00919     {
<a name="l00920"></a>00920       <span class="keywordflow">if</span>((match_index == -1) &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[i].addr_valid))
<a name="l00921"></a>00921       {
<a name="l00922"></a>00922         match_index = i;
<a name="l00923"></a>00923         partial_match = <span class="keyword">true</span>;
<a name="l00924"></a>00924       }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926       <span class="keywordflow">if</span>(oracle_index == -1)
<a name="l00927"></a>00927       {
<a name="l00928"></a>00928         oracle_index = i;
<a name="l00929"></a>00929         oracle_partial_match = <span class="keyword">true</span>;
<a name="l00930"></a>00930       }
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     num_stores++;
<a name="l00934"></a>00934   }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936   <span class="keywordflow">if</span>(partial_match)
<a name="l00937"></a>00937   {
<a name="l00938"></a>00938     <span class="comment">/* in presence of (known) partial store forwarding, stall until store *commits* */</span>
<a name="l00939"></a>00939     <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#15375f9fa16ccc59fde7402fb43d487a">partial_forward</a> = <span class="keyword">true</span>;
<a name="l00940"></a>00940     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00941"></a>00941   }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   <span class="keywordflow">return</span> <a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">memdep</a>-&gt;<a class="code" href="classmemdep__t.html#4e942f2faba7dd4b7ed2d28b887723b0">lookup</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,sta_unknown,oracle_regular_match,oracle_partial_match);
<a name="l00944"></a>00944 }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946 <span class="comment">/* helper function to remove issued uops after a latency misprediction */</span>
<a name="l00947"></a><a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">00947</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">core_exec_DPM_t::snatch_back</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> replayed_uop)
<a name="l00948"></a>00948 {
<a name="l00949"></a>00949   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00950"></a>00950   <span class="keywordtype">int</span> i;
<a name="l00951"></a>00951   <span class="keywordtype">int</span> index = 0;
<a name="l00952"></a>00952   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> ** stack = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>**) alloca(<span class="keyword">sizeof</span>(*stack) * knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a>);
<a name="l00953"></a>00953   <span class="keywordflow">if</span>(!stack)
<a name="l00954"></a>00954     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't alloca snatch_back_stack"</span>);
<a name="l00955"></a>00955   stack[0] = replayed_uop;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957   <span class="keywordflow">while</span>(index &gt;= 0)
<a name="l00958"></a>00958   {
<a name="l00959"></a>00959     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = stack[index];
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <span class="comment">/* reset current uop */</span>
<a name="l00962"></a>00962     uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00963"></a>00963     uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6a823830b3496618e63ce4486f60fe8c">when_exec</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00964"></a>00964     uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00965"></a>00965     uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00966"></a>00966     <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>)
<a name="l00967"></a>00967     {
<a name="l00968"></a>00968       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l00969"></a>00969       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l00970"></a>00970       <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a> = <span class="keyword">false</span>;
<a name="l00971"></a>00971       <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#f6227d585f433401f9eb299684cf5ea7">addr_valid</a> = <span class="keyword">false</span>;
<a name="l00972"></a>00972       <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00973"></a>00973       <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9849939f8fb88ebf561452aeb67cb445">first_byte_requested</a> = <span class="keyword">false</span>;
<a name="l00974"></a>00974       <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a6b521d057414fe8ea6ed3bed4e51e22">last_byte_requested</a> = <span class="keyword">false</span>;
<a name="l00975"></a>00975       <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">first_byte_arrived</a> = <span class="keyword">false</span>;
<a name="l00976"></a>00976       <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a> = <span class="keyword">false</span>;
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="comment">/* remove uop from payload RAM pipe */</span>
<a name="l00980"></a>00980     <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#aa00af896d341748fc352988cb528ce7">occupancy</a> &gt; 0)
<a name="l00981"></a>00981       <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#9d2834576ea4ae6471d9538548107973">payload_depth</a>;i++)
<a name="l00982"></a>00982         <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> == uop)
<a name="l00983"></a>00983         {
<a name="l00984"></a>00984           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = NULL;
<a name="l00985"></a>00985           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#aa00af896d341748fc352988cb528ce7">occupancy</a>--;
<a name="l00986"></a>00986           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#aa00af896d341748fc352988cb528ce7">occupancy</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l00987"></a>00987           <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#4236da8517eb44a608d141215bdf23cc">exec_uops_snatched_back</a>++;)
<a name="l00988"></a>00988           <span class="keywordflow">break</span>;
<a name="l00989"></a>00989         }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991     <span class="comment">/* remove uop from readyQ */</span>
<a name="l00992"></a>00992     uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l00993"></a>00993     uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a> = <span class="keyword">false</span>;
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <span class="comment">/* remove uop from squash list */</span>
<a name="l00996"></a>00996     stack[index] = NULL;
<a name="l00997"></a>00997     index --;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999     <span class="comment">/* add dependents to squash list */</span>
<a name="l01000"></a>01000     <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01001"></a>01001     <span class="keywordflow">while</span>(odep)
<a name="l01002"></a>01002     {
<a name="l01003"></a>01003       <span class="comment">/* squash this input tag */</span>
<a name="l01004"></a>01004       odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01005"></a>01005 
<a name="l01006"></a>01006       <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>) <span class="comment">/* if the child issued */</span>
<a name="l01007"></a>01007       {
<a name="l01008"></a>01008         index ++;
<a name="l01009"></a>01009         stack[index] = odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>;
<a name="l01010"></a>01010       }
<a name="l01011"></a>01011       <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a>) <span class="comment">/* if child is in the readyQ */</span>
<a name="l01012"></a>01012       {
<a name="l01013"></a>01013         odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l01014"></a>01014         odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a> = <span class="keyword">false</span>;
<a name="l01015"></a>01015       }
<a name="l01016"></a>01016       odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01017"></a>01017     }
<a name="l01018"></a>01018   }
<a name="l01019"></a>01019 
<a name="l01020"></a>01020   <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> when_ready = 0;
<a name="l01021"></a>01021   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;i++)
<a name="l01022"></a>01022     <span class="keywordflow">if</span>(replayed_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[i] &gt; when_ready)
<a name="l01023"></a>01023       when_ready = replayed_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[i];
<a name="l01024"></a>01024   <span class="comment">/* we assume if a when_ready has been reset to TICK_T_MAX, then</span>
<a name="l01025"></a>01025 <span class="comment">     the parent will re-wakeup the child.  In any case, we also</span>
<a name="l01026"></a>01026 <span class="comment">     assume that a parent that takes longer to execute than</span>
<a name="l01027"></a>01027 <span class="comment">     originally predicted will update its children's</span>
<a name="l01028"></a>01028 <span class="comment">     when_itag_ready's to the new value */</span>
<a name="l01029"></a>01029   <span class="keywordflow">if</span>(when_ready != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>) <span class="comment">/* otherwise reschedule the uop */</span>
<a name="l01030"></a>01030   {
<a name="l01031"></a>01031     replayed_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> = when_ready;
<a name="l01032"></a>01032     <a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">insert_ready_uop</a>(replayed_uop);
<a name="l01033"></a>01033   }
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036 <span class="comment">/* The callback functions below (after load_writeback) mark flags</span>
<a name="l01037"></a>01037 <span class="comment">   in the uop to specify the completion of each task, and only when</span>
<a name="l01038"></a>01038 <span class="comment">   all are done do we call the load-writeback function to finish</span>
<a name="l01039"></a>01039 <span class="comment">   off execution of the load. */</span>
<a name="l01040"></a>01040 
<a name="l01041"></a><a class="code" href="classcore__exec__DPM__t.html#b07c4d1f245b656e14be9138c5a6070e">01041</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#b07c4d1f245b656e14be9138c5a6070e">core_exec_DPM_t::load_writeback</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> <a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>)
<a name="l01042"></a>01042 {
<a name="l01043"></a>01043   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l01044"></a>01044   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l01045"></a>01045   <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a>) <span class="comment">/* no match in STQ, so use cache value */</span>
<a name="l01046"></a>01046   {
<a name="l01047"></a>01047 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01048"></a>01048 <span class="preprocessor"></span>    ztrace_print(uop,<span class="stringliteral">"e|load|writeback from cache/writeback"</span>);
<a name="l01049"></a>01049 <span class="preprocessor">#endif</span>
<a name="l01050"></a>01050 <span class="preprocessor"></span>
<a name="l01051"></a>01051     <span class="keywordtype">int</span> <a class="code" href="structcore__knobs__t.html#1e0a19a190d0ecb6eb4fabb1a9b32d2d">fp_penalty</a> = <a class="code" href="machine_8h.html#68982a77353744eb45beec6d4075bb4b">REG_IS_FPR</a>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#6b25418271a661494d1ddd662cd1ecf8">odep_name</a>)?knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#1e0a19a190d0ecb6eb4fabb1a9b32d2d">fp_penalty</a>:0;
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#7b2f7ee0f5ef4e237188bbbbf6c48459">when_bypass_used</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01054"></a>01054     uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a> = uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a>; <span class="comment">/* XXX: just using oracle value for now */</span>
<a name="l01055"></a>01055     uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#81fdd7fda39dcc7d7d349ffe8add49b2">ovalue_valid</a> = <span class="keyword">true</span>;
<a name="l01056"></a>01056     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l01057"></a>01057     uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01058"></a>01058     <a class="code" href="classcore__exec__t.html#cdd57a5cb5d71ea527ef696086d97bee">last_completed</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty; <span class="comment">/* for deadlock detection */</span>
<a name="l01059"></a>01059     <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#9ccd1826a44171c8c8a70f4ba0206bc9">is_ctrl</a> &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> != uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a>)) <span class="comment">/* XXX: for RETN */</span>
<a name="l01060"></a>01060     {
<a name="l01061"></a>01061       uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#b816a0b34ea5ca8a061c02c6946fef3e">branch_mispred</a> = <span class="keyword">true</span>;
<a name="l01062"></a>01062       <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#c687f6e9c8564e5fd108ca8c9f771dce">pipe_recover</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>);
<a name="l01063"></a>01063       <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e6a4a159e00e9d5b93db9544015f98f7">num_jeclear</a>++;)
<a name="l01064"></a>01064       <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#92d2861b39c23b47dd58854da3288e81">spec_mode</a>)
<a name="l01065"></a>01065         <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#33a60de88faadccd45eacdf575271002">num_wp_jeclear</a>++;)
<a name="l01066"></a>01066 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01067"></a>01067 <span class="preprocessor"></span>      ztrace_print(uop,<span class="stringliteral">"e|jeclear|load/RETN mispred detected (no STQ hit)"</span>);
<a name="l01068"></a>01068 <span class="preprocessor">#endif</span>
<a name="l01069"></a>01069 <span class="preprocessor"></span>    }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> &gt; (<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty))
<a name="l01073"></a>01073       <span class="comment">/* we thought this output would be ready later in the future,</span>
<a name="l01074"></a>01074 <span class="comment">         but it's ready now! */</span>
<a name="l01075"></a>01075       uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <span class="comment">/* bypass output value to dependents, but also check to see if</span>
<a name="l01078"></a>01078 <span class="comment">       dependents were already speculatively scheduled; if not,</span>
<a name="l01079"></a>01079 <span class="comment">       wake them up. */</span>
<a name="l01080"></a>01080     <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     <span class="keywordflow">while</span>(odep)
<a name="l01083"></a>01083     {
<a name="l01084"></a>01084       <span class="comment">/* check scheduling info (tags) */</span>
<a name="l01085"></a>01085       <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] &gt; (<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty))
<a name="l01086"></a>01086       {
<a name="l01087"></a>01087         <span class="keywordtype">int</span> j;
<a name="l01088"></a>01088         <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> when_ready = 0;
<a name="l01089"></a>01089 
<a name="l01090"></a>01090         odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01091"></a>01091 
<a name="l01092"></a>01092         <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;j++)
<a name="l01093"></a>01093           <span class="keywordflow">if</span>(when_ready &lt; odep-&gt;uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j])
<a name="l01094"></a>01094             when_ready = odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j];
<a name="l01095"></a>01095 
<a name="l01096"></a>01096         <span class="keywordflow">if</span>(when_ready &lt; <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01097"></a>01097         {
<a name="l01098"></a>01098           odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> = when_ready;
<a name="l01099"></a>01099           <span class="keywordflow">if</span>(!odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a>)
<a name="l01100"></a>01100             <a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">insert_ready_uop</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01101"></a>01101         }
<a name="l01102"></a>01102       }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104       <span class="comment">/* bypass value */</span>
<a name="l01105"></a>01105       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(!odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>],(<span class="keywordtype">void</span>)0);
<a name="l01106"></a>01106       odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <span class="keyword">true</span>;
<a name="l01107"></a>01107       <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#1b87d9a262d821eb09ac04a1007a7505">aflags</a>) <span class="comment">/* shouldn't happen for loads? */</span>
<a name="l01108"></a>01108       {
<a name="l01109"></a>01109         <a class="code" href="misc_8h.html#f80d19f1297a11626fab61a248959c71">warn</a>(<span class="stringliteral">"load modified flags?\n"</span>);
<a name="l01110"></a>01110         odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#86094935a31d7cd09945c60b74813abb">ivalue</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>].<a class="code" href="unionval__t.html#0097b33ae33eaf111f07f341005c37ae">dw</a> = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a0d602d55a295c1e2b230d66190f5fc7">oflags</a>;
<a name="l01111"></a>01111       }
<a name="l01112"></a>01112       <span class="keywordflow">else</span>
<a name="l01113"></a>01113         odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#86094935a31d7cd09945c60b74813abb">ivalue</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a>;
<a name="l01114"></a>01114       odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6912f9079359470ab0fd61f0f8972ad6">when_ival_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116       odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01117"></a>01117     }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119   }
<a name="l01120"></a>01120 }
<a name="l01121"></a>01121 
<a name="l01122"></a>01122 <span class="comment">/* used for accesses that can be serviced entirely by one cacheline,</span>
<a name="l01123"></a>01123 <span class="comment">   or by the first access of a split-access */</span>
<a name="l01124"></a><a class="code" href="classcore__exec__DPM__t.html#109d24bd6ea7ae6180264e1cbc763748">01124</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#109d24bd6ea7ae6180264e1cbc763748">core_exec_DPM_t::DL1_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l01125"></a>01125 {
<a name="l01126"></a>01126   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>*) op;
<a name="l01127"></a>01127   <span class="keyword">class </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a> * E = (<a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>*)uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>;
<a name="l01128"></a>01128   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> != -1)
<a name="l01129"></a>01129   {
<a name="l01130"></a>01130         <span class="comment">//fprintf(stdout,"\n[%lld]DL1 callback %llx ",sim_cycle, uop-&gt;oracle.phys_addr);</span>
<a name="l01131"></a>01131 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01132"></a>01132 <span class="preprocessor"></span>    ztrace_print(uop,<span class="stringliteral">"e|load|returned from cache/memory"</span>);
<a name="l01133"></a>01133 <span class="preprocessor">#endif</span>
<a name="l01134"></a>01134 <span class="preprocessor"></span>    E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">first_byte_arrived</a> = <span class="keyword">true</span>;
<a name="l01135"></a>01135     <span class="keywordflow">if</span>((uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#44c8299aefb215702694ddcc3922b1d6">when_addr_translated</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>) &amp;&amp;
<a name="l01136"></a>01136         E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a> &amp;&amp;
<a name="l01137"></a>01137         !E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a>) <span class="comment">/* no match in STQ, so use cache value */</span>
<a name="l01138"></a>01138     {
<a name="l01139"></a>01139       <span class="comment">/* if load received value from STQ, it could have already</span>
<a name="l01140"></a>01140 <span class="comment">         committed by the time this gets called (esp. if we went to</span>
<a name="l01141"></a>01141 <span class="comment">         main memory) */</span>
<a name="l01142"></a>01142       uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a54efc9d4d0253ebecdac3485cdd5d93">when_data_loaded</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01143"></a>01143       E-&gt;<a class="code" href="classcore__exec__DPM__t.html#b07c4d1f245b656e14be9138c5a6070e">load_writeback</a>(uop);
<a name="l01144"></a>01144     }
<a name="l01145"></a>01145   }
<a name="l01146"></a>01146 }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148 <span class="comment">/* used only for the second access of a split access */</span>
<a name="l01149"></a><a class="code" href="classcore__exec__DPM__t.html#d5d17ca90be424042d6c5051903537d2">01149</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#d5d17ca90be424042d6c5051903537d2">core_exec_DPM_t::DL1_split_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l01150"></a>01150 {
<a name="l01151"></a>01151   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>*) op;
<a name="l01152"></a>01152   <span class="keyword">class </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a> * E = (<a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>*)uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>;
<a name="l01153"></a>01153   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> != -1)
<a name="l01154"></a>01154   {
<a name="l01155"></a>01155 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01156"></a>01156 <span class="preprocessor"></span>    ztrace_print(uop,<span class="stringliteral">"e|load|returned from cache/memory"</span>);
<a name="l01157"></a>01157 <span class="preprocessor">#endif</span>
<a name="l01158"></a>01158 <span class="preprocessor"></span>    E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a> = <span class="keyword">true</span>;
<a name="l01159"></a>01159     <span class="keywordflow">if</span>((uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#44c8299aefb215702694ddcc3922b1d6">when_addr_translated</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>) &amp;&amp;
<a name="l01160"></a>01160         E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">first_byte_arrived</a> &amp;&amp;
<a name="l01161"></a>01161         !E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a>) <span class="comment">/* no match in STQ, so use cache value */</span>
<a name="l01162"></a>01162     {
<a name="l01163"></a>01163       <span class="comment">/* if load received value from STQ, it could have already</span>
<a name="l01164"></a>01164 <span class="comment">         committed by the time this gets called (esp. if we went to</span>
<a name="l01165"></a>01165 <span class="comment">         main memory) */</span>
<a name="l01166"></a>01166       uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a54efc9d4d0253ebecdac3485cdd5d93">when_data_loaded</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01167"></a>01167       E-&gt;<a class="code" href="classcore__exec__DPM__t.html#b07c4d1f245b656e14be9138c5a6070e">load_writeback</a>(uop);
<a name="l01168"></a>01168     }
<a name="l01169"></a>01169   }
<a name="l01170"></a>01170 }
<a name="l01171"></a>01171 
<a name="l01172"></a><a class="code" href="classcore__exec__DPM__t.html#4e14cd7a5104eceeb931ef5498cc6a78">01172</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#4e14cd7a5104eceeb931ef5498cc6a78">core_exec_DPM_t::DTLB_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l01173"></a>01173 {
<a name="l01174"></a>01174   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>*) op;
<a name="l01175"></a>01175 <span class="preprocessor">#ifndef DEBUG</span>
<a name="l01176"></a>01176 <span class="preprocessor"></span>  <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> * <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a> = uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>;
<a name="l01177"></a>01177 <span class="preprocessor">#endif</span>
<a name="l01178"></a>01178 <span class="preprocessor"></span>  <span class="keyword">struct </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a> * E = (<a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>*)uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>;
<a name="l01179"></a>01179   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> != -1)
<a name="l01180"></a>01180   {
<a name="l01181"></a>01181     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#44c8299aefb215702694ddcc3922b1d6">when_addr_translated</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l01182"></a>01182     uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#44c8299aefb215702694ddcc3922b1d6">when_addr_translated</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01183"></a>01183 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01184"></a>01184 <span class="preprocessor"></span>    ztrace_print(uop,<span class="stringliteral">"e|load|virtual address translated"</span>);
<a name="l01185"></a>01185 <span class="preprocessor">#endif</span>
<a name="l01186"></a>01186 <span class="preprocessor"></span>    <span class="keywordflow">if</span>((uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#44c8299aefb215702694ddcc3922b1d6">when_addr_translated</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>) &amp;&amp;
<a name="l01187"></a>01187         E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">first_byte_arrived</a> &amp;&amp;
<a name="l01188"></a>01188         E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a> &amp;&amp;
<a name="l01189"></a>01189         !E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a>)
<a name="l01190"></a>01190       E-&gt;<a class="code" href="classcore__exec__DPM__t.html#b07c4d1f245b656e14be9138c5a6070e">load_writeback</a>(uop);
<a name="l01191"></a>01191   }
<a name="l01192"></a>01192 }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194 <span class="comment">/* returns true if TLB translation has completed */</span>
<a name="l01195"></a><a class="code" href="classcore__exec__DPM__t.html#f000198904efa0b681cafd05b331c376">01195</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#f000198904efa0b681cafd05b331c376">core_exec_DPM_t::translated_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op, <span class="keyword">const</span> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> action_id)
<a name="l01196"></a>01196 {
<a name="l01197"></a>01197   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>*) op;
<a name="l01198"></a>01198   <span class="keywordflow">if</span>((uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> == action_id) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> != -1))
<a name="l01199"></a>01199     <span class="keywordflow">return</span> uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#44c8299aefb215702694ddcc3922b1d6">when_addr_translated</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01200"></a>01200   <span class="keywordflow">else</span>
<a name="l01201"></a>01201     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 <span class="comment">/* Used by the cache processing functions to recover the id of the</span>
<a name="l01205"></a>01205 <span class="comment">   uop without needing to know about the uop struct. */</span>
<a name="l01206"></a><a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">01206</a> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">core_exec_DPM_t::get_uop_action_id</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> <a class="code" href="structuop__t.html#c1fb2c48a0b03eafe8596e3b134042f4">op</a>)
<a name="l01207"></a>01207 {
<a name="l01208"></a>01208   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> const * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>*) op;
<a name="l01209"></a>01209   <span class="keywordflow">return</span> uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>;
<a name="l01210"></a>01210 }
<a name="l01211"></a>01211 
<a name="l01212"></a>01212 <span class="comment">/* This function takes care of uops that have been misscheduled due</span>
<a name="l01213"></a>01213 <span class="comment">   to a latency misprediction (e.g., they got scheduled assuming</span>
<a name="l01214"></a>01214 <span class="comment">   the parent uop would hit in the DL1, but it turns out that the</span>
<a name="l01215"></a>01215 <span class="comment">   load latency will be longer due to a cache miss).  Uops may be</span>
<a name="l01216"></a>01216 <span class="comment">   speculatively rescheduled based on the next anticipated latency</span>
<a name="l01217"></a>01217 <span class="comment">   (e.g., L2 hit latency). */</span>
<a name="l01218"></a><a class="code" href="classcore__exec__DPM__t.html#c18400df36d37f24fcb9c47cb356700a">01218</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#c18400df36d37f24fcb9c47cb356700a">core_exec_DPM_t::load_miss_reschedule</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> <a class="code" href="structuop__t.html#c1fb2c48a0b03eafe8596e3b134042f4">op</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> new_pred_latency)
<a name="l01219"></a>01219 {
<a name="l01220"></a>01220   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>*) op;
<a name="l01221"></a>01221   <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> * <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a> = uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>;
<a name="l01222"></a>01222   <span class="keyword">struct </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a> * E = (<a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>*)core-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>;
<a name="l01223"></a>01223   <span class="keyword">struct</span> <a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = core-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l01224"></a>01224   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>,(<span class="keywordtype">void</span>)0);
<a name="l01225"></a>01225   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &lt; <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l01226"></a>01226 
<a name="l01227"></a>01227   <span class="comment">/* if we've speculatively woken up our dependents, we need to</span>
<a name="l01228"></a>01228 <span class="comment">     snatch them back out of the execution pipeline and replay them</span>
<a name="l01229"></a>01229 <span class="comment">     later (but if the load already hit in the STQ, then don't need</span>
<a name="l01230"></a>01230 <span class="comment">     to replay) */</span>
<a name="l01231"></a>01231   <span class="keywordflow">if</span>(E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a> &amp;&amp; !E-&gt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a>)
<a name="l01232"></a>01232   {
<a name="l01233"></a>01233 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01234"></a>01234 <span class="preprocessor"></span>    ztrace_print(uop,<span class="stringliteral">"e|cache-miss|no STQ hit"</span>);
<a name="l01235"></a>01235 <span class="preprocessor">#endif</span>
<a name="l01236"></a>01236 <span class="preprocessor"></span>    <span class="comment">/* we speculatively scheduled children assuming we'd hit in the</span>
<a name="l01237"></a>01237 <span class="comment">       previous cache level, but we didn't... so put children back</span>
<a name="l01238"></a>01238 <span class="comment">       to sleep */</span>
<a name="l01239"></a>01239     uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01240"></a>01240     <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01241"></a>01241     <span class="keywordflow">while</span>(odep)
<a name="l01242"></a>01242     {
<a name="l01243"></a>01243       odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01244"></a>01244       E-&gt;<a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">snatch_back</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01245"></a>01245 
<a name="l01246"></a>01246       odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01247"></a>01247     }
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     <span class="comment">/* now assume a hit in this cache level */</span>
<a name="l01250"></a>01250     odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01251"></a>01251     <span class="keywordflow">if</span>(new_pred_latency != <a class="code" href="config_2zesto-cache_8h.html#8d2ff015ca2239311fb6533186242f9e">BIG_LATENCY</a>)
<a name="l01252"></a>01252       uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> + new_pred_latency - <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#9d2834576ea4ae6471d9538548107973">payload_depth</a> - 1;
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     <span class="keywordflow">while</span>(odep)
<a name="l01255"></a>01255     {
<a name="l01256"></a>01256       odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a>;
<a name="l01257"></a>01257 
<a name="l01258"></a>01258       <span class="comment">/* put back on to readyQ if appropriate */</span>
<a name="l01259"></a>01259       <span class="keywordtype">int</span> j;
<a name="l01260"></a>01260       <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> when_ready = 0;
<a name="l01261"></a>01261       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(!odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a>,(<span class="keywordtype">void</span>)0);
<a name="l01262"></a>01262 
<a name="l01263"></a>01263       <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;j++)
<a name="l01264"></a>01264         <span class="keywordflow">if</span>(when_ready &lt; odep-&gt;uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j])
<a name="l01265"></a>01265           when_ready = odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j];
<a name="l01266"></a>01266 
<a name="l01267"></a>01267       odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> = when_ready;
<a name="l01268"></a>01268       <span class="keywordflow">if</span>(when_ready &lt; <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01269"></a>01269       {
<a name="l01270"></a>01270         E-&gt;<a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">insert_ready_uop</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01271"></a>01271       }
<a name="l01272"></a>01272 
<a name="l01273"></a>01273       odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01274"></a>01274     }
<a name="l01275"></a>01275   }
<a name="l01276"></a>01276 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01277"></a>01277 <span class="preprocessor"></span>  <span class="keywordflow">else</span>
<a name="l01278"></a>01278     ztrace_print(uop,<span class="stringliteral">"e|cache-miss|STQ hit so miss not observed"</span>);
<a name="l01279"></a>01279 <span class="preprocessor">#endif</span>
<a name="l01280"></a>01280 <span class="preprocessor"></span>
<a name="l01281"></a>01281 }
<a name="l01282"></a>01282 
<a name="l01283"></a>01283 <span class="comment">/* process loads exiting the STQ search pipeline, update caches */</span>
<a name="l01284"></a><a class="code" href="classcore__exec__DPM__t.html#23c9e1a684a28d4dacd9eb9ba2365d84">01284</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#23c9e1a684a28d4dacd9eb9ba2365d84">core_exec_DPM_t::LDST_exec</a>(<span class="keywordtype">void</span>)
<a name="l01285"></a>01285 {
<a name="l01286"></a>01286   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l01287"></a>01287   <span class="keywordtype">int</span> i;
<a name="l01288"></a>01288 
<a name="l01289"></a>01289   <span class="comment">/* shuffle STQ pipeline forward */</span>
<a name="l01290"></a>01290   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>].num_FUs;i++)
<a name="l01291"></a>01291   {
<a name="l01292"></a>01292     <span class="keywordtype">int</span> port_num = knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>].ports[i];
<a name="l01293"></a>01293     <span class="keywordtype">int</span> stage = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">latency</a>-1;
<a name="l01294"></a>01294     <span class="keywordtype">int</span> j;
<a name="l01295"></a>01295     <span class="keywordflow">for</span>(j=stage;j&gt;0;j--)
<a name="l01296"></a>01296       <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>-&gt;pipe[j] = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[j-1];
<a name="l01297"></a>01297     <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = NULL;
<a name="l01298"></a>01298   }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300   <span class="comment">/* process STQ pipes */</span>
<a name="l01301"></a>01301   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>].num_FUs;i++)
<a name="l01302"></a>01302   {
<a name="l01303"></a>01303     <span class="keywordtype">int</span> port_num = knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>].ports[i];
<a name="l01304"></a>01304     <span class="keywordtype">int</span> stage = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">latency</a>-1;
<a name="l01305"></a>01305     <span class="keywordtype">int</span> j;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a>;
<a name="l01308"></a>01308 
<a name="l01309"></a>01309 
<a name="l01310"></a>01310     <span class="keywordflow">if</span>(uop &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[port_num].<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>-&gt;pipe[stage].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a> == uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>))
<a name="l01311"></a>01311     {
<a name="l01312"></a>01312 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01313"></a>01313 <span class="preprocessor"></span>      ztrace_print(uop,<span class="stringliteral">"e|STQ|load searches STQ for addr match"</span>);
<a name="l01314"></a>01314 <span class="preprocessor">#endif</span>
<a name="l01315"></a>01315 <span class="preprocessor"></span>      <span class="keywordtype">int</span> num_stores = 0;
<a name="l01316"></a>01316       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l01317"></a>01317 
<a name="l01318"></a>01318       <span class="comment">/* check STQ for match, including senior STQ */</span>
<a name="l01319"></a>01319       <span class="comment">/*for(j=LDQ[uop-&gt;alloc.LDQ_index].store_color;</span>
<a name="l01320"></a>01320 <span class="comment">          STQ[j].sta &amp;&amp; (STQ[j].sta-&gt;decode.uop_seq &lt; uop-&gt;decode.uop_seq) &amp;&amp; (num_stores &lt; STQ_senior_num);</span>
<a name="l01321"></a>01321 <span class="comment">          j=(j-1+knobs-&gt;exec.STQ_size) % knobs-&gt;exec.STQ_size)*/</span>
<a name="l01322"></a>01322 
<a name="l01323"></a>01323       j=<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1f4a7cd8f60161109737d9722f60d6fc">store_color</a>;
<a name="l01324"></a>01324 
<a name="l01325"></a>01325       <span class="keywordtype">int</span> cond1 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a> != NULL;
<a name="l01326"></a>01326       <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> seq1 = (<a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a>)-1, seq2 = (<a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a>)-1;
<a name="l01327"></a>01327       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(j &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l01328"></a>01328       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(j &lt; knobs-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.STQ_size,(<span class="keywordtype">void</span>)0);
<a name="l01329"></a>01329       <span class="keywordflow">if</span>(j)
<a name="l01330"></a>01330       {
<a name="l01331"></a>01331         seq1 = (<a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a>)-2;
<a name="l01332"></a>01332       }
<a name="l01333"></a>01333       <span class="keywordflow">if</span>(cond1)
<a name="l01334"></a>01334       {
<a name="l01335"></a>01335         seq1 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a>-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>;
<a name="l01336"></a>01336         seq2 = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>;
<a name="l01337"></a>01337       }
<a name="l01338"></a>01338       <span class="keywordtype">int</span> cond2 = cond1 &amp;&amp; (seq1 &lt; seq2);
<a name="l01339"></a>01339       <span class="keywordtype">int</span> cond3 = (num_stores &lt; <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a>);
<a name="l01340"></a>01340 
<a name="l01341"></a>01341       <span class="keywordflow">while</span>(cond1 &amp;&amp; cond2 &amp;&amp; cond3)
<a name="l01342"></a>01342       {
<a name="l01343"></a>01343         <span class="keywordtype">int</span> st_mem_size = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">mem_size</a>;
<a name="l01344"></a>01344         <span class="keywordtype">int</span> ld_mem_size = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>;
<a name="l01345"></a>01345         <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> st_addr1 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#68434b699cc17dac41c332e7ebaf015a">virt_addr</a>; <span class="comment">/* addr of first byte */</span>
<a name="l01346"></a>01346         <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> st_addr2 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#68434b699cc17dac41c332e7ebaf015a">virt_addr</a> + st_mem_size - 1; <span class="comment">/* addr of last byte */</span>
<a name="l01347"></a>01347         <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> ld_addr1 = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a4e96c4d36187d57b55b3ca3720475d6">virt_addr</a>;
<a name="l01348"></a>01348         <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> ld_addr2 = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a4e96c4d36187d57b55b3ca3720475d6">virt_addr</a> + ld_mem_size - 1;
<a name="l01349"></a>01349 
<a name="l01350"></a>01350         <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].addr_valid)
<a name="l01351"></a>01351         {
<a name="l01352"></a>01352           <span class="keywordflow">if</span>((st_addr1 &lt;= ld_addr1) &amp;&amp; (st_addr2 &gt;= ld_addr2)) <span class="comment">/* match */</span>
<a name="l01353"></a>01353           {
<a name="l01354"></a>01354             <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01355"></a>01355             {
<a name="l01356"></a>01356               <span class="comment">//fprintf(stdout,"order-violation");</span>
<a name="l01357"></a>01357               <a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">memdep</a>-&gt;<a class="code" href="classmemdep__t.html#61189c4dc4e8dbb5928f51a91d629f76">update</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>);
<a name="l01358"></a>01358               uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#b816a0b34ea5ca8a061c02c6946fef3e">branch_mispred</a> = <span class="keyword">false</span>;
<a name="l01359"></a>01359               <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#d79ed0d31e9421037f71a3aae2aa0cbb">pipe_flush</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>);
<a name="l01360"></a>01360               <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#39d7d4fa63d61b57d7b92c14827c0704">load_nukes</a>++;)
<a name="l01361"></a>01361               <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#92d2861b39c23b47dd58854da3288e81">spec_mode</a>)
<a name="l01362"></a>01362                 <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#285541b5146d15da412fb1475e647123">wp_load_nukes</a>++;)
<a name="l01363"></a>01363 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01364"></a>01364 <span class="preprocessor"></span>              ztrace_print(uop,<span class="stringliteral">"e|order-violation|matching store found but load already executed"</span>);
<a name="l01365"></a>01365 <span class="preprocessor">#endif</span>
<a name="l01366"></a>01366 <span class="preprocessor"></span>            }
<a name="l01367"></a>01367             <span class="keywordflow">else</span>
<a name="l01368"></a>01368             {
<a name="l01369"></a>01369               <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].value_valid)
<a name="l01370"></a>01370               {
<a name="l01371"></a>01371                 <span class="keywordtype">int</span> fp_penalty = <a class="code" href="machine_8h.html#68982a77353744eb45beec6d4075bb4b">REG_IS_FPR</a>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#6b25418271a661494d1ddd662cd1ecf8">odep_name</a>)?knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#1e0a19a190d0ecb6eb4fabb1a9b32d2d">fp_penalty</a>:0;
<a name="l01372"></a>01372                 uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a> = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#35a655b6baeb594e50ec6df0dbadaa1d">value</a>;
<a name="l01373"></a>01373                 uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#81fdd7fda39dcc7d7d349ffe8add49b2">ovalue_valid</a> = <span class="keyword">true</span>;
<a name="l01374"></a>01374                 uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l01375"></a>01375                 <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l01376"></a>01376                 uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01377"></a>01377                 uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6a823830b3496618e63ce4486f60fe8c">when_exec</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01378"></a>01378                 <a class="code" href="classcore__exec__t.html#cdd57a5cb5d71ea527ef696086d97bee">last_completed</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty; <span class="comment">/* for deadlock detection */</span>
<a name="l01379"></a>01379 
<a name="l01380"></a>01380                 <span class="comment">/* when_issued should be != TICK_T_MAX; in a few cases I was</span>
<a name="l01381"></a>01381 <span class="comment">                   finding it set; haven't had time to fully debug this yet,</span>
<a name="l01382"></a>01382 <span class="comment">                   but this fix apparently works for now. */</span>
<a name="l01383"></a>01383                 <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01384"></a>01384                   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01385"></a>01385                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a> = <span class="keyword">true</span>;
<a name="l01386"></a>01386 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01387"></a>01387 <span class="preprocessor"></span>                ztrace_print(uop,<span class="stringliteral">"e|STQ-hit|store-to-load forward"</span>);
<a name="l01388"></a>01388 <span class="preprocessor">#endif</span>
<a name="l01389"></a>01389 <span class="preprocessor"></span>
<a name="l01390"></a>01390                 <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#9ccd1826a44171c8c8a70f4ba0206bc9">is_ctrl</a> &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> != uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a>)) <span class="comment">/* for RETN */</span>
<a name="l01391"></a>01391                 {
<a name="l01392"></a>01392                   uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#b816a0b34ea5ca8a061c02c6946fef3e">branch_mispred</a> = <span class="keyword">true</span>;
<a name="l01393"></a>01393                   <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#c687f6e9c8564e5fd108ca8c9f771dce">pipe_recover</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>);
<a name="l01394"></a>01394                   <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e6a4a159e00e9d5b93db9544015f98f7">num_jeclear</a>++;)
<a name="l01395"></a>01395                   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#92d2861b39c23b47dd58854da3288e81">spec_mode</a>)
<a name="l01396"></a>01396                     <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#33a60de88faadccd45eacdf575271002">num_wp_jeclear</a>++;)
<a name="l01397"></a>01397 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01398"></a>01398 <span class="preprocessor"></span>                  ztrace_print(uop,<span class="stringliteral">"e|jeclear|load/RETN mispred detected in STQ hit"</span>);
<a name="l01399"></a>01399 <span class="preprocessor">#endif</span>
<a name="l01400"></a>01400 <span class="preprocessor"></span>                }
<a name="l01401"></a>01401 
<a name="l01402"></a>01402                 <span class="comment">/* we thought this output would be ready later in the future, but</span>
<a name="l01403"></a>01403 <span class="comment">                   it's ready now! */</span>
<a name="l01404"></a>01404                 <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> &gt; (<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty))
<a name="l01405"></a>01405                   uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                 <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01408"></a>01408 
<a name="l01409"></a>01409                 <span class="keywordflow">while</span>(odep)
<a name="l01410"></a>01410                 {
<a name="l01411"></a>01411                   <span class="comment">/* check scheduling info (tags) */</span>
<a name="l01412"></a>01412                   <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] &gt; <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>)
<a name="l01413"></a>01413                   {
<a name="l01414"></a>01414                     <span class="keywordtype">int</span> j;
<a name="l01415"></a>01415                     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> when_ready = 0;
<a name="l01416"></a>01416 
<a name="l01417"></a>01417                     odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01418"></a>01418 
<a name="l01419"></a>01419                     <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;j++)
<a name="l01420"></a>01420                       <span class="keywordflow">if</span>(when_ready &lt; odep-&gt;uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j])
<a name="l01421"></a>01421                         when_ready = odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j];
<a name="l01422"></a>01422 
<a name="l01423"></a>01423                     <span class="keywordflow">if</span>(when_ready &lt; <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01424"></a>01424                     {
<a name="l01425"></a>01425                       odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> = when_ready;
<a name="l01426"></a>01426                       <span class="keywordflow">if</span>(!odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a>)
<a name="l01427"></a>01427                         <a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">insert_ready_uop</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01428"></a>01428                     }
<a name="l01429"></a>01429                   }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431                   <span class="comment">/* bypass output value to dependents */</span>
<a name="l01432"></a>01432                   odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <span class="keyword">true</span>;
<a name="l01433"></a>01433                   <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#1b87d9a262d821eb09ac04a1007a7505">aflags</a>) <span class="comment">/* shouldn't happen for loads? */</span>
<a name="l01434"></a>01434                   {
<a name="l01435"></a>01435                     <a class="code" href="misc_8h.html#f80d19f1297a11626fab61a248959c71">warn</a>(<span class="stringliteral">"load modified flags?"</span>);
<a name="l01436"></a>01436                     odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#86094935a31d7cd09945c60b74813abb">ivalue</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>].<a class="code" href="unionval__t.html#0097b33ae33eaf111f07f341005c37ae">dw</a> = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a0d602d55a295c1e2b230d66190f5fc7">oflags</a>;
<a name="l01437"></a>01437                   }
<a name="l01438"></a>01438                   <span class="keywordflow">else</span>
<a name="l01439"></a>01439                     odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#86094935a31d7cd09945c60b74813abb">ivalue</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a>;
<a name="l01440"></a>01440                   odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6912f9079359470ab0fd61f0f8972ad6">when_ival_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01441"></a>01441 
<a name="l01442"></a>01442                   odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01443"></a>01443                 }
<a name="l01444"></a>01444               }
<a name="l01445"></a>01445               <span class="keywordflow">else</span> <span class="comment">/* addr match but STD unknown */</span>
<a name="l01446"></a>01446               {
<a name="l01447"></a>01447 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01448"></a>01448 <span class="preprocessor"></span>                ztrace_print(uop,<span class="stringliteral">"e|STQ-miss|addr hit but data not ready"</span>);
<a name="l01449"></a>01449 <span class="preprocessor">#endif</span>
<a name="l01450"></a>01450 <span class="preprocessor"></span>                <span class="comment">/* reset the load's children */</span>
<a name="l01451"></a>01451                 <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a>)
<a name="l01452"></a>01452                 {
<a name="l01453"></a>01453                   uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01454"></a>01454                   uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01455"></a>01455                   <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01456"></a>01456                   <span class="keywordflow">while</span>(odep)
<a name="l01457"></a>01457                   {
<a name="l01458"></a>01458                     odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01459"></a>01459                     odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <span class="keyword">false</span>;
<a name="l01460"></a>01460 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01461"></a>01461 <span class="preprocessor"></span>                    <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01462"></a>01462                       ztrace_print(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>,<span class="stringliteral">"e|snatch-back|parent STQ data not ready"</span>);
<a name="l01463"></a>01463 <span class="preprocessor">#endif</span>
<a name="l01464"></a>01464 <span class="preprocessor"></span>                    <a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">snatch_back</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01465"></a>01465 
<a name="l01466"></a>01466                     odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01467"></a>01467                   }
<a name="l01468"></a>01468                   <span class="comment">/* clear flag so we don't keep doing this over and over again */</span>
<a name="l01469"></a>01469                   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a> = <span class="keyword">false</span>;
<a name="l01470"></a>01470                 }
<a name="l01471"></a>01471                 uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l01472"></a>01472                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a> = <span class="keyword">false</span>;
<a name="l01473"></a>01473                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9849939f8fb88ebf561452aeb67cb445">first_byte_requested</a> = <span class="keyword">false</span>;
<a name="l01474"></a>01474                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a6b521d057414fe8ea6ed3bed4e51e22">last_byte_requested</a> = <span class="keyword">false</span>;
<a name="l01475"></a>01475                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">first_byte_arrived</a> = <span class="keyword">false</span>;
<a name="l01476"></a>01476                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a> = <span class="keyword">false</span>;
<a name="l01477"></a>01477                 <span class="comment">/* When_issued is still set, so LDQ won't reschedule the load.  The load</span>
<a name="l01478"></a>01478 <span class="comment">                   will wait until the STD finishes and wakes it up. */</span>
<a name="l01479"></a>01479               }
<a name="l01480"></a>01480             }
<a name="l01481"></a>01481             <span class="keywordflow">break</span>;
<a name="l01482"></a>01482           }
<a name="l01483"></a>01483           <span class="keywordflow">else</span> <span class="keywordflow">if</span>((st_addr2 &lt; ld_addr1) || (st_addr1 &gt; ld_addr2)) <span class="comment">/* no overlap */</span>
<a name="l01484"></a>01484           {
<a name="l01485"></a>01485             <span class="comment">/* nothing to do */</span>
<a name="l01486"></a>01486           }
<a name="l01487"></a>01487           <span class="keywordflow">else</span> <span class="comment">/* partial match */</span>
<a name="l01488"></a>01488           {
<a name="l01489"></a>01489             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#15375f9fa16ccc59fde7402fb43d487a">partial_forward</a> = <span class="keyword">true</span>;
<a name="l01490"></a>01490 
<a name="l01491"></a>01491             <span class="comment">/* squash if load already executed */</span>
<a name="l01492"></a>01492             <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01493"></a>01493             {
<a name="l01494"></a>01494               <span class="comment">/* flush is slightly different from branch mispred -</span>
<a name="l01495"></a>01495 <span class="comment">                 on branch, we squash everything *after* the branch,</span>
<a name="l01496"></a>01496 <span class="comment">                 whereas with this flush (e.g., used for memory</span>
<a name="l01497"></a>01497 <span class="comment">                 order violations), we squash the Mop itself as well</span>
<a name="l01498"></a>01498 <span class="comment">                 as everything after it */</span>
<a name="l01499"></a>01499               <span class="comment">//fprintf(stdout,"\norder violation-partially matching store found but load executed");</span>
<a name="l01500"></a>01500               <a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">memdep</a>-&gt;<a class="code" href="classmemdep__t.html#61189c4dc4e8dbb5928f51a91d629f76">update</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>);
<a name="l01501"></a>01501               uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#b816a0b34ea5ca8a061c02c6946fef3e">branch_mispred</a> = <span class="keyword">false</span>;
<a name="l01502"></a>01502               <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#d79ed0d31e9421037f71a3aae2aa0cbb">pipe_flush</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>);
<a name="l01503"></a>01503               <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#39d7d4fa63d61b57d7b92c14827c0704">load_nukes</a>++;)
<a name="l01504"></a>01504               <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#92d2861b39c23b47dd58854da3288e81">spec_mode</a>)
<a name="l01505"></a>01505                 <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#285541b5146d15da412fb1475e647123">wp_load_nukes</a>++;)
<a name="l01506"></a>01506 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01507"></a>01507 <span class="preprocessor"></span>              ztrace_print(uop,<span class="stringliteral">"e|order-violation|partially matching store found but load already executed"</span>);
<a name="l01508"></a>01508 <span class="preprocessor">#endif</span>
<a name="l01509"></a>01509 <span class="preprocessor"></span>            }
<a name="l01510"></a>01510             <span class="comment">/* reset the load's children - the load's going to have to wait until this store commits */</span>
<a name="l01511"></a>01511             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a>)
<a name="l01512"></a>01512             {
<a name="l01513"></a>01513               uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01514"></a>01514               uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01515"></a>01515               <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01516"></a>01516               <span class="keywordflow">while</span>(odep)
<a name="l01517"></a>01517               {
<a name="l01518"></a>01518                 odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01519"></a>01519                 odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <span class="keyword">false</span>;
<a name="l01520"></a>01520 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01521"></a>01521 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01522"></a>01522                   ztrace_print(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>,<span class="stringliteral">"e|snatch-back|parent had partial match in STQ"</span>);
<a name="l01523"></a>01523 <span class="preprocessor">#endif</span>
<a name="l01524"></a>01524 <span class="preprocessor"></span>                <a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">snatch_back</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01525"></a>01525                 odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01526"></a>01526               }
<a name="l01527"></a>01527               <span class="comment">/* clear flag so we don't keep doing this over and over again */</span>
<a name="l01528"></a>01528               <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a> = <span class="keyword">false</span>;
<a name="l01529"></a>01529             }
<a name="l01530"></a>01530             uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l01531"></a>01531 
<a name="l01532"></a>01532             <span class="comment">/* different from STD-not-ready case above, in the case of a partial match,</span>
<a name="l01533"></a>01533 <span class="comment">               the load may not get woken up by the store (and even if it does, the</span>
<a name="l01534"></a>01534 <span class="comment">               load still can't execute, so we reset the load's when_issued so that</span>
<a name="l01535"></a>01535 <span class="comment">               LDQ_schedule keeps polling until the partial-matching store retires. */</span>
<a name="l01536"></a>01536             <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l01537"></a>01537             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01538"></a>01538             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a> = <span class="keyword">false</span>;
<a name="l01539"></a>01539             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9849939f8fb88ebf561452aeb67cb445">first_byte_requested</a> = <span class="keyword">false</span>;
<a name="l01540"></a>01540             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a6b521d057414fe8ea6ed3bed4e51e22">last_byte_requested</a> = <span class="keyword">false</span>;
<a name="l01541"></a>01541             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">first_byte_arrived</a> = <span class="keyword">false</span>;
<a name="l01542"></a>01542             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a> = <span class="keyword">false</span>;
<a name="l01543"></a>01543 
<a name="l01544"></a>01544             <span class="comment">/* On a case where partial store forwarding occurs, the load doesn't really</span>
<a name="l01545"></a>01545 <span class="comment">               "know" when the partially-matched store finishes writing back to the cache.</span>
<a name="l01546"></a>01546 <span class="comment">               So what we do is we stop the load from polling the STQ, except for immediately</span>
<a name="l01547"></a>01547 <span class="comment">               after each store (whether matching or not) writes back and deallocates from</span>
<a name="l01548"></a>01548 <span class="comment">               the senior store queue (see STQ_deallocate_senior). */</span>
<a name="l01549"></a>01549             <span class="keywordflow">if</span>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#8727de6473bf8cbad910c7c11ff2a17d">throttle_partial</a>)
<a name="l01550"></a>01550               <a class="code" href="classcore__exec__DPM__t.html#27fea483684987dd8def0fa02ae8c08c">partial_forward_throttle</a> = <span class="keyword">true</span>;
<a name="l01551"></a>01551             <span class="keywordflow">break</span>;
<a name="l01552"></a>01552           }
<a name="l01553"></a>01553         }
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 
<a name="l01556"></a>01556         num_stores++;
<a name="l01557"></a>01557 
<a name="l01558"></a>01558         j=<a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(j,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(j-1+knobs-&gt;exec.STQ_size) % knobs-&gt;exec.STQ_size;</span>
<a name="l01559"></a>01559 
<a name="l01560"></a>01560         cond1 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a> != NULL;
<a name="l01561"></a>01561         cond2 = cond1 &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[j].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a>-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a> &lt; uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>);
<a name="l01562"></a>01562         cond3 = (num_stores &lt; <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a>);
<a name="l01563"></a>01563       }
<a name="l01564"></a>01564     }
<a name="l01565"></a>01565   }
<a name="l01566"></a>01566 
<a name="l01567"></a>01567   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a> &amp;&amp; <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>-&gt;<a class="code" href="structcache__t.html#9b4a4bd434c4df3d4d004df6b1c362b8">check_for_work</a>) <a class="code" href="config_2zesto-cache_8cpp.html#93ce14ef87e7565964216ea27d912147">cache_process</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>);
<a name="l01568"></a>01568   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>-&gt;<a class="code" href="structcache__t.html#9b4a4bd434c4df3d4d004df6b1c362b8">check_for_work</a>) <a class="code" href="config_2zesto-cache_8cpp.html#93ce14ef87e7565964216ea27d912147">cache_process</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>);
<a name="l01569"></a>01569   <span class="comment">//if((core-&gt;current_thread-&gt;id == 0) &amp;&amp; !(sim_cycle&amp; core-&gt;uncore-&gt;LLC_cycle_mask) &amp;&amp; core-&gt;uncore-&gt;LLC-&gt;check_for_work)</span>
<a name="l01570"></a>01570     <span class="comment">//cache_process(uncore-&gt;LLC);</span>
<a name="l01571"></a>01571   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a> &amp;&amp; <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>-&gt;<a class="code" href="structcache__t.html#9b4a4bd434c4df3d4d004df6b1c362b8">check_for_work</a>) <a class="code" href="config_2zesto-cache_8cpp.html#93ce14ef87e7565964216ea27d912147">cache_process</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>);
<a name="l01572"></a>01572   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#9b4a4bd434c4df3d4d004df6b1c362b8">check_for_work</a>) <a class="code" href="config_2zesto-cache_8cpp.html#93ce14ef87e7565964216ea27d912147">cache_process</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>);
<a name="l01573"></a>01573 }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575 <span class="comment">/* Schedule load uops to execute from the LDQ.  Load execution occurs in a two-step</span>
<a name="l01576"></a>01576 <span class="comment">   process: first the address gets computed (issuing from the RS), and then the</span>
<a name="l01577"></a>01577 <span class="comment">   cache/STQ search occur (issuing from the LDQ). */</span>
<a name="l01578"></a><a class="code" href="classcore__exec__DPM__t.html#3abf667bd2a370573ac2d255e8a0738b">01578</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#3abf667bd2a370573ac2d255e8a0738b">core_exec_DPM_t::LDQ_schedule</a>(<span class="keywordtype">void</span>)
<a name="l01579"></a>01579 {
<a name="l01580"></a>01580   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l01581"></a>01581   <span class="keywordtype">int</span> i;
<a name="l01582"></a>01582   <span class="comment">/* walk LDQ, if anyone's ready, issue to DTLB/DL1 */</span>
<a name="l01583"></a>01583   <span class="keywordtype">int</span> index = <a class="code" href="classcore__exec__DPM__t.html#22cff5744d7616c8b1a7eafb409ae62a">LDQ_head</a>;
<a name="l01584"></a>01584   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a>;i++)
<a name="l01585"></a>01585   {
<a name="l01586"></a>01586     <span class="comment">//int index = (LDQ_head + i) % knobs-&gt;exec.LDQ_size;</span>
<a name="l01587"></a>01587     <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].addr_valid) <span class="comment">/* agen has finished */</span>
<a name="l01588"></a>01588     {
<a name="l01589"></a>01589       <span class="keywordflow">if</span>((!<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].partial_forward || !<a class="code" href="classcore__exec__DPM__t.html#27fea483684987dd8def0fa02ae8c08c">partial_forward_throttle</a>) <span class="comment">/* load not blocked on partially matching store */</span> )
<a name="l01590"></a>01590       {
<a name="l01591"></a>01591         <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].when_issued == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>) <span class="comment">/* load hasn't issued to DL1/STQ already */</span>
<a name="l01592"></a>01592         {
<a name="l01593"></a>01593           <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#15810e9312609410063d8ee3de5e681c">check_load_issue_conditions</a>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].uop)) <span class="comment">/* retval of true means load is predicted to be cleared for issue */</span>
<a name="l01594"></a>01594           {
<a name="l01595"></a>01595             <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>;
<a name="l01596"></a>01596             <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].first_byte_requested)
<a name="l01597"></a>01597             {
<a name="l01598"></a>01598               <span class="keywordflow">if</span>((<a class="code" href="config_2zesto-cache_8cpp.html#35c7c82c117f5713ec55d40f831060da">cache_enqueuable</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>))) &amp;&amp;
<a name="l01599"></a>01599                  (<a class="code" href="config_2zesto-cache_8cpp.html#35c7c82c117f5713ec55d40f831060da">cache_enqueuable</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#fdd71edb53caa0d97b0947644ebfcfc1">phys_addr</a>)) &amp;&amp;
<a name="l01600"></a>01600                  (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> == NULL))
<a name="l01601"></a>01601               {
<a name="l01602"></a>01602                 uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a54efc9d4d0253ebecdac3485cdd5d93">when_data_loaded</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01603"></a>01603                 uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#44c8299aefb215702694ddcc3922b1d6">when_addr_translated</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01604"></a>01604                 <a class="code" href="config_2zesto-cache_8cpp.html#0831369c0f015a2e350b71f2fc445c70">cache_enqueue</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>,NULL,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>),uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>,0,<a class="code" href="config_2zesto-cache_8h.html#47d3ac5bd49bbf1ff15859f38059ac97">NO_MSHR</a>,uop,<a class="code" href="classcore__exec__DPM__t.html#4e14cd7a5104eceeb931ef5498cc6a78">DTLB_callback</a>,<a class="code" href="classcore__exec__DPM__t.html#c18400df36d37f24fcb9c47cb356700a">load_miss_reschedule</a>,NULL,<a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">get_uop_action_id</a>);
<a name="l01605"></a>01605                 <a class="code" href="config_2zesto-cache_8cpp.html#0831369c0f015a2e350b71f2fc445c70">cache_enqueue</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,NULL,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#fdd71edb53caa0d97b0947644ebfcfc1">phys_addr</a>,uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>,0,<a class="code" href="config_2zesto-cache_8h.html#47d3ac5bd49bbf1ff15859f38059ac97">NO_MSHR</a>,uop,<a class="code" href="classcore__exec__DPM__t.html#109d24bd6ea7ae6180264e1cbc763748">DL1_callback</a>,<a class="code" href="classcore__exec__DPM__t.html#c18400df36d37f24fcb9c47cb356700a">load_miss_reschedule</a>,<a class="code" href="classcore__exec__DPM__t.html#f000198904efa0b681cafd05b331c376">translated_callback</a>,<a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">get_uop_action_id</a>);
<a name="l01606"></a>01606 
<a name="l01607"></a>01607                 <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = uop;
<a name="l01608"></a>01608                 <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a>].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#fc1d32ea7cc73c119f2354b07303027c">STQ</a>-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#0adcd9ccf128d31dd9c5b3f122a63010">action_id</a> = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>;
<a name="l01609"></a>01609 
<a name="l01610"></a>01610                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9849939f8fb88ebf561452aeb67cb445">first_byte_requested</a> = <span class="keyword">true</span>;
<a name="l01611"></a>01611                 <span class="keywordflow">if</span>(((uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>+uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>)&gt;&gt;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2537c4668603eddef78b14fc0238266c">addr_shift</a>) == (uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>&gt;&gt;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2537c4668603eddef78b14fc0238266c">addr_shift</a>))
<a name="l01612"></a>01612                 {
<a name="l01613"></a>01613                   <span class="comment">/* not a split-line access */</span>
<a name="l01614"></a>01614                   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a6b521d057414fe8ea6ed3bed4e51e22">last_byte_requested</a> = <span class="keyword">true</span>;
<a name="l01615"></a>01615                   <span class="comment">/* we just mark the last byte as fetched, so that when the default callback gets invoked</span>
<a name="l01616"></a>01616 <span class="comment">                     and sets first_byte_arrived to true, then it appears that the whole line is available. */</span>
<a name="l01617"></a>01617                   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a> = <span class="keyword">true</span>;
<a name="l01618"></a>01618                   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01619"></a>01619                 }
<a name="l01620"></a>01620 
<a name="l01621"></a>01621                 <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].speculative_broadcast) <span class="comment">/* need to re-wakeup children */</span>
<a name="l01622"></a>01622                 {
<a name="l01623"></a>01623                   <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01624"></a>01624                   <span class="keywordflow">if</span>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#9d2834576ea4ae6471d9538548107973">payload_depth</a> &lt; <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#85aa054d657c7a242147602cb1fff479">latency</a>) <span class="comment">/* assume DL1 hit */</span>
<a name="l01625"></a>01625                     <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> + <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#85aa054d657c7a242147602cb1fff479">latency</a> - knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#9d2834576ea4ae6471d9538548107973">payload_depth</a>;
<a name="l01626"></a>01626                   <span class="keywordflow">else</span>
<a name="l01627"></a>01627                     <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01628"></a>01628                   <span class="keywordflow">while</span>(odep)
<a name="l01629"></a>01629                   {
<a name="l01630"></a>01630                     <span class="comment">/* odep already finished executing.  Normally this wouldn't (can't?) happen,</span>
<a name="l01631"></a>01631 <span class="comment">                       but there are some weird interactions between cache misses, store-to-load</span>
<a name="l01632"></a>01632 <span class="comment">                       forwarding, and load stalling on earlier partial forwarding cases. */</span>
<a name="l01633"></a>01633                     <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6a823830b3496618e63ce4486f60fe8c">when_exec</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>) <span class="comment">/* inst already finished executing */</span>
<a name="l01634"></a>01634                     {
<a name="l01635"></a>01635                       <span class="comment">/* bad mis-scheduling, just flush to recover */</span>
<a name="l01637"></a>01637                       uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#b816a0b34ea5ca8a061c02c6946fef3e">branch_mispred</a> = <span class="keyword">true</span>;
<a name="l01638"></a>01638                       <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#c687f6e9c8564e5fd108ca8c9f771dce">pipe_recover</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>);
<a name="l01639"></a>01639                       <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e6a4a159e00e9d5b93db9544015f98f7">num_jeclear</a>++;)
<a name="l01640"></a>01640                       <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#92d2861b39c23b47dd58854da3288e81">spec_mode</a>)
<a name="l01641"></a>01641                         <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#33a60de88faadccd45eacdf575271002">num_wp_jeclear</a>++;)
<a name="l01642"></a>01642 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01643"></a>01643 <span class="preprocessor"></span>          ztrace_print(uop,<span class="stringliteral">"e|jeclear|UNEXPECTED flush"</span>);
<a name="l01644"></a>01644 <span class="preprocessor">#endif</span>
<a name="l01645"></a>01645 <span class="preprocessor"></span>                    }
<a name="l01646"></a>01646                     <span class="keywordflow">else</span>
<a name="l01647"></a>01647                     {
<a name="l01648"></a>01648                       odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a>;
<a name="l01649"></a>01649 
<a name="l01650"></a>01650                       <span class="comment">/* put back on to readyQ if appropriate */</span>
<a name="l01651"></a>01651                       <span class="keywordtype">int</span> j;
<a name="l01652"></a>01652                       <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> when_ready = 0;
<a name="l01653"></a>01653 
<a name="l01654"></a>01654                       <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;j++)
<a name="l01655"></a>01655                         <span class="keywordflow">if</span>(when_ready &lt; odep-&gt;uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j])
<a name="l01656"></a>01656                           when_ready = odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[j];
<a name="l01657"></a>01657 
<a name="l01658"></a>01658                       <span class="keywordflow">if</span>(when_ready &lt; <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01659"></a>01659                       {
<a name="l01660"></a>01660                         odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> = when_ready;
<a name="l01661"></a>01661                         <span class="comment">/* is it possible that the odep is already on the readyq because if</span>
<a name="l01662"></a>01662 <span class="comment">                           it has more than one input replayed on the same cycle, then the</span>
<a name="l01663"></a>01663 <span class="comment">                           first inst to replay will have already placed the odep into</span>
<a name="l01664"></a>01664 <span class="comment">                           the readyq. */</span>
<a name="l01665"></a>01665                         <span class="keywordflow">if</span>(!odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e9795695e79fbfbcdaa52b622a768e1e">in_readyQ</a>)
<a name="l01666"></a>01666                           <a class="code" href="classcore__exec__DPM__t.html#2b25eac2731434d9ca1f5ef99297bac6">insert_ready_uop</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01667"></a>01667                       }
<a name="l01668"></a>01668                     }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670                     odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01671"></a>01671                   }
<a name="l01672"></a>01672                   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a> = <span class="keyword">true</span>;
<a name="l01673"></a>01673                 }
<a name="l01674"></a>01674 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01675"></a>01675 <span class="preprocessor"></span>                ztrace_print(uop,<span class="stringliteral">"e|load|load enqueued to DL1/DTLB"</span>);
<a name="l01676"></a>01676 <span class="preprocessor">#endif</span>
<a name="l01677"></a>01677 <span class="preprocessor"></span>              }
<a name="l01678"></a>01678             }
<a name="l01679"></a>01679 
<a name="l01680"></a>01680             <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].first_byte_requested &amp;&amp; !<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].last_byte_requested)
<a name="l01681"></a>01681             {
<a name="l01682"></a>01682               <span class="comment">/* split-line access.  XXX: we're currently not handling the 2nd translation</span>
<a name="l01683"></a>01683 <span class="comment">                 for acceses that cross *pages*. */</span>
<a name="l01684"></a>01684               <span class="keywordflow">if</span>(<a class="code" href="config_2zesto-cache_8cpp.html#35c7c82c117f5713ec55d40f831060da">cache_enqueuable</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#fdd71edb53caa0d97b0947644ebfcfc1">phys_addr</a>+uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>))
<a name="l01685"></a>01685               {
<a name="l01686"></a>01686                 <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#bb877e542f5f8d359cdf905408babf06">DL1_load_split_accesses</a>++;)
<a name="l01687"></a>01687                 <a class="code" href="config_2zesto-cache_8cpp.html#0831369c0f015a2e350b71f2fc445c70">cache_enqueue</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,NULL,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#fdd71edb53caa0d97b0947644ebfcfc1">phys_addr</a>+uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>,uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>,0,<a class="code" href="config_2zesto-cache_8h.html#47d3ac5bd49bbf1ff15859f38059ac97">NO_MSHR</a>,uop,<a class="code" href="classcore__exec__DPM__t.html#d5d17ca90be424042d6c5051903537d2">DL1_split_callback</a>,<a class="code" href="classcore__exec__DPM__t.html#c18400df36d37f24fcb9c47cb356700a">load_miss_reschedule</a>,<a class="code" href="classcore__exec__DPM__t.html#f000198904efa0b681cafd05b331c376">translated_callback</a>,<a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">get_uop_action_id</a>);
<a name="l01688"></a>01688                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a6b521d057414fe8ea6ed3bed4e51e22">last_byte_requested</a> = <span class="keyword">true</span>;
<a name="l01689"></a>01689                 <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01690"></a>01690                 <span class="comment">/* XXX: we should probably do some rescheduling, too */</span>
<a name="l01691"></a>01691               }
<a name="l01692"></a>01692             }
<a name="l01693"></a>01693           }
<a name="l01694"></a>01694           <span class="keywordflow">else</span>
<a name="l01695"></a>01695           {
<a name="l01696"></a>01696             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01697"></a>01697             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01698"></a>01698             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a> = <span class="keyword">false</span>;
<a name="l01699"></a>01699 
<a name="l01700"></a>01700             <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].speculative_broadcast)
<a name="l01701"></a>01701             {
<a name="l01702"></a>01702               <span class="comment">/* we speculatively scheduled children assuming we'd immediately</span>
<a name="l01703"></a>01703 <span class="comment">                 go to cache, but we didn't... so put children back to sleep */</span>
<a name="l01704"></a>01704               <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01705"></a>01705               <span class="keywordflow">while</span>(odep)
<a name="l01706"></a>01706               {
<a name="l01707"></a>01707                 odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01708"></a>01708                 odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <span class="keyword">false</span>;
<a name="l01709"></a>01709 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01710"></a>01710 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01711"></a>01711                   ztrace_print(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>,<span class="stringliteral">"e|snatch_back|load unable to issue from LDQ to cache"</span>);
<a name="l01712"></a>01712 <span class="preprocessor">#endif</span>
<a name="l01713"></a>01713 <span class="preprocessor"></span>                <a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">snatch_back</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01714"></a>01714 
<a name="l01715"></a>01715                 odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01716"></a>01716               }
<a name="l01717"></a>01717               <span class="comment">/* clear flag so we don't keep doing this over and over again */</span>
<a name="l01718"></a>01718               <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a> = <span class="keyword">false</span>;
<a name="l01719"></a>01719             }
<a name="l01720"></a>01720           }
<a name="l01721"></a>01721         }
<a name="l01722"></a>01722       }
<a name="l01723"></a>01723     }
<a name="l01724"></a>01724     index = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(index,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>);
<a name="l01725"></a>01725   }
<a name="l01726"></a>01726 }
<a name="l01727"></a>01727 
<a name="l01728"></a>01728 <span class="comment">/* Process actual execution (in ALUs) of uops, as well as shuffling of</span>
<a name="l01729"></a>01729 <span class="comment">   uops through the payload pipeline. */</span>
<a name="l01730"></a><a class="code" href="classcore__exec__DPM__t.html#7275a99b63b767196f8a0ff94acac19f">01730</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#7275a99b63b767196f8a0ff94acac19f">core_exec_DPM_t::ALU_exec</a>(<span class="keywordtype">void</span>)
<a name="l01731"></a>01731 {
<a name="l01732"></a>01732   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l01733"></a>01733   <span class="keywordtype">int</span> i;
<a name="l01734"></a>01734 
<a name="l01735"></a>01735   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#1481184b99dd1dca8a0e570980bf1abc">check_for_work</a> == <span class="keyword">false</span>)
<a name="l01736"></a>01736     <span class="keywordflow">return</span>;
<a name="l01737"></a>01737 
<a name="l01738"></a>01738   <span class="keywordtype">bool</span> work_found = <span class="keyword">false</span>;
<a name="l01739"></a>01739 
<a name="l01740"></a>01740   <span class="comment">/* Process Functional Units */</span>
<a name="l01741"></a>01741   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>;i++)
<a name="l01742"></a>01742   {
<a name="l01743"></a>01743     <span class="keywordtype">int</span> j;
<a name="l01744"></a>01744     <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#2447d80ac9daa272dc0d2c5af375cf8e">num_FU_types</a>;j++)
<a name="l01745"></a>01745     {
<a name="l01746"></a>01746       <span class="keyword">enum</span> <a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d">md_fu_class</a> FU_type = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].FU_types[j];
<a name="l01747"></a>01747       <span class="keyword">struct </span><a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html">ALU_t</a> * FU = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[FU_type];
<a name="l01748"></a>01748       <span class="keywordflow">if</span>(FU &amp;&amp; (FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#048592627a2d37afb4cc0c20d0910cd8">occupancy</a> &gt; 0))
<a name="l01749"></a>01749       {
<a name="l01750"></a>01750         work_found = <span class="keyword">true</span>;
<a name="l01751"></a>01751         <span class="comment">/* process last stage of FU pipeline (those uops completing execution) */</span>
<a name="l01752"></a>01752         <span class="keywordtype">int</span> stage = FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a143f618af8681b59955becaf7c0e8e0">latency</a>-1;
<a name="l01753"></a>01753         <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a>;
<a name="l01754"></a>01754         <span class="keywordflow">if</span>(uop)
<a name="l01755"></a>01755         {
<a name="l01756"></a>01756           <span class="keywordtype">int</span> squashed = (FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#0adcd9ccf128d31dd9c5b3f122a63010">action_id</a> != uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>);
<a name="l01757"></a>01757           <span class="keywordtype">int</span> bypass_available = (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#7b2f7ee0f5ef4e237188bbbbf6c48459">when_bypass_used</a> != <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>);
<a name="l01758"></a>01758           <span class="keywordtype">int</span> needs_bypass = !(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#eec85d8cffdbdff59e335df7cf38174a">is_sta</a>||uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#85d4bc293425ae1bcd322b314414ce1b">is_std</a>||uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>||uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#9ccd1826a44171c8c8a70f4ba0206bc9">is_ctrl</a>);
<a name="l01759"></a>01759 
<a name="l01760"></a>01760 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01761"></a>01761 <span class="preprocessor"></span>          ztrace_print(uop,<span class="stringliteral">"e|ALU:squash=%d:needs-bp=%d:bp-available=%d|execution complete"</span>,(<span class="keywordtype">int</span>)squashed,(<span class="keywordtype">int</span>)needs_bypass,(<span class="keywordtype">int</span>)bypass_available);
<a name="l01762"></a>01762 <span class="preprocessor">#endif</span>
<a name="l01763"></a>01763 <span class="preprocessor"></span>
<a name="l01764"></a>01764           <span class="keywordflow">if</span>(squashed || !needs_bypass || bypass_available)
<a name="l01765"></a>01765           {
<a name="l01766"></a>01766             FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#048592627a2d37afb4cc0c20d0910cd8">occupancy</a>--;
<a name="l01767"></a>01767             <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#048592627a2d37afb4cc0c20d0910cd8">occupancy</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l01768"></a>01768             FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = NULL;
<a name="l01769"></a>01769           }
<a name="l01770"></a>01770 
<a name="l01771"></a>01771           <span class="comment">/* there's a uop completing execution (that hasn't been squashed) */</span>
<a name="l01772"></a>01772           <span class="keywordflow">if</span>(!squashed &amp;&amp; (!needs_bypass || bypass_available))
<a name="l01773"></a>01773           {
<a name="l01774"></a>01774             <span class="keywordflow">if</span>(needs_bypass)
<a name="l01775"></a>01775               <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#7b2f7ee0f5ef4e237188bbbbf6c48459">when_bypass_used</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01776"></a>01776 
<a name="l01777"></a>01777             <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>) <span class="comment">/* loads need to be processed differently */</span>
<a name="l01778"></a>01778             {
<a name="l01779"></a>01779               <span class="comment">/* update load queue entry */</span>
<a name="l01780"></a>01780               <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l01781"></a>01781               <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a4e96c4d36187d57b55b3ca3720475d6">virt_addr</a> = uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>;
<a name="l01782"></a>01782               <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#f6227d585f433401f9eb299684cf5ea7">addr_valid</a> = <span class="keyword">true</span>;
<a name="l01783"></a>01783               <span class="comment">/* actual scheduling from load queue takes place in LDQ_schedule() */</span>
<a name="l01784"></a>01784             }
<a name="l01785"></a>01785             <span class="keywordflow">else</span>
<a name="l01786"></a>01786             {
<a name="l01787"></a>01787               <span class="keywordtype">int</span> fp_penalty = ((<a class="code" href="machine_8h.html#68982a77353744eb45beec6d4075bb4b">REG_IS_FPR</a>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#6b25418271a661494d1ddd662cd1ecf8">odep_name</a>) &amp;&amp; !(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#049e7e1cae99e04134e75e9f7f300a7b">opflags</a> &amp; <a class="code" href="machine_8h.html#96492ad3766dc5f2ef84c5ef6a197e11">F_FCOMP</a>)) ||
<a name="l01788"></a>01788                                (!<a class="code" href="machine_8h.html#68982a77353744eb45beec6d4075bb4b">REG_IS_FPR</a>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#6b25418271a661494d1ddd662cd1ecf8">odep_name</a>) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#049e7e1cae99e04134e75e9f7f300a7b">opflags</a> &amp; <a class="code" href="machine_8h.html#96492ad3766dc5f2ef84c5ef6a197e11">F_FCOMP</a>)))?knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#1e0a19a190d0ecb6eb4fabb1a9b32d2d">fp_penalty</a>:0;
<a name="l01789"></a>01789               <span class="comment">/* TODO: real execute-at-execute of instruction */</span>
<a name="l01790"></a>01790               <span class="comment">/* XXX for now just copy oracle value */</span>
<a name="l01791"></a>01791               uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#81fdd7fda39dcc7d7d349ffe8add49b2">ovalue_valid</a> = <span class="keyword">true</span>;
<a name="l01792"></a>01792               uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a> = uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a>;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794               <span class="comment">/* alloc, uopQ, and decode all have to search for the</span>
<a name="l01795"></a>01795 <span class="comment">                 recovery point (Mop) because a long flow may have</span>
<a name="l01796"></a>01796 <span class="comment">                 uops that span multiple sections of the pipeline.  */</span>
<a name="l01797"></a>01797               <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#9ccd1826a44171c8c8a70f4ba0206bc9">is_ctrl</a> &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> != uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a>))
<a name="l01798"></a>01798               {
<a name="l01799"></a>01799                 <span class="comment">//fprintf(stdout," Branch mispredicted ");</span>
<a name="l01800"></a>01800                 uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a> = uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>; <span class="comment">/* in case this instruction gets flushed more than once (jeclear followed by load-nuke) */</span>
<a name="l01801"></a>01801                 uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#b816a0b34ea5ca8a061c02c6946fef3e">branch_mispred</a> = <span class="keyword">true</span>;
<a name="l01802"></a>01802                 <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#c687f6e9c8564e5fd108ca8c9f771dce">pipe_recover</a>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>);
<a name="l01803"></a>01803                 <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e6a4a159e00e9d5b93db9544015f98f7">num_jeclear</a>++;)
<a name="l01804"></a>01804                 <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#92d2861b39c23b47dd58854da3288e81">spec_mode</a>)
<a name="l01805"></a>01805                   <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#33a60de88faadccd45eacdf575271002">num_wp_jeclear</a>++;)
<a name="l01806"></a>01806 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01807"></a>01807 <span class="preprocessor"></span>                ztrace_print(uop,<span class="stringliteral">"e|jeclear|branch mispred detected at execute"</span>);
<a name="l01808"></a>01808 <span class="preprocessor">#endif</span>
<a name="l01809"></a>01809 <span class="preprocessor"></span>              }
<a name="l01810"></a>01810               <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#eec85d8cffdbdff59e335df7cf38174a">is_sta</a>)
<a name="l01811"></a>01811               {
<a name="l01812"></a>01812                 <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l01813"></a>01813                 <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(!<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#467417274abd61110c78ce4b279e924e">addr_valid</a>,(<span class="keywordtype">void</span>)0);
<a name="l01814"></a>01814                 <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#68434b699cc17dac41c332e7ebaf015a">virt_addr</a> = uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>;
<a name="l01815"></a>01815                 <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#467417274abd61110c78ce4b279e924e">addr_valid</a> = <span class="keyword">true</span>;
<a name="l01816"></a>01816               }
<a name="l01817"></a>01817               <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#85d4bc293425ae1bcd322b314414ce1b">is_std</a>)
<a name="l01818"></a>01818               {
<a name="l01819"></a>01819                 <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l01820"></a>01820                 <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(!<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#8f487108e9e9fef004abc9b617bf604d">value_valid</a>,(<span class="keywordtype">void</span>)0);
<a name="l01821"></a>01821                 <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#35a655b6baeb594e50ec6df0dbadaa1d">value</a> = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a>;
<a name="l01822"></a>01822                 <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#8f487108e9e9fef004abc9b617bf604d">value_valid</a> = <span class="keyword">true</span>;
<a name="l01823"></a>01823               }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825               <span class="keywordflow">if</span>((uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#eec85d8cffdbdff59e335df7cf38174a">is_sta</a> || uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#85d4bc293425ae1bcd322b314414ce1b">is_std</a>) &amp;&amp;
<a name="l01826"></a>01826                   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#467417274abd61110c78ce4b279e924e">addr_valid</a> &amp;&amp;
<a name="l01827"></a>01827                   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#8f487108e9e9fef004abc9b617bf604d">value_valid</a>)
<a name="l01828"></a>01828               {
<a name="l01829"></a>01829                 <span class="comment">/* both parts of store have now made it to the STQ: walk</span>
<a name="l01830"></a>01830 <span class="comment">                   forward in LDQ to see if there are any loads waiting on this</span>
<a name="l01831"></a>01831 <span class="comment">                   this STD.  If so, unblock them. */</span>
<a name="l01832"></a>01832                 <span class="keywordtype">int</span> idx;
<a name="l01833"></a>01833                 <span class="keywordtype">int</span> num_loads = 0;
<a name="l01834"></a>01834                 <span class="keywordtype">int</span> overwrite_index = uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>;
<a name="l01835"></a>01835 
<a name="l01836"></a>01836                 <span class="comment">/* XXX using oracle info here. */</span>
<a name="l01837"></a>01837                 <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l01838"></a>01838                 <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> st_addr1 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a>-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>;
<a name="l01839"></a>01839                 <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> st_addr2 = st_addr1 + <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">mem_size</a> - 1;
<a name="l01840"></a>01840 
<a name="l01841"></a>01841                 <span class="comment">/* this is a bit mask for each byte of the stored value; if it reaches zero,</span>
<a name="l01842"></a>01842 <span class="comment">                   then we've been completely overwritten and we can stop.</span>
<a name="l01843"></a>01843 <span class="comment">                   least-sig bit corresponds to lowest address byte. */</span>
<a name="l01844"></a>01844                 <span class="keywordtype">int</span> overwrite_mask = (1&lt;&lt; <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">mem_size</a>)-1;
<a name="l01845"></a>01845 
<a name="l01846"></a>01846                 <span class="keywordflow">for</span>(idx=<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#10592474b3cce4f112cd6c4e8a4bd4b0">next_load</a>;
<a name="l01847"></a>01847                     <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a> &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a> &gt; uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>) &amp;&amp; (num_loads &lt; <a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a>);
<a name="l01848"></a>01848                     idx=<a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(idx,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>))
<a name="l01849"></a>01849                 {
<a name="l01850"></a>01850                   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].store_color != uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>) <span class="comment">/* some younger stores present */</span>
<a name="l01851"></a>01851                   {
<a name="l01852"></a>01852                     <span class="comment">/* scan store queue for younger loads to see if we've been overwritten */</span>
<a name="l01853"></a>01853                     <span class="keywordflow">while</span>(overwrite_index != <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].store_color)
<a name="l01854"></a>01854                     {
<a name="l01855"></a>01855                       overwrite_index = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(overwrite_index,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(overwrite_index + 1) % knobs-&gt;exec.STQ_size;</span>
<a name="l01856"></a>01856                       <span class="keywordflow">if</span>(overwrite_index == <a class="code" href="classcore__exec__DPM__t.html#dd9d11161fa5063c1c4a42010100c4ad">STQ_tail</a>)
<a name="l01857"></a>01857                         <a class="code" href="zesto-MC_8h.html#a62f33e5d3102234e8f957f4722f5f51">zesto_fatal</a>(<span class="stringliteral">"searching for matching store color but hit the end of the STQ"</span>,(<span class="keywordtype">void</span>)0);
<a name="l01858"></a>01858 
<a name="l01859"></a>01859                       <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> new_st_addr1 = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[overwrite_index].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#68434b699cc17dac41c332e7ebaf015a">virt_addr</a>;
<a name="l01860"></a>01860                       <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> new_st_addr2 = new_st_addr1 + <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[overwrite_index].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">mem_size</a> - 1;
<a name="l01861"></a>01861 
<a name="l01862"></a>01862                       <span class="comment">/* does this store overwrite any of our bytes? </span>
<a name="l01863"></a>01863 <span class="comment">                         (1) address has been computed and</span>
<a name="l01864"></a>01864 <span class="comment">                         (2) addr does NOT come completely before or after us */</span>
<a name="l01865"></a>01865                       <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[overwrite_index].addr_valid &amp;&amp;
<a name="l01866"></a>01866                         !((st_addr2 &lt; new_st_addr1) || (st_addr1 &gt; new_st_addr2)))
<a name="l01867"></a>01867                       {
<a name="l01868"></a>01868                         <span class="comment">/* If the old store does a write of 8 bytes at addres 1000, then</span>
<a name="l01869"></a>01869 <span class="comment">                           its mask is:  0000000011111111 (with the lsb representing the</span>
<a name="l01870"></a>01870 <span class="comment">                           byte at address 1000, and the 8th '1' bit mapping to 1007).</span>
<a name="l01871"></a>01871 <span class="comment">                           If the next store is a 2 byte write to address 1002, then</span>
<a name="l01872"></a>01872 <span class="comment">                           its initial mask is 00..00011, which gets shifted up to:</span>
<a name="l01873"></a>01873 <span class="comment">                           0000000000001100.  We then use this to mask out those two</span>
<a name="l01874"></a>01874 <span class="comment">                           bits to get: 0000000011110011, with the remaining 1's indicating</span>
<a name="l01875"></a>01875 <span class="comment">                           which bytes are still "in play" (i.e. have not been overwritten</span>
<a name="l01876"></a>01876 <span class="comment">                           by a younger store) */</span>
<a name="l01877"></a>01877                         <span class="keywordtype">int</span> new_write_mask = (1&lt;&lt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[overwrite_index].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">mem_size</a>)-1;
<a name="l01878"></a>01878                         <span class="keywordtype">int</span> offset = new_st_addr1 - st_addr1;
<a name="l01879"></a>01879                         <span class="keywordflow">if</span>(offset &lt; 0) <span class="comment">/* new_addr is at lower address */</span>
<a name="l01880"></a>01880                           new_write_mask &gt;&gt;= (-offset);
<a name="l01881"></a>01881                         <span class="keywordflow">else</span>
<a name="l01882"></a>01882                           new_write_mask &lt;&lt;= offset;
<a name="l01883"></a>01883                         overwrite_mask &amp;= ~new_write_mask;
<a name="l01884"></a>01884 
<a name="l01885"></a>01885                         <span class="keywordflow">if</span>(overwrite_mask == 0)
<a name="l01886"></a>01886                           <span class="keywordflow">break</span>; <span class="comment">/* while */</span>
<a name="l01887"></a>01887                       }
<a name="l01888"></a>01888                     }
<a name="l01889"></a>01889 
<a name="l01890"></a>01890                     <span class="keywordflow">if</span>(overwrite_mask == 0)
<a name="l01891"></a>01891                       <span class="keywordflow">break</span>; <span class="comment">/* for */</span>
<a name="l01892"></a>01892                   }
<a name="l01893"></a>01893 
<a name="l01894"></a>01894                   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].addr_valid &amp;&amp; <span class="comment">/* if addr not valid, load hasn't finished AGEN... it'll pick up the right value after AGEN */</span>
<a name="l01895"></a>01895                      (<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)) <span class="comment">/* similar to addr not valid, the load'll grab the value when it issues from the LDQ */</span>
<a name="l01896"></a>01896                   {
<a name="l01897"></a>01897                     <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> ld_addr1 = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a4e96c4d36187d57b55b3ca3720475d6">virt_addr</a>;
<a name="l01898"></a>01898                     <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> ld_addr2 = ld_addr1 + <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#10d6df15476a7ae3fd8524ee7ba8de04">mem_size</a> - 1;
<a name="l01899"></a>01899 
<a name="l01900"></a>01900                     <span class="comment">/* order violation/forwarding case/partial forwarding can</span>
<a name="l01901"></a>01901 <span class="comment">                       occur if there's any overlap in the addresses */</span>
<a name="l01902"></a>01902                     <span class="keywordflow">if</span>(!((st_addr2 &lt; ld_addr1) || (st_addr1 &gt; ld_addr2)))
<a name="l01903"></a>01903                     {
<a name="l01904"></a>01904                       <span class="comment">/* Similar to the store-overwrite mask above, we take the store</span>
<a name="l01905"></a>01905 <span class="comment">                         mask to see which bytes are still in play (if all bytes overwritten,</span>
<a name="l01906"></a>01906 <span class="comment">                         then the overwriting stores would have been responsible for forwarding</span>
<a name="l01907"></a>01907 <span class="comment">                         to this load/checking for misspeculations).  Taking the same mask</span>
<a name="l01908"></a>01908 <span class="comment">                         as above, if the store wrote to address 1000, and there was that</span>
<a name="l01909"></a>01909 <span class="comment">                         one intervening store, the mask would still be 0000000011110011.</span>
<a name="l01910"></a>01910 <span class="comment">                         Now if we have a 2-byte load from address 1002, it would generate</span>
<a name="l01911"></a>01911 <span class="comment">                         a mask of 00..00011,then shifted to 00..0001100.  When AND'ed with</span>
<a name="l01912"></a>01912 <span class="comment">                         the store mask, we would get all zeros indicating no conflict (this</span>
<a name="l01913"></a>01913 <span class="comment">                         is ok, even though the store overlaps the load's address range,</span>
<a name="l01914"></a>01914 <span class="comment">                         the latter 2-byte store would have forwarded the value to this 2-byte</span>
<a name="l01915"></a>01915 <span class="comment">                         load).  However, if the load was say 4-byte read from 09FE, it would</span>
<a name="l01916"></a>01916 <span class="comment">                         have a mask of 000..001111.  We would then shift the store's mask</span>
<a name="l01917"></a>01917 <span class="comment">                         (since the load is at a lower address) to 00..0001111001100.  ANDing</span>
<a name="l01918"></a>01918 <span class="comment">                         these gives 00...001100, which indicates that the 2 least significant</span>
<a name="l01919"></a>01919 <span class="comment">                         bytes of the store overlapped with the two most-significant bytes of</span>
<a name="l01920"></a>01920 <span class="comment">                         the load, which reveals a match.  Hooray for non-aligned loads and</span>
<a name="l01921"></a>01921 <span class="comment">                         stores of every which size! */</span>
<a name="l01922"></a>01922                       <span class="keywordtype">int</span> load_read_mask = (1&lt;&lt;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#10d6df15476a7ae3fd8524ee7ba8de04">mem_size</a>) - 1;
<a name="l01923"></a>01923                       <span class="keywordtype">int</span> offset = ld_addr1 - st_addr1;
<a name="l01924"></a>01924                       <span class="keywordflow">if</span>(offset &lt; 0) <span class="comment">/* load is at lower address */</span>
<a name="l01925"></a>01925                         overwrite_mask &lt;&lt;= (-offset);
<a name="l01926"></a>01926                       <span class="keywordflow">else</span>
<a name="l01927"></a>01927                         load_read_mask &lt;&lt;= offset;
<a name="l01928"></a>01928 
<a name="l01929"></a>01929                       <span class="keywordflow">if</span>(load_read_mask &amp; overwrite_mask)
<a name="l01930"></a>01930                       {
<a name="l01931"></a>01931                         <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>) <span class="comment">/* completed --&gt; memory-ordering violation */</span>
<a name="l01932"></a>01932                         {
<a name="l01933"></a>01933                           <a class="code" href="classcore__exec__DPM__t.html#021c735548a662a595a457cee49aef4b">memdep</a>-&gt;<a class="code" href="classmemdep__t.html#61189c4dc4e8dbb5928f51a91d629f76">update</a>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>);
<a name="l01934"></a>01934 
<a name="l01935"></a>01935                           <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#39d7d4fa63d61b57d7b92c14827c0704">load_nukes</a>++;)
<a name="l01936"></a>01936                           <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#92d2861b39c23b47dd58854da3288e81">spec_mode</a>)
<a name="l01937"></a>01937                             <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#285541b5146d15da412fb1475e647123">wp_load_nukes</a>++;)
<a name="l01938"></a>01938 
<a name="l01939"></a>01939 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01940"></a>01940 <span class="preprocessor"></span>                          ztrace_print(uop,<span class="stringliteral">"e|order-violation:STQ=%d|store uncovered mis-ordered load"</span>,uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>);
<a name="l01941"></a>01941                           ztrace_print(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].uop,<span class="stringliteral">"e|order-violation:LDQ=%d|load squashed"</span>,idx);
<a name="l01942"></a>01942 <span class="preprocessor">#endif</span>
<a name="l01944"></a>01944 <span class="preprocessor">                          uop-&gt;Mop-&gt;fetch.branch_mispred = false;</span>
<a name="l01945"></a>01945 <span class="preprocessor"></span>                          <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#d79ed0d31e9421037f71a3aae2aa0cbb">pipe_flush</a>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].uop-&gt;Mop);
<a name="l01946"></a>01946                         }
<a name="l01947"></a>01947                         <span class="keywordflow">else</span> <span class="comment">/* attempted to issue, but STD not available or still in flight in the memory hierarchy */</span>
<a name="l01948"></a>01948                         {
<a name="l01949"></a>01949                           <span class="comment">/* mark load as schedulable */</span>
<a name="l01950"></a>01950                           <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>; <span class="comment">/* this will allow it to get issued from LDQ_schedule */</span>
<a name="l01951"></a>01951                           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l01952"></a>01952                           <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#7259fcc7eea39db7ca525f84e5ee045f">hit_in_STQ</a> = <span class="keyword">false</span>; <span class="comment">/* it's possible the store commits before the load gets back to searching the STQ */</span>
<a name="l01953"></a>01953                           <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9849939f8fb88ebf561452aeb67cb445">first_byte_requested</a> = <span class="keyword">false</span>;
<a name="l01954"></a>01954                           <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#a6b521d057414fe8ea6ed3bed4e51e22">last_byte_requested</a> = <span class="keyword">false</span>;
<a name="l01955"></a>01955                           <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#9d6d4afce7765aba2628d2b698d9fb80">first_byte_arrived</a> = <span class="keyword">false</span>;
<a name="l01956"></a>01956                           <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#79f4c6395a8df5be7f0414d7e035be77">last_byte_arrived</a> = <span class="keyword">false</span>;
<a name="l01957"></a>01957 
<a name="l01958"></a>01958                           <span class="comment">/* invalidate any in-flight loads from cache hierarchy */</span>
<a name="l01959"></a>01959                           <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l01960"></a>01960 
<a name="l01961"></a>01961                           <span class="comment">/* since load attempted to issue, its dependents may have been mis-scheduled */</span>
<a name="l01962"></a>01962                           <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].speculative_broadcast)
<a name="l01963"></a>01963                           {
<a name="l01964"></a>01964                             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01965"></a>01965                             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01966"></a>01966                             <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01967"></a>01967                             <span class="keywordflow">while</span>(odep)
<a name="l01968"></a>01968                             {
<a name="l01969"></a>01969                               odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#fdbdf82713fa7baab2635b9cdc40c232">when_itag_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l01970"></a>01970                               odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <span class="keyword">false</span>;
<a name="l01971"></a>01971 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l01972"></a>01972 <span class="preprocessor"></span>                              <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l01973"></a>01973                                 ztrace_print(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>,<span class="stringliteral">"e|snatch-back|STA hit, but STD not ready"</span>);
<a name="l01974"></a>01974 <span class="preprocessor">#endif</span>
<a name="l01975"></a>01975 <span class="preprocessor"></span>                              <a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">snatch_back</a>(odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>);
<a name="l01976"></a>01976 
<a name="l01977"></a>01977                               odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l01978"></a>01978                             }
<a name="l01979"></a>01979                             <span class="comment">/* clear flag so we don't keep doing this over and over again */</span>
<a name="l01980"></a>01980                             <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[idx].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#8026bfef253db0a335e221851166c6e9">speculative_broadcast</a> = <span class="keyword">false</span>;
<a name="l01981"></a>01981                           }
<a name="l01982"></a>01982                         }
<a name="l01983"></a>01983                       }
<a name="l01984"></a>01984                     }
<a name="l01985"></a>01985                   }
<a name="l01986"></a>01986 
<a name="l01987"></a>01987                   num_loads++;
<a name="l01988"></a>01988                 }
<a name="l01989"></a>01989               }
<a name="l01990"></a>01990               <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>,(<span class="keywordtype">void</span>)0);
<a name="l01991"></a>01991               uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l01992"></a>01992               <a class="code" href="classcore__exec__t.html#cdd57a5cb5d71ea527ef696086d97bee">last_completed</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty; <span class="comment">/* for deadlock detection */</span>
<a name="l01993"></a>01993 
<a name="l01994"></a>01994               <span class="comment">/* bypass output value to dependents */</span>
<a name="l01995"></a>01995               <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * odep = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l01996"></a>01996               <span class="keywordflow">while</span>(odep)
<a name="l01997"></a>01997               {
<a name="l01998"></a>01998                 <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(!odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>],(<span class="keywordtype">void</span>)0);
<a name="l01999"></a>01999                 odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <span class="keyword">true</span>;
<a name="l02000"></a>02000                 <span class="keywordflow">if</span>(odep-&gt;<a class="code" href="structodep__t.html#1b87d9a262d821eb09ac04a1007a7505">aflags</a>)
<a name="l02001"></a>02001                   odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#86094935a31d7cd09945c60b74813abb">ivalue</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>].<a class="code" href="unionval__t.html#0097b33ae33eaf111f07f341005c37ae">dw</a> = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a0d602d55a295c1e2b230d66190f5fc7">oflags</a>;
<a name="l02002"></a>02002                 <span class="keywordflow">else</span>
<a name="l02003"></a>02003                   odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#86094935a31d7cd09945c60b74813abb">ivalue</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#ed68709816c544662f377435b3c3fadb">ovalue</a>;
<a name="l02004"></a>02004                 odep-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a>-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6912f9079359470ab0fd61f0f8972ad6">when_ival_ready</a>[odep-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a>] = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+fp_penalty;
<a name="l02005"></a>02005 
<a name="l02006"></a>02006                 odep = odep-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l02007"></a>02007               }
<a name="l02008"></a>02008             }
<a name="l02009"></a>02009           }
<a name="l02010"></a>02010         }
<a name="l02011"></a>02011 
<a name="l02012"></a>02012         <span class="comment">/* shuffle the rest forward */</span>
<a name="l02013"></a>02013         <span class="keywordflow">if</span>(FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#048592627a2d37afb4cc0c20d0910cd8">occupancy</a> &gt; 0)
<a name="l02014"></a>02014         {
<a name="l02015"></a>02015           <span class="keywordflow">for</span>( <span class="comment">/*nada*/</span>; stage &gt; 0; stage--)
<a name="l02016"></a>02016           {
<a name="l02017"></a>02017             <span class="keywordflow">if</span>((FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> == NULL) &amp;&amp; FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage-1].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a>)
<a name="l02018"></a>02018             {
<a name="l02019"></a>02019               FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage] = FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage-1];
<a name="l02020"></a>02020               FU-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[stage-1].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = NULL;
<a name="l02021"></a>02021             }
<a name="l02022"></a>02022           }
<a name="l02023"></a>02023         }
<a name="l02024"></a>02024       }
<a name="l02025"></a>02025     }
<a name="l02026"></a>02026   }
<a name="l02027"></a>02027 
<a name="l02028"></a>02028   <span class="comment">/* Process Payload RAM pipestages */</span>
<a name="l02029"></a>02029   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a>;i++)
<a name="l02030"></a>02030   {
<a name="l02031"></a>02031     <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].occupancy &gt; 0)
<a name="l02032"></a>02032     {
<a name="l02033"></a>02033       <span class="keywordtype">int</span> stage = knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#9d2834576ea4ae6471d9538548107973">payload_depth</a>-1;
<a name="l02034"></a>02034       <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>[stage].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a>;
<a name="l02035"></a>02035       work_found = <span class="keyword">true</span>;
<a name="l02036"></a>02036 
<a name="l02037"></a>02037       <span class="comment">/* uops leaving payload section go to their respective FU's */</span>
<a name="l02038"></a>02038       <span class="keywordflow">if</span>(uop &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].payload_pipe[stage].<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> == uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>)) <span class="comment">/* uop is valid, hasn't been squashed */</span>
<a name="l02039"></a>02039       {
<a name="l02040"></a>02040         <span class="keywordtype">int</span> j;
<a name="l02041"></a>02041         <span class="keywordtype">int</span> all_ready = <span class="keyword">true</span>;
<a name="l02042"></a>02042         <span class="keyword">enum</span> <a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d">md_fu_class</a> <a class="code" href="structuop__t.html#156195a0d0889db67681f0900c044423">FU_class</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#156195a0d0889db67681f0900c044423">FU_class</a>;
<a name="l02043"></a>02043 
<a name="l02044"></a>02044         <span class="comment">/* uop leaves payload regardless of whether it replays */</span>
<a name="l02045"></a>02045         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>[stage].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = NULL;
<a name="l02046"></a>02046         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#aa00af896d341748fc352988cb528ce7">occupancy</a>--;
<a name="l02047"></a>02047         <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].occupancy &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02048"></a>02048 
<a name="l02049"></a>02049         <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;j++)
<a name="l02050"></a>02050           all_ready &amp;= uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[j];
<a name="l02051"></a>02051 
<a name="l02052"></a>02052         <span class="comment">/* have all input values arrived and FU available? */</span>
<a name="l02053"></a>02053         <span class="keywordflow">if</span>((!all_ready) || (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[FU_class]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> != NULL) || (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[FU_class]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#48cab98e064f120d1679f120f852518c">when_executable</a> &gt; <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>))
<a name="l02054"></a>02054         {
<a name="l02055"></a>02055           <span class="comment">/* if not, replay */</span>
<a name="l02056"></a>02056           <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#b005a5cbe605689ec13b19d653471fcf">exec_uops_replayed</a>++;)
<a name="l02057"></a>02057           uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#893e89c3ea74d28385e53253dbeb7f5b">num_replays</a>++;
<a name="l02058"></a>02058 
<a name="l02059"></a>02059           <span class="keywordflow">for</span>(j=0;j&lt;MAX_IDEPS;j++)
<a name="l02060"></a>02060           {
<a name="l02061"></a>02061             <span class="keywordflow">if</span>((!uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#1f2942c6edfb3dd4179550a04ed91b25">ivalue_valid</a>[j]) &amp;&amp; uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#e941cb97551b1b6f4205334d2c23fbc4">idep_uop</a>[j] &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#e941cb97551b1b6f4205334d2c23fbc4">idep_uop</a>[j]-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#d0a96abdf3806e586b22c423791ca65b">when_otag_ready</a> &lt; <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>))
<a name="l02062"></a>02062             {
<a name="l02063"></a>02063               uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+<a class="code" href="config_2zesto-cache_8h.html#8d2ff015ca2239311fb6533186242f9e">BIG_LATENCY</a>;
<a name="l02064"></a>02064             }
<a name="l02065"></a>02065           }
<a name="l02066"></a>02066           <a class="code" href="classcore__exec__DPM__t.html#27ca36090494dd73c82ce0fecb9b423e">snatch_back</a>(uop);
<a name="l02067"></a>02067 
<a name="l02068"></a>02068           <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>) <span class="comment">/* we were supposed to be ready in the past */</span>
<a name="l02069"></a>02069           {
<a name="l02070"></a>02070             uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>+1;
<a name="l02071"></a>02071             <span class="keywordflow">if</span>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#c39e6bf4d52146fb3a9bcef5434626d8">tornado_breaker</a>)
<a name="l02072"></a>02072             {
<a name="l02073"></a>02073               <span class="comment">/* heuristic replay tornado breaker; if uop is replaying too much, slow down</span>
<a name="l02074"></a>02074 <span class="comment">                 its ability to issue by delaying its readiness (amount of additional delay</span>
<a name="l02075"></a>02075 <span class="comment">                 escalates with the number of times the uop has been replayed).  If a cache</span>
<a name="l02076"></a>02076 <span class="comment">                 access gets "stuck" for some reason (e.g., cache bank blocked due to full</span>
<a name="l02077"></a>02077 <span class="comment">                 MSHRs), the load's dependents won't get notified of a change in the load's</span>
<a name="l02078"></a>02078 <span class="comment">                 latency since the load is still stuck somewhere in the middle of the cache,</span>
<a name="l02079"></a>02079 <span class="comment">                 and so the dependents will enter a loop of scheduling, issuing, reaching</span>
<a name="l02080"></a>02080 <span class="comment">                 execution and discovering that input operands are not ready, and then going</span>
<a name="l02081"></a>02081 <span class="comment">                 back to the RS to immediately start the process all over again.  Such replay</span>
<a name="l02082"></a>02082 <span class="comment">                 "tornados" waste power and issue slots, and so we try to detect and slow</span>
<a name="l02083"></a>02083 <span class="comment">                 down the replay cycle.</span>
<a name="l02084"></a>02084 <span class="comment">                 */</span>
<a name="l02085"></a>02085               <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#893e89c3ea74d28385e53253dbeb7f5b">num_replays</a> &gt; 20)
<a name="l02086"></a>02086                 uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> += uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#893e89c3ea74d28385e53253dbeb7f5b">num_replays</a> &lt;&lt; 1;
<a name="l02087"></a>02087               <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#893e89c3ea74d28385e53253dbeb7f5b">num_replays</a> &gt; 4)
<a name="l02088"></a>02088                 uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a> += uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#893e89c3ea74d28385e53253dbeb7f5b">num_replays</a> &lt;&lt; 3;
<a name="l02089"></a>02089             }
<a name="l02090"></a>02090           }
<a name="l02091"></a>02091 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l02092"></a>02092 <span class="preprocessor"></span>          ztrace_print(uop,<span class="stringliteral">"e|snatch-back|uop cannot go to ALU because inputs not ready"</span>,uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#893e89c3ea74d28385e53253dbeb7f5b">num_replays</a>,uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#0d34db19472056540aed52be61665241">when_ready</a>);
<a name="l02093"></a>02093 <span class="preprocessor">#endif</span>
<a name="l02094"></a>02094 <span class="preprocessor"></span>
<a name="l02095"></a>02095         }
<a name="l02096"></a>02096         <span class="keywordflow">else</span>
<a name="l02097"></a>02097         {
<a name="l02098"></a>02098           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l02099"></a>02099           <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#831dde25d8ef14de7a0c73bc3a5fa3c9">in_fusion</a>)
<a name="l02100"></a>02100             uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#430e0f4aeb84fac91fc04ae7d31b5329">fusion_head</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a1d3be5c5165d80adc09e68c841a79d3">uops_in_RS</a>--;
<a name="l02101"></a>02101 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l02102"></a>02102 <span class="preprocessor"></span>          ztrace_print_start(uop,<span class="stringliteral">"e|payload|uop goes to ALU"</span>);
<a name="l02103"></a>02103 <span class="preprocessor">#endif</span>
<a name="l02104"></a>02104 <span class="preprocessor"></span>
<a name="l02105"></a>02105           <span class="keywordflow">if</span>((!uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#831dde25d8ef14de7a0c73bc3a5fa3c9">in_fusion</a>) || (uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#430e0f4aeb84fac91fc04ae7d31b5329">fusion_head</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a1d3be5c5165d80adc09e68c841a79d3">uops_in_RS</a> == 0)) <span class="comment">/* only deallocate when entire fused uop finished (or not fused) */</span>
<a name="l02106"></a>02106           {
<a name="l02107"></a>02107             <a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">RS</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a>] = NULL;
<a name="l02108"></a>02108             <a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a>--;
<a name="l02109"></a>02109             <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02110"></a>02110             <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#831dde25d8ef14de7a0c73bc3a5fa3c9">in_fusion</a>)
<a name="l02111"></a>02111             {
<a name="l02112"></a>02112               <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * fusion_uop = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#430e0f4aeb84fac91fc04ae7d31b5329">fusion_head</a>;
<a name="l02113"></a>02113               <span class="keywordflow">while</span>(fusion_uop)
<a name="l02114"></a>02114               {
<a name="l02115"></a>02115                 fusion_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> = -1;
<a name="l02116"></a>02116                 fusion_uop = fusion_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#17e765e3d22399396fbe31aab97cdf06">fusion_next</a>;
<a name="l02117"></a>02117               }
<a name="l02118"></a>02118             }
<a name="l02119"></a>02119             <span class="keywordflow">else</span>
<a name="l02120"></a>02120               uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> = -1;
<a name="l02121"></a>02121 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l02122"></a>02122 <span class="preprocessor"></span>            ztrace_print_cont(<span class="stringliteral">", deallocates from RS"</span>);
<a name="l02123"></a>02123 <span class="preprocessor">#endif</span>
<a name="l02124"></a>02124 <span class="preprocessor"></span>          }
<a name="l02125"></a>02125 
<a name="l02126"></a>02126 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l02127"></a>02127 <span class="preprocessor"></span>          ztrace_print_finish(<span class="stringliteral">""</span>);
<a name="l02128"></a>02128 <span class="preprocessor">#endif</span>
<a name="l02129"></a>02129 <span class="preprocessor"></span>
<a name="l02130"></a>02130           <a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a>--;
<a name="l02131"></a>02131           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02132"></a>02132 
<a name="l02133"></a>02133           <span class="comment">/* update port loading table */</span>
<a name="l02134"></a>02134           <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#20394b8c7a44d5ad56a16e9cd635299e">alloc</a>-&gt;<a class="code" href="classcore__alloc__t.html#5be5ea812a0a42bf67a1e307acf0dbd8">RS_deallocate</a>(uop);
<a name="l02135"></a>02135 
<a name="l02136"></a>02136           uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6a823830b3496618e63ce4486f60fe8c">when_exec</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l02137"></a>02137 
<a name="l02138"></a>02138           <span class="comment">/* this port has the proper FU and the first stage is free. */</span>
<a name="l02139"></a>02139           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].FU[FU_class] &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].FU[FU_class]-&gt;pipe[0].uop == NULL),(<span class="keywordtype">void</span>)0);
<a name="l02140"></a>02140 
<a name="l02141"></a>02141           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[FU_class]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = uop;
<a name="l02142"></a>02142           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[FU_class]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#0a7a0d77edc0b1e9014ce573ea157ae5">pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#0adcd9ccf128d31dd9c5b3f122a63010">action_id</a> = uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>;
<a name="l02143"></a>02143           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[FU_class]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#048592627a2d37afb4cc0c20d0910cd8">occupancy</a>++;
<a name="l02144"></a>02144           <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[FU_class]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#48cab98e064f120d1679f120f852518c">when_executable</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> + <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#010d4af24d4fc5e753676432cc29180c">FU</a>[FU_class]-&gt;<a class="code" href="structcore__exec__DPM__t_1_1ALU__t.html#a565898e067059987f9836d533bffbe9">issue_rate</a>;
<a name="l02145"></a>02145           <a class="code" href="classcore__exec__DPM__t.html#1481184b99dd1dca8a0e570980bf1abc">check_for_work</a> = <span class="keyword">true</span>;
<a name="l02146"></a>02146         }
<a name="l02147"></a>02147       }
<a name="l02148"></a>02148       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uop &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].payload_pipe[stage].<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> != uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>)) <span class="comment">/* uop has been squashed */</span>
<a name="l02149"></a>02149       {
<a name="l02150"></a>02150 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l02151"></a>02151 <span class="preprocessor"></span>        ztrace_print(uop,<span class="stringliteral">"e|payload|on exit from payload, uop discovered to have been squashed"</span>);
<a name="l02152"></a>02152 <span class="preprocessor">#endif</span>
<a name="l02153"></a>02153 <span class="preprocessor"></span>        <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>[stage].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = NULL;
<a name="l02154"></a>02154         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#aa00af896d341748fc352988cb528ce7">occupancy</a>--;
<a name="l02155"></a>02155         <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].occupancy &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02156"></a>02156       }
<a name="l02157"></a>02157 
<a name="l02158"></a>02158       <span class="comment">/* shuffle the other uops through the payload pipeline */</span>
<a name="l02159"></a>02159 
<a name="l02160"></a>02160       <span class="keywordflow">for</span>(<span class="comment">/*nada*/</span>; stage &gt; 0; stage--)
<a name="l02161"></a>02161         <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].payload_pipe[stage] = <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].payload_pipe[stage-1];
<a name="l02162"></a>02162       <a class="code" href="classcore__exec__DPM__t.html#7cb72d184613cecd3d2504e6546b77b9">port</a>[i].<a class="code" href="structcore__exec__DPM__t_1_1exec__port__t.html#dfdef9ad8a9874cfbb1f99abb1cf203e">payload_pipe</a>[0].<a class="code" href="structcore__exec__DPM__t_1_1uop__action__t.html#9371fd63194ec02ca9e654a39a46209c">uop</a> = NULL;
<a name="l02163"></a>02163     }
<a name="l02164"></a>02164   }
<a name="l02165"></a>02165 
<a name="l02166"></a>02166   <a class="code" href="classcore__exec__DPM__t.html#1481184b99dd1dca8a0e570980bf1abc">check_for_work</a> = work_found;
<a name="l02167"></a>02167 }
<a name="l02168"></a>02168 
<a name="l02169"></a><a class="code" href="classcore__exec__DPM__t.html#fc70d3a8405f5bbd3102f1ef4119c07b">02169</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#5814929b0ccda77afa4554df6b990783">core_exec_DPM_t::recover</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structMop__t.html">Mop_t</a> * <span class="keyword">const</span> <a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>)
<a name="l02170"></a>02170 {
<a name="l02171"></a>02171   <span class="comment">/* most flushing/squashing is accomplished through assignments of new action_id's */</span>
<a name="l02172"></a>02172 }
<a name="l02173"></a>02173 
<a name="l02174"></a><a class="code" href="classcore__exec__DPM__t.html#5814929b0ccda77afa4554df6b990783">02174</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#5814929b0ccda77afa4554df6b990783">core_exec_DPM_t::recover</a>(<span class="keywordtype">void</span>)
<a name="l02175"></a>02175 {
<a name="l02176"></a>02176   <span class="comment">/* most flushing/squashing is accomplished through assignments of new action_id's */</span>
<a name="l02177"></a>02177 }
<a name="l02178"></a>02178 
<a name="l02179"></a><a class="code" href="classcore__exec__DPM__t.html#2b2575b1ba3174ced4e7bed8b17689d6">02179</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#2b2575b1ba3174ced4e7bed8b17689d6">core_exec_DPM_t::RS_available</a>(<span class="keywordtype">void</span>)
<a name="l02180"></a>02180 {
<a name="l02181"></a>02181   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02182"></a>02182   <span class="keywordflow">return</span> <a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a>;
<a name="l02183"></a>02183 }
<a name="l02184"></a>02184 
<a name="l02185"></a>02185 <span class="comment">/* assumes you already called RS_available to check that</span>
<a name="l02186"></a>02186 <span class="comment">   an entry is available */</span>
<a name="l02187"></a><a class="code" href="classcore__exec__DPM__t.html#8e9ca9566f37da702b6e2f14ead41fad">02187</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#8e9ca9566f37da702b6e2f14ead41fad">core_exec_DPM_t::RS_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l02188"></a>02188 {
<a name="l02189"></a>02189   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02190"></a>02190   <span class="keywordtype">int</span> RS_index;
<a name="l02191"></a>02191   <span class="comment">/* find a free RS entry */</span>
<a name="l02192"></a>02192   <span class="keywordflow">for</span>(RS_index=0;RS_index &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a>;RS_index++)
<a name="l02193"></a>02193   {
<a name="l02194"></a>02194     <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">RS</a>[RS_index] == NULL)
<a name="l02195"></a>02195       <span class="keywordflow">break</span>;
<a name="l02196"></a>02196   }
<a name="l02197"></a>02197   <span class="keywordflow">if</span>(RS_index == knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a>)
<a name="l02198"></a>02198     <a class="code" href="zesto-MC_8h.html#a62f33e5d3102234e8f957f4722f5f51">zesto_fatal</a>(<span class="stringliteral">"RS and RS_num out of sync"</span>,(<span class="keywordtype">void</span>)0);
<a name="l02199"></a>02199 
<a name="l02200"></a>02200   <a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">RS</a>[RS_index] = uop;
<a name="l02201"></a>02201   <a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a>++;
<a name="l02202"></a>02202   <a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a>++;
<a name="l02203"></a>02203   uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> = RS_index;
<a name="l02204"></a>02204 
<a name="l02205"></a>02205   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#831dde25d8ef14de7a0c73bc3a5fa3c9">in_fusion</a>)
<a name="l02206"></a>02206     uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a1d3be5c5165d80adc09e68c841a79d3">uops_in_RS</a> ++; <span class="comment">/* used to track when RS can be deallocated */</span>
<a name="l02207"></a>02207   uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#c7b59f0c9f5dd616855772ccd50554ad">full_fusion_allocated</a> = <span class="keyword">false</span>;
<a name="l02208"></a>02208 }
<a name="l02209"></a>02209 
<a name="l02210"></a>02210 <span class="comment">/* add uops to an existing entry (where all uops in the same</span>
<a name="l02211"></a>02211 <span class="comment">   entry are assumed to be fused) */</span>
<a name="l02212"></a><a class="code" href="classcore__exec__DPM__t.html#06bdb518d429ece3311d878968432bc9">02212</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#06bdb518d429ece3311d878968432bc9">core_exec_DPM_t::RS_fuse_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l02213"></a>02213 {
<a name="l02214"></a>02214   <span class="comment">/* fusion body shares same RS entry as fusion head */</span>
<a name="l02215"></a>02215   uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#430e0f4aeb84fac91fc04ae7d31b5329">fusion_head</a>-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a>;
<a name="l02216"></a>02216   <a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a>++;
<a name="l02217"></a>02217   uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#430e0f4aeb84fac91fc04ae7d31b5329">fusion_head</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a1d3be5c5165d80adc09e68c841a79d3">uops_in_RS</a> ++;
<a name="l02218"></a>02218   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#17e765e3d22399396fbe31aab97cdf06">fusion_next</a> == NULL)
<a name="l02219"></a>02219     uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#430e0f4aeb84fac91fc04ae7d31b5329">fusion_head</a>-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#c7b59f0c9f5dd616855772ccd50554ad">full_fusion_allocated</a> = <span class="keyword">true</span>;
<a name="l02220"></a>02220 }
<a name="l02221"></a>02221 
<a name="l02222"></a><a class="code" href="classcore__exec__DPM__t.html#91a1a6eefe2b90d3c4d786f688b116d4">02222</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#91a1a6eefe2b90d3c4d786f688b116d4">core_exec_DPM_t::RS_deallocate</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> dead_uop)
<a name="l02223"></a>02223 {
<a name="l02224"></a>02224   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02225"></a>02225   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a>,(<span class="keywordtype">void</span>)0);
<a name="l02226"></a>02226   <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#831dde25d8ef14de7a0c73bc3a5fa3c9">in_fusion</a> &amp;&amp; (dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#6a823830b3496618e63ce4486f60fe8c">when_exec</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>))
<a name="l02227"></a>02227   {
<a name="l02228"></a>02228     dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#430e0f4aeb84fac91fc04ae7d31b5329">fusion_head</a>-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a1d3be5c5165d80adc09e68c841a79d3">uops_in_RS</a> --;
<a name="l02229"></a>02229     <a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a>--;
<a name="l02230"></a>02230     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02231"></a>02231   }
<a name="l02232"></a>02232   <span class="keywordflow">if</span>(!dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#831dde25d8ef14de7a0c73bc3a5fa3c9">in_fusion</a>)
<a name="l02233"></a>02233   {
<a name="l02234"></a>02234     <a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a>--;
<a name="l02235"></a>02235     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#2308413374fddf442d11516c374fbd6e">RS_eff_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02236"></a>02236   }
<a name="l02237"></a>02237 
<a name="l02238"></a>02238   <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#e915e589eff078d3f108ff4d45ed216c">is_fusion_head</a>)
<a name="l02239"></a>02239     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#a1d3be5c5165d80adc09e68c841a79d3">uops_in_RS</a> == 0,(<span class="keywordtype">void</span>)0);
<a name="l02240"></a>02240 
<a name="l02241"></a>02241   <span class="keywordflow">if</span>((!dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#831dde25d8ef14de7a0c73bc3a5fa3c9">in_fusion</a>) || dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#e915e589eff078d3f108ff4d45ed216c">is_fusion_head</a>) <span class="comment">/* make head uop responsible for deallocating RS during recovery */</span>
<a name="l02242"></a>02242   {
<a name="l02243"></a>02243     <a class="code" href="classcore__exec__DPM__t.html#91582412a8b3c78e5d75271f4189a0d2">RS</a>[dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a>] = NULL;
<a name="l02244"></a>02244     <a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a> --;
<a name="l02245"></a>02245     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02246"></a>02246   }
<a name="l02247"></a>02247   dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> = -1;
<a name="l02248"></a>02248 }
<a name="l02249"></a>02249 
<a name="l02250"></a><a class="code" href="classcore__exec__DPM__t.html#9b7fef0c453e1980ff612a7e0181ed03">02250</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#9b7fef0c453e1980ff612a7e0181ed03">core_exec_DPM_t::LDQ_available</a>(<span class="keywordtype">void</span>)
<a name="l02251"></a>02251 {
<a name="l02252"></a>02252   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02253"></a>02253   <span class="keywordflow">return</span> <a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>;
<a name="l02254"></a>02254 }
<a name="l02255"></a>02255 
<a name="l02256"></a><a class="code" href="classcore__exec__DPM__t.html#3df4995363c8fe7593800e13315bd14c">02256</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#3df4995363c8fe7593800e13315bd14c">core_exec_DPM_t::LDQ_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l02257"></a>02257 {
<a name="l02258"></a>02258   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02259"></a>02259   <span class="comment">//memset(&amp;LDQ[LDQ_tail],0,sizeof(*LDQ));</span>
<a name="l02260"></a>02260   <a class="code" href="misc_8h.html#c0247ae9677929c0d7a34cd197d3e57e">memzero</a>(&amp;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[<a class="code" href="classcore__exec__DPM__t.html#eeb8e9d2ac0d5f0da9ef92cf4617b2bb">LDQ_tail</a>],<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>));
<a name="l02261"></a>02261   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[LDQ_tail].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a> = uop;
<a name="l02262"></a>02262   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[LDQ_tail].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#10d6df15476a7ae3fd8524ee7ba8de04">mem_size</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>;
<a name="l02263"></a>02263   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[LDQ_tail].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1f4a7cd8f60161109737d9722f60d6fc">store_color</a> = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__exec__DPM__t.html#dd9d11161fa5063c1c4a42010100c4ad">STQ_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(STQ_tail - 1 + knobs-&gt;exec.STQ_size) % knobs-&gt;exec.STQ_size;</span>
<a name="l02264"></a>02264   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[LDQ_tail].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#1b66eb313a8160ccb653bfe35058c01d">when_issued</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l02265"></a>02265   uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> = LDQ_tail;
<a name="l02266"></a>02266   <a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a>++;
<a name="l02267"></a>02267   LDQ_tail = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(LDQ_tail,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>); <span class="comment">//(LDQ_tail+1) % knobs-&gt;exec.LDQ_size;</span>
<a name="l02268"></a>02268 }
<a name="l02269"></a>02269 
<a name="l02270"></a>02270 <span class="comment">/* called by commit */</span>
<a name="l02271"></a><a class="code" href="classcore__exec__DPM__t.html#78f6cdc56b22df9d7d26ed6a59edd762">02271</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#78f6cdc56b22df9d7d26ed6a59edd762">core_exec_DPM_t::LDQ_deallocate</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l02272"></a>02272 {
<a name="l02273"></a>02273   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02274"></a>02274   <a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[<a class="code" href="classcore__exec__DPM__t.html#22cff5744d7616c8b1a7eafb409ae62a">LDQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a> = NULL;
<a name="l02275"></a>02275   <a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a> --;
<a name="l02276"></a>02276   <a class="code" href="classcore__exec__DPM__t.html#22cff5744d7616c8b1a7eafb409ae62a">LDQ_head</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__exec__DPM__t.html#22cff5744d7616c8b1a7eafb409ae62a">LDQ_head</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>); <span class="comment">//(LDQ_head+1) % knobs-&gt;exec.LDQ_size;</span>
<a name="l02277"></a>02277   uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> = -1;
<a name="l02278"></a>02278 }
<a name="l02279"></a>02279 
<a name="l02280"></a><a class="code" href="classcore__exec__DPM__t.html#61bee8b6575679752ff99b170f09fec7">02280</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#61bee8b6575679752ff99b170f09fec7">core_exec_DPM_t::LDQ_squash</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> dead_uop)
<a name="l02281"></a>02281 {
<a name="l02282"></a>02282   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02283"></a>02283   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &gt;= 0) &amp;&amp; (dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l02284"></a>02284   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1LDQ__t.html#bf45eb3853f62915fa9ca4a9f748aced">uop</a> == dead_uop,(<span class="keywordtype">void</span>)0);
<a name="l02285"></a>02285   <span class="comment">//memset(&amp;LDQ[dead_uop-&gt;alloc.LDQ_index],0,sizeof(LDQ[0]));</span>
<a name="l02286"></a>02286   <a class="code" href="misc_8h.html#c0247ae9677929c0d7a34cd197d3e57e">memzero</a>(&amp;<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a>],<span class="keyword">sizeof</span>(<a class="code" href="classcore__exec__DPM__t.html#4fe7b0eceb18489825f37b8c97513598">LDQ</a>[0]));
<a name="l02287"></a>02287   <a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a> --;
<a name="l02288"></a>02288   <a class="code" href="classcore__exec__DPM__t.html#eeb8e9d2ac0d5f0da9ef92cf4617b2bb">LDQ_tail</a> = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__exec__DPM__t.html#eeb8e9d2ac0d5f0da9ef92cf4617b2bb">LDQ_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a>); <span class="comment">//(LDQ_tail - 1 + knobs-&gt;exec.LDQ_size) % knobs-&gt;exec.LDQ_size;</span>
<a name="l02289"></a>02289   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02290"></a>02290   dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d058a7ec11bfd9e8174d4bc77570512c">LDQ_index</a> = -1;
<a name="l02291"></a>02291 }
<a name="l02292"></a>02292 
<a name="l02293"></a><a class="code" href="classcore__exec__DPM__t.html#cd2ed4a962da699b47dda3abc24d256a">02293</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#cd2ed4a962da699b47dda3abc24d256a">core_exec_DPM_t::STQ_available</a>(<span class="keywordtype">void</span>)
<a name="l02294"></a>02294 {
<a name="l02295"></a>02295   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02296"></a>02296   <span class="keywordflow">return</span> <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>;
<a name="l02297"></a>02297 }
<a name="l02298"></a>02298 
<a name="l02299"></a><a class="code" href="classcore__exec__DPM__t.html#0c23a1b1e2f0c81600467c544aa1a6b3">02299</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#0c23a1b1e2f0c81600467c544aa1a6b3">core_exec_DPM_t::STQ_insert_sta</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l02300"></a>02300 {
<a name="l02301"></a>02301   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02302"></a>02302   <span class="comment">//memset(&amp;STQ[STQ_tail],0,sizeof(*STQ));</span>
<a name="l02303"></a>02303   <a class="code" href="misc_8h.html#c0247ae9677929c0d7a34cd197d3e57e">memzero</a>(&amp;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#dd9d11161fa5063c1c4a42010100c4ad">STQ_tail</a>],<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>));
<a name="l02304"></a>02304   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[STQ_tail].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a> = uop;
<a name="l02305"></a>02305   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[STQ_tail].sta != NULL)
<a name="l02306"></a>02306     uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#eec85d8cffdbdff59e335df7cf38174a">is_sta</a> = <span class="keyword">true</span>;
<a name="l02307"></a>02307   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[STQ_tail].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8d2c250122d5b13cb3f6e92fd655372">mem_size</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>;
<a name="l02308"></a>02308   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[STQ_tail].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#f75e13d26a4ebba3da425d142902811c">uop_seq</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>;
<a name="l02309"></a>02309   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[STQ_tail].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#10592474b3cce4f112cd6c4e8a4bd4b0">next_load</a> = <a class="code" href="classcore__exec__DPM__t.html#eeb8e9d2ac0d5f0da9ef92cf4617b2bb">LDQ_tail</a>;
<a name="l02310"></a>02310   uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> = STQ_tail;
<a name="l02311"></a>02311   <a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a>++;
<a name="l02312"></a>02312   <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a>++;
<a name="l02313"></a>02313   STQ_tail = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(STQ_tail,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(STQ_tail+1) % knobs-&gt;exec.STQ_size;</span>
<a name="l02314"></a>02314 }
<a name="l02315"></a>02315 
<a name="l02316"></a><a class="code" href="classcore__exec__DPM__t.html#f8766fda83629cd750d7b41ed7ea7a95">02316</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#f8766fda83629cd750d7b41ed7ea7a95">core_exec_DPM_t::STQ_insert_std</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l02317"></a>02317 {
<a name="l02318"></a>02318   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02319"></a>02319   <span class="comment">/* STQ_tail already incremented from the STA.  Just add this uop to STQ-&gt;std */</span>
<a name="l02320"></a>02320   <span class="keywordtype">int</span> index = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__exec__DPM__t.html#dd9d11161fa5063c1c4a42010100c4ad">STQ_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(STQ_tail - 1 + knobs-&gt;exec.STQ_size) % knobs-&gt;exec.STQ_size;</span>
<a name="l02321"></a>02321   uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> = index;
<a name="l02322"></a>02322   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[index].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#e0344449b4f8eef6b241aa620f0ae4ec">std</a> = uop;
<a name="l02323"></a>02323   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[index].sta,(<span class="keywordtype">void</span>)0); <span class="comment">/* shouldn't have STD w/o a corresponding STA */</span>
<a name="l02324"></a>02324   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[index].sta-&gt;Mop == uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>,(<span class="keywordtype">void</span>)0); <span class="comment">/* and we should be from the same macro */</span>
<a name="l02325"></a>02325 }
<a name="l02326"></a>02326 
<a name="l02327"></a><a class="code" href="classcore__exec__DPM__t.html#92a5d237405f5a04e466d1f023dcd4fa">02327</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#92a5d237405f5a04e466d1f023dcd4fa">core_exec_DPM_t::STQ_deallocate_sta</a>(<span class="keywordtype">void</span>)
<a name="l02328"></a>02328 {
<a name="l02329"></a>02329   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a> = NULL;
<a name="l02330"></a>02330 }
<a name="l02331"></a>02331 
<a name="l02332"></a>02332 <span class="comment">/* returns true if successful */</span>
<a name="l02333"></a><a class="code" href="classcore__exec__DPM__t.html#4593c06b9cd20d697033cfd948837df6">02333</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#4593c06b9cd20d697033cfd948837df6">core_exec_DPM_t::STQ_deallocate_std</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l02334"></a>02334 {
<a name="l02335"></a>02335   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02336"></a>02336   <span class="comment">/* Store write back occurs here at commit.  NOTE: stores go directly to</span>
<a name="l02337"></a>02337 <span class="comment">     DTLB2 (See "Intel 64 and IA-32 Architectures Optimization Reference</span>
<a name="l02338"></a>02338 <span class="comment">     Manual"). */</span>
<a name="l02339"></a>02339   <span class="keyword">struct </span><a class="code" href="structcache__t.html">cache_t</a> * tlb = (<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>)?<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>:<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>;
<a name="l02340"></a>02340   <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8cpp.html#35c7c82c117f5713ec55d40f831060da">cache_enqueuable</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#fdd71edb53caa0d97b0947644ebfcfc1">phys_addr</a>) ||
<a name="l02341"></a>02341      !<a class="code" href="config_2zesto-cache_8cpp.html#35c7c82c117f5713ec55d40f831060da">cache_enqueuable</a>(tlb,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>)))
<a name="l02342"></a>02342     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02343"></a>02343 
<a name="l02344"></a>02344 
<a name="l02345"></a>02345   <span class="keywordflow">if</span>(!<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].first_byte_requested)
<a name="l02346"></a>02346   {
<a name="l02347"></a>02347     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#877df377f0f978281a76644e31f9fd96">translation_complete</a> = <span class="keyword">false</span>;
<a name="l02348"></a>02348     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8a0d483ae23caa1cca70f2636c48109">write_complete</a> = <span class="keyword">false</span>;
<a name="l02349"></a>02349     <span class="comment">/* These are just dummy placeholders, but we need them</span>
<a name="l02350"></a>02350 <span class="comment">       because the original uop pointers will be made invalid</span>
<a name="l02351"></a>02351 <span class="comment">       when the Mop commits and the oracle reclaims the</span>
<a name="l02352"></a>02352 <span class="comment">       original uop-arrays.  The store continues to occupy STQ</span>
<a name="l02353"></a>02353 <span class="comment">       entries until the store actually finishes accessing</span>
<a name="l02354"></a>02354 <span class="comment">       memory, but commit can proceed past this store once the</span>
<a name="l02355"></a>02355 <span class="comment">       request has entered into the cache hierarchy. */</span>
<a name="l02356"></a>02356     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * dl1_uop = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#c7fc21b5fb694c21209262c29615fdb7">get_uop_array</a>(1);
<a name="l02357"></a>02357     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * dtlb_uop = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#c7fc21b5fb694c21209262c29615fdb7">get_uop_array</a>(1);
<a name="l02358"></a>02358     dl1_uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>;
<a name="l02359"></a>02359     dtlb_uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>;
<a name="l02360"></a>02360 
<a name="l02361"></a>02361     dl1_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> = uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>;
<a name="l02362"></a>02362     dtlb_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> = uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>;
<a name="l02363"></a>02363 
<a name="l02364"></a>02364     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l02365"></a>02365     dl1_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a>;
<a name="l02366"></a>02366     dtlb_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a>;
<a name="l02367"></a>02367     dl1_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#46ca09f2272d8c3dd6b6b14d5e722185">Mop_seq</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#46ca09f2272d8c3dd6b6b14d5e722185">Mop_seq</a>;
<a name="l02368"></a>02368     dtlb_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#46ca09f2272d8c3dd6b6b14d5e722185">Mop_seq</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#46ca09f2272d8c3dd6b6b14d5e722185">Mop_seq</a>;
<a name="l02369"></a>02369     dl1_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>;
<a name="l02370"></a>02370     dtlb_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>;
<a name="l02371"></a>02371 
<a name="l02372"></a>02372     <a class="code" href="config_2zesto-cache_8cpp.html#0831369c0f015a2e350b71f2fc445c70">cache_enqueue</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,tlb,NULL,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>),dtlb_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>,0,<a class="code" href="config_2zesto-cache_8h.html#47d3ac5bd49bbf1ff15859f38059ac97">NO_MSHR</a>,dtlb_uop,<a class="code" href="classcore__exec__DPM__t.html#e44b1534550acdb1621aea03f5de7011">store_dtlb_callback</a>,NULL,NULL,<a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">get_uop_action_id</a>);
<a name="l02373"></a>02373     <a class="code" href="config_2zesto-cache_8cpp.html#0831369c0f015a2e350b71f2fc445c70">cache_enqueue</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,NULL,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255f31232fbf9e45b41922cf68b09a4a201">CACHE_WRITE</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#fdd71edb53caa0d97b0947644ebfcfc1">phys_addr</a>,dl1_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>,0,<a class="code" href="config_2zesto-cache_8h.html#47d3ac5bd49bbf1ff15859f38059ac97">NO_MSHR</a>,dl1_uop,<a class="code" href="classcore__exec__DPM__t.html#e5b9da15ba0b9b90d68793c6dcf6e5a4">store_dl1_callback</a>,NULL,<a class="code" href="classcore__exec__DPM__t.html#d61bb8f33057037b8d0d9b20270352b5">store_translated_callback</a>,<a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">get_uop_action_id</a>);
<a name="l02374"></a>02374 
<a name="l02375"></a>02375     <span class="comment">/* not a split-line access */</span>
<a name="l02376"></a>02376     <span class="keywordflow">if</span>(((uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>+uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>)&gt;&gt;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2537c4668603eddef78b14fc0238266c">addr_shift</a>) == (uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#d7e89a7b0583599bf140c251ce1731f5">virt_addr</a>&gt;&gt;<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>-&gt;<a class="code" href="structcache__t.html#2537c4668603eddef78b14fc0238266c">addr_shift</a>))
<a name="l02377"></a>02377     {
<a name="l02378"></a>02378       <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#6dc334ad05d9160f08b81e1ffa2898ea">last_byte_requested</a> = <span class="keyword">true</span>;
<a name="l02379"></a>02379       <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b7e912e72db5bc04e0c5a1bece119286">last_byte_written</a> = <span class="keyword">true</span>;
<a name="l02380"></a>02380     }
<a name="l02381"></a>02381 
<a name="l02382"></a>02382     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#9bcbb2b9abc5c2f3efe77419f003796b">first_byte_requested</a> = <span class="keyword">true</span>;
<a name="l02383"></a>02383   }
<a name="l02384"></a>02384 
<a name="l02385"></a>02385   <span class="comment">/* split-line access */</span>
<a name="l02386"></a>02386   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].first_byte_requested &amp;&amp; !<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].last_byte_requested)
<a name="l02387"></a>02387   {
<a name="l02388"></a>02388     <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#e3f4766c49b7d48cff4cdcbf0db8f24a">DL1_store_split_accesses</a>++;)
<a name="l02389"></a>02389 
<a name="l02390"></a>02390     <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8cpp.html#35c7c82c117f5713ec55d40f831060da">cache_enqueuable</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#fdd71edb53caa0d97b0947644ebfcfc1">phys_addr</a>+uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>))
<a name="l02391"></a>02391       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02392"></a>02392 
<a name="l02393"></a>02393     <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * dl1_split_uop = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#c7fc21b5fb694c21209262c29615fdb7">get_uop_array</a>(1);
<a name="l02394"></a>02394     dl1_split_uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>;
<a name="l02395"></a>02395     dl1_split_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> = uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>;
<a name="l02396"></a>02396     dl1_split_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a>;
<a name="l02397"></a>02397     dl1_split_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#46ca09f2272d8c3dd6b6b14d5e722185">Mop_seq</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#46ca09f2272d8c3dd6b6b14d5e722185">Mop_seq</a>;
<a name="l02398"></a>02398     dl1_split_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a> = uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#a7b9e443607a13d90b1b51db2a921257">uop_seq</a>;
<a name="l02399"></a>02399 
<a name="l02400"></a>02400     <span class="comment">/* XXX: similar to split-access loads, we're not handling the translation of both</span>
<a name="l02401"></a>02401 <span class="comment">       pages in the case that the access crosses page boundaries. */</span>
<a name="l02402"></a>02402     <a class="code" href="config_2zesto-cache_8cpp.html#0831369c0f015a2e350b71f2fc445c70">cache_enqueue</a>(<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,NULL,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255f31232fbf9e45b41922cf68b09a4a201">CACHE_WRITE</a>,<a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,uop-&gt;<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#fdd71edb53caa0d97b0947644ebfcfc1">phys_addr</a>+uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#58a7c8e6a49a879b290148211ac08e5a">mem_size</a>,dl1_split_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a>,0,<a class="code" href="config_2zesto-cache_8h.html#47d3ac5bd49bbf1ff15859f38059ac97">NO_MSHR</a>,dl1_split_uop,<a class="code" href="classcore__exec__DPM__t.html#1ebb3bdb6783434b0ff5857ab17ea8ff">store_dl1_split_callback</a>,NULL,<a class="code" href="classcore__exec__DPM__t.html#d61bb8f33057037b8d0d9b20270352b5">store_translated_callback</a>,<a class="code" href="classcore__exec__DPM__t.html#3a16f4bb7b4626d019f66a46d0cf63af">get_uop_action_id</a>);
<a name="l02403"></a>02403 
<a name="l02404"></a>02404     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#6dc334ad05d9160f08b81e1ffa2898ea">last_byte_requested</a> = <span class="keyword">true</span>;
<a name="l02405"></a>02405   }
<a name="l02406"></a>02406 
<a name="l02407"></a>02407   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].first_byte_requested &amp;&amp; <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].last_byte_requested)
<a name="l02408"></a>02408   {
<a name="l02409"></a>02409 <span class="preprocessor">#ifdef ZTRACE</span>
<a name="l02410"></a>02410 <span class="preprocessor"></span>    ztrace_print(uop,<span class="stringliteral">"c|store|store enqueued to DL1/DTLB"</span>);
<a name="l02411"></a>02411 <span class="preprocessor">#endif</span>
<a name="l02412"></a>02412 <span class="preprocessor"></span>
<a name="l02413"></a>02413     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#e0344449b4f8eef6b241aa620f0ae4ec">std</a> = NULL;
<a name="l02414"></a>02414     <a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a> --;
<a name="l02415"></a>02415     <a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(STQ_head+1) % knobs-&gt;exec.STQ_size;</span>
<a name="l02416"></a>02416 
<a name="l02417"></a>02417     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02418"></a>02418   }
<a name="l02419"></a>02419   <span class="keywordflow">else</span>
<a name="l02420"></a>02420     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">/* store not completed processed */</span>
<a name="l02421"></a>02421 }
<a name="l02422"></a>02422 
<a name="l02423"></a><a class="code" href="classcore__exec__DPM__t.html#3d53b2fdf7a7417775826ba647ee0b7d">02423</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#3d53b2fdf7a7417775826ba647ee0b7d">core_exec_DPM_t::STQ_deallocate_senior</a>(<span class="keywordtype">void</span>)
<a name="l02424"></a>02424 {
<a name="l02425"></a>02425   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02426"></a>02426   <span class="keywordflow">if</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a>].write_complete &amp;&amp;
<a name="l02427"></a>02427      <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a>].translation_complete)
<a name="l02428"></a>02428   {
<a name="l02429"></a>02429     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8a0d483ae23caa1cca70f2636c48109">write_complete</a> = <span class="keyword">false</span>;
<a name="l02430"></a>02430     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#877df377f0f978281a76644e31f9fd96">translation_complete</a> = <span class="keyword">false</span>;
<a name="l02431"></a>02431     <a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(STQ_senior_head + 1) % knobs-&gt;exec.STQ_size;</span>
<a name="l02432"></a>02432     <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a>--;
<a name="l02433"></a>02433     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02434"></a>02434     <a class="code" href="classcore__exec__DPM__t.html#27fea483684987dd8def0fa02ae8c08c">partial_forward_throttle</a> = <span class="keyword">false</span>;
<a name="l02435"></a>02435   }
<a name="l02436"></a>02436 }
<a name="l02437"></a>02437 
<a name="l02438"></a><a class="code" href="classcore__exec__DPM__t.html#579b2933ffc0634a765926c8accab187">02438</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#579b2933ffc0634a765926c8accab187">core_exec_DPM_t::STQ_squash_sta</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> dead_uop)
<a name="l02439"></a>02439 {
<a name="l02440"></a>02440   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02441"></a>02441   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l02442"></a>02442   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#e0344449b4f8eef6b241aa620f0ae4ec">std</a> == NULL,(<span class="keywordtype">void</span>)0);
<a name="l02443"></a>02443   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#fea78f479facb83c6ecdc231e2297960">sta</a> == dead_uop,(<span class="keywordtype">void</span>)0);
<a name="l02444"></a>02444   <span class="comment">//memset(&amp;STQ[dead_uop-&gt;alloc.STQ_index],0,sizeof(STQ[0]));</span>
<a name="l02445"></a>02445   <a class="code" href="misc_8h.html#c0247ae9677929c0d7a34cd197d3e57e">memzero</a>(&amp;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>],<span class="keyword">sizeof</span>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[0]));
<a name="l02446"></a>02446   <a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a> --;
<a name="l02447"></a>02447   <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a> --;
<a name="l02448"></a>02448   <a class="code" href="classcore__exec__DPM__t.html#dd9d11161fa5063c1c4a42010100c4ad">STQ_tail</a> = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__exec__DPM__t.html#dd9d11161fa5063c1c4a42010100c4ad">STQ_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(STQ_tail - 1 + knobs-&gt;exec.STQ_size) % knobs-&gt;exec.STQ_size;</span>
<a name="l02449"></a>02449   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02450"></a>02450   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l02451"></a>02451   dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> = -1;
<a name="l02452"></a>02452 }
<a name="l02453"></a>02453 
<a name="l02454"></a><a class="code" href="classcore__exec__DPM__t.html#877aa84541b1cdaec526a14aaa890c05">02454</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#877aa84541b1cdaec526a14aaa890c05">core_exec_DPM_t::STQ_squash_std</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> dead_uop)
<a name="l02455"></a>02455 {
<a name="l02456"></a>02456   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02457"></a>02457   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l02458"></a>02458   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#e0344449b4f8eef6b241aa620f0ae4ec">std</a> == dead_uop,(<span class="keywordtype">void</span>)0);
<a name="l02459"></a>02459   <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#e0344449b4f8eef6b241aa620f0ae4ec">std</a> = NULL;
<a name="l02460"></a>02460   dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> = -1;
<a name="l02461"></a>02461 }
<a name="l02462"></a>02462 
<a name="l02463"></a><a class="code" href="classcore__exec__DPM__t.html#be6f5af1f9348805b6582a768885201b">02463</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#be6f5af1f9348805b6582a768885201b">core_exec_DPM_t::STQ_squash_senior</a>(<span class="keywordtype">void</span>)
<a name="l02464"></a>02464 {
<a name="l02465"></a>02465   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02466"></a>02466 
<a name="l02467"></a>02467   <span class="keywordflow">while</span>(<a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a> &gt; 0)
<a name="l02468"></a>02468   {
<a name="l02469"></a>02469     <a class="code" href="misc_8h.html#c0247ae9677929c0d7a34cd197d3e57e">memzero</a>(&amp;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[<a class="code" href="classcore__exec__DPM__t.html#d92480b778f880620b3ba31dd85addeb">STQ_senior_head</a>],<span class="keyword">sizeof</span>(*<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>));
<a name="l02470"></a>02470     <a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[STQ_senior_head].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a> = <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l02471"></a>02471 
<a name="l02472"></a>02472     <span class="keywordflow">if</span>((STQ_senior_head == <a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>) &amp;&amp; (<a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a>&gt;0))
<a name="l02473"></a>02473     {
<a name="l02474"></a>02474       <a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__exec__DPM__t.html#df15e2a1008f20fcc4a5428ba23db3e2">STQ_head</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(STQ_head + 1) % knobs-&gt;exec.STQ_size;</span>
<a name="l02475"></a>02475       <a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a>--;
<a name="l02476"></a>02476     }
<a name="l02477"></a>02477     STQ_senior_head = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(STQ_senior_head,knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>); <span class="comment">//(STQ_senior_head + 1) % knobs-&gt;exec.STQ_size;</span>
<a name="l02478"></a>02478     <a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a>--;
<a name="l02479"></a>02479   }
<a name="l02480"></a>02480 }
<a name="l02481"></a>02481 
<a name="l02482"></a><a class="code" href="classcore__exec__DPM__t.html#f51f86602b423d4367ad2a7f74e77cac">02482</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#f51f86602b423d4367ad2a7f74e77cac">core_exec_DPM_t::recover_check_assertions</a>(<span class="keywordtype">void</span>)
<a name="l02483"></a>02483 {
<a name="l02484"></a>02484   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#6f304a4841fb71a2938fbd566c238732">STQ_senior_num</a> == 0,(<span class="keywordtype">void</span>)0);
<a name="l02485"></a>02485   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#8a6ecbae313d26a1d2c405583bd9bb7a">STQ_num</a> == 0,(<span class="keywordtype">void</span>)0);
<a name="l02486"></a>02486   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#9f55168920c0f70859931d7b2dac8dc7">LDQ_num</a> == 0,(<span class="keywordtype">void</span>)0);
<a name="l02487"></a>02487   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__exec__DPM__t.html#3a990ff37f564076b717aef2fde1435b">RS_num</a> == 0,(<span class="keywordtype">void</span>)0);
<a name="l02488"></a>02488 }
<a name="l02489"></a>02489 
<a name="l02490"></a>02490 <span class="comment">/* Stores don't write back to cache/memory until commit.  When D$</span>
<a name="l02491"></a>02491 <span class="comment">   and DTLB accesses complete, these functions get called which</span>
<a name="l02492"></a>02492 <span class="comment">   update the status of the corresponding STQ entries.  The STQ</span>
<a name="l02493"></a>02493 <span class="comment">   entry cannot be deallocated until the store has completed. */</span>
<a name="l02494"></a><a class="code" href="classcore__exec__DPM__t.html#e5b9da15ba0b9b90d68793c6dcf6e5a4">02494</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#e5b9da15ba0b9b90d68793c6dcf6e5a4">core_exec_DPM_t::store_dl1_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l02495"></a>02495 {
<a name="l02496"></a>02496   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> *)op;
<a name="l02497"></a>02497   <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> * <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a> = uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>;
<a name="l02498"></a>02498   <span class="keyword">struct </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a> * E = (<a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>*)core-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>;
<a name="l02499"></a>02499   <span class="keyword">struct</span> <a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = core-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02500"></a>02500 
<a name="l02501"></a>02501 #ifdef ZTRACE
<a name="l02502"></a>02502   ztrace_print(uop,<span class="stringliteral">"c|store|written to cache/memory"</span>);
<a name="l02503"></a>02503 <span class="preprocessor">#endif</span>
<a name="l02504"></a>02504 <span class="preprocessor"></span>
<a name="l02505"></a>02505   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l02506"></a>02506   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> == E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a>)
<a name="l02507"></a>02507   {
<a name="l02508"></a>02508     E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#d90106f07a571dbfecd4586aa92d0838">first_byte_written</a> = <span class="keyword">true</span>;
<a name="l02509"></a>02509     <span class="keywordflow">if</span>(E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b7e912e72db5bc04e0c5a1bece119286">last_byte_written</a>)
<a name="l02510"></a>02510       E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8a0d483ae23caa1cca70f2636c48109">write_complete</a> = <span class="keyword">true</span>;
<a name="l02511"></a>02511   }
<a name="l02512"></a>02512   core-&gt;<a class="code" href="classcore__t.html#466dcf5a0ecb9fd32ad557561286dfc9">return_uop_array</a>(uop);
<a name="l02513"></a>02513 }
<a name="l02514"></a>02514 
<a name="l02515"></a>02515 <span class="comment">/* only used for the 2nd part of a split write */</span>
<a name="l02516"></a><a class="code" href="classcore__exec__DPM__t.html#1ebb3bdb6783434b0ff5857ab17ea8ff">02516</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#1ebb3bdb6783434b0ff5857ab17ea8ff">core_exec_DPM_t::store_dl1_split_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l02517"></a>02517 {
<a name="l02518"></a>02518   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> *)op;
<a name="l02519"></a>02519   <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> * <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a> = uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>;
<a name="l02520"></a>02520   <span class="keyword">struct </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a> * E = (<a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>*)core-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>;
<a name="l02521"></a>02521   <span class="keyword">struct</span> <a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = core-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02522"></a>02522 
<a name="l02523"></a>02523 #ifdef ZTRACE
<a name="l02524"></a>02524   ztrace_print(uop,<span class="stringliteral">"c|store|written to cache/memory"</span>);
<a name="l02525"></a>02525 <span class="preprocessor">#endif</span>
<a name="l02526"></a>02526 <span class="preprocessor"></span>
<a name="l02527"></a>02527   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l02528"></a>02528   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> == E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a>)
<a name="l02529"></a>02529   {
<a name="l02530"></a>02530     E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b7e912e72db5bc04e0c5a1bece119286">last_byte_written</a> = <span class="keyword">true</span>;
<a name="l02531"></a>02531     <span class="keywordflow">if</span>(E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#d90106f07a571dbfecd4586aa92d0838">first_byte_written</a>)
<a name="l02532"></a>02532       E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#b8a0d483ae23caa1cca70f2636c48109">write_complete</a> = <span class="keyword">true</span>;
<a name="l02533"></a>02533   }
<a name="l02534"></a>02534   core-&gt;<a class="code" href="classcore__t.html#466dcf5a0ecb9fd32ad557561286dfc9">return_uop_array</a>(uop);
<a name="l02535"></a>02535 }
<a name="l02536"></a>02536 
<a name="l02537"></a><a class="code" href="classcore__exec__DPM__t.html#e44b1534550acdb1621aea03f5de7011">02537</a> <span class="keywordtype">void</span> <a class="code" href="classcore__exec__DPM__t.html#e44b1534550acdb1621aea03f5de7011">core_exec_DPM_t::store_dtlb_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l02538"></a>02538 {
<a name="l02539"></a>02539   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> *)op;
<a name="l02540"></a>02540   <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> * <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a> = uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>;
<a name="l02541"></a>02541   <span class="keyword">struct </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a> * E = (<a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>*)core-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>;
<a name="l02542"></a>02542   <span class="keyword">struct</span> <a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = core-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02543"></a>02543   
<a name="l02544"></a>02544 #ifdef ZTRACE
<a name="l02545"></a>02545   ztrace_print(uop,<span class="stringliteral">"c|store|translated"</span>);
<a name="l02546"></a>02546 <span class="preprocessor">#endif</span>
<a name="l02547"></a>02547 <span class="preprocessor"></span>
<a name="l02548"></a>02548   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),(<span class="keywordtype">void</span>)0);
<a name="l02549"></a>02549   <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> == E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a>)
<a name="l02550"></a>02550     E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#877df377f0f978281a76644e31f9fd96">translation_complete</a> = <span class="keyword">true</span>;
<a name="l02551"></a>02551   core-&gt;<a class="code" href="classcore__t.html#466dcf5a0ecb9fd32ad557561286dfc9">return_uop_array</a>(uop);
<a name="l02552"></a>02552 }
<a name="l02553"></a>02553 
<a name="l02554"></a><a class="code" href="classcore__exec__DPM__t.html#d61bb8f33057037b8d0d9b20270352b5">02554</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__exec__DPM__t.html#d61bb8f33057037b8d0d9b20270352b5">core_exec_DPM_t::store_translated_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op, <span class="keyword">const</span> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> action_id <span class="comment">/* ignored */</span>)
<a name="l02555"></a>02555 {
<a name="l02556"></a>02556   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> *)op;
<a name="l02557"></a>02557   <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> * <a class="code" href="classcore__exec__t.html#c6a29d8547d2949f5203b0e97468565a">core</a> = uop-&gt;<a class="code" href="structuop__t.html#0f98fc5d2776745a7543b190c454143b">core</a>;
<a name="l02558"></a>02558   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = core-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l02559"></a>02559   <span class="keyword">struct </span><a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a> * E = (<a class="code" href="classcore__exec__DPM__t.html">core_exec_DPM_t</a>*)core-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>;
<a name="l02560"></a>02560 
<a name="l02561"></a>02561   <span class="keywordflow">if</span>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> == -1) || (uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> != E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#00dbbb9dc309a31e4fa7f48f86d6e1d5">action_id</a>))
<a name="l02562"></a>02562     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02563"></a>02563   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>((uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &gt;= 0) &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a>),<span class="keyword">true</span>);
<a name="l02564"></a>02564   <span class="keywordflow">return</span> E-&gt;<a class="code" href="classcore__exec__DPM__t.html#c5d8ec4798f63c3fffeb32f7a58c720e">STQ</a>[uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#d7c02fea6ab96a3296267fbc7d83d5f2">STQ_index</a>].<a class="code" href="structcore__exec__DPM__t_1_1STQ__t.html#877df377f0f978281a76644e31f9fd96">translation_complete</a>;
<a name="l02565"></a>02565 }
<a name="l02566"></a>02566 
<a name="l02567"></a>02567 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 23 00:20:56 2010 for IRIS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
