<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>IRIS: fusion-colt.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_014faa727c0b2aaba2cbdd8f326de4f6.html">source</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_4516642e80adc9bf50ea604a2fbf2492.html">zesto</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_53699732bfcfedf164a190a0882ad320.html">ZCOMPS-fusion</a>
  </div>
</div>
<div class="contents">
<h1>fusion-colt.cpp</h1><a href="fusion-colt_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* fusion-colt.cpp: Combined Output Lookup Table [Loh, PACT 2002] */</span>
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * __COPYRIGHT__ GT</span>
<a name="l00004"></a>00004 <span class="comment"> */</span>
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="fusion-colt_8cpp.html#9146ade7ce24e3db226a973a59063892">00006</a> <span class="preprocessor">#define COMPONENT_NAME "colt"</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>
<a name="l00008"></a>00008 <span class="preprocessor">#ifdef BPRED_PARSE_ARGS</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="keywordflow">if</span>(!strcasecmp(<span class="stringliteral">"colt"</span>,type))
<a name="l00010"></a>00010 {
<a name="l00011"></a>00011   <span class="keywordtype">int</span> num_entries;
<a name="l00012"></a>00012   <span class="keywordtype">int</span> counter_width;
<a name="l00013"></a>00013   <span class="keywordtype">int</span> history_size;
<a name="l00014"></a>00014   <span class="keywordtype">int</span> bhr_width;
<a name="l00015"></a>00015   <span class="keywordflow">if</span>(sscanf(opt_string,<span class="stringliteral">"%*[^:]:%[^:]:%d:%d:%d:%d"</span>,name,&amp;num_entries,&amp;counter_width,&amp;history_size,&amp;bhr_width) != 5)
<a name="l00016"></a>00016     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"bad fusion options string %s (should be \"colt:name:num-entries:counter_width:history-size:bhr-width\")"</span>,opt_string);
<a name="l00017"></a>00017   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classfusion__colt__t.html">fusion_colt_t</a>(name,num_pred,num_entries,counter_width,history_size,bhr_width);
<a name="l00018"></a>00018 }
<a name="l00019"></a>00019 <span class="preprocessor">#else</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a><a class="code" href="classfusion__colt__t.html">00021</a> <span class="keyword">class </span><a class="code" href="classfusion__colt__t.html">fusion_colt_t</a>:<span class="keyword">public</span> <a class="code" href="classfusion__t.html">fusion_t</a>
<a name="l00022"></a>00022 {
<a name="l00023"></a><a class="code" href="classfusion__colt__t_1_1fusion__colt__sc__t.html">00023</a>   <span class="keyword">class </span><a class="code" href="classfusion__colt__t_1_1fusion__colt__sc__t.html">fusion_colt_sc_t</a>:<span class="keyword">public</span> <a class="code" href="classfusion__sc__t.html">fusion_sc_t</a>
<a name="l00024"></a>00024   {
<a name="l00025"></a>00025     <span class="keyword">public</span>:
<a name="l00026"></a><a class="code" href="classfusion__colt__t_1_1fusion__colt__sc__t.html#149fd7d6c7ca44972b833e7c8a60b055">00026</a>     <span class="keywordtype">char</span> * <a class="code" href="classfusion__colt__t_1_1fusion__colt__sc__t.html#149fd7d6c7ca44972b833e7c8a60b055">current_ctr</a>;
<a name="l00027"></a><a class="code" href="classfusion__colt__t_1_1fusion__colt__sc__t.html#f113cf2733ef1916ba94154f79780358">00027</a>     <span class="keywordtype">int</span> * <a class="code" href="classfusion__colt__t_1_1fusion__colt__sc__t.html#f113cf2733ef1916ba94154f79780358">bhr</a>;
<a name="l00028"></a><a class="code" href="classfusion__colt__t_1_1fusion__colt__sc__t.html#79cedeb505399ef592b73a89e4dfa065">00028</a>     <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t_1_1fusion__colt__sc__t.html#79cedeb505399ef592b73a89e4dfa065">lookup_bhr</a>;
<a name="l00029"></a>00029   };
<a name="l00030"></a>00030 
<a name="l00031"></a>00031   <span class="keyword">protected</span>:
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="classfusion__colt__t.html#9bc320921224f09a5ca72000c525c999">00033</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#9bc320921224f09a5ca72000c525c999">meta_size</a>;
<a name="l00034"></a><a class="code" href="classfusion__colt__t.html#2a25ee5f93ff219a80d68389dc93b61a">00034</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#2a25ee5f93ff219a80d68389dc93b61a">meta_mask</a>;
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="classfusion__colt__t.html#d283c343edb68a46ad0c8a343c6c61bd">00036</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#d283c343edb68a46ad0c8a343c6c61bd">counter_width</a>;
<a name="l00037"></a><a class="code" href="classfusion__colt__t.html#160c949fa8f6777e3647db02a24ac984">00037</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#160c949fa8f6777e3647db02a24ac984">counter_shift</a>;
<a name="l00038"></a><a class="code" href="classfusion__colt__t.html#1a5fe0b61c6257327cfac167f958e93a">00038</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#1a5fe0b61c6257327cfac167f958e93a">counter_max</a>;
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="classfusion__colt__t.html#737fa08ca73f1afa22c28fe6e81e689f">00040</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#737fa08ca73f1afa22c28fe6e81e689f">history_size</a>;
<a name="l00041"></a><a class="code" href="classfusion__colt__t.html#bcb897f168963a8ba8cde86e2f0b8973">00041</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#bcb897f168963a8ba8cde86e2f0b8973">history_mask</a>;
<a name="l00042"></a><a class="code" href="classfusion__colt__t.html#d5176d6026c3fb5b65c45256e479e0d3">00042</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#d5176d6026c3fb5b65c45256e479e0d3">bhr_width</a>;
<a name="l00043"></a><a class="code" href="classfusion__colt__t.html#8754e20fad808d396d3f472a67045576">00043</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#8754e20fad808d396d3f472a67045576">bhr_mask</a>;
<a name="l00044"></a><a class="code" href="classfusion__colt__t.html#3ff3b08667cae766bb2b30f4eadec129">00044</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#3ff3b08667cae766bb2b30f4eadec129">xorshift</a>;
<a name="l00045"></a><a class="code" href="classfusion__colt__t.html#efd85049f01605f48f812013ae8c26ba">00045</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#efd85049f01605f48f812013ae8c26ba">xormask</a>;
<a name="l00046"></a><a class="code" href="classfusion__colt__t.html#b12be914d3a82619474897b84047b49b">00046</a>   <span class="keywordtype">int</span> <a class="code" href="classfusion__colt__t.html#b12be914d3a82619474897b84047b49b">xor2shift</a>;
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">00048</a>   <span class="keywordtype">int</span> * <a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a>;
<a name="l00049"></a><a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">00049</a>   <span class="keywordtype">char</span> * <a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a>;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051   <span class="keyword">public</span>:
<a name="l00052"></a>00052 
<a name="l00053"></a>00053   <span class="comment">/* CREATE */</span>
<a name="l00054"></a><a class="code" href="classfusion__colt__t.html#62a10d42e1a1fb0acd0acc15b95d0759">00054</a>   <a class="code" href="classfusion__colt__t.html#62a10d42e1a1fb0acd0acc15b95d0759">fusion_colt_t</a>(<span class="keywordtype">char</span> * <span class="keyword">const</span> arg_name,
<a name="l00055"></a>00055                 <span class="keyword">const</span> <span class="keywordtype">int</span> arg_num_pred,
<a name="l00056"></a>00056                 <span class="keyword">const</span> <span class="keywordtype">int</span> arg_meta_size,
<a name="l00057"></a>00057                 <span class="keyword">const</span> <span class="keywordtype">int</span> arg_counter_width,
<a name="l00058"></a>00058                 <span class="keyword">const</span> <span class="keywordtype">int</span> arg_history_size,
<a name="l00059"></a>00059                 <span class="keyword">const</span> <span class="keywordtype">int</span> arg_bhr_width
<a name="l00060"></a>00060                )
<a name="l00061"></a>00061   {
<a name="l00062"></a>00062     <a class="code" href="classfusion__t.html#65608af086c04e3ce10acf9c3bcbe8de">init</a>();
<a name="l00063"></a>00063 
<a name="l00064"></a>00064     <span class="comment">/* verify arguments are valid */</span>
<a name="l00065"></a>00065     <a class="code" href="valcheck_8h.html#c99c690e4a721f3296ab6329a6dbaebf">CHECK_PPOW2</a>(arg_meta_size);
<a name="l00066"></a>00066     <a class="code" href="valcheck_8h.html#c99c690e4a721f3296ab6329a6dbaebf">CHECK_PPOW2</a>(arg_history_size);
<a name="l00067"></a>00067     <a class="code" href="valcheck_8h.html#add41af8cea1e110db7000fd5b0fb871">CHECK_NNEG</a>(arg_bhr_width);
<a name="l00068"></a>00068     <a class="code" href="valcheck_8h.html#5d0c5afbebddacc12b87872ae081da05">CHECK_POS_LEQ</a>(arg_counter_width,8);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <a class="code" href="classfusion__t.html#9fc6daa850cc2f748b839bcd8dedf9ea">name</a> = strdup(arg_name);
<a name="l00071"></a>00071     <span class="keywordflow">if</span>(!<a class="code" href="classfusion__t.html#9fc6daa850cc2f748b839bcd8dedf9ea">name</a>)
<a name="l00072"></a>00072       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't malloc fusion colt name (strdup)"</span>);
<a name="l00073"></a>00073     <a class="code" href="classfusion__t.html#7cccd266cdca11cad51fa7bd848391c6">type</a> = strdup(<span class="stringliteral">"fusion Table"</span>);
<a name="l00074"></a>00074     <span class="keywordflow">if</span>(!<a class="code" href="classfusion__t.html#7cccd266cdca11cad51fa7bd848391c6">type</a>)
<a name="l00075"></a>00075       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't malloc fusion colt type (strdup)"</span>);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <a class="code" href="classfusion__t.html#ce0fc3061288ad024a3fd3295ada0ae9">num_pred</a> = arg_num_pred;
<a name="l00078"></a>00078     <a class="code" href="classfusion__colt__t.html#9bc320921224f09a5ca72000c525c999">meta_size</a> = arg_meta_size;
<a name="l00079"></a>00079     <a class="code" href="classfusion__colt__t.html#2a25ee5f93ff219a80d68389dc93b61a">meta_mask</a> = arg_meta_size-1;
<a name="l00080"></a>00080     <a class="code" href="classfusion__colt__t.html#d283c343edb68a46ad0c8a343c6c61bd">counter_width</a> = arg_counter_width;
<a name="l00081"></a>00081     <a class="code" href="classfusion__colt__t.html#160c949fa8f6777e3647db02a24ac984">counter_shift</a> = arg_counter_width-1;
<a name="l00082"></a>00082     <a class="code" href="classfusion__colt__t.html#1a5fe0b61c6257327cfac167f958e93a">counter_max</a> = (1&lt;&lt;arg_counter_width)-1;
<a name="l00083"></a>00083     <a class="code" href="classfusion__colt__t.html#737fa08ca73f1afa22c28fe6e81e689f">history_size</a> = arg_history_size;
<a name="l00084"></a>00084     <a class="code" href="classfusion__colt__t.html#bcb897f168963a8ba8cde86e2f0b8973">history_mask</a> = arg_history_size-1;
<a name="l00085"></a>00085     <a class="code" href="classfusion__colt__t.html#d5176d6026c3fb5b65c45256e479e0d3">bhr_width</a> = arg_bhr_width;
<a name="l00086"></a>00086     <a class="code" href="classfusion__colt__t.html#8754e20fad808d396d3f472a67045576">bhr_mask</a> = (1&lt;&lt;arg_bhr_width)-1;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <a class="code" href="classfusion__colt__t.html#efd85049f01605f48f812013ae8c26ba">xormask</a> = (<a class="code" href="classfusion__colt__t.html#9bc320921224f09a5ca72000c525c999">meta_size</a>-1)&gt;&gt;<a class="code" href="classfusion__t.html#ce0fc3061288ad024a3fd3295ada0ae9">num_pred</a>;
<a name="l00089"></a>00089     <a class="code" href="classfusion__colt__t.html#b12be914d3a82619474897b84047b49b">xor2shift</a> = <a class="code" href="misc_8h.html#a36cd338e0176d883719b7c69ebc5670">log_base2</a>(<a class="code" href="classfusion__colt__t.html#9bc320921224f09a5ca72000c525c999">meta_size</a>)-<a class="code" href="classfusion__t.html#ce0fc3061288ad024a3fd3295ada0ae9">num_pred</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a> = (<span class="keywordtype">int</span>*) calloc(<a class="code" href="classfusion__colt__t.html#737fa08ca73f1afa22c28fe6e81e689f">history_size</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a>));
<a name="l00092"></a>00092     <span class="keywordflow">if</span>(!<a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a>)
<a name="l00093"></a>00093       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't malloc colt history table"</span>);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a> = (<span class="keywordtype">char</span>*) calloc(<a class="code" href="classfusion__colt__t.html#9bc320921224f09a5ca72000c525c999">meta_size</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a>));
<a name="l00096"></a>00096     <span class="keywordflow">if</span>(!<a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a>)
<a name="l00097"></a>00097       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't malloc colt meta table"</span>);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="comment">/* initialize to very weakly taken/not-taken: 2^(n-1) and 2^(n-1)-1*/</span>
<a name="l00100"></a>00100     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classfusion__colt__t.html#9bc320921224f09a5ca72000c525c999">meta_size</a>;i++)
<a name="l00101"></a>00101       <a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a>[i] = (i&amp;1)?((1&lt;&lt;(<a class="code" href="classfusion__colt__t.html#d283c343edb68a46ad0c8a343c6c61bd">counter_width</a>-1))-1):(1&lt;&lt;(<a class="code" href="classfusion__colt__t.html#d283c343edb68a46ad0c8a343c6c61bd">counter_width</a>-1));
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     <a class="code" href="classfusion__t.html#da3872e69676e0d38f54db3f549d471b">bits</a> = meta_size*<a class="code" href="classfusion__colt__t.html#d283c343edb68a46ad0c8a343c6c61bd">counter_width</a> + <a class="code" href="classfusion__colt__t.html#737fa08ca73f1afa22c28fe6e81e689f">history_size</a>*<a class="code" href="classfusion__colt__t.html#d5176d6026c3fb5b65c45256e479e0d3">bhr_width</a>;
<a name="l00104"></a>00104   }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   <span class="comment">/* DESTROY */</span>
<a name="l00107"></a><a class="code" href="classfusion__colt__t.html#796c11c1684243ac88655aea45d346be">00107</a>   <a class="code" href="classfusion__colt__t.html#796c11c1684243ac88655aea45d346be">~fusion_colt_t</a>()
<a name="l00108"></a>00108   {
<a name="l00109"></a>00109     <span class="keywordflow">if</span>(<a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a>) free(<a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a>); <a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a> = NULL;
<a name="l00110"></a>00110     <span class="keywordflow">if</span>(<a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a>) free(<a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a>); <a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a> = NULL;
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <a class="code" href="zesto-bpred_8cpp.html#fd52998f3f7ab32d5e430aadd9b971e6">FUSION_LOOKUP_HEADER</a>
<a name="l00114"></a>00114   {
<a name="l00115"></a>00115     <span class="keyword">class </span>fusion_colt_sc_t * sc = (<span class="keyword">class </span>fusion_colt_sc_t*) scvp;
<a name="l00116"></a>00116     <span class="keywordtype">int</span> pred_cat = 0; <span class="comment">/* concatenation of predictions */</span>
<a name="l00117"></a>00117     <span class="keywordtype">bool</span> pred;
<a name="l00118"></a>00118     <span class="keywordtype">int</span> index;
<a name="l00119"></a>00119     sc-&gt;bhr = &amp;<a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a>[PC&amp;<a class="code" href="classfusion__colt__t.html#bcb897f168963a8ba8cde86e2f0b8973">history_mask</a>];
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="classfusion__t.html#ce0fc3061288ad024a3fd3295ada0ae9">num_pred</a>;i++)
<a name="l00122"></a>00122       pred_cat |= preds[i]&lt;&lt;i;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="comment">/* p = bit for pred_cat; b = bit from bhr;</span>
<a name="l00125"></a>00125 <span class="comment">       0-9 = bits from PC; - = zero bits/padding */</span>
<a name="l00126"></a>00126             <span class="comment">/* ppppbbb--- ^ ----543210 */</span>
<a name="l00127"></a>00127     index = ((PC^(*sc-&gt;bhr&lt;&lt;<a class="code" href="classfusion__colt__t.html#3ff3b08667cae766bb2b30f4eadec129">xorshift</a>))&amp;<a class="code" href="classfusion__colt__t.html#efd85049f01605f48f812013ae8c26ba">xormask</a>) | (pred_cat&lt;&lt;<a class="code" href="classfusion__colt__t.html#b12be914d3a82619474897b84047b49b">xor2shift</a>);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     sc-&gt;current_ctr = &amp;<a class="code" href="classfusion__colt__t.html#a66a9d755f23805c07015efc8c3a7027">ftable</a>[index&amp;<a class="code" href="classfusion__colt__t.html#2a25ee5f93ff219a80d68389dc93b61a">meta_mask</a>];
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     pred = (*sc-&gt;current_ctr&gt;&gt;<a class="code" href="classfusion__colt__t.html#160c949fa8f6777e3647db02a24ac984">counter_shift</a>)&amp;1;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <a class="code" href="zesto-bpred_8cpp.html#c5dc90bfbf7b76595c5840a22962ca8b">BPRED_STAT</a>(<a class="code" href="classfusion__t.html#ca5bb14f422e74aa3d055b41b45c75aa">lookups</a>++;)
<a name="l00134"></a>00134     sc-&gt;lookup_bhr = *sc-&gt;bhr;
<a name="l00135"></a>00135     sc-&gt;updated = <span class="keyword">false</span>;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <span class="keywordflow">return</span> pred;
<a name="l00138"></a>00138   }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140   <span class="comment">/* UPDATE */</span>
<a name="l00141"></a>00141   <a class="code" href="zesto-bpred_8cpp.html#d4cc51d419490f6cb55a6e302a41605c">FUSION_UPDATE_HEADER</a>
<a name="l00142"></a>00142   {
<a name="l00143"></a>00143     <span class="keyword">class </span>fusion_colt_sc_t * sc = (<span class="keyword">class </span>fusion_colt_sc_t*) scvp;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordflow">if</span>(!sc-&gt;updated)
<a name="l00146"></a>00146     {
<a name="l00147"></a>00147         <a class="code" href="zesto-bpred_8cpp.html#c5dc90bfbf7b76595c5840a22962ca8b">BPRED_STAT</a>(<a class="code" href="classfusion__t.html#7788554edd47ba65da50c9def7cff27a">updates</a>++;)
<a name="l00148"></a>00148         <a class="code" href="zesto-bpred_8cpp.html#c5dc90bfbf7b76595c5840a22962ca8b">BPRED_STAT</a>(<a class="code" href="classfusion__t.html#f1f594aa25cd5c1226431ad412549ca5">num_hits</a> += our_pred == outcome;)
<a name="l00149"></a>00149         sc-&gt;updated = <span class="keyword">true</span>;
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="keywordflow">if</span>(outcome)
<a name="l00153"></a>00153     {
<a name="l00154"></a>00154       <span class="keywordflow">if</span>(*sc-&gt;current_ctr &lt; (<span class="keywordtype">int</span>)<a class="code" href="classfusion__colt__t.html#1a5fe0b61c6257327cfac167f958e93a">counter_max</a>)
<a name="l00155"></a>00155         ++ *sc-&gt;current_ctr;
<a name="l00156"></a>00156     }
<a name="l00157"></a>00157     <span class="keywordflow">else</span>
<a name="l00158"></a>00158     {
<a name="l00159"></a>00159       <span class="keywordflow">if</span>(*sc-&gt;current_ctr &gt; 0)
<a name="l00160"></a>00160         -- *sc-&gt;current_ctr;
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164   <span class="comment">/* SPEC_UPDATE */</span>
<a name="l00165"></a>00165   <a class="code" href="zesto-bpred_8cpp.html#74381a046bb8e34b49e4765af288f3e4">FUSION_SPEC_UPDATE_HEADER</a>
<a name="l00166"></a>00166   {
<a name="l00167"></a>00167     <span class="keyword">class </span>fusion_colt_sc_t * sc = (<span class="keyword">class </span>fusion_colt_sc_t*) scvp;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <a class="code" href="zesto-bpred_8cpp.html#c5dc90bfbf7b76595c5840a22962ca8b">BPRED_STAT</a>(<a class="code" href="classfusion__t.html#00685b4010d24234f2cb730c66d6e5a6">spec_updates</a>++;)
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     *sc-&gt;bhr = ((*sc-&gt;bhr&lt;&lt;1)|our_pred)&amp;<a class="code" href="classfusion__colt__t.html#8754e20fad808d396d3f472a67045576">bhr_mask</a>;
<a name="l00172"></a>00172   }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <span class="comment">/* RECOVER */</span>
<a name="l00175"></a>00175   <a class="code" href="zesto-bpred_8cpp.html#a85d7386d0dba9b2de10046e926a1f1c">FUSION_RECOVER_HEADER</a>
<a name="l00176"></a>00176   {
<a name="l00177"></a>00177     <span class="keyword">class </span>fusion_colt_sc_t * sc = (<span class="keyword">class </span>fusion_colt_sc_t*) scvp;
<a name="l00178"></a>00178     <span class="keywordflow">if</span>(<a class="code" href="classfusion__colt__t.html#737fa08ca73f1afa22c28fe6e81e689f">history_size</a> == 1)
<a name="l00179"></a>00179         <a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a>[0] = (sc-&gt;lookup_bhr&lt;&lt;1)|outcome;
<a name="l00180"></a>00180   }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="comment">/* FLUSH */</span>
<a name="l00183"></a>00183   <a class="code" href="zesto-bpred_8cpp.html#e59fd0a867dbb4a33469182b8de58f43">FUSION_FLUSH_HEADER</a>
<a name="l00184"></a>00184   {
<a name="l00185"></a>00185     <span class="keyword">class </span>fusion_colt_sc_t * sc = (<span class="keyword">class </span>fusion_colt_sc_t*) scvp;
<a name="l00186"></a>00186     <span class="keywordflow">if</span>(<a class="code" href="classfusion__colt__t.html#737fa08ca73f1afa22c28fe6e81e689f">history_size</a> == 1)
<a name="l00187"></a>00187       <a class="code" href="classfusion__colt__t.html#1d33a087db7fac8860c34d447a74530c">history</a>[0] = sc-&gt;lookup_bhr;
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190   <span class="comment">/* GET_CACHE */</span>
<a name="l00191"></a>00191   <a class="code" href="zesto-bpred_8cpp.html#eabf066c308addafb45eeb95c89e11c0">FUSION_GET_CACHE_HEADER</a>
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193     <span class="keyword">class </span>fusion_colt_sc_t * sc = <span class="keyword">new</span> fusion_colt_sc_t();
<a name="l00194"></a>00194     <span class="keywordflow">if</span>(!sc)
<a name="l00195"></a>00195       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't malloc colt State Cache"</span>);
<a name="l00196"></a>00196     <span class="keywordflow">return</span> sc;
<a name="l00197"></a>00197   }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 };
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="preprocessor">#endif </span><span class="comment">/* BPRED_PARSE_ARGS */</span>
<a name="l00202"></a>00202 <span class="preprocessor">#undef COMPONENT_NAME</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 23 00:20:56 2010 for IRIS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
