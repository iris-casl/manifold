<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>IRIS: sim-zesto.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_014faa727c0b2aaba2cbdd8f326de4f6.html">source</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_4516642e80adc9bf50ea604a2fbf2492.html">zesto</a>
  </div>
</div>
<div class="contents">
<h1>sim-zesto.cpp</h1><a href="sim-zesto_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* sim-zesto.cpp - x86 execute-at-fetch timing simulator</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright © 2009 by Gabriel H. Loh and the Georgia Tech Research Corporation</span>
<a name="l00004"></a>00004 <span class="comment"> * Atlanta, GA  30332-0415</span>
<a name="l00005"></a>00005 <span class="comment"> * All Rights Reserved.</span>
<a name="l00006"></a>00006 <span class="comment"> * </span>
<a name="l00007"></a>00007 <span class="comment"> * THIS IS A LEGAL DOCUMENT BY DOWNLOADING ZESTO, YOU ARE AGREEING TO THESE</span>
<a name="l00008"></a>00008 <span class="comment"> * TERMS AND CONDITIONS.</span>
<a name="l00009"></a>00009 <span class="comment"> * </span>
<a name="l00010"></a>00010 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</span>
<a name="l00011"></a>00011 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00012"></a>00012 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00013"></a>00013 <span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNERS OR CONTRIBUTORS BE</span>
<a name="l00014"></a>00014 <span class="comment"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a name="l00015"></a>00015 <span class="comment"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a name="l00016"></a>00016 <span class="comment"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<a name="l00017"></a>00017 <span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<a name="l00018"></a>00018 <span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="l00019"></a>00019 <span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00020"></a>00020 <span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00021"></a>00021 <span class="comment"> * </span>
<a name="l00022"></a>00022 <span class="comment"> * NOTE: Portions of this release are directly derived from the SimpleScalar</span>
<a name="l00023"></a>00023 <span class="comment"> * Toolset (property of SimpleScalar LLC), and as such, those portions are</span>
<a name="l00024"></a>00024 <span class="comment"> * bound by the corresponding legal terms and conditions.  All source files</span>
<a name="l00025"></a>00025 <span class="comment"> * derived directly or in part from the SimpleScalar Toolset bear the original</span>
<a name="l00026"></a>00026 <span class="comment"> * user agreement.</span>
<a name="l00027"></a>00027 <span class="comment"> * </span>
<a name="l00028"></a>00028 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00029"></a>00029 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00030"></a>00030 <span class="comment"> * </span>
<a name="l00031"></a>00031 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice,</span>
<a name="l00032"></a>00032 <span class="comment"> * this list of conditions and the following disclaimer.</span>
<a name="l00033"></a>00033 <span class="comment"> * </span>
<a name="l00034"></a>00034 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<a name="l00035"></a>00035 <span class="comment"> * this list of conditions and the following disclaimer in the documentation</span>
<a name="l00036"></a>00036 <span class="comment"> * and/or other materials provided with the distribution.</span>
<a name="l00037"></a>00037 <span class="comment"> * </span>
<a name="l00038"></a>00038 <span class="comment"> * 3. Neither the name of the Georgia Tech Research Corporation nor the names of</span>
<a name="l00039"></a>00039 <span class="comment"> * its contributors may be used to endorse or promote products derived from</span>
<a name="l00040"></a>00040 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00041"></a>00041 <span class="comment"> * </span>
<a name="l00042"></a>00042 <span class="comment"> * 4. Zesto is distributed freely for commercial and non-commercial use.  Note,</span>
<a name="l00043"></a>00043 <span class="comment"> * however, that the portions derived from the SimpleScalar Toolset are bound</span>
<a name="l00044"></a>00044 <span class="comment"> * by the terms and agreements set forth by SimpleScalar, LLC.  In particular:</span>
<a name="l00045"></a>00045 <span class="comment"> * </span>
<a name="l00046"></a>00046 <span class="comment"> *   "Nonprofit and noncommercial use is encouraged. SimpleScalar may be</span>
<a name="l00047"></a>00047 <span class="comment"> *   downloaded, compiled, executed, copied, and modified solely for nonprofit,</span>
<a name="l00048"></a>00048 <span class="comment"> *   educational, noncommercial research, and noncommercial scholarship</span>
<a name="l00049"></a>00049 <span class="comment"> *   purposes provided that this notice in its entirety accompanies all copies.</span>
<a name="l00050"></a>00050 <span class="comment"> *   Copies of the modified software can be delivered to persons who use it</span>
<a name="l00051"></a>00051 <span class="comment"> *   solely for nonprofit, educational, noncommercial research, and</span>
<a name="l00052"></a>00052 <span class="comment"> *   noncommercial scholarship purposes provided that this notice in its</span>
<a name="l00053"></a>00053 <span class="comment"> *   entirety accompanies all copies."</span>
<a name="l00054"></a>00054 <span class="comment"> * </span>
<a name="l00055"></a>00055 <span class="comment"> * User is responsible for reading and adhering to the terms set forth by</span>
<a name="l00056"></a>00056 <span class="comment"> * SimpleScalar, LLC where appropriate.</span>
<a name="l00057"></a>00057 <span class="comment"> * </span>
<a name="l00058"></a>00058 <span class="comment"> * 5. No nonprofit user may place any restrictions on the use of this software,</span>
<a name="l00059"></a>00059 <span class="comment"> * including as modified by the user, by any other authorized user.</span>
<a name="l00060"></a>00060 <span class="comment"> * </span>
<a name="l00061"></a>00061 <span class="comment"> * 6. Noncommercial and nonprofit users may distribute copies of Zesto in</span>
<a name="l00062"></a>00062 <span class="comment"> * compiled or executable form as set forth in Section 2, provided that either:</span>
<a name="l00063"></a>00063 <span class="comment"> * (A) it is accompanied by the corresponding machine-readable source code, or</span>
<a name="l00064"></a>00064 <span class="comment"> * (B) it is accompanied by a written offer, with no time limit, to give anyone</span>
<a name="l00065"></a>00065 <span class="comment"> * a machine-readable copy of the corresponding source code in return for</span>
<a name="l00066"></a>00066 <span class="comment"> * reimbursement of the cost of distribution. This written offer must permit</span>
<a name="l00067"></a>00067 <span class="comment"> * verbatim duplication by anyone, or (C) it is distributed by someone who</span>
<a name="l00068"></a>00068 <span class="comment"> * received only the executable form, and is accompanied by a copy of the</span>
<a name="l00069"></a>00069 <span class="comment"> * written offer of source code.</span>
<a name="l00070"></a>00070 <span class="comment"> * </span>
<a name="l00071"></a>00071 <span class="comment"> * 7. Zesto was developed by Gabriel H. Loh, Ph.D.  US Mail: 266 Ferst Drive,</span>
<a name="l00072"></a>00072 <span class="comment"> * Georgia Institute of Technology, Atlanta, GA 30332-0765</span>
<a name="l00073"></a>00073 <span class="comment"> * SimpleScalar Ô Tool Suite</span>
<a name="l00074"></a>00074 <span class="comment"> * © 1994-2003 Todd M. Austin, Ph.D. and SimpleScalar, LLC</span>
<a name="l00075"></a>00075 <span class="comment"> * All Rights Reserved.</span>
<a name="l00076"></a>00076 <span class="comment"> * </span>
<a name="l00077"></a>00077 <span class="comment"> * THIS IS A LEGAL DOCUMENT BY DOWNLOADING SIMPLESCALAR, YOU ARE AGREEING TO</span>
<a name="l00078"></a>00078 <span class="comment"> * THESE TERMS AND CONDITIONS.</span>
<a name="l00079"></a>00079 <span class="comment"> * </span>
<a name="l00080"></a>00080 <span class="comment"> * No portion of this work may be used by any commercial entity, or for any</span>
<a name="l00081"></a>00081 <span class="comment"> * commercial purpose, without the prior, written permission of SimpleScalar,</span>
<a name="l00082"></a>00082 <span class="comment"> * LLC (info@simplescalar.com). Nonprofit and noncommercial use is permitted as</span>
<a name="l00083"></a>00083 <span class="comment"> * described below.</span>
<a name="l00084"></a>00084 <span class="comment"> * </span>
<a name="l00085"></a>00085 <span class="comment"> * 1. SimpleScalar is provided AS IS, with no warranty of any kind, express or</span>
<a name="l00086"></a>00086 <span class="comment"> * implied. The user of the program accepts full responsibility for the</span>
<a name="l00087"></a>00087 <span class="comment"> * application of the program and the use of any results.</span>
<a name="l00088"></a>00088 <span class="comment"> * </span>
<a name="l00089"></a>00089 <span class="comment"> * 2. Nonprofit and noncommercial use is encouraged.  SimpleScalar may be</span>
<a name="l00090"></a>00090 <span class="comment"> * downloaded, compiled, executed, copied, and modified solely for nonprofit,</span>
<a name="l00091"></a>00091 <span class="comment"> * educational, noncommercial research, and noncommercial scholarship purposes</span>
<a name="l00092"></a>00092 <span class="comment"> * provided that this notice in its entirety accompanies all copies. Copies of</span>
<a name="l00093"></a>00093 <span class="comment"> * the modified software can be delivered to persons who use it solely for</span>
<a name="l00094"></a>00094 <span class="comment"> * nonprofit, educational, noncommercial research, and noncommercial</span>
<a name="l00095"></a>00095 <span class="comment"> * scholarship purposes provided that this notice in its entirety accompanies</span>
<a name="l00096"></a>00096 <span class="comment"> * all copies.</span>
<a name="l00097"></a>00097 <span class="comment"> * </span>
<a name="l00098"></a>00098 <span class="comment"> * 3. ALL COMMERCIAL USE, AND ALL USE BY FOR PROFIT ENTITIES, IS EXPRESSLY</span>
<a name="l00099"></a>00099 <span class="comment"> * PROHIBITED WITHOUT A LICENSE FROM SIMPLESCALAR, LLC (info@simplescalar.com).</span>
<a name="l00100"></a>00100 <span class="comment"> * </span>
<a name="l00101"></a>00101 <span class="comment"> * 4. No nonprofit user may place any restrictions on the use of this software,</span>
<a name="l00102"></a>00102 <span class="comment"> * including as modified by the user, by any other authorized user.</span>
<a name="l00103"></a>00103 <span class="comment"> * </span>
<a name="l00104"></a>00104 <span class="comment"> * 5. Noncommercial and nonprofit users may distribute copies of SimpleScalar</span>
<a name="l00105"></a>00105 <span class="comment"> * in compiled or executable form as set forth in Section 2, provided that</span>
<a name="l00106"></a>00106 <span class="comment"> * either: (A) it is accompanied by the corresponding machine-readable source</span>
<a name="l00107"></a>00107 <span class="comment"> * code, or (B) it is accompanied by a written offer, with no time limit, to</span>
<a name="l00108"></a>00108 <span class="comment"> * give anyone a machine-readable copy of the corresponding source code in</span>
<a name="l00109"></a>00109 <span class="comment"> * return for reimbursement of the cost of distribution. This written offer</span>
<a name="l00110"></a>00110 <span class="comment"> * must permit verbatim duplication by anyone, or (C) it is distributed by</span>
<a name="l00111"></a>00111 <span class="comment"> * someone who received only the executable form, and is accompanied by a copy</span>
<a name="l00112"></a>00112 <span class="comment"> * of the written offer of source code.</span>
<a name="l00113"></a>00113 <span class="comment"> * </span>
<a name="l00114"></a>00114 <span class="comment"> * 6. SimpleScalar was developed by Todd M. Austin, Ph.D. The tool suite is</span>
<a name="l00115"></a>00115 <span class="comment"> * currently maintained by SimpleScalar LLC (info@simplescalar.com). US Mail:</span>
<a name="l00116"></a>00116 <span class="comment"> * 2395 Timbercrest Court, Ann Arbor, MI 48105.</span>
<a name="l00117"></a>00117 <span class="comment"> * </span>
<a name="l00118"></a>00118 <span class="comment"> * Copyright © 1994-2003 by Todd M. Austin, Ph.D. and SimpleScalar, LLC.</span>
<a name="l00119"></a>00119 <span class="comment"> */</span>
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00122"></a>00122 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00123"></a>00123 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00124"></a>00124 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00125"></a>00125 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00126"></a>00126 <span class="preprocessor">#include &lt;sys/io.h&gt;</span>
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="preprocessor">#include "<a class="code" href="zesto-qsim_8h.html">zesto-qsim.h</a>"</span>
<a name="l00129"></a>00129 <span class="preprocessor">#include "<a class="code" href="host_8h.html">host.h</a>"</span>
<a name="l00130"></a>00130 <span class="preprocessor">#include "<a class="code" href="misc_8h.html">misc.h</a>"</span>
<a name="l00131"></a>00131 <span class="preprocessor">#include "<a class="code" href="machine_8h.html">machine.h</a>"</span>
<a name="l00132"></a>00132 <span class="preprocessor">#include "<a class="code" href="regs_8h.html">regs.h</a>"</span>
<a name="l00133"></a>00133 <span class="preprocessor">#include "<a class="code" href="memory_8h.html">memory.h</a>"</span>
<a name="l00134"></a>00134 <span class="preprocessor">#include "<a class="code" href="loader_8h.html">loader.h</a>"</span>
<a name="l00135"></a>00135 <span class="preprocessor">#include "<a class="code" href="syscall_8h.html">syscall.h</a>"</span>
<a name="l00136"></a>00136 <span class="preprocessor">#include "<a class="code" href="options_8h.html">options.h</a>"</span>
<a name="l00137"></a>00137 <span class="preprocessor">#include "<a class="code" href="zesto_2stats_8h.html">stats.h</a>"</span>
<a name="l00138"></a>00138 <span class="preprocessor">#include "<a class="code" href="sim_8h.html">sim.h</a>"</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include "<a class="code" href="thread_8h.html">thread.h</a>"</span>
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="preprocessor">#include "<a class="code" href="zesto-opts_8h.html">zesto-opts.h</a>"</span>
<a name="l00142"></a>00142 <span class="preprocessor">#include "<a class="code" href="zesto-core_8h.html">zesto-core.h</a>"</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include "<a class="code" href="zesto-oracle_8h.html">zesto-oracle.h</a>"</span>
<a name="l00144"></a>00144 <span class="preprocessor">#include "<a class="code" href="zesto-fetch_8h.html">zesto-fetch.h</a>"</span>
<a name="l00145"></a>00145 <span class="preprocessor">#include "<a class="code" href="zesto-decode_8h.html">zesto-decode.h</a>"</span>
<a name="l00146"></a>00146 <span class="preprocessor">#include "<a class="code" href="zesto-bpred_8h.html">zesto-bpred.h</a>"</span>
<a name="l00147"></a>00147 <span class="preprocessor">#include "<a class="code" href="zesto-alloc_8h.html">zesto-alloc.h</a>"</span>
<a name="l00148"></a>00148 <span class="preprocessor">#include "<a class="code" href="zesto-exec_8h.html">zesto-exec.h</a>"</span>
<a name="l00149"></a>00149 <span class="preprocessor">#include "<a class="code" href="zesto-commit_8h.html">zesto-commit.h</a>"</span>
<a name="l00150"></a>00150 <span class="preprocessor">#include "<a class="code" href="zesto-uncore_8h.html">zesto-uncore.h</a>"</span>
<a name="l00151"></a>00151 <span class="preprocessor">#include "<a class="code" href="zesto-cache_8h.html">zesto-cache.h</a>"</span>
<a name="l00152"></a>00152 <span class="comment">//#include "distorm.h"</span>
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="preprocessor">#ifdef USE_PIN_TRACES</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span><span class="keyword">extern</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> <a class="code" href="sim-zesto_8cpp.html#87de3dd0dc95ac44e817dc0f7c7ba3d7">store_nextPC</a>[16];
<a name="l00156"></a>00156 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="sim-zesto_8cpp.html#38a36f4cd3940833135cd0c497f726f4">use_stored_nextPC</a>[16];
<a name="l00157"></a>00157 <span class="preprocessor">#else</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span><span class="keyword">extern</span> CDomain *cd;
<a name="l00159"></a>00159 Queue *q[16];
<a name="l00160"></a>00160 <span class="comment">//class Vm *v_ptr=NULL;</span>
<a name="l00161"></a>00161 <span class="comment">//class VmQ *vq_ptr=NULL;</span>
<a name="l00162"></a>00162 <span class="preprocessor">#endif</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">/* architected state */</span>
<a name="l00167"></a><a class="code" href="thread_8h.html#f227be61b1f91b71aafae105501d92f7">00167</a> <span class="keyword">struct </span><a class="code" href="structthread__t.html">thread_t</a> ** <a class="code" href="sim-zesto_8cpp.html#f227be61b1f91b71aafae105501d92f7">threads</a> = NULL;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="comment">/* microarchitecture state */</span>
<a name="l00170"></a><a class="code" href="zesto-structs_8h.html#fd1fbe748ceabf38ef289bb5b346f69a">00170</a> <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> ** <a class="code" href="sim-zesto_8cpp.html#fd1fbe748ceabf38ef289bb5b346f69a">cores</a> = NULL;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 <span class="comment">/*global pointer to array of uncores*/</span>
<a name="l00173"></a><a class="code" href="zesto-structs_8h.html#58a16285046a9c04416e306f52015b52">00173</a> <span class="keyword">struct </span><a class="code" href="classuncore__t.html">uncore_t</a> ** <a class="code" href="sim-zesto_8cpp.html#58a16285046a9c04416e306f52015b52">uncores</a> = NULL; 
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="comment">/*CPU speed*/</span>
<a name="l00176"></a><a class="code" href="sim_8h.html#ebb0be7596a98356724d9653c17116c2">00176</a> <span class="keywordtype">double</span> <a class="code" href="sim-zesto_8cpp.html#ebb0be7596a98356724d9653c17116c2">cpu_speed</a> =3000;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="comment">/*pointer to modulo process the cores to avoid starvation*/</span>
<a name="l00179"></a><a class="code" href="sim-zesto_8cpp.html#9715e2df77829e54cb078a298fd6c434">00179</a> <span class="keywordtype">int</span> <a class="code" href="sim-zesto_8cpp.html#9715e2df77829e54cb078a298fd6c434">start_pos</a> = 0;
<a name="l00180"></a>00180 
<a name="l00181"></a><a class="code" href="sim-zesto_8cpp.html#af9443448449d3e516d9e748c4fbb6bf">00181</a> <span class="keywordtype">int</span> <a class="code" href="sim-zesto_8cpp.html#af9443448449d3e516d9e748c4fbb6bf">heartbeat_count</a> = 0;
<a name="l00182"></a>00182 <span class="comment">/* microarchitecture configuration parameters/knobs */</span>
<a name="l00183"></a><a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">00183</a> <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="comment">/* number of cores */</span>
<a name="l00186"></a><a class="code" href="thread_8h.html#26a8352e9cd3bc9a6a35bc8d88152985">00186</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a> = 1;
<a name="l00187"></a><a class="code" href="thread_8h.html#1b2701dab57f1ffb6459bbde33452d68">00187</a> <span class="keywordtype">int</span> <a class="code" href="sim-zesto_8cpp.html#1b2701dab57f1ffb6459bbde33452d68">simulated_processes_remaining</a> = 1;
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="zesto-opts_8h.html#d93be82106e505ae03e3a443a62d7238">00189</a> <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> = 0;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">/* initialize simulator data structures - called before any command-line options have been parsed! */</span>
<a name="l00192"></a>00192 <span class="keywordtype">void</span>
<a name="l00193"></a><a class="code" href="sim_8h.html#6f8bfcc0d1d039d6fb378af082656f6f">00193</a> <a class="code" href="sim-zesto_8cpp.html#6f8bfcc0d1d039d6fb378af082656f6f">sim_pre_init</a>(<span class="keywordtype">void</span>)
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195   <span class="comment">/* this only sets (malloc) up default values for the knobs */</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   <a class="code" href="misc_8h.html#c0247ae9677929c0d7a34cd197d3e57e">memzero</a>(&amp;<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>,<span class="keyword">sizeof</span>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>));
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   <span class="comment">/* set default parameters */</span>
<a name="l00200"></a>00200   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#38c1182c9de1cdd5d705fa5eb90dd5ab">model</a> = (<span class="keywordtype">char</span>*)<span class="stringliteral">"DPM"</span>;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#dac46ccee7d80153f423be4258e3b6c0">IL1PF_opt_str</a>[0] = (<span class="keywordtype">char</span>*)<span class="stringliteral">"nextline"</span>;
<a name="l00203"></a>00203   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#44849b4e0751d9fabd27568f778bac14">IL1_num_PF</a> = 1;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a> = 4;
<a name="l00206"></a>00206   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#19d455195aa815b92d55a848fba5cd7e">byteQ_linesize</a> = 16;
<a name="l00207"></a>00207   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#0b2a5addcef411c228190e315c0ac716">depth</a> = 2;
<a name="l00208"></a>00208   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#b58b777420f6904e072325942a0c2415">width</a> = 4;
<a name="l00209"></a>00209   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#2e52f47618b01dd4f95b250f0a6d0337">IQ_size</a> = 8;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#7b83939598abed42aee2ef81dbeda645">bpred_opt_str</a>[0] = (<span class="keywordtype">char</span>*)<span class="stringliteral">"2lev:gshare:1:1024:6:1"</span>;
<a name="l00212"></a>00212   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#55f4c8ed9d852752439e9aeb5327cb28">num_bpred_components</a> = 1;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#0b2a5addcef411c228190e315c0ac716">depth</a> = 3;
<a name="l00215"></a>00215   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#b58b777420f6904e072325942a0c2415">width</a> = 4;
<a name="l00216"></a>00216   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#35e7cbfcedd8d200ba4f922edd980927">target_stage</a> = 1;
<a name="l00217"></a>00217   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#9b6f98794199b9cd277b63a53f57a951">branch_decode_limit</a> = 1;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#49f397a2ac5d7d53b172d565ee9de02b">decoders</a>[0] = 4;
<a name="l00220"></a>00220   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1;i&lt;<a class="code" href="zesto-structs_8h.html#7925458602fb09113662210a6e857332">MAX_DECODE_WIDTH</a>;i++)
<a name="l00221"></a>00221     <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#49f397a2ac5d7d53b172d565ee9de02b">decoders</a>[i] = 1;
<a name="l00222"></a>00222   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#ed005388842df3298f60271dd48f3540">num_decoder_specs</a> = 4;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#11221d13b1478222871a40bcb9b597da">MS_latency</a> = 0;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#6dc1fa40282035ef593c34664e66c2a1">decode</a>.<a class="code" href="structcore__knobs__t.html#afce6ee11bf69be92bb7e2f779f58981">uopQ_size</a> = 8;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#59dbf024a4199a4119773f12776f2e06">alloc</a>.<a class="code" href="structcore__knobs__t.html#0b2a5addcef411c228190e315c0ac716">depth</a> = 2;
<a name="l00229"></a>00229   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#59dbf024a4199a4119773f12776f2e06">alloc</a>.<a class="code" href="structcore__knobs__t.html#b58b777420f6904e072325942a0c2415">width</a> = 4;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#08394d4bea79adf01bdecf738a7f58f8">RS_size</a> = 20;
<a name="l00232"></a>00232   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#84e38971897e7c17c06d859c92079204">LDQ_size</a> = 20;
<a name="l00233"></a>00233   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0b72c6bffc51d7d9380117678e5ab22d">STQ_size</a> = 16;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#92fc1674acee4fc2bed07ab13a058f7a">num_exec_ports</a> = 4;
<a name="l00236"></a>00236   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#9d2834576ea4ae6471d9538548107973">payload_depth</a> = 1;
<a name="l00237"></a>00237   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#1e0a19a190d0ecb6eb4fabb1a9b32d2d">fp_penalty</a> = 0;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d4c916607268cc4ccf11e41a8d88c4308">FU_IEU</a>].num_FUs = 2;
<a name="l00240"></a>00240   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d4c916607268cc4ccf11e41a8d88c4308">FU_IEU</a>][0] = 0;
<a name="l00241"></a>00241   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d4c916607268cc4ccf11e41a8d88c4308">FU_IEU</a>][1] = 1;
<a name="l00242"></a>00242   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d4c916607268cc4ccf11e41a8d88c4308">FU_IEU</a>] = 1;
<a name="l00243"></a>00243   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d4c916607268cc4ccf11e41a8d88c4308">FU_IEU</a>] = 1;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d83bb3975188b3c46010ce75e319b8c05">FU_JEU</a>].num_FUs = 1;
<a name="l00246"></a>00246   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d83bb3975188b3c46010ce75e319b8c05">FU_JEU</a>][0] = 0;
<a name="l00247"></a>00247   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d83bb3975188b3c46010ce75e319b8c05">FU_JEU</a>] = 1;
<a name="l00248"></a>00248   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d83bb3975188b3c46010ce75e319b8c05">FU_JEU</a>] = 1;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d94067a1a39501738fd9e1338139c251e">FU_IMUL</a>].num_FUs = 1;
<a name="l00251"></a>00251   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d94067a1a39501738fd9e1338139c251e">FU_IMUL</a>][0] = 2;
<a name="l00252"></a>00252   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d94067a1a39501738fd9e1338139c251e">FU_IMUL</a>] = 4;
<a name="l00253"></a>00253   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d94067a1a39501738fd9e1338139c251e">FU_IMUL</a>] = 1;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dcb7870498a4bec151bf3b1a12026fcee">FU_SHIFT</a>].num_FUs = 1;
<a name="l00256"></a>00256   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dcb7870498a4bec151bf3b1a12026fcee">FU_SHIFT</a>][0] = 0;
<a name="l00257"></a>00257   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dcb7870498a4bec151bf3b1a12026fcee">FU_SHIFT</a>] = 1;
<a name="l00258"></a>00258   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dcb7870498a4bec151bf3b1a12026fcee">FU_SHIFT</a>] = 1;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d2ddf79bdd59f512d03e088ddb09d2140">FU_FADD</a>].num_FUs = 1;
<a name="l00261"></a>00261   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d2ddf79bdd59f512d03e088ddb09d2140">FU_FADD</a>][0] = 0;
<a name="l00262"></a>00262   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d2ddf79bdd59f512d03e088ddb09d2140">FU_FADD</a>] = 3;
<a name="l00263"></a>00263   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d2ddf79bdd59f512d03e088ddb09d2140">FU_FADD</a>] = 1;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d552e3b0ae5425cc25662d735624af417">FU_FMUL</a>].num_FUs = 1;
<a name="l00266"></a>00266   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d552e3b0ae5425cc25662d735624af417">FU_FMUL</a>][0] = 1;
<a name="l00267"></a>00267   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d552e3b0ae5425cc25662d735624af417">FU_FMUL</a>] = 5;
<a name="l00268"></a>00268   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d552e3b0ae5425cc25662d735624af417">FU_FMUL</a>] = 2;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dc6df6a21736799f1ef6c1e3523fe15f1">FU_FCPLX</a>].num_FUs = 1;
<a name="l00271"></a>00271   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dc6df6a21736799f1ef6c1e3523fe15f1">FU_FCPLX</a>][0] = 2;
<a name="l00272"></a>00272   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dc6df6a21736799f1ef6c1e3523fe15f1">FU_FCPLX</a>] = 58;
<a name="l00273"></a>00273   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dc6df6a21736799f1ef6c1e3523fe15f1">FU_FCPLX</a>] = 58;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dcbf8d8b595a486e710ce3cc17f72c449">FU_IDIV</a>].num_FUs = 1;
<a name="l00276"></a>00276   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dcbf8d8b595a486e710ce3cc17f72c449">FU_IDIV</a>][0] = 2;
<a name="l00277"></a>00277   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dcbf8d8b595a486e710ce3cc17f72c449">FU_IDIV</a>] = 13;
<a name="l00278"></a>00278   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97dcbf8d8b595a486e710ce3cc17f72c449">FU_IDIV</a>] = 13;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97db5a90fa9eeff5d159eea288fb91c95ba">FU_FDIV</a>].num_FUs = 1;
<a name="l00281"></a>00281   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97db5a90fa9eeff5d159eea288fb91c95ba">FU_FDIV</a>][0] = 2;
<a name="l00282"></a>00282   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97db5a90fa9eeff5d159eea288fb91c95ba">FU_FDIV</a>] = 32;
<a name="l00283"></a>00283   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97db5a90fa9eeff5d159eea288fb91c95ba">FU_FDIV</a>] = 24;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>].num_FUs = 1;
<a name="l00286"></a>00286   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>][0] = 1;
<a name="l00287"></a>00287   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>] = 1;
<a name="l00288"></a>00288   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d15dc11f953742a3523aeed4b3a1625e4">FU_LD</a>] = 1;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d9bac22bb5c28d465c62bb3fc277d6593">FU_STA</a>].num_FUs = 1;
<a name="l00291"></a>00291   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d9bac22bb5c28d465c62bb3fc277d6593">FU_STA</a>][0] = 2;
<a name="l00292"></a>00292   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d9bac22bb5c28d465c62bb3fc277d6593">FU_STA</a>] = 1;
<a name="l00293"></a>00293   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d9bac22bb5c28d465c62bb3fc277d6593">FU_STA</a>] = 1;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#f4546e186d02184b706cbf20e189d5e8">port_binding</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d966321f8d50adda59b4025d3f733acdb">FU_STD</a>].num_FUs = 1;
<a name="l00296"></a>00296   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#2f223e6127eacf183677dab9be649e9b">fu_bindings</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d966321f8d50adda59b4025d3f733acdb">FU_STD</a>][0] = 3;
<a name="l00297"></a>00297   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d966321f8d50adda59b4025d3f733acdb">FU_STD</a>] = 1;
<a name="l00298"></a>00298   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#850a6f528cfc66eb1a963269d39d19fc">exec</a>.<a class="code" href="structcore__knobs__t.html#b5e29b731f4e53f680cdf44e785e8b45">issue_rate</a>[<a class="code" href="machine_8h.html#8df19faa86d463480418a8a9be92b97d966321f8d50adda59b4025d3f733acdb">FU_STD</a>] = 1;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#992e7058ad0a77e99b9e454d67d48c16">DL2PF_opt_str</a>[0] = (<span class="keywordtype">char</span>*)<span class="stringliteral">"nextline"</span>;
<a name="l00301"></a>00301   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#e34ca10986e72600bcd62707dff6fd99">DL2_num_PF</a> = 1;
<a name="l00302"></a>00302   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#af0904c8498e9f7a6e5bbcf4f2de8d44">DL2_MSHR_cmd</a> = (<span class="keywordtype">char</span>*)<span class="stringliteral">"RPWB"</span>;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#35a66a170baf0e1b69bd3d531150b14a">DL1PF_opt_str</a>[0] = (<span class="keywordtype">char</span>*)<span class="stringliteral">"nextline"</span>;
<a name="l00305"></a>00305   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#d2e3e855a3211975e29bcfc575ecc9c1">DL1_num_PF</a> = 1;
<a name="l00306"></a>00306   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#c424ee99e6a7cbba14b0ebd96f47b82b">DL1_MSHR_cmd</a> = (<span class="keywordtype">char</span>*)<span class="stringliteral">"RWBP"</span>;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a> = 64;
<a name="l00309"></a>00309   <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#b58b777420f6904e072325942a0c2415">width</a> = 4;
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="comment">/* helper signal handler for holding the processor state after a</span>
<a name="l00313"></a>00313 <span class="comment">   seg-fault or deadlock so that a debugger can be attached to check out</span>
<a name="l00314"></a>00314 <span class="comment">   what's wrong. */</span>
<a name="l00315"></a><a class="code" href="sim-zesto_8cpp.html#b35cfeccf968c0e4d7ce20475c5b8b69">00315</a> <span class="keywordtype">void</span> <a class="code" href="sim-zesto_8cpp.html#b35cfeccf968c0e4d7ce20475c5b8b69">my_SIGSEGV_handler</a>(<span class="keywordtype">int</span> signum)
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317 <span class="preprocessor">#ifdef ZESTO_DEBUG</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>  fprintf(stderr,<span class="stringliteral">"[%lld]# please attach a debugger or kill the simulator.\n"</span>,<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>);
<a name="l00319"></a>00319   <span class="keywordflow">while</span>(<span class="keyword">true</span>)
<a name="l00320"></a>00320     sleep(5);
<a name="l00321"></a>00321 <span class="preprocessor">#else</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span>  fprintf(stderr,<span class="stringliteral">"# SIGSEGV or deadlock detected ... killing the simulator\n"</span>);
<a name="l00323"></a>00323   exit(1);
<a name="l00324"></a>00324 <span class="preprocessor">#endif</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>}
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <span class="comment">/* initialize per-thread state, core state, etc. - called AFTER command-line parameters have been parsed */</span>
<a name="l00329"></a>00329 <span class="keywordtype">void</span>
<a name="l00330"></a><a class="code" href="sim_8h.html#7af633ff74aee8f90ea9a610892191ce">00330</a> <a class="code" href="sim-zesto_8cpp.html#7af633ff74aee8f90ea9a610892191ce">sim_post_init</a>(<span class="keywordtype">void</span>)
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00333"></a>00333   assert(<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a> &gt; 0);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335   <span class="comment">/* initialize architected state(s) */</span>
<a name="l00336"></a>00336   threads = (<span class="keyword">struct </span><a class="code" href="structthread__t.html">thread_t</a> **)calloc(<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a>,<span class="keyword">sizeof</span>(*threads));
<a name="l00337"></a>00337   <span class="keywordflow">if</span>(!threads)
<a name="l00338"></a>00338     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc threads"</span>);
<a name="l00339"></a>00339   <span class="keywordflow">else</span>
<a name="l00340"></a>00340     fprintf(stderr,<span class="stringliteral">"\nAllocating threads"</span>);
<a name="l00341"></a>00341   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a>;i++)
<a name="l00342"></a>00342   {
<a name="l00343"></a>00343     threads[i] = (<span class="keyword">struct </span><a class="code" href="structthread__t.html">thread_t</a> *)calloc(1,<span class="keyword">sizeof</span>(**threads));
<a name="l00344"></a>00344     <span class="keywordflow">if</span>(!threads[i])
<a name="l00345"></a>00345       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc threads[%d]"</span>,i);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     threads[i]-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a> = i;
<a name="l00348"></a>00348     threads[i]-&gt;<a class="code" href="structthread__t.html#fe142c06b5866f3f0c7cecdcb09dd4b2">current_core</a> = i; <span class="comment">/* assuming num_threads == num_cores */</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="comment">/* allocate and initialize register file */</span>
<a name="l00351"></a>00351     <a class="code" href="regs_8h.html#1c61451a98ebffdc6844774223f78de5">regs_init</a>(&amp;threads[i]-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="comment">/*start address of each thread, gets overridden by address of the first QEMU queue instruction*/</span>
<a name="l00354"></a>00354     threads[i]-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>=<a class="code" href="thread_8h.html#3e8bd7832d770102979335a24585c78f">BOOT_PC</a>;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358   <span class="comment">/* initialize microarchitecture state */</span>
<a name="l00359"></a>00359   cores = (<span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a>**) calloc(num_threads,<span class="keyword">sizeof</span>(*cores));
<a name="l00360"></a>00360   <span class="keywordflow">if</span>(!cores)
<a name="l00361"></a>00361     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc cores"</span>);
<a name="l00362"></a>00362   <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l00363"></a>00363   {
<a name="l00364"></a>00364     cores[i] = <span class="keyword">new</span> <a class="code" href="classcore__t.html#5bc9e3784ebc125c92ac3d84e0aed88a">core_t</a>(i);
<a name="l00365"></a>00365     <span class="keywordflow">if</span>(!cores[i])
<a name="l00366"></a>00366       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc cores[]"</span>);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     cores[i]-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a> = threads[i];
<a name="l00369"></a>00369     cores[i]-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a> = &amp;<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>;
<a name="l00370"></a>00370   }
<a name="l00371"></a>00371   <span class="comment">//fprintf(stderr,"\nAllocating Cores %s %d ", knobs.model,  num_threads);</span>
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <span class="comment">/* install signal handler for debug assistance */</span>
<a name="l00374"></a>00374   signal(SIGSEGV,<a class="code" href="sim-zesto_8cpp.html#b35cfeccf968c0e4d7ce20475c5b8b69">my_SIGSEGV_handler</a>);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 
<a name="l00378"></a>00378  <span class="comment">/*Create the uncores of all the CMP tiles*/</span>
<a name="l00379"></a>00379  uncores = (<span class="keyword">struct </span><a class="code" href="classuncore__t.html">uncore_t</a>**) calloc( (<a class="code" href="genericRC_8h.html#b78c10782810279fb9680eafef33b77d">no_nodes</a>-<a class="code" href="mshr_8h.html#56d27d790e05179f3787fce80d802d04">no_mcs</a>),<span class="keyword">sizeof</span>(*cores));
<a name="l00380"></a>00380  <span class="keywordflow">if</span>(!uncores)
<a name="l00381"></a>00381     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc uncores"</span>);
<a name="l00382"></a>00382  <span class="keywordflow">else</span>
<a name="l00383"></a>00383     fprintf(stderr,<span class="stringliteral">"\nAllocating Uncores"</span>);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> core_num=0;<span class="comment">/*Cores are assigned linearly to the uncores */</span>
<a name="l00386"></a>00386  <span class="keywordflow">for</span>(i=0;i&lt;(<a class="code" href="genericRC_8h.html#b78c10782810279fb9680eafef33b77d">no_nodes</a>-<a class="code" href="mshr_8h.html#56d27d790e05179f3787fce80d802d04">no_mcs</a>);i++)
<a name="l00387"></a>00387  {
<a name="l00388"></a>00388     uncores[i] = <span class="keyword">new</span> <a class="code" href="classuncore__t.html#e77d4ff919b2a60d9288553573c94143">uncore_t</a>(i,<a class="code" href="sim-zesto_8cpp.html#ebb0be7596a98356724d9653c17116c2">cpu_speed</a>,<a class="code" href="config__params_8h.html#167bf7b9303ef9d8ccec13d71a10d6b5">vcs</a>,<a class="code" href="genericRC_8h.html#b78c10782810279fb9680eafef33b77d">no_nodes</a>);
<a name="l00389"></a>00389     <span class="keywordflow">if</span>(!uncores[i])
<a name="l00390"></a>00390       <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc uncores[]"</span>);
<a name="l00391"></a>00391    
<a name="l00392"></a>00392     <span class="comment">/*Linking cores to the uncore and viceversa*/</span>
<a name="l00393"></a>00393     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="manifold__fullsim_8cc.html#d1fe1c89980f30a3204e89fe23449677">cores_per_node</a>;j++)
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395         fprintf(stderr,<span class="stringliteral">"\nUncore %d Core %d\n"</span>,i, core_num);
<a name="l00396"></a>00396         uncores[i]-&gt;<a class="code" href="classuncore__t.html#0ec1c954e2de8eb1cded0fb69d9eb14b">core</a>[j] = cores[core_num];
<a name="l00397"></a>00397         cores[core_num]-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a> = uncores[i];
<a name="l00398"></a>00398         core_num++;
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400  }
<a name="l00401"></a>00401  <span class="comment">/*Every thread/core is assigned an uncore*/</span>
<a name="l00402"></a>00402  assert(core_num==num_threads);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <span class="comment">/*Zesto originally calls the functional front end Oracle, For simplicity the name is left as is, but it is no more an oracle*/</span>
<a name="l00405"></a>00405   <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l00406"></a>00406   {
<a name="l00407"></a>00407     cores[i]-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>  = <span class="keyword">new</span> <a class="code" href="classcore__oracle__t.html">core_oracle_t</a>(cores[i]);
<a name="l00408"></a>00408     cores[i]-&gt;<a class="code" href="classcore__t.html#1058815318dc1da3c60b90d9a5479092">commit</a>  = <a class="code" href="zesto-commit_8cpp.html#6dec1ee8a7d324bb5e49bd7246608c52">commit_create</a>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#38c1182c9de1cdd5d705fa5eb90dd5ab">model</a>,cores[i]);
<a name="l00409"></a>00409     cores[i]-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>  = <a class="code" href="zesto-exec_8cpp.html#bc3339106471b5130704c973349de0ee">exec_create</a>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#38c1182c9de1cdd5d705fa5eb90dd5ab">model</a>,cores[i]);
<a name="l00410"></a>00410     cores[i]-&gt;<a class="code" href="classcore__t.html#20394b8c7a44d5ad56a16e9cd635299e">alloc</a>  = <a class="code" href="zesto-alloc_8cpp.html#d5e0575b7db14c11053d5da87dab1708">alloc_create</a>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#38c1182c9de1cdd5d705fa5eb90dd5ab">model</a>,cores[i]);
<a name="l00411"></a>00411     cores[i]-&gt;<a class="code" href="classcore__t.html#5a8f490b74ace2edeb7f90c493c98691">decode</a>  = <a class="code" href="zesto-decode_8cpp.html#4fc719f96861588f24dd802be6e2b0df">decode_create</a>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#38c1182c9de1cdd5d705fa5eb90dd5ab">model</a>,cores[i]);
<a name="l00412"></a>00412     cores[i]-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>  = <a class="code" href="zesto-fetch_8cpp.html#9dabdc921dc59e593201a9d42ee1fc63">fetch_create</a>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#38c1182c9de1cdd5d705fa5eb90dd5ab">model</a>,cores[i]);
<a name="l00413"></a>00413     cores[i]-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#47c204871c8aecc186222de0093d15b9">active</a> = <span class="keyword">true</span>;
<a name="l00414"></a>00414   }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416  fprintf(stderr,<span class="stringliteral">"core_num %d "</span>, core_num);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 <span class="comment">/* print simulator-specific configuration information */</span>
<a name="l00422"></a>00422   <span class="keywordtype">void</span>
<a name="l00423"></a><a class="code" href="thread_8h.html#67e5d7a21600d2eb1fb2f0798fc24a7c">00423</a> <a class="code" href="sim-zesto_8cpp.html#67e5d7a21600d2eb1fb2f0798fc24a7c">sim_aux_config</a>(FILE *stream)        <span class="comment">/* output stream */</span>
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425   <span class="comment">/* nothing currently */</span>
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 <span class="comment">/* dump simulator-specific auxiliary simulator statistics */</span>
<a name="l00429"></a>00429   <span class="keywordtype">void</span>
<a name="l00430"></a><a class="code" href="thread_8h.html#f0d3b44eaaad1fd53b38c9f82deb05fd">00430</a> <a class="code" href="sim-zesto_8cpp.html#f0d3b44eaaad1fd53b38c9f82deb05fd">sim_aux_stats</a>(FILE *stream)        <span class="comment">/* output stream */</span>
<a name="l00431"></a>00431 {
<a name="l00432"></a>00432   <span class="comment">/* nada */</span>
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 <span class="comment">/* un-initialize simulator-specific state */</span>
<a name="l00436"></a>00436   <span class="keywordtype">void</span>
<a name="l00437"></a><a class="code" href="thread_8h.html#12f418d794abd0896d834c9582373b00">00437</a> <a class="code" href="sim-zesto_8cpp.html#12f418d794abd0896d834c9582373b00">sim_uninit</a>(<span class="keywordtype">void</span>)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439   <span class="comment">/* nada */</span>
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="comment">/*</span>
<a name="l00445"></a>00445 <span class="comment"> * The following set of macros are for the fast forwarding</span>
<a name="l00446"></a>00446 <span class="comment"> */</span>
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 <span class="comment">/* next program counter */</span>
<a name="l00449"></a>00449 <span class="preprocessor">#define SET_NPC(EXPR)           (thread-&gt;regs.regs_NPC = (EXPR))</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span>
<a name="l00451"></a>00451 <span class="comment">/* current program counter */</span>
<a name="l00452"></a>00452 <span class="preprocessor">#define CPC                     (thread-&gt;regs.regs_PC)</span>
<a name="l00453"></a>00453 <span class="preprocessor"></span>
<a name="l00454"></a>00454 <span class="preprocessor">#ifdef TARGET_X86</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span><span class="comment">/* current program counter */</span>
<a name="l00456"></a><a class="code" href="sim-zesto_8cpp.html#47928f393a8ffdecfa07271f22beb34b">00456</a> <span class="preprocessor">#define CPC                     (thread-&gt;regs.regs_PC)</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span>
<a name="l00458"></a>00458 <span class="comment">/* next program counter */</span>
<a name="l00459"></a><a class="code" href="sim-zesto_8cpp.html#6bc40f3f63777e2bd9deb13953e38b2d">00459</a> <span class="preprocessor">#define NPC                     (thread-&gt;regs.regs_NPC)</span>
<a name="l00460"></a><a class="code" href="sim-zesto_8cpp.html#865b63e02a03e6220f36dfedfaf171f0">00460</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_NPC(EXPR)           (thread-&gt;regs.regs_NPC = (EXPR))</span>
<a name="l00461"></a><a class="code" href="sim-zesto_8cpp.html#237e92c04084e04a6903083038b0d2b3">00461</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_NPC_D(EXPR)         SET_NPC(EXPR)</span>
<a name="l00462"></a><a class="code" href="sim-zesto_8cpp.html#5df75989ea017f05abfeeaaca9c34c4b">00462</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_NPC_V(EXPR)                                                 \</span>
<a name="l00463"></a>00463 <span class="preprocessor">  ((Mop-&gt;fetch.inst.mode &amp; MODE_OPER32) ? SET_NPC((EXPR)) : SET_NPC((EXPR) &amp; 0xffff))</span>
<a name="l00464"></a>00464 <span class="preprocessor"></span>
<a name="l00465"></a>00465                                                  <span class="comment">/* general purpose registers */</span>
<a name="l00466"></a><a class="code" href="sim-zesto_8cpp.html#950ef2d9ae345ed861765730157d37d2">00466</a> <span class="preprocessor">#define _HI(N)                  ((N) &amp; 0x04)</span>
<a name="l00467"></a><a class="code" href="sim-zesto_8cpp.html#711eed827b7f6cfec827e05579cd2b66">00467</a> <span class="preprocessor"></span><span class="preprocessor">#define _ID(N)                  ((N) &amp; 0x03)</span>
<a name="l00468"></a><a class="code" href="sim-zesto_8cpp.html#93a68b4412d259f67d1257b64267534d">00468</a> <span class="preprocessor"></span><span class="preprocessor">#define _ARCH(N)                ((N) &lt; MD_REG_TMP0)</span>
<a name="l00469"></a>00469 <span class="preprocessor"></span>
<a name="l00470"></a>00470                                                  <span class="comment">/* segment registers ; UCSD*/</span>
<a name="l00471"></a><a class="code" href="sim-zesto_8cpp.html#a3788cd9050f7482f9bd8ac25e0ecf5b">00471</a> <span class="preprocessor">#define SEG_W(N)                (thread-&gt;regs.regs_S.w[N])</span>
<a name="l00472"></a><a class="code" href="sim-zesto_8cpp.html#0e4a1562565f347b84caa32963258150">00472</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_SEG_W(N,EXPR)       (thread-&gt;regs.regs_S.w[N] = (EXPR))</span>
<a name="l00473"></a>00473 <span class="preprocessor"></span>
<a name="l00474"></a><a class="code" href="sim-zesto_8cpp.html#841ea8fd08139832b659b3ff0d6f0e3d">00474</a> <span class="preprocessor">#define GPR_B(N)                (_ARCH(N)                               \</span>
<a name="l00475"></a>00475 <span class="preprocessor">    ? (_HI(N)                           \</span>
<a name="l00476"></a>00476 <span class="preprocessor">      ? thread-&gt;regs.regs_R.b[_ID(N)].hi                \</span>
<a name="l00477"></a>00477 <span class="preprocessor">      : thread-&gt;regs.regs_R.b[_ID(N)].lo)       \</span>
<a name="l00478"></a>00478 <span class="preprocessor">    : thread-&gt;regs.regs_R.b[N].lo)</span>
<a name="l00479"></a><a class="code" href="sim-zesto_8cpp.html#d033dd2415fd695c9d1e8318b6341a2e">00479</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_GPR_B(N,EXPR)       (_ARCH(N)                                  \</span>
<a name="l00480"></a>00480 <span class="preprocessor">    ? (_HI(N)                              \</span>
<a name="l00481"></a>00481 <span class="preprocessor">      ? (thread-&gt;regs.regs_R.b[_ID(N)].hi = (EXPR))  \</span>
<a name="l00482"></a>00482 <span class="preprocessor">      : (thread-&gt;regs.regs_R.b[_ID(N)].lo = (EXPR))) \</span>
<a name="l00483"></a>00483 <span class="preprocessor">    : (thread-&gt;regs.regs_R.b[N].lo = (EXPR)))</span>
<a name="l00484"></a>00484 <span class="preprocessor"></span>
<a name="l00485"></a><a class="code" href="sim-zesto_8cpp.html#49937247dbcf35e59ac3a4103e47259f">00485</a> <span class="preprocessor">#define GPR_W(N)                (thread-&gt;regs.regs_R.w[N].lo)</span>
<a name="l00486"></a><a class="code" href="sim-zesto_8cpp.html#94bc1db9dcc4e27b6f9dc9b181c1f188">00486</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_GPR_W(N,EXPR)       (thread-&gt;regs.regs_R.w[N].lo = (EXPR))</span>
<a name="l00487"></a>00487 <span class="preprocessor"></span>
<a name="l00488"></a><a class="code" href="sim-zesto_8cpp.html#47f414f821791526173fe7d70d726fb2">00488</a> <span class="preprocessor">#define GPR_D(N)                (thread-&gt;regs.regs_R.dw[N])</span>
<a name="l00489"></a><a class="code" href="sim-zesto_8cpp.html#f479882a574ad1c3e8028a799c3c031d">00489</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_GPR_D(N,EXPR)       (thread-&gt;regs.regs_R.dw[N] = (EXPR))</span>
<a name="l00490"></a>00490 <span class="preprocessor"></span>
<a name="l00491"></a>00491                                                  <span class="comment">/* FIXME: move these to the DEF file? */</span>
<a name="l00492"></a><a class="code" href="sim-zesto_8cpp.html#643f69abe43c44c53ccb513dc75b8edd">00492</a> <span class="preprocessor">#define GPR_V(N)                ((Mop-&gt;fetch.inst.mode &amp; MODE_OPER32)           \</span>
<a name="l00493"></a>00493 <span class="preprocessor">    ? GPR_D(N)                          \</span>
<a name="l00494"></a>00494 <span class="preprocessor">    : (dword_t)GPR_W(N))</span>
<a name="l00495"></a><a class="code" href="sim-zesto_8cpp.html#94ea2069d35ea9a6666a46dd573c310d">00495</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_GPR_V(N,EXPR)       ((Mop-&gt;fetch.inst.mode &amp; MODE_OPER32)           \</span>
<a name="l00496"></a>00496 <span class="preprocessor">    ? SET_GPR_D(N, EXPR)                        \</span>
<a name="l00497"></a>00497 <span class="preprocessor">    : SET_GPR_W(N, EXPR))</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span>
<a name="l00499"></a><a class="code" href="sim-zesto_8cpp.html#fe3b1fb9d4a9bfd28f1f0536e6a52094">00499</a> <span class="preprocessor">#define GPR_A(N)                ((Mop-&gt;fetch.inst.mode &amp; MODE_ADDR32)           \</span>
<a name="l00500"></a>00500 <span class="preprocessor">    ? GPR_D(N)                          \</span>
<a name="l00501"></a>00501 <span class="preprocessor">    : (dword_t)GPR_W(N))</span>
<a name="l00502"></a><a class="code" href="sim-zesto_8cpp.html#aaad11abd50c2dc2ff406fa27cf7678f">00502</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_GPR_A(N,EXPR)       ((Mop-&gt;fetch.inst.mode &amp; MODE_ADDR32)           \</span>
<a name="l00503"></a>00503 <span class="preprocessor">    ? SET_GPR_D(N, EXPR)                        \</span>
<a name="l00504"></a>00504 <span class="preprocessor">    : SET_GPR_W(N, EXPR))</span>
<a name="l00505"></a>00505 <span class="preprocessor"></span>
<a name="l00506"></a><a class="code" href="sim-zesto_8cpp.html#7533b70fb575778a0b20811f5a9c8bb4">00506</a> <span class="preprocessor">#define GPR_S(N)                ((Mop-&gt;fetch.inst.mode &amp; MODE_STACK32)          \</span>
<a name="l00507"></a>00507 <span class="preprocessor">    ? GPR_D(N)                          \</span>
<a name="l00508"></a>00508 <span class="preprocessor">    : (dword_t)GPR_W(N))</span>
<a name="l00509"></a><a class="code" href="sim-zesto_8cpp.html#36c3c33eb0e30cbae3b64c6d0803eae4">00509</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_GPR_S(N,EXPR)       ((Mop-&gt;fetch.inst.mode &amp; MODE_STACK32)          \</span>
<a name="l00510"></a>00510 <span class="preprocessor">    ? SET_GPR_D(N, EXPR)                        \</span>
<a name="l00511"></a>00511 <span class="preprocessor">    : SET_GPR_W(N, EXPR))</span>
<a name="l00512"></a>00512 <span class="preprocessor"></span>
<a name="l00513"></a><a class="code" href="sim-zesto_8cpp.html#33a09842f2467a215179ba1c4e09653f">00513</a> <span class="preprocessor">#define GPR(N)                  GPR_D(N)</span>
<a name="l00514"></a><a class="code" href="sim-zesto_8cpp.html#68fae1b429c1b8849ca83f455ad6ea38">00514</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_GPR(N,EXPR)         SET_GPR_D(N,EXPR)</span>
<a name="l00515"></a>00515 <span class="preprocessor"></span>
<a name="l00516"></a><a class="code" href="sim-zesto_8cpp.html#369389eba049ae8bd5b4de5d660b861f">00516</a> <span class="preprocessor">#define AFLAGS(MSK)             (thread-&gt;regs.regs_C.aflags &amp; (MSK))</span>
<a name="l00517"></a><a class="code" href="sim-zesto_8cpp.html#c5654cb73f3268e0390e1bd8382c6ad8">00517</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_AFLAGS(EXPR,MSK)    (assert(((EXPR) &amp; ~(MSK)) == 0),        \</span>
<a name="l00518"></a>00518 <span class="preprocessor">    thread-&gt;regs.regs_C.aflags =                        \</span>
<a name="l00519"></a>00519 <span class="preprocessor">    ((thread-&gt;regs.regs_C.aflags &amp; ~(MSK))      \</span>
<a name="l00520"></a>00520 <span class="preprocessor">     | ((EXPR) &amp; (MSK))))</span>
<a name="l00521"></a>00521 <span class="preprocessor"></span>
<a name="l00522"></a><a class="code" href="sim-zesto_8cpp.html#1a0c942425e8394d87a1262793048912">00522</a> <span class="preprocessor">#define FSW(MSK)                (thread-&gt;regs.regs_C.fsw &amp; (MSK))</span>
<a name="l00523"></a><a class="code" href="sim-zesto_8cpp.html#9896e158582eb11c95d07047c3fec101">00523</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_FSW(EXPR,MSK)       (assert(((EXPR) &amp; ~(MSK)) == 0),        \</span>
<a name="l00524"></a>00524 <span class="preprocessor">    thread-&gt;regs.regs_C.fsw =                   \</span>
<a name="l00525"></a>00525 <span class="preprocessor">    ((thread-&gt;regs.regs_C.fsw &amp; ~(MSK))         \</span>
<a name="l00526"></a>00526 <span class="preprocessor">     | ((EXPR) &amp; (MSK))))</span>
<a name="l00527"></a>00527 <span class="preprocessor"></span>
<a name="l00528"></a>00528                                                  <span class="comment">// added by cristiano</span>
<a name="l00529"></a><a class="code" href="sim-zesto_8cpp.html#9fbb923f79e2e5cdd6c74c94705b21cb">00529</a> <span class="preprocessor">#define CWD(MSK)                (thread-&gt;regs.regs_C.cwd &amp; (MSK))</span>
<a name="l00530"></a><a class="code" href="sim-zesto_8cpp.html#8071d6de21b945570bfac9589dd49f79">00530</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_CWD(EXPR,MSK)       (assert(((EXPR) &amp; ~(MSK)) == 0),        \</span>
<a name="l00531"></a>00531 <span class="preprocessor">    thread-&gt;regs.regs_C.cwd =                      \</span>
<a name="l00532"></a>00532 <span class="preprocessor">    ((thread-&gt;regs.regs_C.cwd &amp; ~(MSK))            \</span>
<a name="l00533"></a>00533 <span class="preprocessor">     | ((EXPR) &amp; (MSK))))</span>
<a name="l00534"></a>00534 <span class="preprocessor"></span>
<a name="l00535"></a>00535                                                  <span class="comment">/* floating point registers, L-&gt;word, F-&gt;single-prec, D-&gt;double-prec */</span>
<a name="l00536"></a>00536                                                  <span class="comment">/* FIXME: bad overlap, also need to support stack indexing... */</span>
<a name="l00537"></a><a class="code" href="sim-zesto_8cpp.html#4c385ed05e0bd8490781f35a122a0241">00537</a> <span class="preprocessor">#define _FPARCH(N)              ((N) &lt; MD_REG_FTMP0)</span>
<a name="l00538"></a><a class="code" href="sim-zesto_8cpp.html#9adbd7a2d18e1ad0c7ae0fe923acad93">00538</a> <span class="preprocessor"></span><span class="preprocessor">#define F2P(N)                                                          \</span>
<a name="l00539"></a>00539 <span class="preprocessor">                                                   (_FPARCH(N)                                                          \</span>
<a name="l00540"></a>00540 <span class="preprocessor">                                                    ? ((FSW_TOP(thread-&gt;regs.regs_C.fsw) + (N)) &amp; 0x07)                         \</span>
<a name="l00541"></a>00541 <span class="preprocessor">                                                    : (N))</span>
<a name="l00542"></a><a class="code" href="sim-zesto_8cpp.html#fcb75f93887802ec859d1129462e2bc7">00542</a> <span class="preprocessor"></span><span class="preprocessor">#define FPR(N)                  (thread-&gt;regs.regs_F.e[F2P(N)])</span>
<a name="l00543"></a><a class="code" href="sim-zesto_8cpp.html#d1f2e24af906596ccab8c65a695dce70">00543</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_FPR(N,EXPR)         (thread-&gt;regs.regs_F.e[F2P(N)] = (EXPR))</span>
<a name="l00544"></a>00544 <span class="preprocessor"></span>
<a name="l00545"></a><a class="code" href="sim-zesto_8cpp.html#327a614a72ecd9c0b62884060a1bb259">00545</a> <span class="preprocessor">#define FPSTACK_POP()                                                   \</span>
<a name="l00546"></a>00546 <span class="preprocessor">                                                   SET_FSW_TOP(thread-&gt;regs.regs_C.fsw, (FSW_TOP(thread-&gt;regs.regs_C.fsw) + 1) &amp; 0x07)</span>
<a name="l00547"></a><a class="code" href="sim-zesto_8cpp.html#33f3b84a911da7e5f45c0ef7c72d2cd1">00547</a> <span class="preprocessor"></span><span class="preprocessor">#define FPSTACK_PUSH()                                                  \</span>
<a name="l00548"></a>00548 <span class="preprocessor">                                                   SET_FSW_TOP(thread-&gt;regs.regs_C.fsw, (FSW_TOP(thread-&gt;regs.regs_C.fsw) + 7) &amp; 0x07)</span>
<a name="l00549"></a>00549 <span class="preprocessor"></span>
<a name="l00550"></a><a class="code" href="sim-zesto_8cpp.html#bdcf3cd4e8e60b7a1219db98c857cef9">00550</a> <span class="preprocessor">#define FPSTACK_OP(OP)                                                  \</span>
<a name="l00551"></a>00551 <span class="preprocessor">{                                                                       \</span>
<a name="l00552"></a>00552 <span class="preprocessor">  if ((OP) == fpstk_nop)                                                \</span>
<a name="l00553"></a>00553 <span class="preprocessor">  </span><span class="comment">/* nada... */</span>;                                                        \
<a name="l00554"></a>00554   else if ((OP) == fpstk_pop)                                           \
<a name="l00555"></a>00555   SET_FSW_TOP(thread-&gt;regs.regs_C.fsw, (FSW_TOP(thread-&gt;regs.regs_C.fsw)+1)&amp;0x07);\
<a name="l00556"></a>00556   else if ((OP) == fpstk_poppop)                                        \
<a name="l00557"></a>00557   {                                                                     \
<a name="l00558"></a>00558     SET_FSW_TOP(thread-&gt;regs.regs_C.fsw, (FSW_TOP(thread-&gt;regs.regs_C.fsw)+1)&amp;0x07);\
<a name="l00559"></a>00559     SET_FSW_TOP(thread-&gt;regs.regs_C.fsw, (FSW_TOP(thread-&gt;regs.regs_C.fsw)+1)&amp;0x07);\
<a name="l00560"></a>00560   }                                                                     \
<a name="l00561"></a>00561   else if ((OP) == fpstk_push)                                  \
<a name="l00562"></a>00562   SET_FSW_TOP(thread-&gt;regs.regs_C.fsw, (FSW_TOP(thread-&gt;regs.regs_C.fsw)+7)&amp;0x07);\
<a name="l00563"></a>00563   else                                                          \
<a name="l00564"></a>00564   panic("bogus FP stack operation");                            \
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="preprocessor">#else</span>
<a name="l00568"></a>00568 <span class="preprocessor"></span><span class="preprocessor">#error No ISA target defined (only x86 supported) ...</span>
<a name="l00569"></a>00569 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00570"></a>00570 <span class="preprocessor"></span>
<a name="l00571"></a>00571                                                  <span class="comment">/* precise architected memory state accessor macros */</span>
<a name="l00572"></a>00572 <span class="preprocessor">#ifdef TARGET_X86</span>
<a name="l00573"></a>00573 <span class="preprocessor"></span>
<a name="l00574"></a><a class="code" href="sim-zesto_8cpp.html#2967bbef616af8861c316b12b5ca3203">00574</a> <span class="preprocessor">#define READ_BYTE(SRC, FAULT)                                           \</span>
<a name="l00575"></a>00575 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, MEM_READ_BYTE(thread-&gt;mem, *addr = (SRC)))</span>
<a name="l00576"></a><a class="code" href="sim-zesto_8cpp.html#6a5dc8a34de59be3e818f3e4e548f6c8">00576</a> <span class="preprocessor"></span><span class="preprocessor">#define READ_WORD(SRC, FAULT)                                           \</span>
<a name="l00577"></a>00577 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, XMEM_READ_WORD(thread-&gt;mem, *addr = (SRC)))</span>
<a name="l00578"></a><a class="code" href="sim-zesto_8cpp.html#a2ff7b45c340039544196f5da2de752b">00578</a> <span class="preprocessor"></span><span class="preprocessor">#define READ_DWORD(SRC, FAULT)                                          \</span>
<a name="l00579"></a>00579 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, XMEM_READ_DWORD(thread-&gt;mem, *addr = (SRC)))</span>
<a name="l00580"></a><a class="code" href="sim-zesto_8cpp.html#7c5f5d585d91dff10f5b6ca754b421f6">00580</a> <span class="preprocessor"></span><span class="preprocessor">#define READ_QWORD(SRC, FAULT)                                          \</span>
<a name="l00581"></a>00581 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, XMEM_READ_QWORD(thread-&gt;mem, *addr = (SRC)))</span>
<a name="l00582"></a>00582 <span class="preprocessor"></span>
<a name="l00583"></a><a class="code" href="sim-zesto_8cpp.html#fc76adbab625381a0c38c41c059ca331">00583</a> <span class="preprocessor">#define WRITE_BYTE(SRC, DST, FAULT)                                     \</span>
<a name="l00584"></a>00584 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, MEM_WRITE_BYTE(thread-&gt;mem, *addr = (DST), (SRC)))</span>
<a name="l00585"></a><a class="code" href="sim-zesto_8cpp.html#39396193613c8f3b1a09a4ff205c16da">00585</a> <span class="preprocessor"></span><span class="preprocessor">#define WRITE_WORD(SRC, DST, FAULT)                                     \</span>
<a name="l00586"></a>00586 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, XMEM_WRITE_WORD(thread-&gt;mem, *addr = (DST), (SRC)))</span>
<a name="l00587"></a><a class="code" href="sim-zesto_8cpp.html#76efb0aae9cc59d15bad44bbdeca75d5">00587</a> <span class="preprocessor"></span><span class="preprocessor">#define WRITE_DWORD(SRC, DST, FAULT)                                    \</span>
<a name="l00588"></a>00588 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, XMEM_WRITE_DWORD(thread-&gt;mem, *addr = (DST), (SRC)))</span>
<a name="l00589"></a><a class="code" href="sim-zesto_8cpp.html#973ac8efc8287f3aebe50e8cf1aef741">00589</a> <span class="preprocessor"></span><span class="preprocessor">#define WRITE_QWORD(SRC, DST, FAULT)                                    \</span>
<a name="l00590"></a>00590 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, XMEM_WRITE_QWORD(thread-&gt;mem, *addr = (DST), (SRC)))</span>
<a name="l00591"></a>00591 <span class="preprocessor"></span>
<a name="l00592"></a>00592 <span class="preprocessor">#else </span><span class="comment">/* !TARGET_X86 */</span>
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 <span class="preprocessor">#define READ_BYTE(SRC, FAULT)                                           \</span>
<a name="l00595"></a>00595 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, *addr = (SRC), MEM_READ_BYTE(thread-&gt;mem, (SRC)))</span>
<a name="l00596"></a>00596 <span class="preprocessor"></span><span class="preprocessor">#define READ_WORD(SRC, FAULT)                                           \</span>
<a name="l00597"></a>00597 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, *addr = (SRC), MEM_READ_WORD(thread-&gt;mem, (SRC)))</span>
<a name="l00598"></a>00598 <span class="preprocessor"></span><span class="preprocessor">#define READ_DWORD(SRC, FAULT)                                          \</span>
<a name="l00599"></a>00599 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, *addr = (SRC), MEM_READ_DWORD(thread-&gt;mem, (SRC)))</span>
<a name="l00600"></a>00600 <span class="preprocessor"></span><span class="preprocessor">#define READ_QWORD(SRC, FAULT)                                          \</span>
<a name="l00601"></a>00601 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, *addr = (SRC), MEM_READ_QWORD(thread-&gt;mem, (SRC)))</span>
<a name="l00602"></a>00602 <span class="preprocessor"></span>
<a name="l00603"></a>00603 <span class="preprocessor">#define WRITE_BYTE(SRC, DST, FAULT)                                     \</span>
<a name="l00604"></a>00604 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, *addr = (DST), MEM_WRITE_BYTE(thread-&gt;mem, (DST), (SRC)))</span>
<a name="l00605"></a>00605 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_WORD(SRC, DST, FAULT)                                     \</span>
<a name="l00606"></a>00606 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, *addr = (DST), MEM_WRITE_WORD(thread-&gt;mem, (DST), (SRC)))</span>
<a name="l00607"></a>00607 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_DWORD(SRC, DST, FAULT)                                    \</span>
<a name="l00608"></a>00608 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, *addr = (DST), MEM_WRITE_DWORD(thread-&gt;mem, (DST), (SRC)))</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_QWORD(SRC, DST, FAULT)                                    \</span>
<a name="l00610"></a>00610 <span class="preprocessor">                                                   ((FAULT) = md_fault_none, *addr = (DST), MEM_WRITE_QWORD(thread-&gt;mem, (DST), (SRC)))</span>
<a name="l00611"></a>00611 <span class="preprocessor"></span>
<a name="l00612"></a>00612 <span class="preprocessor">#endif </span><span class="comment">/* !TARGET_X86 */</span>
<a name="l00613"></a>00613 
<a name="l00614"></a>00614                                                  <span class="comment">/* system call handler macro */</span>
<a name="l00615"></a><a class="code" href="sim-zesto_8cpp.html#72bc0399d2dd2ad179b9c5f0505551e2">00615</a> <span class="preprocessor">#define SYSCALL(INST)           unsigned int tni=0               // (sys_syscall(thread, mem_access, INST, true))</span>
<a name="l00616"></a>00616 <span class="preprocessor"></span>
<a name="l00617"></a>00617 <span class="comment">/* Inst/uop execution functions: doing this allows you to actually compile this</span>
<a name="l00618"></a>00618 <span class="comment">   file with optimizations turned on (e.g. gcc -O3), since without it, the</span>
<a name="l00619"></a>00619 <span class="comment">   giant switch was making gcc run out of memory. */</span>
<a name="l00620"></a><a class="code" href="sim-zesto_8cpp.html#0d06a1978d25d25a08e7365790bb9cea">00620</a> <span class="preprocessor">#define DEFINST(OP,MSK,NAME,OPFORM,RES,FLAGS,O1,I1,I2,I3,OFLAGS,IFLAGS)\</span>
<a name="l00621"></a>00621 <span class="preprocessor">static inline void SYMCAT(OP,_IMPL_FUNC)(struct thread_t * thread, struct Mop_t * Mop, enum md_fault_type * fault, md_addr_t *addr, bool * bogus)               \</span>
<a name="l00622"></a>00622 <span class="preprocessor">     SYMCAT(OP,_IMPL)</span>
<a name="l00623"></a><a class="code" href="sim-zesto_8cpp.html#e2e57a47696d1134596738df09c2a5f2">00623</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFLINK(OP,MSK,NAME,MASK,SHIFT)</span>
<a name="l00624"></a><a class="code" href="sim-zesto_8cpp.html#39a7648865000d8fa2ae64257cb18132">00624</a> <span class="preprocessor"></span><span class="preprocessor">#define CONNECT(OP)</span>
<a name="l00625"></a><a class="code" href="sim-zesto_8cpp.html#598ae1e60cce3e06a2f531d8a3de36a1">00625</a> <span class="preprocessor"></span><span class="preprocessor">#define DECLARE_FAULT(FAULT)                        \</span>
<a name="l00626"></a>00626 <span class="preprocessor">      { *fault = (FAULT); return; }</span>
<a name="l00627"></a>00627 <span class="preprocessor"></span><span class="preprocessor">#include "machine.def"</span>
<a name="l00628"></a>00628 <span class="preprocessor">#undef DEFINST</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span><span class="preprocessor">#undef DEFUOP</span>
<a name="l00630"></a>00630 <span class="preprocessor"></span><span class="preprocessor">#undef DEFLINK</span>
<a name="l00631"></a>00631 <span class="preprocessor"></span><span class="preprocessor">#undef DECLARE_FAULT</span>
<a name="l00632"></a>00632 <span class="preprocessor"></span>
<a name="l00633"></a>00633 <span class="keywordtype">void</span>
<a name="l00634"></a><a class="code" href="sim-zesto_8cpp.html#d4465337904f2c1d2b694eb41043de6e">00634</a> <a class="code" href="sim-zesto_8cpp.html#d4465337904f2c1d2b694eb41043de6e">sim_fastfwd</a>(<span class="keyword">struct</span> <a class="code" href="classcore__t.html">core_t</a> ** cores, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> insn_count)
<a name="l00635"></a>00635 {
<a name="l00636"></a>00636   <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> addr = 0;
<a name="l00637"></a>00637   <span class="keyword">struct </span><a class="code" href="structthread__t.html">thread_t</a> * thread = NULL;
<a name="l00638"></a>00638   <span class="keyword">enum</span> <a class="code" href="machine_8h.html#a85392bc9273ef092efe1e9f7422b321">md_fault_type</a> fault = <a class="code" href="machine_8h.html#a85392bc9273ef092efe1e9f7422b32119b8f8ccd7cf501d68fbe167f0244bbc">md_fault_none</a>;
<a name="l00639"></a>00639   <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> Mop_v;
<a name="l00640"></a>00640   <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> * Mop = &amp; Mop_v;
<a name="l00641"></a>00641   <span class="comment">//bool * bogus = NULL;</span>
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   <a class="code" href="misc_8h.html#c0247ae9677929c0d7a34cd197d3e57e">memzero</a>(Mop,<span class="keyword">sizeof</span>(*Mop));
<a name="l00644"></a>00644   <span class="keywordflow">if</span>(<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a> &gt; 1)
<a name="l00645"></a>00645     fprintf(stderr, <span class="stringliteral">"### fast forwarding %u instructions per thread, for all %d threads"</span>, insn_count,<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a>);
<a name="l00646"></a>00646   <span class="keywordflow">else</span>
<a name="l00647"></a>00647     fprintf(stderr, <span class="stringliteral">"### fast forwarding %u instructions"</span>, insn_count);
<a name="l00648"></a>00648   <span class="keywordflow">if</span>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#854336fff6e30b4d81f39378d9e7b2d6">warm_caches</a> || <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#9a4506be3b2e4d386b6cd3c889810043">warm_bpred</a>)
<a name="l00649"></a>00649   {
<a name="l00650"></a>00650     fprintf(stderr,<span class="stringliteral">": warming "</span>);
<a name="l00651"></a>00651     <span class="keywordflow">if</span>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#854336fff6e30b4d81f39378d9e7b2d6">warm_caches</a> &amp;&amp; <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#9a4506be3b2e4d386b6cd3c889810043">warm_bpred</a>)
<a name="l00652"></a>00652       fprintf(stderr,<span class="stringliteral">"caches and bpred"</span>);
<a name="l00653"></a>00653     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#854336fff6e30b4d81f39378d9e7b2d6">warm_caches</a>)
<a name="l00654"></a>00654       fprintf(stderr,<span class="stringliteral">"caches only"</span>);
<a name="l00655"></a>00655     <span class="keywordflow">else</span>
<a name="l00656"></a>00656       fprintf(stderr,<span class="stringliteral">"bpred only"</span>);
<a name="l00657"></a>00657   }
<a name="l00658"></a>00658   fprintf(stderr,<span class="stringliteral">"\n"</span>);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;insn_count;i++)
<a name="l00661"></a>00661   {
<a name="l00662"></a>00662     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0;t&lt;<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a>;t++)
<a name="l00663"></a>00663     {
<a name="l00664"></a>00664       <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> * core = cores[t];
<a name="l00665"></a>00665       <span class="keyword">struct </span><a class="code" href="classuncore__t.html">uncore_t</a> *uncore = core-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>;
<a name="l00666"></a>00666       Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a> = core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#48647ea733ca43990ea2a9b8c4d03ab8">get_state_cache</a>();
<a name="l00667"></a>00667       thread = core-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="comment">//exec_rep_again:</span>
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 <span class="comment">//      /* maintain $r0 semantics */</span>
<a name="l00672"></a>00672 <span class="comment">//      thread-&gt;regs.regs_R.dw[MD_REG_ZERO] = 0;</span>
<a name="l00673"></a>00673 
<a name="l00674"></a>00674       <span class="comment">/* get the next instruction to execute */</span>
<a name="l00675"></a>00675       <span class="comment">/* read raw bytes from virtual memory */</span>
<a name="l00676"></a>00676       <a class="code" href="zesto-oracle_8h.html#465a782fc5c7f5e58a637011cd6c26ed">MD_FETCH_INST</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>, thread-&gt;<a class="code" href="structthread__t.html#5a5007f71bf42d78ac7305cd30f7dd3f">mem</a>, thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>, core-&gt;<a class="code" href="classcore__t.html#3a8653bac0ed9aefff8d1679ca81546f">id</a>);
<a name="l00677"></a>00677       <span class="comment">/* then decode the instruction */</span>
<a name="l00678"></a>00678       <a class="code" href="machine_8h.html#7d127ef0f1f9750b48bb0085c83af02a">MD_SET_OPCODE_DURING_FETCH</a>(Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#59504c7680bff25f84fca7951439626a">op</a>, Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 <span class="comment">//      if(Mop-&gt;fetch.inst.rep)</span>
<a name="l00681"></a>00681 <span class="comment">//        Mop-&gt;decode.opflags |= F_COND|F_CTRL;</span>
<a name="l00682"></a>00682 
<a name="l00683"></a>00683       Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7301ad4e0c0f5ece738ba62448f7c655">opflags</a> = <a class="code" href="machine_8h.html#9b0f21d8388c386bb4159d06bcf1ed72">MD_OP_FLAGS</a>(Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#59504c7680bff25f84fca7951439626a">op</a>);
<a name="l00684"></a>00684 
<a name="l00685"></a>00685       Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#2ac0786c8628d0e7042cdc07a8d6fcdd">is_trap</a> = !!(Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7301ad4e0c0f5ece738ba62448f7c655">opflags</a> &amp; <a class="code" href="machine_8h.html#fca5911ccd3348339952f3772240aa24">F_TRAP</a>);
<a name="l00686"></a>00686       Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#64bb9f9c135012445c43e8823e98bb3d">is_ctrl</a> = !!(Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7301ad4e0c0f5ece738ba62448f7c655">opflags</a> &amp; <a class="code" href="machine_8h.html#366552bee0ef835c75db8fedf12c11f7">F_CTRL</a>);
<a name="l00687"></a>00687 
<a name="l00688"></a>00688       <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> nextPC;
<a name="l00689"></a>00689       <a class="code" href="zesto-oracle_8h.html#486f7c7db21691d4d34a7818717e98b8">MD_FETCH_NEXT_PC</a>(nextPC, core-&gt;<a class="code" href="classcore__t.html#3a8653bac0ed9aefff8d1679ca81546f">id</a>);
<a name="l00690"></a>00690       thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#70500e5215c4ebb383c43c05a670346c">regs_NPC</a>=nextPC;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 <span class="comment">//      /* set up initial default next PC */</span>
<a name="l00694"></a>00694 <span class="comment">//      thread-&gt;regs.regs_NPC = thread-&gt;regs.regs_PC + MD_INST_SIZE(Mop-&gt;fetch.inst);</span>
<a name="l00695"></a>00695       thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>=Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#95beb627225d1c1eb84837df86c53e28">vaddr</a>;       
<a name="l00696"></a>00696       Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a> = thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698       <span class="comment">/* set default reference address */</span>
<a name="l00699"></a>00699       addr = 0;
<a name="l00700"></a>00700       fault = <a class="code" href="machine_8h.html#a85392bc9273ef092efe1e9f7422b32119b8f8ccd7cf501d68fbe167f0244bbc">md_fault_none</a>;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702       <span class="keywordflow">if</span>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#854336fff6e30b4d81f39378d9e7b2d6">warm_caches</a>)
<a name="l00703"></a>00703       {
<a name="l00704"></a>00704         <span class="comment">/* icache */</span>
<a name="l00705"></a>00705         <a class="code" href="machine_8h.html#1283325781575bd7f116553a4cd7efd5">md_paddr_t</a> pPC = Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#e05730869a364bf93b640941f78113ab">paddr</a>; <span class="comment">//v2p_translate(thread-&gt;id,thread-&gt;regs.regs_PC); /* physical addr for PC */</span>
<a name="l00706"></a>00706         <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8cpp.html#bbba2e5ba6186173122bcf1e35dc56eb">cache_is_hit</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,pPC,core))
<a name="l00707"></a>00707         {
<a name="l00708"></a>00708           <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8cpp.html#64ef5d6d0aef624c6534b1aae0416f96">cache_get_evictee</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>,pPC,core);
<a name="l00709"></a>00709           p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00710"></a>00710           <a class="code" href="config_2zesto-cache_8cpp.html#1f7522c0547a72f15e199abba2f63812">cache_insert_block</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,pPC,core);
<a name="l00711"></a>00711 
<a name="l00712"></a>00712           <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>)
<a name="l00713"></a>00713           {
<a name="l00714"></a>00714             <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8cpp.html#bbba2e5ba6186173122bcf1e35dc56eb">cache_is_hit</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,pPC,core))
<a name="l00715"></a>00715             {
<a name="l00716"></a>00716               <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8cpp.html#64ef5d6d0aef624c6534b1aae0416f96">cache_get_evictee</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,pPC,core);
<a name="l00717"></a>00717               p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00718"></a>00718               <a class="code" href="config_2zesto-cache_8cpp.html#1f7522c0547a72f15e199abba2f63812">cache_insert_block</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,pPC,core);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720               <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8h.html#4c8a74cb2e996679500e5a9adb9efb5c">cache_is_hit_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,pPC,core))
<a name="l00721"></a>00721               {
<a name="l00722"></a>00722                 <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8h.html#77864b4219a45ec15cbe3ff986d131b9">cache_get_evictee_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,pPC,core);
<a name="l00723"></a>00723                 p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00724"></a>00724                 <a class="code" href="config_2zesto-cache_8h.html#abc5a15d6fe00d533a2b4b8e4b13cc59">cache_insert_block_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,pPC,core);
<a name="l00725"></a>00725               }
<a name="l00726"></a>00726             }
<a name="l00727"></a>00727           }
<a name="l00728"></a>00728           <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8h.html#4c8a74cb2e996679500e5a9adb9efb5c">cache_is_hit_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,pPC,core))
<a name="l00729"></a>00729           {
<a name="l00730"></a>00730             <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8h.html#77864b4219a45ec15cbe3ff986d131b9">cache_get_evictee_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,pPC,core);
<a name="l00731"></a>00731             p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00732"></a>00732             <a class="code" href="config_2zesto-cache_8h.html#abc5a15d6fe00d533a2b4b8e4b13cc59">cache_insert_block_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,pPC,core);
<a name="l00733"></a>00733           }
<a name="l00734"></a>00734         }
<a name="l00735"></a>00735         <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8cpp.html#bbba2e5ba6186173122bcf1e35dc56eb">cache_is_hit</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>),core))
<a name="l00736"></a>00736         {
<a name="l00737"></a>00737           <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8cpp.html#64ef5d6d0aef624c6534b1aae0416f96">cache_get_evictee</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>),core);
<a name="l00738"></a>00738           p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00739"></a>00739           <a class="code" href="config_2zesto-cache_8cpp.html#1f7522c0547a72f15e199abba2f63812">cache_insert_block</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>),core);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741           <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a> &amp;&amp; !<a class="code" href="config_2zesto-cache_8cpp.html#bbba2e5ba6186173122bcf1e35dc56eb">cache_is_hit</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>),core))
<a name="l00742"></a>00742           {
<a name="l00743"></a>00743             <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8cpp.html#64ef5d6d0aef624c6534b1aae0416f96">cache_get_evictee</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>),core);
<a name="l00744"></a>00744             p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00745"></a>00745             <a class="code" href="config_2zesto-cache_8cpp.html#1f7522c0547a72f15e199abba2f63812">cache_insert_block</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>),core);
<a name="l00746"></a>00746           }
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="comment">/* dcache */</span>
<a name="l00750"></a>00750         <span class="keywordflow">if</span>(<a class="code" href="machine_8h.html#9b0f21d8388c386bb4159d06bcf1ed72">MD_OP_FLAGS</a>(Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#59504c7680bff25f84fca7951439626a">op</a>) &amp; <a class="code" href="machine_8h.html#a6be3e11431119e8d3ab666ab4f5ded7">F_MEM</a>)
<a name="l00751"></a>00751         {
<a name="l00752"></a>00752           <span class="keyword">enum</span> <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255">cache_command</a> cmd = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>;
<a name="l00753"></a>00753           <a class="code" href="machine_8h.html#1283325781575bd7f116553a4cd7efd5">md_paddr_t</a> paddr = Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#fed221efd36b737217220c9c44cf8e99">mem_paddr</a>;         <span class="comment">//v2p_translate(thread-&gt;id,addr);</span>
<a name="l00754"></a>00754           <span class="keywordflow">if</span>(<a class="code" href="machine_8h.html#9b0f21d8388c386bb4159d06bcf1ed72">MD_OP_FLAGS</a>(Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#59504c7680bff25f84fca7951439626a">op</a>) &amp; <a class="code" href="machine_8h.html#88eaa4bf4bc810ef90a437971cd5cf9e">F_STORE</a>)
<a name="l00755"></a>00755             cmd = <a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255f31232fbf9e45b41922cf68b09a4a201">CACHE_WRITE</a>;
<a name="l00756"></a>00756           <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8cpp.html#bbba2e5ba6186173122bcf1e35dc56eb">cache_is_hit</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,cmd,paddr,core))
<a name="l00757"></a>00757           {
<a name="l00758"></a>00758             <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8cpp.html#64ef5d6d0aef624c6534b1aae0416f96">cache_get_evictee</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,paddr,core);
<a name="l00759"></a>00759             p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00760"></a>00760             <a class="code" href="config_2zesto-cache_8cpp.html#1f7522c0547a72f15e199abba2f63812">cache_insert_block</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>,cmd,paddr,core);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762             <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>)
<a name="l00763"></a>00763             {
<a name="l00764"></a>00764               <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8cpp.html#bbba2e5ba6186173122bcf1e35dc56eb">cache_is_hit</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,cmd,paddr,core))
<a name="l00765"></a>00765               {
<a name="l00766"></a>00766                 <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8cpp.html#64ef5d6d0aef624c6534b1aae0416f96">cache_get_evictee</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,paddr,core);
<a name="l00767"></a>00767                 p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00768"></a>00768                 <a class="code" href="config_2zesto-cache_8cpp.html#1f7522c0547a72f15e199abba2f63812">cache_insert_block</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,cmd,paddr,core);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770                 <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8h.html#4c8a74cb2e996679500e5a9adb9efb5c">cache_is_hit_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,cmd,paddr,core))
<a name="l00771"></a>00771                 {
<a name="l00772"></a>00772                   <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8h.html#77864b4219a45ec15cbe3ff986d131b9">cache_get_evictee_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,paddr,core);
<a name="l00773"></a>00773                   p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00774"></a>00774                   <a class="code" href="config_2zesto-cache_8h.html#abc5a15d6fe00d533a2b4b8e4b13cc59">cache_insert_block_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,cmd,paddr,core);
<a name="l00775"></a>00775                 }
<a name="l00776"></a>00776               }
<a name="l00777"></a>00777             }
<a name="l00778"></a>00778             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8h.html#4c8a74cb2e996679500e5a9adb9efb5c">cache_is_hit_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,cmd,paddr,core))
<a name="l00779"></a>00779             {
<a name="l00780"></a>00780               <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8h.html#77864b4219a45ec15cbe3ff986d131b9">cache_get_evictee_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,paddr,core);
<a name="l00781"></a>00781               p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00782"></a>00782               <a class="code" href="config_2zesto-cache_8h.html#abc5a15d6fe00d533a2b4b8e4b13cc59">cache_insert_block_llc</a>(uncore-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,cmd,paddr,core);
<a name="l00783"></a>00783             }
<a name="l00784"></a>00784           }
<a name="l00785"></a>00785           addr=Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#b5f64c5560af0a48098e149f107890d6">mem_vaddr</a>;
<a name="l00786"></a>00786           <span class="keywordflow">if</span>(!<a class="code" href="config_2zesto-cache_8cpp.html#bbba2e5ba6186173122bcf1e35dc56eb">cache_is_hit</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,addr),core))
<a name="l00787"></a>00787           {
<a name="l00788"></a>00788             <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8cpp.html#64ef5d6d0aef624c6534b1aae0416f96">cache_get_evictee</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,addr),core);
<a name="l00789"></a>00789             p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00790"></a>00790             <a class="code" href="config_2zesto-cache_8cpp.html#1f7522c0547a72f15e199abba2f63812">cache_insert_block</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,addr),core);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792             <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a> &amp;&amp; !<a class="code" href="config_2zesto-cache_8cpp.html#bbba2e5ba6186173122bcf1e35dc56eb">cache_is_hit</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,addr),core))
<a name="l00793"></a>00793             {
<a name="l00794"></a>00794               <span class="keyword">struct </span><a class="code" href="structcache__line__t.html">cache_line_t</a> * p = <a class="code" href="config_2zesto-cache_8cpp.html#64ef5d6d0aef624c6534b1aae0416f96">cache_get_evictee</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,addr),core);
<a name="l00795"></a>00795               p-&gt;<a class="code" href="structcache__line__t.html#b4349edfc16860c559fbf5870b2dfc3f">dirty</a> = p-&gt;<a class="code" href="structcache__line__t.html#a28415835a1134b3b9c32020ad2ffdc9">valid</a> = <span class="keyword">false</span>;
<a name="l00796"></a>00796               <a class="code" href="config_2zesto-cache_8cpp.html#1f7522c0547a72f15e199abba2f63812">cache_insert_block</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(thread-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,addr),core);
<a name="l00797"></a>00797             }
<a name="l00798"></a>00798           }
<a name="l00799"></a>00799         }
<a name="l00800"></a>00800       }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802       <span class="keywordflow">if</span>(<a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a>.<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#9a4506be3b2e4d386b6cd3c889810043">warm_bpred</a> &amp;&amp; (Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#64bb9f9c135012445c43e8823e98bb3d">is_ctrl</a> || Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#3cb7c4132587d2f78d978d951ab0eef7">rep</a>) &amp;&amp; core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>)
<a name="l00803"></a>00803       {
<a name="l00804"></a>00804         <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#64bb9f9c135012445c43e8823e98bb3d">is_ctrl</a>)
<a name="l00805"></a>00805         {
<a name="l00806"></a>00806                 <span class="keywordflow">if</span>(thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#70500e5215c4ebb383c43c05a670346c">regs_NPC</a> != (thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a> + <a class="code" href="machine_8h.html#14c2828e3f3d84cfb676273b5dfc5bf8">MD_INST_SIZE</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>)) )
<a name="l00807"></a>00807                         Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#f820451bdee352d521eb3bf905c3d4e0">targetPC</a>=thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#70500e5215c4ebb383c43c05a670346c">regs_NPC</a>;
<a name="l00808"></a>00808                 <span class="keywordflow">else</span>
<a name="l00809"></a>00809                         Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#f820451bdee352d521eb3bf905c3d4e0">targetPC</a>=thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a> + <a class="code" href="machine_8h.html#14c2828e3f3d84cfb676273b5dfc5bf8">MD_INST_SIZE</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>)+ Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#b2f0a90d745653fcc0f7b2764407bb59">imm</a>;
<a name="l00810"></a>00810         }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812         Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> = thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#70500e5215c4ebb383c43c05a670346c">regs_NPC</a>;
<a name="l00813"></a>00813         <span class="comment">/* bpred */</span>
<a name="l00814"></a>00814         core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#eb9b5d4a17fb1fb8ea0055de44874d4e">lookup</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>,
<a name="l00815"></a>00815                                    Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7301ad4e0c0f5ece738ba62448f7c655">opflags</a>,
<a name="l00816"></a>00816                                    Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>+Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>,
<a name="l00817"></a>00817                                    Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#f820451bdee352d521eb3bf905c3d4e0">targetPC</a>,
<a name="l00818"></a>00818                                    Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>,(Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> != (Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>+Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>)));
<a name="l00819"></a>00819 
<a name="l00820"></a>00820         core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#d355ab253a6029ba45cc4fa10229081d">recover</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>,(Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> != (Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a> + Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>)));
<a name="l00821"></a>00821 
<a name="l00822"></a>00822         core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#8c7073a32e9c65c31b1af33b6c16b754">update</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>,
<a name="l00823"></a>00823                                    Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7301ad4e0c0f5ece738ba62448f7c655">opflags</a>,
<a name="l00824"></a>00824                                    Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,
<a name="l00825"></a>00825                                    Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#f820451bdee352d521eb3bf905c3d4e0">targetPC</a>,
<a name="l00826"></a>00826                                    Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>,
<a name="l00827"></a>00827                                    (Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> != (Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a> + Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>)));
<a name="l00828"></a>00828       }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830 <span class="comment">//      /* hit end of inst, count it. (REP counts as single inst.) */</span>
<a name="l00831"></a>00831 <span class="comment">//      if(thread-&gt;regs.regs_NPC != thread-&gt;regs.regs_PC)</span>
<a name="l00832"></a>00832 <span class="comment">//              thread-&gt;stat.num_insn++;</span>
<a name="l00833"></a>00833 <span class="comment">//      else</span>
<a name="l00834"></a>00834 <span class="comment">//        goto exec_rep_again; /* complete execution of entire REP instruction before moving on */</span>
<a name="l00835"></a>00835 
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       thread-&gt;<a class="code" href="structthread__t.html#9ec7f775f2b8390dc4088ee1c40d9cc3">stat</a>.<a class="code" href="structthread__t.html#f868fe7453e104d71cbe7cd80248a451">num_insn</a>++;
<a name="l00838"></a>00838       <span class="comment">/* go to the next instruction */</span>
<a name="l00839"></a>00839       thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a> = thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#70500e5215c4ebb383c43c05a670346c">regs_NPC</a>;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841       core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#f9c3b3c249ede7672c20b900ff8768e9">return_state_cache</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>);
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843   }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0;t&lt;<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a>;t++)
<a name="l00846"></a>00846   {
<a name="l00847"></a>00847     <span class="keyword">struct </span><a class="code" href="classcore__t.html">core_t</a> * core = cores[t];
<a name="l00848"></a>00848     thread = core-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>;
<a name="l00849"></a>00849 
<a name="l00850"></a>00850     core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a> = thread-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>;
<a name="l00851"></a>00851 
<a name="l00852"></a>00852 <span class="comment">//    /* maintain $r0 semantics */</span>
<a name="l00853"></a>00853 <span class="comment">//    thread-&gt;regs.regs_R.dw[MD_REG_ZERO] = 0;</span>
<a name="l00854"></a>00854 
<a name="l00855"></a>00855     <span class="comment">/* reset stats */</span>
<a name="l00856"></a>00856     <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>) <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>);
<a name="l00857"></a>00857     <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>) <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>);
<a name="l00858"></a>00858     <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>) <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>);
<a name="l00859"></a>00859     <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>) <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>);
<a name="l00860"></a>00860     <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>) <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>);
<a name="l00861"></a>00861     <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>) <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>);
<a name="l00862"></a>00862     <span class="keywordflow">if</span>(core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>) core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#256cf64d1d35419885b964316cfa95f2">reset_stats</a>();
<a name="l00863"></a>00863     core-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a> = insn_count;
<a name="l00864"></a>00864   }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0;t&lt;(<a class="code" href="genericRC_8h.html#b78c10782810279fb9680eafef33b77d">no_nodes</a>-<a class="code" href="mshr_8h.html#56d27d790e05179f3787fce80d802d04">no_mcs</a>);t++)
<a name="l00867"></a>00867   {
<a name="l00868"></a>00868      <span class="keywordflow">if</span>(uncores[t]-&gt;LLC) <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(uncores[t]-&gt;LLC);
<a name="l00869"></a>00869   }
<a name="l00870"></a>00870 }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872 <span class="comment">/* If a thread gets really wedged (architecturally incorrect), we can try to recover by blowing away</span>
<a name="l00873"></a>00873 <span class="comment">   all of its state, reloading from its EIO file, and fastfwding back to the point of failure. */</span>
<a name="l00874"></a>00874 <span class="keywordtype">void</span>
<a name="l00875"></a><a class="code" href="sim-zesto_8cpp.html#46f3df2fecce36d299cd1dd4534d0088">00875</a> <a class="code" href="sim-zesto_8cpp.html#46f3df2fecce36d299cd1dd4534d0088">emergency_recovery</a>(<span class="keyword">struct</span> <a class="code" href="classcore__t.html">core_t</a> * core)
<a name="l00876"></a>00876 {
<a name="l00877"></a>00877   <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> addr = 0;
<a name="l00878"></a>00878   <span class="keyword">struct </span><a class="code" href="structthread__t.html">thread_t</a> * thread = core-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>;
<a name="l00879"></a>00879   <span class="keyword">enum</span> <a class="code" href="machine_8h.html#a85392bc9273ef092efe1e9f7422b321">md_fault_type</a> fault = <a class="code" href="machine_8h.html#a85392bc9273ef092efe1e9f7422b32119b8f8ccd7cf501d68fbe167f0244bbc">md_fault_none</a>;
<a name="l00880"></a>00880   <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> Mop_v;
<a name="l00881"></a>00881   <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> * Mop = &amp; Mop_v;
<a name="l00882"></a>00882   <span class="keywordtype">bool</span> * bogus = NULL;
<a name="l00883"></a>00883   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> insn_count = core-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a>;
<a name="l00884"></a>00884 
<a name="l00885"></a>00885   <span class="keywordflow">if</span>((core-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a> == core-&gt;<a class="code" href="classcore__t.html#11034d8bb95a7d541a7a0d5efdaded9a">last_emergency_recovery_count</a>) &amp;&amp; (core-&gt;<a class="code" href="classcore__t.html#ad184ce68308f37e1fb07a5eab624314">num_emergency_recoveries</a> &gt; 0))
<a name="l00886"></a>00886     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"After previous attempted recovery, thread %d is still getting wedged... giving up."</span>,core-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888   memset(Mop,0,<span class="keyword">sizeof</span>(*Mop));
<a name="l00889"></a>00889   fprintf(stderr, <span class="stringliteral">"### Emergency recovery for thread %d, resetting to inst-count: %lld\n"</span>, core-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,core-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a>);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891   <span class="comment">/* reset core state */</span>
<a name="l00892"></a>00892   core-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a> = 0;
<a name="l00893"></a>00893   core-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#9f125e90b225555a2632277161f3b27c">complete_flush</a>();
<a name="l00894"></a>00894   core-&gt;<a class="code" href="classcore__t.html#1058815318dc1da3c60b90d9a5479092">commit</a>-&gt;<a class="code" href="classcore__commit__t.html#93b5aa051280bff8ca2a57bf00fd3f87">recover</a>();
<a name="l00895"></a>00895   core-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#b9edcea5d76d1bbdbe89696ddf876c73">recover</a>();
<a name="l00896"></a>00896   core-&gt;<a class="code" href="classcore__t.html#20394b8c7a44d5ad56a16e9cd635299e">alloc</a>-&gt;<a class="code" href="classcore__alloc__t.html#e8350cafe32ac5219eaea41e6fb11f57">recover</a>();
<a name="l00897"></a>00897   core-&gt;<a class="code" href="classcore__t.html#5a8f490b74ace2edeb7f90c493c98691">decode</a>-&gt;<a class="code" href="classcore__decode__t.html#4cc12f3baa24ee5764ae57d87b759743">recover</a>();
<a name="l00898"></a>00898   core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#5f9f05d72804be74a2a622eeb5456e51">recover</a>(0);
<a name="l00899"></a>00899   <span class="comment">// NOT NEEDED WITH QEMU wipe_memory(core-&gt;current_thread-&gt;mem);</span>
<a name="l00900"></a>00900 
<a name="l00901"></a>00901   <span class="comment">//ld_reload_prog(core-&gt;current_thread);</span>
<a name="l00902"></a>00902 
<a name="l00903"></a>00903   <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> nextPC;
<a name="l00904"></a>00904 <span class="preprocessor">#ifdef USE_PIN_TRACES</span>
<a name="l00905"></a>00905 <span class="preprocessor"></span>  <a class="code" href="sim-zesto_8cpp.html#38a36f4cd3940833135cd0c497f726f4">use_stored_nextPC</a>[core-&gt;<a class="code" href="classcore__t.html#3a8653bac0ed9aefff8d1679ca81546f">id</a>]=<span class="keyword">false</span>;
<a name="l00906"></a>00906 <span class="preprocessor">#endif</span>
<a name="l00907"></a>00907 <span class="preprocessor"></span>  <a class="code" href="zesto-oracle_8h.html#486f7c7db21691d4d34a7818717e98b8">MD_FETCH_NEXT_PC</a>(nextPC, core-&gt;<a class="code" href="classcore__t.html#3a8653bac0ed9aefff8d1679ca81546f">id</a>);
<a name="l00908"></a>00908   core-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>=nextPC;
<a name="l00909"></a>00909   core-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#70500e5215c4ebb383c43c05a670346c">regs_NPC</a>=nextPC;
<a name="l00910"></a>00910   core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a> = core-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>;
<a name="l00911"></a>00911   core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#ced0dd38e3004abe40e9eeb7ab865c1f">bogus</a> = <span class="keyword">false</span>;
<a name="l00912"></a>00912   core-&gt;<a class="code" href="classcore__t.html#ad184ce68308f37e1fb07a5eab624314">num_emergency_recoveries</a>++;
<a name="l00913"></a>00913   core-&gt;<a class="code" href="classcore__t.html#11034d8bb95a7d541a7a0d5efdaded9a">last_emergency_recovery_count</a> = core-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a>;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915 <span class="comment">//  for(int i=0;i&lt;insn_count;i++)</span>
<a name="l00916"></a>00916 <span class="comment">//  {</span>
<a name="l00917"></a>00917 <span class="comment">//    thread = core-&gt;current_thread;</span>
<a name="l00918"></a>00918 <span class="comment">//</span>
<a name="l00919"></a>00919 <span class="comment">//exec_rep_again:</span>
<a name="l00920"></a>00920 <span class="comment">//</span>
<a name="l00921"></a>00921 <span class="comment">//    /* maintain $r0 semantics */</span>
<a name="l00922"></a>00922 <span class="comment">//    thread-&gt;regs.regs_R.dw[MD_REG_ZERO] = 0;</span>
<a name="l00923"></a>00923 <span class="comment">//</span>
<a name="l00924"></a>00924 <span class="comment">//    /* get the next instruction to execute */</span>
<a name="l00925"></a>00925 <span class="comment">//    /* read raw bytes from virtual memory */</span>
<a name="l00926"></a>00926 <span class="comment">//    MD_FETCH_INST(Mop-&gt;fetch.inst, thread-&gt;mem, thread-&gt;regs.regs_PC);</span>
<a name="l00927"></a>00927 <span class="comment">//    /* then decode the instruction */</span>
<a name="l00928"></a>00928 <span class="comment">//    MD_SET_OPCODE(Mop-&gt;decode.op, Mop-&gt;fetch.inst);</span>
<a name="l00929"></a>00929 <span class="comment">//</span>
<a name="l00930"></a>00930 <span class="comment">//    if(Mop-&gt;fetch.inst.rep)</span>
<a name="l00931"></a>00931 <span class="comment">//      Mop-&gt;decode.opflags |= F_COND|F_CTRL;</span>
<a name="l00932"></a>00932 <span class="comment">//</span>
<a name="l00933"></a>00933 <span class="comment">//    Mop-&gt;decode.opflags = MD_OP_FLAGS(Mop-&gt;decode.op);</span>
<a name="l00934"></a>00934 <span class="comment">//</span>
<a name="l00935"></a>00935 <span class="comment">//    Mop-&gt;decode.is_trap = !!(Mop-&gt;decode.opflags &amp; F_TRAP);</span>
<a name="l00936"></a>00936 <span class="comment">//    Mop-&gt;decode.is_ctrl = !!(Mop-&gt;decode.opflags &amp; F_CTRL);</span>
<a name="l00937"></a>00937 <span class="comment">//</span>
<a name="l00938"></a>00938 <span class="comment">//    /* set up initial default next PC */</span>
<a name="l00939"></a>00939 <span class="comment">//    thread-&gt;regs.regs_NPC = thread-&gt;regs.regs_PC + MD_INST_SIZE(Mop-&gt;fetch.inst);</span>
<a name="l00940"></a>00940 <span class="comment">//    Mop-&gt;fetch.PC = thread-&gt;regs.regs_PC;</span>
<a name="l00941"></a>00941 <span class="comment">//</span>
<a name="l00942"></a>00942 <span class="comment">//    /* set default reference address */</span>
<a name="l00943"></a>00943 <span class="comment">//    addr = 0;</span>
<a name="l00944"></a>00944 <span class="comment">//    fault = md_fault_none;</span>
<a name="l00945"></a>00945 <span class="comment">//</span>
<a name="l00946"></a>00946 <span class="comment">//    if(REP_FIRST(thread-&gt;regs)){</span>
<a name="l00947"></a>00947 <span class="comment">//</span>
<a name="l00948"></a>00948 <span class="comment">//      /* execute the instruction */</span>
<a name="l00949"></a>00949 <span class="comment">//      switch (Mop-&gt;decode.op)</span>
<a name="l00950"></a>00950 <span class="comment">//      {</span>
<a name="l00951"></a>00951 <span class="comment">//#define DEFINST(OP,MSK,NAME,OPFORM,RES,FLAGS,O1,I1,I2,I3,OFLAGS,IFLAGS)\</span>
<a name="l00952"></a>00952 <span class="comment">//        case OP:                                                      SYMCAT(OP,_IMPL_FUNC)(thread,Mop,&amp;fault,&amp;addr,bogus);                                           \</span>
<a name="l00953"></a>00953 <span class="comment">//        break;</span>
<a name="l00954"></a>00954 <span class="comment">//#define DEFLINK(OP,MSK,NAME,MASK,SHIFT)                                       \</span>
<a name="l00955"></a>00955 <span class="comment">//        case OP:                                                      panic("attempted to execute a linking opcode");</span>
<a name="l00956"></a>00956 <span class="comment">//#define CONNECT(OP)</span>
<a name="l00957"></a>00957 <span class="comment">//#undef DECLARE_FAULT</span>
<a name="l00958"></a>00958 <span class="comment">//#define DECLARE_FAULT(FAULT)                                          \</span>
<a name="l00959"></a>00959 <span class="comment">//        { fault = (FAULT); break; }</span>
<a name="l00960"></a>00960 <span class="comment">//#include "machine.def"</span>
<a name="l00961"></a>00961 <span class="comment">//        default:</span>
<a name="l00962"></a>00962 <span class="comment">//          panic("attempted to execute a bogus opcode");</span>
<a name="l00963"></a>00963 <span class="comment">//      }</span>
<a name="l00964"></a>00964 <span class="comment">//</span>
<a name="l00965"></a>00965 <span class="comment">//      if (fault != md_fault_none)</span>
<a name="l00966"></a>00966 <span class="comment">//        fatal("fault (%d) detected @ 0x%08p", fault, thread-&gt;regs.regs_PC);</span>
<a name="l00967"></a>00967 <span class="comment">//</span>
<a name="l00968"></a>00968 <span class="comment">//      /* check for repeating instruction */</span>
<a name="l00969"></a>00969 <span class="comment">//      REP_COUNT;</span>
<a name="l00970"></a>00970 <span class="comment">//      if(REP_AGAIN(thread-&gt;regs)){</span>
<a name="l00971"></a>00971 <span class="comment">//        thread-&gt;regs.regs_NPC = thread-&gt;regs.regs_PC;</span>
<a name="l00972"></a>00972 <span class="comment">//      }           </span>
<a name="l00973"></a>00973 <span class="comment">//    }</span>
<a name="l00974"></a>00974 <span class="comment">//</span>
<a name="l00975"></a>00975 <span class="comment">//    /* hit end of inst, count it. (REP counts as single inst.) */</span>
<a name="l00976"></a>00976 <span class="comment">//    if(thread-&gt;regs.regs_NPC != thread-&gt;regs.regs_PC)</span>
<a name="l00977"></a>00977 <span class="comment">//      thread-&gt;stat.num_insn++;</span>
<a name="l00978"></a>00978 <span class="comment">//    else</span>
<a name="l00979"></a>00979 <span class="comment">//      goto exec_rep_again; /* complete execution of entire REP instruction before moving on */</span>
<a name="l00980"></a>00980 <span class="comment">//</span>
<a name="l00981"></a>00981 <span class="comment">//    /* go to the next instruction */</span>
<a name="l00982"></a>00982 <span class="comment">//    thread-&gt;regs.regs_PC = thread-&gt;regs.regs_NPC;</span>
<a name="l00983"></a>00983 <span class="comment">//  }</span>
<a name="l00984"></a>00984 
<a name="l00985"></a>00985 <span class="comment">//  core-&gt;fetch-&gt;PC = thread-&gt;regs.regs_PC;</span>
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 <span class="comment">//  /* maintain $r0 semantics */</span>
<a name="l00988"></a>00988 <span class="comment">//  thread-&gt;regs.regs_R.dw[MD_REG_ZERO] = 0;</span>
<a name="l00989"></a>00989 
<a name="l00990"></a>00990   <span class="comment">/* reset stats */</span>
<a name="l00991"></a>00991   <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>);
<a name="l00992"></a>00992   <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>);
<a name="l00993"></a>00993   <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#5a91d2a6ce0026324cafd070c12d4b42">DL1</a>);
<a name="l00994"></a>00994   <span class="comment">//cache_reset_stats(uncore-&gt;LLC);</span>
<a name="l00995"></a>00995   <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#503b1a0b936482ad183fef9ee544d1f8">DTLB</a>);
<a name="l00996"></a>00996   <a class="code" href="config_2zesto-cache_8cpp.html#aff01697c94f19565dfd6d631bf4bf76">cache_reset_stats</a>(core-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e617139a2ae1293e5f62c28d9e1e9e42">DTLB2</a>);
<a name="l00997"></a>00997   core-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#256cf64d1d35419885b964316cfa95f2">reset_stats</a>();
<a name="l00998"></a>00998   core-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a> = insn_count;
<a name="l00999"></a>00999 
<a name="l01000"></a>01000   core-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#d00e22e564a08b3912cf93f1e71a502d">hosed</a> = <span class="keyword">false</span>;
<a name="l01001"></a>01001 }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003 
<a name="l01004"></a>01004 <span class="comment">/* start simulation, program loaded, processor precise state initialized */</span>
<a name="l01005"></a>01005 <span class="keywordtype">void</span>
<a name="l01006"></a><a class="code" href="sim_8h.html#6b9951fa76e6d8b400f13df1c975ed3b">01006</a> <a class="code" href="sim-zesto_8cpp.html#6b9951fa76e6d8b400f13df1c975ed3b">sim_main</a>(<span class="keywordtype">void</span>)
<a name="l01007"></a>01007 {
<a name="l01008"></a>01008   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010 
<a name="l01011"></a>01011 <span class="preprocessor">#ifdef USE_PIN_TRACES</span>
<a name="l01012"></a>01012 <span class="preprocessor"></span>
<a name="l01013"></a>01013   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a>;i++)
<a name="l01014"></a>01014   {
<a name="l01015"></a>01015         <span class="keywordtype">char</span> ch[50];
<a name="l01016"></a>01016         sprintf (ch, <span class="stringliteral">"source/zesto/itrace%d.out"</span>,i);
<a name="l01017"></a>01017         printf (<span class="stringliteral">"[%s] is a pin trace file\n"</span>,ch);
<a name="l01018"></a>01018         cores[i]-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#2b2709c2f5cc8eb7d9c87c8cc4e62b5d">pin_trace</a> = fopen(ch,<span class="stringliteral">"r"</span>);
<a name="l01019"></a>01019         <span class="keywordflow">if</span>(!cores[i]-&gt;current_thread-&gt;pin_trace)
<a name="l01020"></a>01020                 <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"could not open trace file from PIN"</span>);
<a name="l01021"></a>01021   }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023   <span class="comment">//fscanf(cores[0]-&gt;current_thread-&gt;pin_trace,"%llx",&amp;store_nextPC);</span>
<a name="l01024"></a>01024   <span class="comment">//fprintf(stdout,"%llx",store_nextPC);</span>
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 <span class="preprocessor">#else</span>
<a name="l01027"></a>01027 <span class="preprocessor"></span>
<a name="l01028"></a>01028   <span class="comment">//read_sys_map();</span>
<a name="l01029"></a>01029   <span class="comment">// Create a coherence domain with 2 CPUs, booting linux/bzImage.</span>
<a name="l01030"></a>01030   cd = <span class="keyword">new</span> CDomain(num_threads, <span class="stringliteral">"./bzImage"</span>);
<a name="l01031"></a>01031 
<a name="l01032"></a>01032   <span class="comment">// This lets us see boot messages and output through the qsim_out program.</span>
<a name="l01033"></a>01033   <span class="comment">//cd-&gt;connect_console(std::cout);</span>
<a name="l01034"></a>01034   cd-&gt;connect_console(std::cerr);
<a name="l01035"></a>01035  <span class="keywordtype">bool</span> all_booted;
<a name="l01036"></a>01036   <span class="keywordflow">do</span> {
<a name="l01037"></a>01037 
<a name="l01038"></a>01038     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0; ii &lt; 100; ii++) {
<a name="l01039"></a>01039       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jj = 0; jj &lt; num_threads; jj++) {
<a name="l01040"></a>01040         cd-&gt;run(jj, 10000);
<a name="l01041"></a>01041       }
<a name="l01042"></a>01042     }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     cd-&gt;timer_interrupt();
<a name="l01045"></a>01045   
<a name="l01046"></a>01046     all_booted = <span class="keyword">true</span>;
<a name="l01047"></a>01047     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; num_threads; k++)
<a name="l01048"></a>01048       <span class="keywordflow">if</span> (!cd-&gt;booted(k)) all_booted = <span class="keyword">false</span>;
<a name="l01049"></a>01049   } <span class="keywordflow">while</span> (!all_booted);
<a name="l01050"></a>01050 <span class="comment">/*</span>
<a name="l01051"></a>01051 <span class="comment">for(int ii=0; ii&lt;10; ii++)</span>
<a name="l01052"></a>01052 <span class="comment">{</span>
<a name="l01053"></a>01053 <span class="comment">  for (int jj = 0; jj &lt; 20; jj++)</span>
<a name="l01054"></a>01054 <span class="comment">  {</span>
<a name="l01055"></a>01055 <span class="comment">      // Run the CPUs in order; we're striving for determinism now.</span>
<a name="l01056"></a>01056 <span class="comment">      for (int kk = 0; kk &lt; num_threads; kk++)</span>
<a name="l01057"></a>01057 <span class="comment">      {</span>
<a name="l01058"></a>01058 <span class="comment">        unsigned ran_for = cd-&gt;run(kk, 1000000/20);</span>
<a name="l01059"></a>01059 <span class="comment">        uint64_t last_rip = cd-&gt;get_reg(kk, QSIM_RIP);</span>
<a name="l01060"></a>01060 <span class="comment">        uint16_t last_tid = cd-&gt;get_tid(kk);</span>
<a name="l01061"></a>01061 <span class="comment">        bool     kernel   = cd-&gt;get_prot(kk) == CDomain::PROT_KERN;</span>
<a name="l01062"></a>01062 <span class="comment">        if (ran_for == 0) continue;</span>
<a name="l01063"></a>01063 <span class="comment">        //cout &lt;&lt; "Ran CPU " &lt;&lt; std::dec &lt;&lt; kk &lt;&lt; " for " &lt;&lt; ran_for &lt;&lt; " insts,"</span>
<a name="l01064"></a>01064 <span class="comment">        //  " stopping at 0x" &lt;&lt; std::hex &lt;&lt; std::setfill('0') &lt;&lt; std::setw(8)</span>
<a name="l01065"></a>01065 <span class="comment">        //     &lt;&lt; last_rip &lt;&lt; "(TID=" &lt;&lt; std::dec &lt;&lt; last_tid &lt;&lt; ')' </span>
<a name="l01066"></a>01066 <span class="comment">        //     &lt;&lt; (kernel?"-kernel\n":"\n");</span>
<a name="l01067"></a>01067 <span class="comment">      }</span>
<a name="l01068"></a>01068 <span class="comment">  }</span>
<a name="l01069"></a>01069 <span class="comment"></span>
<a name="l01070"></a>01070 <span class="comment">  cd-&gt;timer_interrupt();</span>
<a name="l01071"></a>01071 <span class="comment">  cout &lt;&lt; "---Timer Interrupt---\n";</span>
<a name="l01072"></a>01072 <span class="comment">}</span>
<a name="l01073"></a>01073 <span class="comment"></span>
<a name="l01074"></a>01074 <span class="comment">*/</span>
<a name="l01075"></a>01075 
<a name="l01076"></a>01076 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii=0; ii&lt;84; ii++)
<a name="l01077"></a>01077 {
<a name="l01078"></a>01078     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0; ii &lt; 100; ii++) {
<a name="l01079"></a>01079       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jj = 0; jj &lt; num_threads; jj++) {
<a name="l01080"></a>01080         cd-&gt;run(jj, 10000);
<a name="l01081"></a>01081       }
<a name="l01082"></a>01082     }
<a name="l01083"></a>01083     cd-&gt;timer_interrupt();
<a name="l01084"></a>01084 }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086 
<a name="l01087"></a>01087   <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01088"></a>01088   {
<a name="l01089"></a>01089         <span class="comment">//threads[i]-&gt;q = new Queue(*cd, i);</span>
<a name="l01090"></a>01090         q[i]= <span class="keyword">new</span> Queue(*cd, i);
<a name="l01091"></a>01091         <span class="comment">//q[i]-&gt;set_filt(true, false, true, true, 1);</span>
<a name="l01092"></a>01092         <span class="comment">//threads[i]-&gt;q = &amp;qthread;</span>
<a name="l01093"></a>01093   }
<a name="l01094"></a>01094 
<a name="l01095"></a>01095 
<a name="l01096"></a>01096   <span class="comment">//cout &lt;&lt; "Fast Forwarding Core 0 for boot up\n ";</span>
<a name="l01097"></a>01097 
<a name="l01098"></a>01098   <span class="comment">//sim_fwdstartup(cores, 100000000);</span>
<a name="l01099"></a>01099 
<a name="l01100"></a>01100 <span class="preprocessor">#endif</span>
<a name="l01101"></a>01101 <span class="preprocessor"></span>
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">/*All cores start from the BOOT_PC and then Fetch the start address of the program from the QEMU queue*/</span>
<a name="l01104"></a>01104   <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01105"></a>01105   {
<a name="l01106"></a>01106     <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> nextPC;
<a name="l01107"></a>01107 <span class="preprocessor">#ifdef USE_PIN_TRACES</span>
<a name="l01108"></a>01108 <span class="preprocessor"></span>    <a class="code" href="sim-zesto_8cpp.html#38a36f4cd3940833135cd0c497f726f4">use_stored_nextPC</a>[i]=<span class="keyword">false</span>;
<a name="l01109"></a>01109 <span class="preprocessor">#endif</span>
<a name="l01110"></a>01110 <span class="preprocessor"></span>    nextPC=0;
<a name="l01111"></a>01111     <a class="code" href="zesto-oracle_8h.html#486f7c7db21691d4d34a7818717e98b8">MD_FETCH_NEXT_PC</a>(nextPC,i);
<a name="l01112"></a>01112 <span class="preprocessor">#ifdef USE_PIN_TRACES</span>
<a name="l01113"></a>01113 <span class="preprocessor"></span>    <a class="code" href="sim-zesto_8cpp.html#87de3dd0dc95ac44e817dc0f7c7ba3d7">store_nextPC</a>[i]=nextPC;
<a name="l01114"></a>01114 <span class="preprocessor">#endif</span>
<a name="l01115"></a>01115 <span class="preprocessor"></span>    cores[i]-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>=nextPC;
<a name="l01116"></a>01116     cores[i]-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#70500e5215c4ebb383c43c05a670346c">regs_NPC</a>=nextPC;
<a name="l01117"></a>01117     cores[i]-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a> = cores[i]-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#c6889ccce9099e2fbf701f7fb78cedf1">regs_PC</a>;
<a name="l01118"></a>01118   }
<a name="l01119"></a>01119 
<a name="l01120"></a>01120   <span class="keywordflow">if</span>(<a class="code" href="zesto-opts_8h.html#c6fb0e6cfd61969cdb6ca3e23bde14bf">fastfwd</a>)
<a name="l01121"></a>01121     <a class="code" href="sim-zesto_8cpp.html#d4465337904f2c1d2b694eb41043de6e">sim_fastfwd</a>(cores,<a class="code" href="zesto-opts_8h.html#c6fb0e6cfd61969cdb6ca3e23bde14bf">fastfwd</a>);
<a name="l01122"></a>01122 
<a name="l01123"></a>01123   <span class="comment">/* exclude fastforwarding from the simulation wall-clock time */</span>
<a name="l01124"></a>01124   <a class="code" href="manifold__fullsim_8cc.html#e8d0794b6bec1dfbd28ca90a7a08d2b4">sim_start_time</a> = time((time_t *)NULL);
<a name="l01125"></a>01125 
<a name="l01126"></a>01126   fprintf(stderr, <span class="stringliteral">"### starting timing simulation\n"</span>);
<a name="l01127"></a>01127 
<a name="l01128"></a>01128 }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130 
<a name="l01131"></a><a class="code" href="classzesto__component.html#bbdcf4496a9d0615bc45f0ad227c91cb">01131</a> <span class="keywordtype">void</span> <a class="code" href="classzesto__component.html#bbdcf4496a9d0615bc45f0ad227c91cb">zesto_component::uptick_handler</a>()
<a name="l01132"></a>01132 {
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 }
<a name="l01135"></a>01135 
<a name="l01136"></a>01136 <span class="comment">/*This is the event handler that single steps Zesto every cycle*/</span>
<a name="l01137"></a><a class="code" href="classzesto__component.html#14b525d106d3d5e07baa194738c1db1b">01137</a> <span class="keywordtype">void</span> <a class="code" href="classzesto__component.html#14b525d106d3d5e07baa194738c1db1b">zesto_component::downtick_handler</a>()
<a name="l01138"></a>01138 {
<a name="l01139"></a>01139     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 <span class="preprocessor">#ifndef USE_PIN_TRACES</span>
<a name="l01142"></a>01142 <span class="preprocessor"></span>   <span class="comment">//unsigned long long int ratio= (cpu_speed/100); </span>
<a name="l01143"></a>01143    <span class="keywordflow">if</span> ( (<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>%30000000 == 0) &amp;&amp; (<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>!=0) )
<a name="l01144"></a>01144    {
<a name="l01145"></a>01145         fprintf(stdout,<span class="stringliteral">"\nSending a timer interrupt"</span>);
<a name="l01146"></a>01146         cd-&gt;timer_interrupt();
<a name="l01147"></a>01147    }
<a name="l01148"></a>01148 <span class="preprocessor">#endif</span>
<a name="l01149"></a>01149 <span class="preprocessor"></span>
<a name="l01150"></a>01150     <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>++;<span class="comment">//=(unsigned long long int)Simulator::Now();</span>
<a name="l01151"></a>01151     <span class="comment">//fprintf(stdout,"\n[%lld]Tick handler",sim_cycle);</span>
<a name="l01152"></a>01152     <a class="code" href="sim-zesto_8cpp.html#af9443448449d3e516d9e748c4fbb6bf">heartbeat_count</a>++;
<a name="l01153"></a>01153 
<a name="l01154"></a>01154 <span class="comment">/*Add mechanism to stop the simulation QEMU will keep giving instructions*/</span>
<a name="l01155"></a>01155     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="sim-zesto_8cpp.html#26a8352e9cd3bc9a6a35bc8d88152985">num_threads</a>;i++)
<a name="l01156"></a>01156       <span class="keywordflow">if</span>(cores[i]-&gt;current_thread-&gt;active)
<a name="l01157"></a>01157         cores[i]-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#5bdfc20ac509b4f10d9ac1b28f8c5a35">final_sim_cycle</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l01158"></a>01158 
<a name="l01159"></a>01159     <span class="comment">/*********************************************/</span>
<a name="l01160"></a>01160     <span class="comment">/* step through pipe stages in reverse order */</span>
<a name="l01161"></a>01161     <span class="comment">/*********************************************/</span>
<a name="l01162"></a>01162     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0;t&lt; (<a class="code" href="genericRC_8h.html#b78c10782810279fb9680eafef33b77d">no_nodes</a>-<a class="code" href="mshr_8h.html#56d27d790e05179f3787fce80d802d04">no_mcs</a>);t++)
<a name="l01163"></a>01163     {
<a name="l01164"></a>01164          <a class="code" href="config_2zesto-cache_8h.html#65086cfd5f54ff7a76a41587c8f6a01e">step_LLC_PF_controller</a>(uncores[t]);
<a name="l01165"></a>01165     }
<a name="l01166"></a>01166 
<a name="l01167"></a>01167     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01168"></a>01168       <a class="code" href="config_2zesto-cache_8cpp.html#66309167ab5b4ca25ad2bfbf94b0126b">step_core_PF_controllers</a>(cores[i]);
<a name="l01169"></a>01169 
<a name="l01170"></a>01170     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01171"></a>01171       cores[i]-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>-&gt;step();
<a name="l01172"></a>01172 
<a name="l01173"></a>01173     <span class="comment">/* all memory processed here */</span>
<a name="l01174"></a>01174     <span class="comment">/*All LLC's are stepped first as they are the last stage of the memory pipeline*/</span>    
<a name="l01175"></a>01175     <span class="keywordflow">for</span>(i=0;i&lt;(<a class="code" href="genericRC_8h.html#b78c10782810279fb9680eafef33b77d">no_nodes</a>-<a class="code" href="mshr_8h.html#56d27d790e05179f3787fce80d802d04">no_mcs</a>);i++)
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177         <a class="code" href="config_2zesto-cache_8h.html#7b2967a29a17913e313fceec0d9dbd4c">cache_process_llc</a>(uncores[i]-&gt;LLC);
<a name="l01178"></a>01178     }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01181"></a>01181     {<span class="comment">//TODO: Make this modular over single uncore</span>
<a name="l01182"></a>01182       <span class="comment">/* round-robin on which cache to process first so that one core</span>
<a name="l01183"></a>01183 <span class="comment">         doesn't get continual priority over the others for L2 access */</span>
<a name="l01184"></a>01184       cores[<a class="code" href="misc_8h.html#4c5ce3cf6c3a73be0ec80b5cb93c7159">mod2m</a>(<a class="code" href="sim-zesto_8cpp.html#9715e2df77829e54cb078a298fd6c434">start_pos</a>+i,num_threads)]-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#4d30d6c25a185539c64c8cd7d16d9622">LDST_exec</a>();
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01187"></a>01187       cores[i]-&gt;exec-&gt;ALU_exec();
<a name="l01188"></a>01188 
<a name="l01189"></a>01189     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01190"></a>01190       cores[i]-&gt;exec-&gt;LDQ_schedule();
<a name="l01191"></a>01191     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01192"></a>01192       cores[i]-&gt;exec-&gt;RS_schedule();
<a name="l01193"></a>01193     
<a name="l01194"></a>01194     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01195"></a>01195       cores[i]-&gt;alloc-&gt;step();
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01198"></a>01198       cores[i]-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>-&gt;step();
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01201"></a>01201     {
<a name="l01202"></a>01202       <span class="comment">/* round-robin on which cache to process first so that one core</span>
<a name="l01203"></a>01203 <span class="comment">         doesn't get continual priority over the others for L2 access */</span>
<a name="l01204"></a>01204       cores[<a class="code" href="misc_8h.html#4c5ce3cf6c3a73be0ec80b5cb93c7159">mod2m</a>(<a class="code" href="sim-zesto_8cpp.html#9715e2df77829e54cb078a298fd6c434">start_pos</a>+i,num_threads)]-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#ec94882606f788544146ccc91e8adfcd">step</a>();
<a name="l01205"></a>01205     }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207     <span class="comment">/* this is done last so that prefetch requests have the lowest</span>
<a name="l01208"></a>01208 <span class="comment">       priority when competing for queues, buffers, etc. */</span>
<a name="l01209"></a>01209     <span class="keywordflow">for</span>(i=0;i&lt;(<a class="code" href="genericRC_8h.html#b78c10782810279fb9680eafef33b77d">no_nodes</a>-<a class="code" href="mshr_8h.html#56d27d790e05179f3787fce80d802d04">no_mcs</a>);i++)
<a name="l01210"></a>01210        <a class="code" href="config_2zesto-cache_8h.html#8ed5f90d7b07bddefbf6736b13da8eb2">prefetch_LLC</a>(uncores[i]);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01213"></a>01213     {
<a name="l01214"></a>01214       <span class="comment">/* process prefetch requests in reverse order as L1/L2; i.e., whoever</span>
<a name="l01215"></a>01215 <span class="comment">         got the lowest priority for L1/L2 processing gets highest priority</span>
<a name="l01216"></a>01216 <span class="comment">         for prefetch processing */</span>
<a name="l01217"></a>01217       <a class="code" href="config_2zesto-cache_8cpp.html#3f3ef48df254425f422f6cf5de128ade">prefetch_core_caches</a>(cores[<a class="code" href="misc_8h.html#4c5ce3cf6c3a73be0ec80b5cb93c7159">mod2m</a>(<a class="code" href="sim-zesto_8cpp.html#9715e2df77829e54cb078a298fd6c434">start_pos</a>+num_threads-i,num_threads)]);
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220     <span class="comment">/*******************/</span>
<a name="l01221"></a>01221     <span class="comment">/* occupancy stats */</span>
<a name="l01222"></a>01222     <span class="comment">/*******************/</span>
<a name="l01223"></a>01223     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01224"></a>01224     {
<a name="l01225"></a>01225       <span class="comment">/* this avoids the need to guard each stat update below with "ZESTO_STAT()" */</span>
<a name="l01226"></a>01226       <span class="keywordflow">if</span>(!cores[i]-&gt;current_thread-&gt;active)
<a name="l01227"></a>01227         <span class="keywordflow">continue</span>;
<a name="l01228"></a>01228 
<a name="l01229"></a>01229       cores[i]-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#494a10decdeba4a3f043cce0186d806a">update_occupancy</a>();
<a name="l01230"></a>01230       cores[i]-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#63b6effc13801b585b86e4cd27557694">update_occupancy</a>();
<a name="l01231"></a>01231       cores[i]-&gt;<a class="code" href="classcore__t.html#5a8f490b74ace2edeb7f90c493c98691">decode</a>-&gt;<a class="code" href="classcore__decode__t.html#da1d9ea2eab3e615fce9da8a41bf18d0">update_occupancy</a>();
<a name="l01232"></a>01232       cores[i]-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#111ffe54eba7244b49b47cca014c1e48">update_occupancy</a>();
<a name="l01233"></a>01233       cores[i]-&gt;<a class="code" href="classcore__t.html#1058815318dc1da3c60b90d9a5479092">commit</a>-&gt;<a class="code" href="classcore__commit__t.html#59efb1aa4022d49eaa63280fdd0df0d9">update_occupancy</a>();
<a name="l01234"></a>01234     }
<a name="l01235"></a>01235 
<a name="l01236"></a>01236     <span class="comment">/* check to see if all cores are "ok" */</span>
<a name="l01237"></a>01237     <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01238"></a>01238     {
<a name="l01239"></a>01239       <span class="keywordflow">if</span>(cores[i]-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>-&gt;hosed)
<a name="l01240"></a>01240         <a class="code" href="sim-zesto_8cpp.html#46f3df2fecce36d299cd1dd4534d0088">emergency_recovery</a>(cores[i]);
<a name="l01241"></a>01241     }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243     <a class="code" href="sim-zesto_8cpp.html#9715e2df77829e54cb078a298fd6c434">start_pos</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="sim-zesto_8cpp.html#9715e2df77829e54cb078a298fd6c434">start_pos</a>,num_threads);
<a name="l01244"></a>01244 
<a name="l01245"></a>01245     <span class="keywordflow">if</span>((<a class="code" href="zesto-opts_8h.html#fce466a6befaf9dce381d6568d734383">heartbeat_frequency</a> &gt; 0) &amp;&amp; (<a class="code" href="sim-zesto_8cpp.html#af9443448449d3e516d9e748c4fbb6bf">heartbeat_count</a> &gt;= <a class="code" href="zesto-opts_8h.html#fce466a6befaf9dce381d6568d734383">heartbeat_frequency</a>))
<a name="l01246"></a>01246     {
<a name="l01247"></a>01247       fprintf(stderr,<span class="stringliteral">"##HEARTBEAT## %lld: {"</span>,<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>);
<a name="l01248"></a>01248       <span class="keywordflow">for</span>(i=0;i&lt;num_threads;i++)
<a name="l01249"></a>01249       {
<a name="l01250"></a>01250         <span class="keywordflow">if</span>(i &lt; (num_threads-1))
<a name="l01251"></a>01251           fprintf(stderr,<span class="stringliteral">"%lld, "</span>,cores[i]-&gt;<a class="code" href="structMop__t.html#42838437539e18e14b2049aa3ad512c2">stat</a>.commit_insn);
<a name="l01252"></a>01252         <span class="keywordflow">else</span>
<a name="l01253"></a>01253           fprintf(stderr,<span class="stringliteral">"%lld}\n"</span>,cores[i]-&gt;<a class="code" href="structMop__t.html#42838437539e18e14b2049aa3ad512c2">stat</a>.commit_insn);
<a name="l01254"></a>01254       }
<a name="l01255"></a>01255       <a class="code" href="sim-zesto_8cpp.html#af9443448449d3e516d9e748c4fbb6bf">heartbeat_count</a> = 0;
<a name="l01256"></a>01256     }
<a name="l01257"></a>01257 
<a name="l01258"></a>01258 
<a name="l01259"></a>01259 
<a name="l01260"></a>01260 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 23 00:20:56 2010 for IRIS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
