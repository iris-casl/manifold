<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>IRIS: fetch-STM.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_014faa727c0b2aaba2cbdd8f326de4f6.html">source</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_4516642e80adc9bf50ea604a2fbf2492.html">zesto</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_66b24feecc5b171e50d074ec5d62a972.html">ZPIPE-fetch</a>
  </div>
</div>
<div class="contents">
<h1>fetch-STM.cpp</h1><a href="fetch-STM_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* fetch-STM.cpp - Simple(r) Timing Model */</span>
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * __COPYRIGHT__ GT</span>
<a name="l00004"></a>00004 <span class="comment"> */</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#ifdef ZESTO_PARSE_ARGS</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(!strcasecmp(fetch_opt_string,<span class="stringliteral">"STM"</span>))
<a name="l00008"></a>00008     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classcore__fetch__STM__t.html">core_fetch_STM_t</a>(core);
<a name="l00009"></a>00009 <span class="preprocessor">#else</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a><a class="code" href="classcore__fetch__STM__t.html">00011</a> <span class="keyword">class </span><a class="code" href="classcore__fetch__STM__t.html">core_fetch_STM_t</a>:<span class="keyword">public</span> <a class="code" href="classcore__fetch__t.html">core_fetch_t</a>
<a name="l00012"></a>00012 {
<a name="l00013"></a><a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727feb2cc534544c44f385773fc50981b72d4">00013</a>   <span class="keyword">enum</span> <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe">fetch_stall_t</a> {<a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727feb2cc534544c44f385773fc50981b72d4">FSTALL_byteQ_FULL</a>, <span class="comment">/* byteQ is full */</span>
<a name="l00014"></a><a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fed237d31ebfaf174e07aad7448f05c074">00014</a>                       <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fed237d31ebfaf174e07aad7448f05c074">FSTALL_TBR</a>,      <span class="comment">/* predicted taken */</span>
<a name="l00015"></a><a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe92ca723e4d8e941cde56eccf526fff87">00015</a>                       <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe92ca723e4d8e941cde56eccf526fff87">FSTALL_EOL</a>,      <span class="comment">/* hit end of cache line */</span>
<a name="l00016"></a><a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fecf754abe40ec2135c7038984fe6d6ceb">00016</a>                       <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fecf754abe40ec2135c7038984fe6d6ceb">FSTALL_BOGUS</a>,    <span class="comment">/* encountered invalid inst on wrong-path */</span>
<a name="l00017"></a><a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fec8d8a83fbe9c212c2cd8190feef55cff">00017</a>                       <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fec8d8a83fbe9c212c2cd8190feef55cff">FSTALL_SYSCALL</a>,  <span class="comment">/* syscall waiting for pipe to clear */</span>
<a name="l00018"></a><a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe8858d4e0673f8cb7bafe751cc608ba52">00018</a>                       <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe8858d4e0673f8cb7bafe751cc608ba52">FSTALL_ZPAGE</a>,    <span class="comment">/* fetch request from zeroth page of memory */</span>
<a name="l00019"></a><a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe0e7fbb0878850d7cd34fa2e4dda617de">00019</a>                       <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe0e7fbb0878850d7cd34fa2e4dda617de">FSTALL_num</a>
<a name="l00020"></a>00020                      };
<a name="l00021"></a>00021 
<a name="l00022"></a>00022   <span class="keyword">public</span>:
<a name="l00023"></a>00023 
<a name="l00024"></a>00024   <span class="comment">/* constructor, stats registration */</span>
<a name="l00025"></a>00025   <a class="code" href="classcore__fetch__STM__t.html#aad2a1954e9b2fe513a1cdbe03d23837">core_fetch_STM_t</a>(<span class="keyword">struct</span> <a class="code" href="classcore__t.html">core_t</a> * <span class="keyword">const</span> <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>);
<a name="l00026"></a>00026   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#1a13aa718c8481dabf3f0ad3eeb29438">reg_stats</a>(<span class="keyword">struct</span> <a class="code" href="structstat__sdb__t.html">stat_sdb_t</a> * <span class="keyword">const</span> sdb);
<a name="l00027"></a>00027   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#fe8ef61f53ccea1a44f642798f3ef212">update_occupancy</a>(<span class="keywordtype">void</span>);
<a name="l00028"></a>00028 
<a name="l00029"></a>00029   <span class="comment">/* simulate one cycle */</span>
<a name="l00030"></a>00030   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#9366aef38f6639d3999c4efb2f2fb8b4">step</a>(<span class="keywordtype">void</span>);
<a name="l00031"></a>00031 
<a name="l00032"></a>00032   <span class="comment">/* decode interface */</span>
<a name="l00033"></a>00033   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__fetch__STM__t.html#6162b7a5fcf2b9be3ad57937741c061d">Mop_available</a>(<span class="keywordtype">void</span>);
<a name="l00034"></a>00034   <span class="keyword">virtual</span> <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> * <a class="code" href="classcore__fetch__STM__t.html#10ad9c324a326a7dca085f538844b6f9">Mop_peek</a>(<span class="keywordtype">void</span>);
<a name="l00035"></a>00035   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#66d176de79363b837645f8d790c1356f">Mop_consume</a>(<span class="keywordtype">void</span>);
<a name="l00036"></a>00036 
<a name="l00037"></a>00037   <span class="comment">/* enqueue a jeclear event into the jeclear_pipe */</span>
<a name="l00038"></a>00038   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#3ad47b0fc75aedc66d1c96295747c04f">jeclear_enqueue</a>(<span class="keyword">struct</span> <a class="code" href="structMop__t.html">Mop_t</a> * <span class="keyword">const</span> Mop, <span class="keyword">const</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> New_PC);
<a name="l00039"></a>00039   <span class="comment">/* recover the front-end after the recover request actually</span>
<a name="l00040"></a>00040 <span class="comment">     reaches the front end. */</span>
<a name="l00041"></a>00041   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#efa401b9257f82b2feaac0913b269e16">recover</a>(<span class="keyword">const</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> new_PC); 
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="keyword">protected</span>:
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">00045</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <span class="comment">/* The byteQ contains the raw bytes (well, the addresses thereof).</span>
<a name="l00048"></a>00048 <span class="comment">     This is similar to the old IFQ in that the contents of the I$</span>
<a name="l00049"></a>00049 <span class="comment">     are delivered here.  Each entry contains raw bytes, and so</span>
<a name="l00050"></a>00050 <span class="comment">     this may correspond to many, or even less than one, instruction</span>
<a name="l00051"></a>00051 <span class="comment">     per entry. */</span>
<a name="l00052"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">00052</a>   <span class="keyword">struct </span><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a> {
<a name="l00053"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">00053</a>     <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">addr</a>;
<a name="l00054"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#390df8e9d3f035be4e234214c55577c1">00054</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#390df8e9d3f035be4e234214c55577c1">when_fetch_requested</a>;
<a name="l00055"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#239fbb5df474d5fc82780dfcf98cb214">00055</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#239fbb5df474d5fc82780dfcf98cb214">when_fetched</a>;
<a name="l00056"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#dc1ca63643c451db7587513defd97b5c">00056</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#dc1ca63643c451db7587513defd97b5c">when_translation_requested</a>;
<a name="l00057"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">00057</a>     <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">when_translated</a>;
<a name="l00058"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#2ced6cc21377e0a69b55428ce1a3c72c">00058</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#2ced6cc21377e0a69b55428ce1a3c72c">num_Mop</a>;
<a name="l00059"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">00059</a>     <span class="keywordtype">int</span> <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">MopQ_first_index</a>;
<a name="l00060"></a><a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#073f54a7249f0ff1ec47b2f08899867b">00060</a>     <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#073f54a7249f0ff1ec47b2f08899867b">action_id</a>;
<a name="l00061"></a>00061   } * <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>;
<a name="l00062"></a><a class="code" href="classcore__fetch__STM__t.html#3f1925703be344fdbd6c375c9fb281a3">00062</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__fetch__STM__t.html#3f1925703be344fdbd6c375c9fb281a3">byteQ_linemask</a>; <span class="comment">/* for masking out line offset */</span>
<a name="l00063"></a><a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">00063</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>;
<a name="l00064"></a><a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">00064</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>;
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="classcore__fetch__STM__t.html#c2524ba33b5b6435eef5223307dc06d1">00066</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classcore__fetch__STM__t.html#c2524ba33b5b6435eef5223307dc06d1">fetch_stall_str</a>[<a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe0e7fbb0878850d7cd34fa2e4dda617de">FSTALL_num</a>];
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#d546589d0f24b23d8a668ea9f928330f">byteQ_request</a>(<span class="keyword">const</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> lineaddr);
<a name="l00069"></a>00069   <span class="keywordtype">bool</span> <a class="code" href="classcore__fetch__STM__t.html#6f183c0792faf846ea7fbb8aeb7d0aaf">byteQ_is_full</a>(<span class="keywordtype">void</span>);
<a name="l00070"></a>00070   <span class="keywordtype">bool</span> <a class="code" href="classcore__fetch__STM__t.html#b823eca44972f8b3ee288c34be1727c8">byteQ_already_requested</a>(<span class="keyword">const</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> addr);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#f91b2cb6ffde02bc014512e0836f7c27">IL1_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00073"></a>00073   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#2cd42e4e6a771a1a7b1df9d0e54c1b6a">ITLB_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00074"></a>00074   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__fetch__STM__t.html#a6c3c6ba907a0ef5ab4b968d5c0b7b15">translated_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op, <span class="keyword">const</span> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> action_id);
<a name="l00075"></a>00075   <span class="keyword">static</span> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="classcore__fetch__STM__t.html#5f6d70206465ea63029c8e6d6b877af6">get_byteQ_action_id</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 };
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classcore__fetch__STM__t.html#c2524ba33b5b6435eef5223307dc06d1">core_fetch_STM_t::fetch_stall_str</a>[FSTALL_num] = {
<a name="l00080"></a>00080   <span class="stringliteral">"byteQ full             "</span>,
<a name="l00081"></a>00081   <span class="stringliteral">"taken branch           "</span>,
<a name="l00082"></a>00082   <span class="stringliteral">"end of cache line      "</span>,
<a name="l00083"></a>00083   <span class="stringliteral">"wrong-path invalid inst"</span>,
<a name="l00084"></a>00084   <span class="stringliteral">"trap waiting on drain  "</span>,
<a name="l00085"></a>00085   <span class="stringliteral">"request for page zero  "</span>
<a name="l00086"></a>00086 };
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="classcore__fetch__STM__t.html#aad2a1954e9b2fe513a1cdbe03d23837">00089</a> <a class="code" href="classcore__fetch__STM__t.html#aad2a1954e9b2fe513a1cdbe03d23837">core_fetch_STM_t::core_fetch_STM_t</a>(<span class="keyword">struct</span> <a class="code" href="classcore__t.html">core_t</a> * <span class="keyword">const</span> arg_core):
<a name="l00090"></a>00090   byteQ_num(0)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = arg_core-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00093"></a>00093   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a> = arg_core;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="comment">/* must come after exec_init()! */</span>
<a name="l00096"></a>00096   <span class="keywordtype">char</span> name[256];
<a name="l00097"></a>00097   <span class="keywordtype">int</span> sets, assoc, linesize, <a class="code" href="structcore__knobs__t.html#0cefeb1d280f9966c8075ddfcfe14c75">latency</a>, banks, bank_width, MSHR_entries;
<a name="l00098"></a>00098   <span class="keywordtype">char</span> rp;
<a name="l00099"></a>00099   <span class="keywordtype">int</span> i;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="comment">/* bpred */</span>
<a name="l00102"></a>00102   <a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a> = <span class="keyword">new</span> <a class="code" href="classbpred__t.html">bpred_t</a>(
<a name="l00103"></a>00103       knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#55f4c8ed9d852752439e9aeb5327cb28">num_bpred_components</a>,
<a name="l00104"></a>00104       knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#7b83939598abed42aee2ef81dbeda645">bpred_opt_str</a>,
<a name="l00105"></a>00105       knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#107abf3233bd2a0e0fe247a7e063783b">fusion_opt_str</a>,
<a name="l00106"></a>00106       knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#728c63e6314e9ca1fe0ef36afab80b5a">dirjmpbtb_opt_str</a>,
<a name="l00107"></a>00107       knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#3b1187547c8746eed095a4cd2e740952">indirjmpbtb_opt_str</a>,
<a name="l00108"></a>00108       knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#ee9e161a82f92a89a8c7b073e90ba235">ras_opt_str</a>
<a name="l00109"></a>00109     );
<a name="l00110"></a>00110 
<a name="l00111"></a>00111   <span class="keywordflow">if</span>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#c899955252aaaa5b0bd449e2e0ed05f7">jeclear_delay</a> != 0)
<a name="l00112"></a>00112   {
<a name="l00113"></a>00113     warnonce(<span class="stringliteral">"STM fetch model does not support non-zero latency jeclear delay... setting to zero"</span>);
<a name="l00114"></a>00114     knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#c899955252aaaa5b0bd449e2e0ed05f7">jeclear_delay</a> = 0;
<a name="l00115"></a>00115   }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117   <span class="comment">/* IL1 */</span>
<a name="l00118"></a>00118   <span class="keywordflow">if</span>(sscanf(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#d72ddee06b53213f2481158fa3762d64">IL1_opt_str</a>,<span class="stringliteral">"%[^:]:%d:%d:%d:%d:%d:%d:%c:%d"</span>,
<a name="l00119"></a>00119       name,&amp;sets,&amp;assoc,&amp;linesize,&amp;banks,&amp;bank_width,&amp;latency, &amp;rp, &amp;MSHR_entries) != 9)
<a name="l00120"></a>00120     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"invalid IL1 options: &lt;name:sets:assoc:linesize:banks:bank_width:latency:repl-policy:num-MSHR&gt;\n\t(%s)"</span>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#d72ddee06b53213f2481158fa3762d64">IL1_opt_str</a>);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   <span class="comment">/* the write-related options don't matter since the IL1 will(should) never see any stores */</span>
<a name="l00123"></a>00123   <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>)
<a name="l00124"></a>00124     <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa139ba0426a3586969e21ebb44709e8de3">CACHE_READONLY</a>,sets,assoc,linesize,rp,<span class="charliteral">'w'</span>,<span class="charliteral">'t'</span>,<span class="charliteral">'n'</span>,banks,bank_width,latency,4,MSHR_entries,1,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#8924d67219e4fbf56363be1d20d57d87">DL2_bus</a>);
<a name="l00125"></a>00125   <span class="keywordflow">else</span>
<a name="l00126"></a>00126     <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa139ba0426a3586969e21ebb44709e8de3">CACHE_READONLY</a>,sets,assoc,linesize,rp,<span class="charliteral">'w'</span>,<span class="charliteral">'t'</span>,<span class="charliteral">'n'</span>,banks,bank_width,latency,4,MSHR_entries,1,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#d6b074e9f80776c006cf1d399219d111">LLC_bus</a>);
<a name="l00127"></a>00127   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;MSHR_cmd_order = NULL;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#33b4c70f19ea323d92f12d023e14f8ec">PFF_size</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#6c641f632eb1cba75d889c550f8b4355">IL1_PFFsize</a>;
<a name="l00130"></a>00130   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a> = (<a class="code" href="structcache__t_1_1PFF__t.html">cache_t::PFF_t</a> *) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#6c641f632eb1cba75d889c550f8b4355">IL1_PFFsize</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a>));
<a name="l00131"></a>00131   <span class="keywordflow">if</span>(!<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#092432a8d25be05db21f421f873f3781">PFF</a>)
<a name="l00132"></a>00132     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"failed to calloc %s's prefetch FIFO"</span>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#b2a2c8eeb48b5f98cbd0265cce07aa6e">name</a>);
<a name="l00133"></a>00133   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#e7e8e385030eeff779f3286a13294045">prefetch_threshold</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#81cb78f98b406a4e4d02711775950a45">IL1_PFthresh</a>;
<a name="l00134"></a>00134   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#639a7ac5ea0206cfa35c8c86235bf7a4">prefetch_max</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#afc1c24917e1880ee984619e91c0c2ef">IL1_PFmax</a>;
<a name="l00135"></a>00135   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#a8c59fd868757f089f1c64b4fd962974">PF_low_watermark</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#ed804d55e9d5d9c794b6eafcc7e82a24">IL1_low_watermark</a>;
<a name="l00136"></a>00136   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#aa1cd32fa5467078fd28379cf03dd676">PF_high_watermark</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#295827f119458b7b8c2fbc79591a38da">IL1_high_watermark</a>;
<a name="l00137"></a>00137   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#53667e6a8c60a9c09eb66f41ecf7146d">PF_sample_interval</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#dcab08651b8fef497a98e71df1d59fe6">IL1_WMinterval</a>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a> = (<span class="keyword">struct </span><a class="code" href="classprefetch__t.html">prefetch_t</a> **) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#44849b4e0751d9fabd27568f778bac14">IL1_num_PF</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>));
<a name="l00140"></a>00140   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#9c4419121e831734dd6e738ddddb4d2e">num_prefetchers</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#44849b4e0751d9fabd27568f778bac14">IL1_num_PF</a>;
<a name="l00141"></a>00141   <span class="keywordflow">if</span>(!<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>)
<a name="l00142"></a>00142     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc %s's prefetcher array"</span>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#b2a2c8eeb48b5f98cbd0265cce07aa6e">name</a>);
<a name="l00143"></a>00143   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#44849b4e0751d9fabd27568f778bac14">IL1_num_PF</a>;i++)
<a name="l00144"></a>00144     <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>[i] = <a class="code" href="zesto-prefetch_8cpp.html#3d85e6268083839e3f4f31e038f204a8">prefetch_create</a>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#dac46ccee7d80153f423be4258e3b6c0">IL1PF_opt_str</a>[i],<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>);
<a name="l00145"></a>00145   <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#2f92869438ffe1d24402149ebb194b8e">prefetcher</a>[0] == NULL)
<a name="l00146"></a>00146     <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#9c4419121e831734dd6e738ddddb4d2e">num_prefetchers</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#44849b4e0751d9fabd27568f778bac14">IL1_num_PF</a> = 0;
<a name="l00147"></a>00147   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#c9dbdd85b01ac41d232da64808bf70e5">prefetch_on_miss</a> = knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#36cab48af1002b118cb1700cfb990d94">IL1_PF_on_miss</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149   <span class="comment">/* ITLB */</span>
<a name="l00150"></a>00150   <span class="keywordflow">if</span>(sscanf(knobs-&gt;<a class="code" href="structcore__knobs__t.html#cb7140c829f3ecf6ce521d84c327ecb5">memory</a>.<a class="code" href="structcore__knobs__t.html#2e29aaddde4cbc5d4119dea95374b45b">ITLB_opt_str</a>,<span class="stringliteral">"%[^:]:%d:%d:%d:%d:%c:%d"</span>,
<a name="l00151"></a>00151       name,&amp;sets,&amp;assoc,&amp;banks,&amp;latency, &amp;rp, &amp;MSHR_entries) != 7)
<a name="l00152"></a>00152     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"invalid ITLB options: &lt;name:sets:assoc:banks:latency:repl-policy:num-MSHR&gt;"</span>);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154   <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>)
<a name="l00155"></a>00155     <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa139ba0426a3586969e21ebb44709e8de3">CACHE_READONLY</a>,sets,assoc,1,rp,<span class="charliteral">'w'</span>,<span class="charliteral">'t'</span>,<span class="charliteral">'n'</span>,banks,1,latency,4,MSHR_entries,1,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#9b342dd887c9993db9a797f69ead9dd8">DL2</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#8924d67219e4fbf56363be1d20d57d87">DL2_bus</a>);
<a name="l00156"></a>00156   <span class="keywordflow">else</span>
<a name="l00157"></a>00157     <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a> = <a class="code" href="config_2zesto-cache_8cpp.html#76fc9319bafb600695d818375fe21ea3">cache_create</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>,name,<a class="code" href="config_2zesto-cache_8h.html#6cb413fabed99a64137321b4c9779aa139ba0426a3586969e21ebb44709e8de3">CACHE_READONLY</a>,sets,assoc,1,rp,<span class="charliteral">'w'</span>,<span class="charliteral">'t'</span>,<span class="charliteral">'n'</span>,banks,1,latency,4,MSHR_entries,1,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#5395b18a5afbfdfcf7d2c331000781b8">LLC</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#68240450aa17761096c76bb4732a4e64">uncore</a>-&gt;<a class="code" href="classuncore__t.html#d6b074e9f80776c006cf1d399219d111">LLC_bus</a>);
<a name="l00158"></a>00158   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>-&gt;MSHR_cmd_order = NULL;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a> = (<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a>*) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>));
<a name="l00161"></a>00161   <a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a> = <a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a> = 0;
<a name="l00162"></a>00162   <span class="keywordflow">if</span>(!<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>)
<a name="l00163"></a>00163     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc byteQ"</span>);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <a class="code" href="classcore__fetch__STM__t.html#3f1925703be344fdbd6c375c9fb281a3">byteQ_linemask</a> = ~(<a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a>)(knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#19d455195aa815b92d55a848fba5cd7e">byteQ_linesize</a> - 1);
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <span class="keywordtype">void</span>
<a name="l00169"></a><a class="code" href="classcore__fetch__STM__t.html#1a13aa718c8481dabf3f0ad3eeb29438">00169</a> <a class="code" href="classcore__fetch__STM__t.html#1a13aa718c8481dabf3f0ad3eeb29438">core_fetch_STM_t::reg_stats</a>(<span class="keyword">struct</span> <a class="code" href="structstat__sdb__t.html">stat_sdb_t</a> * <span class="keyword">const</span> sdb)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171   <span class="keywordtype">char</span> buf[1024];
<a name="l00172"></a>00172   <span class="keywordtype">char</span> buf2[1024];
<a name="l00173"></a>00173   <span class="keyword">struct </span><a class="code" href="structthread__t.html">thread_t</a> * arch = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <a class="code" href="zesto_2stats_8h.html#ed9b9c4535e4fc2e59a090d6e8157d4f">stat_reg_note</a>(sdb,<span class="stringliteral">"\n#### BPRED STATS ####"</span>);
<a name="l00176"></a>00176   <a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#e3a461a94838883fc3571879d08b4c75">reg_stats</a>(sdb,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   <a class="code" href="zesto_2stats_8h.html#ed9b9c4535e4fc2e59a090d6e8157d4f">stat_reg_note</a>(sdb,<span class="stringliteral">"\n#### INST CACHE STATS ####"</span>);
<a name="l00179"></a>00179   <a class="code" href="config_2zesto-cache_8cpp.html#80141f1bc8f06e0805162cdd6936c5d8">cache_reg_stats</a>(sdb, <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>, <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>);
<a name="l00180"></a>00180   <a class="code" href="config_2zesto-cache_8cpp.html#80141f1bc8f06e0805162cdd6936c5d8">cache_reg_stats</a>(sdb, <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>, <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <a class="code" href="zesto_2stats_8h.html#ed9b9c4535e4fc2e59a090d6e8157d4f">stat_reg_note</a>(sdb,<span class="stringliteral">"\n#### FETCH STATS ####"</span>);
<a name="l00183"></a>00183   sprintf(buf,<span class="stringliteral">"c%d.fetch_insn"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00184"></a>00184   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of instructions fetched"</span>, &amp;<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#3f86f6ee77ffa816fef52f42b3df3ed2">fetch_insn</a>, <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#3f86f6ee77ffa816fef52f42b3df3ed2">fetch_insn</a>, NULL);
<a name="l00185"></a>00185   sprintf(buf,<span class="stringliteral">"c%d.fetch_uops"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00186"></a>00186   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of uops fetched"</span>, &amp;<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#47b9581190262fa0a7a9c7d18173d502">fetch_uops</a>, <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#47b9581190262fa0a7a9c7d18173d502">fetch_uops</a>, NULL);
<a name="l00187"></a>00187   sprintf(buf,<span class="stringliteral">"c%d.fetch_IPC"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00188"></a>00188   sprintf(buf2,<span class="stringliteral">"c%d.fetch_insn/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00189"></a>00189   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"IPC at fetch"</span>, buf2, NULL);
<a name="l00190"></a>00190   sprintf(buf,<span class="stringliteral">"c%d.fetch_uPC"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00191"></a>00191   sprintf(buf2,<span class="stringliteral">"c%d.fetch_uops/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00192"></a>00192   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"uPC at fetch"</span>, buf2, NULL);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   sprintf(buf,<span class="stringliteral">"c%d.fetch_stall"</span>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00195"></a>00195   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#3cddfe5575dce461b508037a13deae5d">fetch_stall</a> = <a class="code" href="zesto_2stats_8h.html#b68118a778041ff66b7dec8bf1030ef4">stat_reg_dist</a>(sdb, buf,
<a name="l00196"></a>00196                                           <span class="stringliteral">"breakdown of stalls in fetch"</span>,
<a name="l00197"></a>00197                                           <span class="comment">/* initial value */</span>0,
<a name="l00198"></a>00198                                           <span class="comment">/* array size */</span><a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe0e7fbb0878850d7cd34fa2e4dda617de">FSTALL_num</a>,
<a name="l00199"></a>00199                                           <span class="comment">/* bucket size */</span>1,
<a name="l00200"></a>00200                                           <span class="comment">/* print format */</span>(<a class="code" href="zesto_2stats_8h.html#a2ea8c2ebd4b70b8bb60561c6fada674">PF_COUNT</a>|<a class="code" href="zesto_2stats_8h.html#7e857abbfb7e3dc6d4446052a96653a3">PF_PDF</a>),
<a name="l00201"></a>00201                                           <span class="comment">/* format */</span>NULL,
<a name="l00202"></a>00202                                           <span class="comment">/* index map */</span><a class="code" href="classcore__fetch__STM__t.html#c2524ba33b5b6435eef5223307dc06d1">fetch_stall_str</a>,
<a name="l00203"></a>00203                                           <span class="comment">/* print fn */</span>NULL);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   sprintf(buf,<span class="stringliteral">"c%d.byteQ_occupancy"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00206"></a>00206   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">false</span>, buf, <span class="stringliteral">"total byteQ occupancy (in lines/entries)"</span>, &amp;<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a364f8fb635bb5006f65c7ca4447efa4">byteQ_occupancy</a>, <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a364f8fb635bb5006f65c7ca4447efa4">byteQ_occupancy</a>, NULL);
<a name="l00207"></a>00207   sprintf(buf,<span class="stringliteral">"c%d.byteQ_avg"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00208"></a>00208   sprintf(buf2,<span class="stringliteral">"c%d.byteQ_occupancy/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00209"></a>00209   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"average byteQ occupancy (in insts)"</span>, buf2, NULL);
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a><a class="code" href="classcore__fetch__STM__t.html#fe8ef61f53ccea1a44f642798f3ef212">00212</a> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#fe8ef61f53ccea1a44f642798f3ef212">core_fetch_STM_t::update_occupancy</a>(<span class="keywordtype">void</span>)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214   <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a364f8fb635bb5006f65c7ca4447efa4">byteQ_occupancy</a> += <a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a>;
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 <span class="comment">/******************************/</span>
<a name="l00219"></a>00219 <span class="comment">/* byteQ/I$ RELATED FUNCTIONS */</span>
<a name="l00220"></a>00220 <span class="comment">/******************************/</span>
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="classcore__fetch__STM__t.html#6f183c0792faf846ea7fbb8aeb7d0aaf">00222</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__fetch__STM__t.html#6f183c0792faf846ea7fbb8aeb7d0aaf">core_fetch_STM_t::byteQ_is_full</a>(<span class="keywordtype">void</span>)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00225"></a>00225   <span class="keywordflow">return</span> (<a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a> &gt;= knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>);
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="comment">/* is this line already the most recently requested? */</span>
<a name="l00229"></a><a class="code" href="classcore__fetch__STM__t.html#b823eca44972f8b3ee288c34be1727c8">00229</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__fetch__STM__t.html#b823eca44972f8b3ee288c34be1727c8">core_fetch_STM_t::byteQ_already_requested</a>(<span class="keyword">const</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> addr)
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00232"></a>00232   <span class="keywordtype">int</span> index = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>); <span class="comment">//(byteQ_tail-1+knobs-&gt;fetch.byteQ_size) % knobs-&gt;fetch.byteQ_size;</span>
<a name="l00233"></a>00233   <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a> &amp;&amp; (<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].addr == (addr &amp; <a class="code" href="classcore__fetch__STM__t.html#3f1925703be344fdbd6c375c9fb281a3">byteQ_linemask</a>)))
<a name="l00234"></a>00234     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00235"></a>00235   <span class="keywordflow">else</span>
<a name="l00236"></a>00236     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="comment">/* Initiate a fetch request */</span>
<a name="l00240"></a><a class="code" href="classcore__fetch__STM__t.html#d546589d0f24b23d8a668ea9f928330f">00240</a> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#d546589d0f24b23d8a668ea9f928330f">core_fetch_STM_t::byteQ_request</a>(<span class="keyword">const</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> lineaddr)
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00243"></a>00243   <span class="comment">/* this function assumes you already called byteQ_already_requested so that</span>
<a name="l00244"></a>00244 <span class="comment">     you don't double-request the same line */</span>
<a name="l00245"></a>00245   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#390df8e9d3f035be4e234214c55577c1">when_fetch_requested</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00246"></a>00246   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#239fbb5df474d5fc82780dfcf98cb214">when_fetched</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00247"></a>00247   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#dc1ca63643c451db7587513defd97b5c">when_translation_requested</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00248"></a>00248   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">when_translated</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00249"></a>00249   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">addr</a> = lineaddr;
<a name="l00250"></a>00250   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#073f54a7249f0ff1ec47b2f08899867b">action_id</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l00251"></a>00251   <a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>); <span class="comment">//(byteQ_tail+1)%knobs-&gt;fetch.byteQ_size;</span>
<a name="l00252"></a>00252   <a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a>++;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254   <span class="keywordflow">return</span>;
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="comment">/* Callback functions used by the cache code to indicate when the IL1/ITLB lookups</span>
<a name="l00258"></a>00258 <span class="comment">   have been completed. */</span>
<a name="l00259"></a><a class="code" href="classcore__fetch__STM__t.html#f91b2cb6ffde02bc014512e0836f7c27">00259</a> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#f91b2cb6ffde02bc014512e0836f7c27">core_fetch_STM_t::IL1_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261   <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a> * <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a> = (<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a>*) op;
<a name="l00262"></a>00262   byteQ-&gt;<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#239fbb5df474d5fc82780dfcf98cb214">when_fetched</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="classcore__fetch__STM__t.html#2cd42e4e6a771a1a7b1df9d0e54c1b6a">00265</a> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#2cd42e4e6a771a1a7b1df9d0e54c1b6a">core_fetch_STM_t::ITLB_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267   <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a> * <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a> = (<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a>*) op;
<a name="l00268"></a>00268   byteQ-&gt;<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">when_translated</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00271"></a><a class="code" href="classcore__fetch__STM__t.html#a6c3c6ba907a0ef5ab4b968d5c0b7b15">00271</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__fetch__STM__t.html#a6c3c6ba907a0ef5ab4b968d5c0b7b15">core_fetch_STM_t::translated_callback</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op, <span class="keyword">const</span> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> action_id)
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273   <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a> * <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a> = (<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a>*) op;
<a name="l00274"></a>00274   <span class="keywordflow">if</span>(byteQ-&gt;<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#073f54a7249f0ff1ec47b2f08899867b">action_id</a> == action_id)
<a name="l00275"></a>00275     <span class="keywordflow">return</span> byteQ-&gt;<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">when_translated</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00276"></a>00276   <span class="keywordflow">else</span>
<a name="l00277"></a>00277     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="classcore__fetch__STM__t.html#5f6d70206465ea63029c8e6d6b877af6">00280</a> <a class="code" href="zesto-structs_8h.html#12ad2f48066289fd2855fccc710cc150">seq_t</a> <a class="code" href="classcore__fetch__STM__t.html#5f6d70206465ea63029c8e6d6b877af6">core_fetch_STM_t::get_byteQ_action_id</a>(<span class="keywordtype">void</span> * <span class="keyword">const</span> op)
<a name="l00281"></a>00281 {
<a name="l00282"></a>00282   <a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a> * <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a> = (<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html">byteQ_entry_t</a>*) op;
<a name="l00283"></a>00283   <span class="keywordflow">return</span> byteQ-&gt;<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#073f54a7249f0ff1ec47b2f08899867b">action_id</a>;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">/************************/</span>
<a name="l00287"></a>00287 <span class="comment">/* MAIN FETCH FUNCTIONS */</span>
<a name="l00288"></a>00288 <span class="comment">/************************/</span>
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="classcore__fetch__STM__t.html#9366aef38f6639d3999c4efb2f2fb8b4">00290</a> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#9366aef38f6639d3999c4efb2f2fb8b4">core_fetch_STM_t::step</a>(<span class="keywordtype">void</span>)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00293"></a>00293   <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> current_line = <a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a> &amp; <a class="code" href="classcore__fetch__STM__t.html#3f1925703be344fdbd6c375c9fb281a3">byteQ_linemask</a>;
<a name="l00294"></a>00294   <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> * Mop = NULL;
<a name="l00295"></a>00295   <span class="keyword">enum</span> <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe">fetch_stall_t</a> stall_reason = <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe92ca723e4d8e941cde56eccf526fff87">FSTALL_EOL</a>;
<a name="l00296"></a>00296   <span class="keywordtype">int</span> i;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   <span class="comment">/* This gets processed here, so that demand misses from the DL1 get higher</span>
<a name="l00299"></a>00299 <span class="comment">     priority for accessing the L2 */</span>
<a name="l00300"></a>00300   <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>-&gt;<a class="code" href="structcache__t.html#9b4a4bd434c4df3d4d004df6b1c362b8">check_for_work</a>) <a class="code" href="config_2zesto-cache_8cpp.html#93ce14ef87e7565964216ea27d912147">cache_process</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>);
<a name="l00301"></a>00301   <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>-&gt;<a class="code" href="structcache__t.html#9b4a4bd434c4df3d4d004df6b1c362b8">check_for_work</a>) <a class="code" href="config_2zesto-cache_8cpp.html#93ce14ef87e7565964216ea27d912147">cache_process</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303   <span class="comment">/* XXX: I don't think we really should need this code here, since</span>
<a name="l00304"></a>00304 <span class="comment">     whenever a Mop gets consumed, this check should be happening</span>
<a name="l00305"></a>00305 <span class="comment">     any way (see the Mop_consume function)... but the simulator</span>
<a name="l00306"></a>00306 <span class="comment">     seems to get stuck with a line where all Mops have been read</span>
<a name="l00307"></a>00307 <span class="comment">     yet has not been reclaimed. */</span>
<a name="l00308"></a>00308   <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a> &amp;&amp; (<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structMop__t.html#9e740f401f882c0173adc702cea64834">when_fetched</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>) 
<a name="l00309"></a>00309                   &amp;&amp; (<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].when_translated != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00310"></a>00310                   &amp;&amp; (<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].num_Mop &lt;= 0))
<a name="l00311"></a>00311   {
<a name="l00312"></a>00312     <span class="comment">/* consumed all insts from this fetch line */</span>
<a name="l00313"></a>00313     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">MopQ_first_index</a> = -1;
<a name="l00314"></a>00314     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#390df8e9d3f035be4e234214c55577c1">when_fetch_requested</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00315"></a>00315     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#239fbb5df474d5fc82780dfcf98cb214">when_fetched</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00316"></a>00316     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#dc1ca63643c451db7587513defd97b5c">when_translation_requested</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00317"></a>00317     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">when_translated</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00318"></a>00318     <a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a>--;
<a name="l00319"></a>00319     <a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>); <span class="comment">//(byteQ_head+1)%knobs-&gt;fetch.byteQ_size;</span>
<a name="l00320"></a>00320   }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="keywordflow">while</span>( <span class="comment">/* still fetching from the same byteQ entry */</span>
<a name="l00324"></a>00324          (<a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a> &amp; byteQ_linemask) == current_line
<a name="l00325"></a>00325        )
<a name="l00326"></a>00326   {
<a name="l00327"></a>00327     Mop = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#1ac2b1204cef575e22d1d03c3ce4cff9">exec</a>(<a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a>);
<a name="l00328"></a>00328     <span class="keywordflow">if</span>(Mop &amp;&amp; ((<a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a> &gt;&gt; <a class="code" href="memory_8h.html#850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>) == 0))
<a name="l00329"></a>00329     {
<a name="l00330"></a>00330       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#c3d9d77c3cc61cac13be93461b663fbb">spec_mode</a>,(<span class="keywordtype">void</span>)0);
<a name="l00331"></a>00331       stall_reason = <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe8858d4e0673f8cb7bafe751cc608ba52">FSTALL_ZPAGE</a>;
<a name="l00332"></a>00332       <span class="keywordflow">break</span>;
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordflow">if</span>(!Mop) <span class="comment">/* awaiting pipe to clear for system call/trap, or encountered wrong-path bogus inst */</span>
<a name="l00336"></a>00336     {
<a name="l00337"></a>00337       <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__t.html#ced0dd38e3004abe40e9eeb7ab865c1f">bogus</a>)
<a name="l00338"></a>00338         stall_reason = <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fecf754abe40ec2135c7038984fe6d6ceb">FSTALL_BOGUS</a>;
<a name="l00339"></a>00339       <span class="keywordflow">else</span>
<a name="l00340"></a>00340         stall_reason = <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fec8d8a83fbe9c212c2cd8190feef55cff">FSTALL_SYSCALL</a>;
<a name="l00341"></a>00341       <span class="keywordflow">break</span>;
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="comment">/* We explicitly check for both the address of the first byte and the last</span>
<a name="l00345"></a>00345 <span class="comment">       byte, since x86 instructions have no alignment restrictions and therefore</span>
<a name="l00346"></a>00346 <span class="comment">       may end up getting split across more than one cache line.  If so, this</span>
<a name="l00347"></a>00347 <span class="comment">       can generate more than one IL1/ITLB lookup. */</span>
<a name="l00348"></a>00348     <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__STM__t.html#b823eca44972f8b3ee288c34be1727c8">byteQ_already_requested</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>))
<a name="l00349"></a>00349     {
<a name="l00350"></a>00350       Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#6df8699de07dace3f1f67a9026536acb">first_byte_requested</a> = <span class="keyword">true</span>;
<a name="l00351"></a>00351       <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#7cbb20c576aa6fff6bfcbd39a074528f">timing</a>.<a class="code" href="structMop__t.html#074734a2c4989bb09528dc993321a01b">when_fetch_started</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00352"></a>00352         Mop-&gt;<a class="code" href="structMop__t.html#7cbb20c576aa6fff6bfcbd39a074528f">timing</a>.<a class="code" href="structMop__t.html#074734a2c4989bb09528dc993321a01b">when_fetch_started</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354     <span class="keywordflow">if</span>(!Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#6df8699de07dace3f1f67a9026536acb">first_byte_requested</a>)
<a name="l00355"></a>00355     {
<a name="l00356"></a>00356       <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__STM__t.html#6f183c0792faf846ea7fbb8aeb7d0aaf">byteQ_is_full</a>()) <span class="comment">/* stall if byteQ is full */</span>
<a name="l00357"></a>00357       {
<a name="l00358"></a>00358         stall_reason = <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727feb2cc534544c44f385773fc50981b72d4">FSTALL_byteQ_FULL</a>;
<a name="l00359"></a>00359         <span class="keywordflow">break</span>;
<a name="l00360"></a>00360       }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362       <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#7cbb20c576aa6fff6bfcbd39a074528f">timing</a>.<a class="code" href="structMop__t.html#074734a2c4989bb09528dc993321a01b">when_fetch_started</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00363"></a>00363         Mop-&gt;<a class="code" href="structMop__t.html#7cbb20c576aa6fff6bfcbd39a074528f">timing</a>.<a class="code" href="structMop__t.html#074734a2c4989bb09528dc993321a01b">when_fetch_started</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00364"></a>00364       Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#6df8699de07dace3f1f67a9026536acb">first_byte_requested</a> = <span class="keyword">true</span>;
<a name="l00365"></a>00365       <a class="code" href="classcore__fetch__STM__t.html#d546589d0f24b23d8a668ea9f928330f">byteQ_request</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a> &amp; byteQ_linemask);
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="comment">/* STM model doesn't deal with fetches across cache lines */</span>
<a name="l00369"></a>00369     Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#ea69aabb30124f2a67afc5c5aa042faf">last_byte_requested</a> = <span class="keyword">true</span>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#6df8699de07dace3f1f67a9026536acb">first_byte_requested</a>,(<span class="keywordtype">void</span>)0);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="comment">/* All bytes for this Mop have been requested.  Record it in the byteQ entry</span>
<a name="l00374"></a>00374 <span class="comment">       and let the oracle know we're done with it so can proceed to the next</span>
<a name="l00375"></a>00375 <span class="comment">       one */</span>
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="keywordtype">int</span> byteQ_index = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>); <span class="comment">//(byteQ_tail-1+knobs-&gt;fetch.byteQ_size)%knobs-&gt;fetch.byteQ_size;</span>
<a name="l00378"></a>00378     <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[byteQ_index].num_Mop == 0)
<a name="l00379"></a>00379       <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[byteQ_index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">MopQ_first_index</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#2c1b1e382fd5cd3a13a52560adf9ce7b">get_index</a>(Mop);
<a name="l00380"></a>00380     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[byteQ_index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#2ced6cc21377e0a69b55428ce1a3c72c">num_Mop</a>++;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#527c3d85c2b86a3fed4c223b529dd33f">consume</a>(Mop);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <span class="comment">/* figure out where to fetch from next */</span>
<a name="l00385"></a>00385     <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#64bb9f9c135012445c43e8823e98bb3d">is_ctrl</a> || Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#3cb7c4132587d2f78d978d951ab0eef7">rep</a>)
<a name="l00386"></a>00386     {
<a name="l00387"></a>00387       Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a> = <a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#48647ea733ca43990ea2a9b8c4d03ab8">get_state_cache</a>();
<a name="l00388"></a>00388 
<a name="l00389"></a>00389       Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a> = <a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#eb9b5d4a17fb1fb8ea0055de44874d4e">lookup</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>,
<a name="l00390"></a>00390           Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7301ad4e0c0f5ece738ba62448f7c655">opflags</a>, Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>+Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>,Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#f820451bdee352d521eb3bf905c3d4e0">targetPC</a>,
<a name="l00391"></a>00391           Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>,(Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> != (Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>+Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>)));
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 
<a name="l00394"></a>00394       <a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#90e48993937d7ed40623003e6d76b138">spec_update</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>,Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7301ad4e0c0f5ece738ba62448f7c655">opflags</a>,
<a name="l00395"></a>00395           Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>,Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#f820451bdee352d521eb3bf905c3d4e0">targetPC</a>,Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>,Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>-&gt;our_pred);
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397     <span class="keywordflow">else</span>
<a name="l00398"></a>00398       Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a> = Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a> + Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a> != Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>)
<a name="l00401"></a>00401     {
<a name="l00402"></a>00402       Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#91414c4b76b4a38c6ee3629b949c01c4">recover_inst</a> = <span class="keyword">true</span>;
<a name="l00403"></a>00403       Mop-&gt;<a class="code" href="structMop__t.html#b435acfedb392843bc50658c7650cbdd">uop</a>[Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#82638df3748d18d1c8c2e3d58d077a49">last_uop_index</a>].<a class="code" href="structuop__t.html#8e4a2982dc7dcc8eb4f22d8d16a9ab1b">oracle</a>.<a class="code" href="structuop__t.html#7c9ed137c8fc7cfdcd22b0d45edd2926">recover_inst</a> = <span class="keyword">true</span>;
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="comment">/* advance the fetch PC to the next instruction */</span>
<a name="l00407"></a>00407     <a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a> = Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a>;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="keywordflow">if</span>(  (Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a> != (Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a> + Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>))
<a name="l00410"></a>00410       &amp;&amp; (Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#2337789f03bfd40d471eafa6e31b4b45">pred_NPC</a> != Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>)) <span class="comment">/* REPs don't count as taken branches w.r.t. fetching */</span>
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412       stall_reason = <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fed237d31ebfaf174e07aad7448f05c074">FSTALL_TBR</a>;
<a name="l00413"></a>00413       <span class="keywordflow">break</span>;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415     <span class="keywordflow">else</span> <span class="keywordflow">if</span>((Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a> &amp; byteQ_linemask) != current_line)
<a name="l00416"></a>00416     {
<a name="l00417"></a>00417       stall_reason = <a class="code" href="classcore__fetch__STM__t.html#d9a976de5266857ae501e548e1a727fe92ca723e4d8e941cde56eccf526fff87">FSTALL_EOL</a>;
<a name="l00418"></a>00418       <span class="keywordflow">break</span>;
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   } <span class="comment">/* while */</span>
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="zesto_2stats_8h.html#702503b8068fdcce1dc8712be9791d42">stat_add_sample</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#3cddfe5575dce461b508037a13deae5d">fetch_stall</a>, (<span class="keywordtype">int</span>)stall_reason);)
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   <span class="comment">/* check byteQ and send requests to I$/ITLB */</span>
<a name="l00426"></a>00426   <span class="keywordtype">int</span> index = <a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>;
<a name="l00427"></a>00427   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a>;i++)
<a name="l00428"></a>00428   {
<a name="l00429"></a>00429     <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].when_fetch_requested == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00430"></a>00430     {
<a name="l00431"></a>00431       <span class="keywordflow">if</span>(<a class="code" href="config_2zesto-cache_8cpp.html#35c7c82c117f5713ec55d40f831060da">cache_enqueuable</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">addr</a>))
<a name="l00432"></a>00432       {
<a name="l00433"></a>00433         <a class="code" href="config_2zesto-cache_8cpp.html#0831369c0f015a2e350b71f2fc445c70">cache_enqueue</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#6d174a98e852ec20f0f8a3410d84b4a9">IL1</a>,NULL,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">addr</a>,<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">addr</a>,<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#073f54a7249f0ff1ec47b2f08899867b">action_id</a>,0,<a class="code" href="config_2zesto-cache_8h.html#47d3ac5bd49bbf1ff15859f38059ac97">NO_MSHR</a>,&amp;<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index],<a class="code" href="classcore__fetch__STM__t.html#f91b2cb6ffde02bc014512e0836f7c27">IL1_callback</a>,NULL,<a class="code" href="classcore__fetch__STM__t.html#a6c3c6ba907a0ef5ab4b968d5c0b7b15">translated_callback</a>,<a class="code" href="classcore__fetch__STM__t.html#5f6d70206465ea63029c8e6d6b877af6">get_byteQ_action_id</a>);
<a name="l00434"></a>00434         <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#390df8e9d3f035be4e234214c55577c1">when_fetch_requested</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00435"></a>00435         <span class="keywordflow">break</span>;
<a name="l00436"></a>00436       }
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438     index = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(index,knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>);
<a name="l00439"></a>00439   }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   index = <a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>;
<a name="l00442"></a>00442   <span class="keywordflow">for</span>(i=0;i&lt;byteQ_num;i++)
<a name="l00443"></a>00443   {
<a name="l00444"></a>00444     <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].when_translation_requested == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00445"></a>00445     {
<a name="l00446"></a>00446       <span class="keywordflow">if</span>(<a class="code" href="config_2zesto-cache_8cpp.html#35c7c82c117f5713ec55d40f831060da">cache_enqueuable</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">addr</a>)))
<a name="l00447"></a>00447       {
<a name="l00448"></a>00448         <a class="code" href="config_2zesto-cache_8cpp.html#0831369c0f015a2e350b71f2fc445c70">cache_enqueue</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#05317565ca33e18c2eb9b8fa9a950ce1">memory</a>.<a class="code" href="structcore__t_1_1core__memory__t.html#e842ebfb4b6de70536a46020eaa92417">ITLB</a>,NULL,<a class="code" href="config_2zesto-cache_8h.html#aa2f5ac205a00e5df606ccf951edb255a614c7f88fbcfcc7dc4e5e9fd697f585">CACHE_READ</a>,0,<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="memory_8h.html#628a3729ebbf0306b93db41d9b34b0ca">PAGE_TABLE_ADDR</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">addr</a>),<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#073f54a7249f0ff1ec47b2f08899867b">action_id</a>,0,<a class="code" href="config_2zesto-cache_8h.html#47d3ac5bd49bbf1ff15859f38059ac97">NO_MSHR</a>,&amp;<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index],<a class="code" href="classcore__fetch__STM__t.html#2cd42e4e6a771a1a7b1df9d0e54c1b6a">ITLB_callback</a>,NULL,NULL,<a class="code" href="classcore__fetch__STM__t.html#5f6d70206465ea63029c8e6d6b877af6">get_byteQ_action_id</a>);
<a name="l00449"></a>00449         <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[index].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#dc1ca63643c451db7587513defd97b5c">when_translation_requested</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00450"></a>00450         <span class="keywordflow">break</span>;
<a name="l00451"></a>00451       }
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453     index = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(index,knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>);
<a name="l00454"></a>00454   }
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 
<a name="l00459"></a><a class="code" href="classcore__fetch__STM__t.html#6162b7a5fcf2b9be3ad57937741c061d">00459</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__fetch__STM__t.html#6162b7a5fcf2b9be3ad57937741c061d">core_fetch_STM_t::Mop_available</a>(<span class="keywordtype">void</span>)
<a name="l00460"></a>00460 {
<a name="l00461"></a>00461   <span class="keywordflow">return</span> <a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a> &amp;&amp; <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#239fbb5df474d5fc82780dfcf98cb214">when_fetched</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>
<a name="l00462"></a>00462                    &amp;&amp; <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">when_translated</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>
<a name="l00463"></a>00463                    &amp;&amp; <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#2ced6cc21377e0a69b55428ce1a3c72c">num_Mop</a>;
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00466"></a><a class="code" href="classcore__fetch__STM__t.html#10ad9c324a326a7dca085f538844b6f9">00466</a> <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> * <a class="code" href="classcore__fetch__STM__t.html#10ad9c324a326a7dca085f538844b6f9">core_fetch_STM_t::Mop_peek</a>(<span class="keywordtype">void</span>)
<a name="l00467"></a>00467 {
<a name="l00468"></a>00468   <span class="keywordtype">int</span> MopQ_index = <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">MopQ_first_index</a>;
<a name="l00469"></a>00469   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(MopQ_index != -1,NULL);
<a name="l00470"></a>00470   <span class="keywordflow">return</span> <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#476405605981d10733d94063d4441dfe">get_Mop</a>(MopQ_index);
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473 <span class="comment">/* check byteQ for fetched/translated instructions */</span>
<a name="l00474"></a><a class="code" href="classcore__fetch__STM__t.html#66d176de79363b837645f8d790c1356f">00474</a> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#66d176de79363b837645f8d790c1356f">core_fetch_STM_t::Mop_consume</a>(<span class="keywordtype">void</span>)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00477"></a>00477   
<a name="l00478"></a>00478   <span class="comment">/* assumes you alerady called Mop_available to check that</span>
<a name="l00479"></a>00479 <span class="comment">     a ready Mop exists. */</span>
<a name="l00480"></a>00480   <span class="keywordtype">int</span> MopQ_index = <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">MopQ_first_index</a>;
<a name="l00481"></a>00481   <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> * Mop = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#476405605981d10733d94063d4441dfe">get_Mop</a>(MopQ_index);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483   Mop-&gt;<a class="code" href="structMop__t.html#7cbb20c576aa6fff6bfcbd39a074528f">timing</a>.<a class="code" href="structMop__t.html#9e740f401f882c0173adc702cea64834">when_fetched</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00484"></a>00484   <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#b435acfedb392843bc50658c7650cbdd">uop</a>[Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#82638df3748d18d1c8c2e3d58d077a49">last_uop_index</a>].<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#be01a5d7b4a12d36d753ca8e295cceb6">EOM</a>)
<a name="l00485"></a>00485     <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#3f86f6ee77ffa816fef52f42b3df3ed2">fetch_insn</a>++;)
<a name="l00486"></a>00486 
<a name="l00487"></a>00487   <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#47b9581190262fa0a7a9c7d18173d502">fetch_uops</a> += Mop-&gt;<a class="code" href="structMop__t.html#42838437539e18e14b2049aa3ad512c2">stat</a>.<a class="code" href="structMop__t.html#b63d1f53be60fd17e64b2e6fe22e6f3b">num_uops</a>;)
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#2ced6cc21377e0a69b55428ce1a3c72c">num_Mop</a>--;
<a name="l00490"></a>00490   <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">MopQ_first_index</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#3d8ea00f353d569980869333b7a92668">next_index</a>(MopQ_index);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   <span class="keywordflow">if</span>(<a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].num_Mop &lt;= 0)
<a name="l00493"></a>00493   {
<a name="l00494"></a>00494     <span class="comment">/* consumed all insts from this fetch line */</span>
<a name="l00495"></a>00495     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">MopQ_first_index</a> = -1;
<a name="l00496"></a>00496     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#390df8e9d3f035be4e234214c55577c1">when_fetch_requested</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00497"></a>00497     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#239fbb5df474d5fc82780dfcf98cb214">when_fetched</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00498"></a>00498     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#dc1ca63643c451db7587513defd97b5c">when_translation_requested</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00499"></a>00499     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">when_translated</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00500"></a>00500     <a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a>--;
<a name="l00501"></a>00501     <a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>); <span class="comment">//(byteQ_head+1)%knobs-&gt;fetch.byteQ_size;</span>
<a name="l00502"></a>00502   }
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a><a class="code" href="classcore__fetch__STM__t.html#3ad47b0fc75aedc66d1c96295747c04f">00505</a> <span class="keywordtype">void</span> <a class="code" href="classcore__fetch__STM__t.html#3ad47b0fc75aedc66d1c96295747c04f">core_fetch_STM_t::jeclear_enqueue</a>(<span class="keyword">struct</span> <a class="code" href="structMop__t.html">Mop_t</a> * <span class="keyword">const</span> Mop, <span class="keyword">const</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> New_PC)
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507   <span class="comment">/* does nothing; should not get called for STM */</span>
<a name="l00508"></a>00508   <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"core_fetch_SMT_t::jeclear_enqueue should never get called"</span>);
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="keywordtype">void</span>
<a name="l00512"></a><a class="code" href="classcore__fetch__STM__t.html#efa401b9257f82b2feaac0913b269e16">00512</a> <a class="code" href="classcore__fetch__STM__t.html#efa401b9257f82b2feaac0913b269e16">core_fetch_STM_t::recover</a>(<span class="keyword">const</span> <a class="code" href="machine_8h.html#fba784f22c1d8233f95c4f4db103018a">md_addr_t</a> new_PC)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00515"></a>00515   <span class="comment">/* XXX: use non-oracle nextPC as there may be multiple re-fetches */</span>
<a name="l00516"></a>00516   <span class="keywordtype">int</span> i;
<a name="l00517"></a>00517   <a class="code" href="classcore__fetch__t.html#dadc3ae0443ab1d4eb3493d8847b10c8">PC</a> = new_PC;
<a name="l00518"></a>00518   <a class="code" href="classcore__fetch__t.html#ced0dd38e3004abe40e9eeb7ab865c1f">bogus</a> = <span class="keyword">false</span>;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520   <span class="comment">/* clear out the byteQ */</span>
<a name="l00521"></a>00521   <span class="keywordflow">for</span>(i=0;i&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#7255d0ea236298f95bb8fb003a06c613">fetch</a>.<a class="code" href="structcore__knobs__t.html#f97a040f494d7b834ea43c3e0f396000">byteQ_size</a>;i++)
<a name="l00522"></a>00522   {
<a name="l00523"></a>00523     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[i].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#617d4d4a12ec2109f2d02a9625612fea">addr</a> = 0;
<a name="l00524"></a>00524     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[i].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#390df8e9d3f035be4e234214c55577c1">when_fetch_requested</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00525"></a>00525     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[i].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#239fbb5df474d5fc82780dfcf98cb214">when_fetched</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00526"></a>00526     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[i].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#dc1ca63643c451db7587513defd97b5c">when_translation_requested</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00527"></a>00527     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[i].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#7d9cf6788941d693bff318d90a9b6d09">when_translated</a> = <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>;
<a name="l00528"></a>00528     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[i].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#2ced6cc21377e0a69b55428ce1a3c72c">num_Mop</a> = 0;
<a name="l00529"></a>00529     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[i].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#76b5a5e471726ebd12382e3c4395bfed">MopQ_first_index</a> = -1;
<a name="l00530"></a>00530     <a class="code" href="classcore__fetch__STM__t.html#02b6e2436f31a265b6d0aa264675662b">byteQ</a>[i].<a class="code" href="structcore__fetch__STM__t_1_1byteQ__entry__t.html#073f54a7249f0ff1ec47b2f08899867b">action_id</a> = <a class="code" href="classcore__fetch__t.html#757e5d883ce7fa744b227cfc27d1fc43">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l00531"></a>00531   }
<a name="l00532"></a>00532   <a class="code" href="classcore__fetch__STM__t.html#1db25b1f79cd51d72647e320922d7f68">byteQ_num</a> = 0;
<a name="l00533"></a>00533   <a class="code" href="classcore__fetch__STM__t.html#680739b960c941b02643db7bec082ba6">byteQ_head</a> = 0;
<a name="l00534"></a>00534   <a class="code" href="classcore__fetch__STM__t.html#eba7c51eb4b9df6bf7ce8b09a84392c0">byteQ_tail</a> = 0;
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 23 00:20:56 2010 for IRIS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
