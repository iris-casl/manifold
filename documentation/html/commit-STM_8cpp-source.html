<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>IRIS: commit-STM.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_014faa727c0b2aaba2cbdd8f326de4f6.html">source</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_4516642e80adc9bf50ea604a2fbf2492.html">zesto</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e9462c8a8fa0956c3f003f6393e2a80d.html">ZPIPE-commit</a>
  </div>
</div>
<div class="contents">
<h1>commit-STM.cpp</h1><a href="commit-STM_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* commit-STM.cpp - Simple(r) Timing Model */</span>
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * __COPYRIGHT__ GT</span>
<a name="l00004"></a>00004 <span class="comment"> */</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#ifdef ZESTO_PARSE_ARGS</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(!strcasecmp(commit_opt_string,<span class="stringliteral">"STM"</span>))
<a name="l00008"></a>00008     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classcore__commit__STM__t.html">core_commit_STM_t</a>(core);
<a name="l00009"></a>00009 <span class="preprocessor">#else</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a><a class="code" href="classcore__commit__STM__t.html">00011</a> <span class="keyword">class </span><a class="code" href="classcore__commit__STM__t.html">core_commit_STM_t</a>:<span class="keyword">public</span> <a class="code" href="classcore__commit__t.html">core_commit_t</a>
<a name="l00012"></a>00012 {
<a name="l00013"></a><a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cd9f2ee8eead92a505751a06718e3451ee">00013</a>   <span class="keyword">enum</span> <a class="code" href="classcore__commit__t.html#cf283124880a10ce01e0fb68f2aa69ce">commit_stall_t</a> {<a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cd9f2ee8eead92a505751a06718e3451ee">CSTALL_NONE</a>,      <span class="comment">/* no stall */</span>
<a name="l00014"></a><a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cdf5159bda287b766e425d794d1aa66bb4">00014</a>                        <a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cdf5159bda287b766e425d794d1aa66bb4">CSTALL_NOT_READY</a>, <span class="comment">/* oldest inst not done (no uops finished) */</span>
<a name="l00015"></a><a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cd2ed2ba1aeb7b2a9d4c1a60aa5e8ac5b5">00015</a>                        <a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cd2ed2ba1aeb7b2a9d4c1a60aa5e8ac5b5">CSTALL_PARTIAL</a>,   <span class="comment">/* oldest inst not done (but some uops finished) */</span>
<a name="l00016"></a><a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cdc98092df7e93d964de5e5ca7621c5143">00016</a>                        <a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cdc98092df7e93d964de5e5ca7621c5143">CSTALL_EMPTY</a>,     <span class="comment">/* ROB is empty, nothing to commit */</span>
<a name="l00017"></a><a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cda6cdb34be6985d546d7fecac4ed76f16">00017</a>                        <a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cda6cdb34be6985d546d7fecac4ed76f16">CSTALL_num</a>
<a name="l00018"></a>00018                      };
<a name="l00019"></a>00019 
<a name="l00020"></a>00020   <span class="keyword">public</span>:
<a name="l00021"></a>00021 
<a name="l00022"></a>00022   <a class="code" href="classcore__commit__STM__t.html#d7182901cfebab979040cc4151cccab0">core_commit_STM_t</a>(<span class="keyword">struct</span> <a class="code" href="classcore__t.html">core_t</a> * <span class="keyword">const</span> <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>);
<a name="l00023"></a>00023   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#80dc96ec7454c0d193c053bfed57b016">reg_stats</a>(<span class="keyword">struct</span> <a class="code" href="structstat__sdb__t.html">stat_sdb_t</a> * <span class="keyword">const</span> sdb);
<a name="l00024"></a>00024   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#84fc053a6d833b4df53f6dde763b81a2">update_occupancy</a>(<span class="keywordtype">void</span>);
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#528f84be030a7ec19bf27ac995a64497">step</a>(<span class="keywordtype">void</span>);
<a name="l00027"></a>00027   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#c69a979d8af28ac84925b16094498845">recover</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structMop__t.html">Mop_t</a> * <span class="keyword">const</span> Mop);
<a name="l00028"></a>00028   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#c69a979d8af28ac84925b16094498845">recover</a>(<span class="keywordtype">void</span>);
<a name="l00029"></a>00029 
<a name="l00030"></a>00030   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__commit__STM__t.html#42b0d6ec2c90655ebafefcdf620a4241">ROB_available</a>(<span class="keywordtype">void</span>);
<a name="l00031"></a>00031   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcore__commit__STM__t.html#a0ff8613308d681e077fe3033e40f5b5">ROB_empty</a>(<span class="keywordtype">void</span>);
<a name="l00032"></a>00032   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#36e6c1d474694d75a35ad7c49bbe7b59">ROB_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00033"></a>00033   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#2e2733c421dbec121c10f40a011095f4">ROB_fuse_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   <span class="keyword">protected</span>:
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">00037</a>   <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> ** <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>;
<a name="l00038"></a><a class="code" href="classcore__commit__STM__t.html#9b1a733bdca4f9c25ae42966e64ad097">00038</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__commit__STM__t.html#9b1a733bdca4f9c25ae42966e64ad097">ROB_head</a>;
<a name="l00039"></a><a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">00039</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a>;
<a name="l00040"></a><a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">00040</a>   <span class="keywordtype">int</span> <a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a>;
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="classcore__commit__STM__t.html#a66e689caef518806e7423e1f4458631">00042</a>   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classcore__commit__STM__t.html#a66e689caef518806e7423e1f4458631">commit_stall_str</a>[<a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cda6cdb34be6985d546d7fecac4ed76f16">CSTALL_num</a>];
<a name="l00043"></a>00043 
<a name="l00044"></a>00044   <span class="comment">/* additional temps to track timing of REP insts */</span>
<a name="l00045"></a><a class="code" href="classcore__commit__STM__t.html#9df76dacfa5669c4c70e4ad538be0751">00045</a>   <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="classcore__commit__STM__t.html#9df76dacfa5669c4c70e4ad538be0751">when_rep_fetch_started</a>;
<a name="l00046"></a><a class="code" href="classcore__commit__STM__t.html#de8947e45c82e771f1bf12a47695ff9b">00046</a>   <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="classcore__commit__STM__t.html#de8947e45c82e771f1bf12a47695ff9b">when_rep_fetched</a>;
<a name="l00047"></a><a class="code" href="classcore__commit__STM__t.html#d2cc45f299ab912b1557d9194ebfa46d">00047</a>   <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="classcore__commit__STM__t.html#d2cc45f299ab912b1557d9194ebfa46d">when_rep_decode_started</a>;
<a name="l00048"></a><a class="code" href="classcore__commit__STM__t.html#e13a3039a3bcaae1bcc1be93cb970326">00048</a>   <a class="code" href="host_8h.html#72c250924ea62bad7fee5d58765cdc86">tick_t</a> <a class="code" href="classcore__commit__STM__t.html#e13a3039a3bcaae1bcc1be93cb970326">when_rep_commit_started</a>;
<a name="l00049"></a>00049 };
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">/* number of buckets in uop-flow-length histogram */</span>
<a name="l00052"></a><a class="code" href="commit-STM_8cpp.html#7e301e88bf620815320ee07e9bda6e62">00052</a> <span class="preprocessor">#define FLOW_HISTO_SIZE 9</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00054"></a>00054 <span class="comment">/* VARIABLES/TYPES */</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classcore__commit__STM__t.html#a66e689caef518806e7423e1f4458631">core_commit_STM_t::commit_stall_str</a>[CSTALL_num] = {
<a name="l00057"></a>00057   <span class="stringliteral">"no stall                   "</span>,
<a name="l00058"></a>00058   <span class="stringliteral">"oldest inst not done       "</span>,
<a name="l00059"></a>00059   <span class="stringliteral">"oldest inst partially done "</span>,
<a name="l00060"></a>00060   <span class="stringliteral">"ROB is empty               "</span>,
<a name="l00061"></a>00061 };
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">/*******************/</span>
<a name="l00064"></a>00064 <span class="comment">/* SETUP FUNCTIONS */</span>
<a name="l00065"></a>00065 <span class="comment">/*******************/</span>
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="classcore__commit__STM__t.html#d7182901cfebab979040cc4151cccab0">00067</a> <a class="code" href="classcore__commit__STM__t.html#d7182901cfebab979040cc4151cccab0">core_commit_STM_t::core_commit_STM_t</a>(<span class="keyword">struct</span> <a class="code" href="classcore__t.html">core_t</a> * <span class="keyword">const</span> arg_core):
<a name="l00068"></a>00068   ROB_head(0), ROB_tail(0), ROB_num(0),
<a name="l00069"></a>00069   when_rep_fetch_started(0), when_rep_fetched(0),
<a name="l00070"></a>00070   when_rep_decode_started(0), when_rep_commit_started(0)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = arg_core-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00073"></a>00073   <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a> = arg_core;
<a name="l00074"></a>00074   <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a> = (<span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a>**) calloc(knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>,<span class="keyword">sizeof</span>(*<a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>));
<a name="l00075"></a>00075   <span class="keywordflow">if</span>(!<a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>)
<a name="l00076"></a>00076     <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"couldn't calloc ROB"</span>);
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keywordtype">void</span>
<a name="l00080"></a><a class="code" href="classcore__commit__STM__t.html#80dc96ec7454c0d193c053bfed57b016">00080</a> <a class="code" href="classcore__commit__STM__t.html#80dc96ec7454c0d193c053bfed57b016">core_commit_STM_t::reg_stats</a>(<span class="keyword">struct</span> <a class="code" href="structstat__sdb__t.html">stat_sdb_t</a> * <span class="keyword">const</span> sdb)
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082   <span class="keywordtype">char</span> buf[1024];
<a name="l00083"></a>00083   <span class="keywordtype">char</span> buf2[1024];
<a name="l00084"></a>00084   <span class="keyword">struct </span><a class="code" href="structthread__t.html">thread_t</a> * arch = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086   <a class="code" href="zesto_2stats_8h.html#ed9b9c4535e4fc2e59a090d6e8157d4f">stat_reg_note</a>(sdb,<span class="stringliteral">"\n#### COMMIT STATS ####"</span>);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   sprintf(buf,<span class="stringliteral">"c%d.commit_insn"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00089"></a>00089   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of instructions committed"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#695be096dc6d4c3ef8dadfb9875a3c38">commit_insn</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#695be096dc6d4c3ef8dadfb9875a3c38">commit_insn</a>, NULL);
<a name="l00090"></a>00090   sprintf(buf,<span class="stringliteral">"c%d.commit_uops"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00091"></a>00091   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of uops committed"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#92a5adf70cb88182f89436f5be116715">commit_uops</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#92a5adf70cb88182f89436f5be116715">commit_uops</a>, NULL);
<a name="l00092"></a>00092   sprintf(buf,<span class="stringliteral">"c%d.commit_IPC"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00093"></a>00093   sprintf(buf2,<span class="stringliteral">"c%d.commit_insn/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00094"></a>00094   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"IPC at commit"</span>, buf2, NULL);
<a name="l00095"></a>00095   sprintf(buf,<span class="stringliteral">"c%d.commit_uPC"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00096"></a>00096   sprintf(buf2,<span class="stringliteral">"c%d.commit_uops/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00097"></a>00097   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"uPC at commit"</span>, buf2, NULL);
<a name="l00098"></a>00098   sprintf(buf,<span class="stringliteral">"c%d.avg_commit_flowlen"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00099"></a>00099   sprintf(buf2,<span class="stringliteral">"c%d.commit_uops/c%d.commit_insn"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00100"></a>00100   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"uops per instruction at commit"</span>, buf2, NULL);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   sprintf(buf,<span class="stringliteral">"c%d.commit_dead_lock_flushes"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00103"></a>00103   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of pipe-flushes due to dead-locked pipeline"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#6c0721ecba9c68f18708d4b2fb155285">commit_deadlock_flushes</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#6c0721ecba9c68f18708d4b2fb155285">commit_deadlock_flushes</a>, NULL);
<a name="l00104"></a>00104   sprintf(buf,<span class="stringliteral">"c%d.ROB_occupancy"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00105"></a>00105   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">false</span>, buf, <span class="stringliteral">"total ROB occupancy"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#899085658ec2043bdc858c5d80c77042">ROB_occupancy</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#899085658ec2043bdc858c5d80c77042">ROB_occupancy</a>, NULL);
<a name="l00106"></a>00106   sprintf(buf,<span class="stringliteral">"c%d.ROB_empty"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00107"></a>00107   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">false</span>, buf, <span class="stringliteral">"total cycles ROB was empty"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#2eda3dc8169484641c1b9fd2e511e85c">ROB_empty_cycles</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#2eda3dc8169484641c1b9fd2e511e85c">ROB_empty_cycles</a>, NULL);
<a name="l00108"></a>00108   sprintf(buf,<span class="stringliteral">"c%d.ROB_full"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00109"></a>00109   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">false</span>, buf, <span class="stringliteral">"total cycles ROB was full"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#beff139f1bd9e6510270680bcb52d775">ROB_full_cycles</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#beff139f1bd9e6510270680bcb52d775">ROB_full_cycles</a>, NULL);
<a name="l00110"></a>00110   sprintf(buf,<span class="stringliteral">"c%d.ROB_avg"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00111"></a>00111   sprintf(buf2,<span class="stringliteral">"c%d.ROB_occupancy/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00112"></a>00112   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"average ROB occupancy"</span>, buf2, NULL);
<a name="l00113"></a>00113   sprintf(buf,<span class="stringliteral">"c%d.ROB_frac_empty"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00114"></a>00114   sprintf(buf2,<span class="stringliteral">"c%d.ROB_empty/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00115"></a>00115   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of cycles ROB was empty"</span>, buf2, NULL);
<a name="l00116"></a>00116   sprintf(buf,<span class="stringliteral">"c%d.ROB_frac_full"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00117"></a>00117   sprintf(buf2,<span class="stringliteral">"c%d.ROB_full/c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00118"></a>00118   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"fraction of cycles ROB was full"</span>, buf2, NULL);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   sprintf(buf,<span class="stringliteral">"c%d.commit_stall"</span>,<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00121"></a>00121   <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#9aa1b782d670256448505543248b88dd">commit_stall</a> = <a class="code" href="zesto_2stats_8h.html#b68118a778041ff66b7dec8bf1030ef4">stat_reg_dist</a>(sdb, buf,
<a name="l00122"></a>00122                                            <span class="stringliteral">"breakdown of stalls at commit"</span>,
<a name="l00123"></a>00123                                            <span class="comment">/* initial value */</span>0,
<a name="l00124"></a>00124                                            <span class="comment">/* array size */</span><a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cda6cdb34be6985d546d7fecac4ed76f16">CSTALL_num</a>,
<a name="l00125"></a>00125                                            <span class="comment">/* bucket size */</span>1,
<a name="l00126"></a>00126                                            <span class="comment">/* print format */</span>(<a class="code" href="zesto_2stats_8h.html#a2ea8c2ebd4b70b8bb60561c6fada674">PF_COUNT</a>|<a class="code" href="zesto_2stats_8h.html#7e857abbfb7e3dc6d4446052a96653a3">PF_PDF</a>),
<a name="l00127"></a>00127                                            <span class="comment">/* format */</span>NULL,
<a name="l00128"></a>00128                                            <span class="comment">/* index map */</span><a class="code" href="classcore__commit__STM__t.html#a66e689caef518806e7423e1f4458631">commit_stall_str</a>,
<a name="l00129"></a>00129                                            <span class="comment">/* print fn */</span>NULL);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   <a class="code" href="zesto_2stats_8h.html#ed9b9c4535e4fc2e59a090d6e8157d4f">stat_reg_note</a>(sdb,<span class="stringliteral">"#### TIMING STATS ####"</span>);
<a name="l00132"></a>00132   sprintf(buf,<span class="stringliteral">"c%d.sim_cycle"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00133"></a>00133   <a class="code" href="zesto_2stats_8h.html#d3b207566a223483451c345114249ac6">stat_reg_qword</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of cycles when last instruction (or uop) committed"</span>, (qword_t*) &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#5bdfc20ac509b4f10d9ac1b28f8c5a35">final_sim_cycle</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#5bdfc20ac509b4f10d9ac1b28f8c5a35">final_sim_cycle</a>, NULL);
<a name="l00134"></a>00134   <span class="comment">/* instruction distribution stats */</span>
<a name="l00135"></a>00135   <a class="code" href="zesto_2stats_8h.html#ed9b9c4535e4fc2e59a090d6e8157d4f">stat_reg_note</a>(sdb,<span class="stringliteral">"\n#### INSTRUCTION STATS (no wrong-path) ####"</span>);
<a name="l00136"></a>00136   sprintf(buf,<span class="stringliteral">"c%d.num_insn"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00137"></a>00137   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of instructions committed"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#695be096dc6d4c3ef8dadfb9875a3c38">commit_insn</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#695be096dc6d4c3ef8dadfb9875a3c38">commit_insn</a>, NULL);
<a name="l00138"></a>00138   sprintf(buf,<span class="stringliteral">"c%d.num_refs"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00139"></a>00139   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of loads and stores committed"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#f7dad952fb9b6af8fa5e7bd24f793c7c">commit_refs</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#f7dad952fb9b6af8fa5e7bd24f793c7c">commit_refs</a>, NULL);
<a name="l00140"></a>00140   sprintf(buf,<span class="stringliteral">"c%d.num_loads"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00141"></a>00141   <a class="code" href="machine_8h.html#d5b220607569cd144bbc637326632a1d">stat_reg_counter</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of loads committed"</span>, &amp;<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#6795007baed703f79069c605b342462c">commit_loads</a>, <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#6795007baed703f79069c605b342462c">commit_loads</a>, NULL);
<a name="l00142"></a>00142   sprintf(buf2,<span class="stringliteral">"c%d.num_refs - c%d.num_loads"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00143"></a>00143   sprintf(buf,<span class="stringliteral">"c%d.num_stores"</span>,arch-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00144"></a>00144   <a class="code" href="zesto_2stats_8h.html#f2f491659903b1b21de69fe6c767a64a">stat_reg_formula</a>(sdb, <span class="keyword">true</span>, buf, <span class="stringliteral">"total number of stores committed"</span>, buf2, <span class="stringliteral">"%12.0f"</span>);
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="classcore__commit__STM__t.html#84fc053a6d833b4df53f6dde763b81a2">00147</a> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#84fc053a6d833b4df53f6dde763b81a2">core_commit_STM_t::update_occupancy</a>(<span class="keywordtype">void</span>)
<a name="l00148"></a>00148 {
<a name="l00149"></a>00149     <span class="comment">/* ROB */</span>
<a name="l00150"></a>00150   <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#899085658ec2043bdc858c5d80c77042">ROB_occupancy</a> += <a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a>;
<a name="l00151"></a>00151   <span class="keywordflow">if</span>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &gt;= <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>)
<a name="l00152"></a>00152     <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#beff139f1bd9e6510270680bcb52d775">ROB_full_cycles</a>++;
<a name="l00153"></a>00153   <span class="keywordflow">if</span>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &lt;= 0)
<a name="l00154"></a>00154     <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#2eda3dc8169484641c1b9fd2e511e85c">ROB_empty_cycles</a>++;
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="comment">/*************************/</span>
<a name="l00159"></a>00159 <span class="comment">/* MAIN COMMIT FUNCTIONS */</span>
<a name="l00160"></a>00160 <span class="comment">/*************************/</span>
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">/* In-order instruction commit.  Individual uops cannot commit</span>
<a name="l00163"></a>00163 <span class="comment">   until it is guaranteed that the entire Mop's worth of uops will</span>
<a name="l00164"></a>00164 <span class="comment">   commit. */</span>
<a name="l00165"></a><a class="code" href="classcore__commit__STM__t.html#528f84be030a7ec19bf27ac995a64497">00165</a> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#528f84be030a7ec19bf27ac995a64497">core_commit_STM_t::step</a>(<span class="keywordtype">void</span>)
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00168"></a>00168   <span class="keywordtype">int</span> commit_count = 0;
<a name="l00169"></a>00169   <span class="keyword">enum</span> <a class="code" href="classcore__commit__t.html#cf283124880a10ce01e0fb68f2aa69ce">commit_stall_t</a> stall_reason = <a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cd9f2ee8eead92a505751a06718e3451ee">CSTALL_NONE</a>;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   <span class="comment">/* This is just a deadlock watchdog.  If something got messed up</span>
<a name="l00172"></a>00172 <span class="comment">     in the pipeline and no forward progress is being made, this</span>
<a name="l00173"></a>00173 <span class="comment">     code will eventually detect it and flush the pipeline in an</span>
<a name="l00174"></a>00174 <span class="comment">     attempt to un-wedge the processor.  If the processor then</span>
<a name="l00175"></a>00175 <span class="comment">     deadlocks again without having first made any more forward</span>
<a name="l00176"></a>00176 <span class="comment">     progress, we give up and kill the simulator. */</span>
<a name="l00177"></a>00177   <span class="keywordflow">if</span>((<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> - <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#cdd57a5cb5d71ea527ef696086d97bee">last_completed</a>) &gt; <a class="code" href="classcore__commit__t.html#53d4826f7dee27103a4065799875796a">deadlock_threshold</a>)
<a name="l00178"></a>00178   {
<a name="l00179"></a>00179     <span class="keywordflow">if</span>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#a1444430b4a5c68a31066fed05b3f774">last_completed_count</a> == <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a>)
<a name="l00180"></a>00180     {
<a name="l00181"></a>00181       <span class="keywordtype">char</span> buf[256];
<a name="l00182"></a>00182       snprintf(buf,<span class="keyword">sizeof</span>(buf),<span class="stringliteral">"At cycle %lld, core[%d] has not completed a uop in %d cycles... definite deadlock"</span>,(<span class="keywordtype">long</span> <span class="keywordtype">long</span>)<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>,<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="classcore__commit__t.html#53d4826f7dee27103a4065799875796a">deadlock_threshold</a>);
<a name="l00183"></a>00183       <a class="code" href="zesto-MC_8h.html#a62f33e5d3102234e8f957f4722f5f51">zesto_fatal</a>(buf,(<span class="keywordtype">void</span>)0);
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185     <span class="keywordflow">else</span>
<a name="l00186"></a>00186     {
<a name="l00187"></a>00187       <a class="code" href="misc_8h.html#f80d19f1297a11626fab61a248959c71">warn</a>(<span class="stringliteral">"At cycle %lld, core[%d] has not completed a uop in %d cycles... possible deadlock, flushing pipeline"</span>,(<span class="keywordtype">long</span> <span class="keywordtype">long</span>)<a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>,<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>,<a class="code" href="classcore__commit__t.html#53d4826f7dee27103a4065799875796a">deadlock_threshold</a>);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189       <span class="comment">/* flush the entire pipeline, correct path or not... passing</span>
<a name="l00190"></a>00190 <span class="comment">         NULL's causes the recover functions to throw everything</span>
<a name="l00191"></a>00191 <span class="comment">         away. */</span>
<a name="l00192"></a>00192       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#9f125e90b225555a2632277161f3b27c">complete_flush</a>();
<a name="l00193"></a>00193       <span class="comment">/*core-&gt;commit-&gt;*/</span><a class="code" href="classcore__commit__STM__t.html#c69a979d8af28ac84925b16094498845">recover</a>();
<a name="l00194"></a>00194       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#b9edcea5d76d1bbdbe89696ddf876c73">recover</a>();
<a name="l00195"></a>00195       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#20394b8c7a44d5ad56a16e9cd635299e">alloc</a>-&gt;<a class="code" href="classcore__alloc__t.html#e8350cafe32ac5219eaea41e6fb11f57">recover</a>();
<a name="l00196"></a>00196       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#5a8f490b74ace2edeb7f90c493c98691">decode</a>-&gt;<a class="code" href="classcore__decode__t.html#4cc12f3baa24ee5764ae57d87b759743">recover</a>();
<a name="l00197"></a>00197       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#5f9f05d72804be74a2a622eeb5456e51">recover</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#91103da0506a0127e32ad580eef763f2">regs</a>.<a class="code" href="structregs__t.html#70500e5215c4ebb383c43c05a670346c">regs_NPC</a>);
<a name="l00198"></a>00198       <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="zesto_2stats_8h.html#702503b8068fdcce1dc8712be9791d42">stat_add_sample</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#9aa1b782d670256448505543248b88dd">commit_stall</a>, (<span class="keywordtype">int</span>)<a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cdc98092df7e93d964de5e5ca7621c5143">CSTALL_EMPTY</a>);)
<a name="l00199"></a>00199       <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#6c0721ecba9c68f18708d4b2fb155285">commit_deadlock_flushes</a>++;)
<a name="l00200"></a>00200       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#cdd57a5cb5d71ea527ef696086d97bee">last_completed</a> = sim_cycle; <span class="comment">/* so we don't do this again next cycle */</span>
<a name="l00201"></a>00201       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#a1444430b4a5c68a31066fed05b3f774">last_completed_count</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a>;
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203     <span class="keywordflow">return</span>;
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="comment">/* MAIN COMMIT LOOP */</span>
<a name="l00207"></a>00207   <span class="keywordflow">for</span>(commit_count=0;commit_count&lt;knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#b58b777420f6904e072325942a0c2415">width</a>;commit_count++)
<a name="l00208"></a>00208   {
<a name="l00209"></a>00209     <span class="keywordflow">if</span>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &lt;= 0) <span class="comment">/* nothing to commit */</span>
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211       stall_reason = commit_count?<a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cd9f2ee8eead92a505751a06718e3451ee">CSTALL_NONE</a>:<a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cdc98092df7e93d964de5e5ca7621c5143">CSTALL_EMPTY</a>;
<a name="l00212"></a>00212       <span class="keywordflow">break</span>;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="keyword">struct </span><a class="code" href="structMop__t.html">Mop_t</a> * Mop = <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[<a class="code" href="classcore__commit__STM__t.html#9b1a733bdca4f9c25ae42966e64ad097">ROB_head</a>]-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#92d2861b39c23b47dd58854da3288e81">spec_mode</a>)
<a name="l00218"></a>00218       <a class="code" href="zesto-MC_8h.html#a62f33e5d3102234e8f957f4722f5f51">zesto_fatal</a>(<span class="stringliteral">"oldest instruction in processor is on wrong-path"</span>,(<span class="keywordtype">void</span>)0);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="comment">/* Are all uops in the Mop completed? */</span>
<a name="l00221"></a>00221     <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#bf12e6ea4212ed366a436c76d7b72fad">complete_index</a> != -1) <span class="comment">/* still some outstanding insts */</span>
<a name="l00222"></a>00222     {
<a name="l00223"></a>00223       <span class="keywordflow">while</span>(Mop-&gt;<a class="code" href="structMop__t.html#b435acfedb392843bc50658c7650cbdd">uop</a>[Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#bf12e6ea4212ed366a436c76d7b72fad">complete_index</a>].<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>)
<a name="l00224"></a>00224       {
<a name="l00225"></a>00225         <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = &amp;Mop-&gt;<a class="code" href="structMop__t.html#b435acfedb392843bc50658c7650cbdd">uop</a>[Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#bf12e6ea4212ed366a436c76d7b72fad">complete_index</a>];
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#bf12e6ea4212ed366a436c76d7b72fad">complete_index</a> += uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#5f5acb91cf98e7630d1fff849c0458be">has_imm</a> ? 3 : 1;
<a name="l00228"></a>00228         <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#bf12e6ea4212ed366a436c76d7b72fad">complete_index</a> &gt;= Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7718f3555efe88921d86e395fc3fbc74">flow_length</a>)
<a name="l00229"></a>00229         {
<a name="l00230"></a>00230           Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#bf12e6ea4212ed366a436c76d7b72fad">complete_index</a> = -1; <span class="comment">/* Mark this Mop as all done */</span>
<a name="l00231"></a>00231           <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>)
<a name="l00232"></a>00232           {
<a name="l00233"></a>00233             <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#8c7073a32e9c65c31b1af33b6c16b754">update</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>,Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7301ad4e0c0f5ece738ba62448f7c655">opflags</a>,
<a name="l00234"></a>00234                 Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a>, Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#f820451bdee352d521eb3bf905c3d4e0">targetPC</a>, Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a>, (Mop-&gt;<a class="code" href="structMop__t.html#f445a1796fbcfb01bb7094b956b4361a">oracle</a>.<a class="code" href="structMop__t.html#56859cbd74e3f756c4b2ef9f573fe642">NextPC</a> != (Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#5645e3dfe55b1b6b2206ffb38379c44d">PC</a> + Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#268a8bdf9dc08de70db61fbbdd52480d">inst</a>.<a class="code" href="structmd__inst__t.html#5dad80b28e8ae15c2bd387663d32fb7e">len</a>)));
<a name="l00235"></a>00235             <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#f9c3b3c249ede7672c20b900ff8768e9">return_state_cache</a>(Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a>);
<a name="l00236"></a>00236             Mop-&gt;<a class="code" href="structMop__t.html#068ff277465b6ed03aad00e96daccc62">fetch</a>.<a class="code" href="structMop__t.html#f33535affa9efa0509db7e31a70bea08">bpred_update</a> = NULL;
<a name="l00237"></a>00237           }
<a name="l00238"></a>00238           <span class="keywordflow">break</span>;
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240       }
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#bf12e6ea4212ed366a436c76d7b72fad">complete_index</a> == -1) <span class="comment">/* commit the uops if the Mop is done */</span>
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245       <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * uop = <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[<a class="code" href="classcore__commit__STM__t.html#9b1a733bdca4f9c25ae42966e64ad097">ROB_head</a>];
<a name="l00246"></a>00246       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#bad67330b68f9df896e3846b50df1f14">when_completed</a> &lt;= <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>,(<span class="keywordtype">void</span>)0);
<a name="l00247"></a>00247       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#e66802928ecce35d60f0495dee0a4ae7">ROB_index</a> == <a class="code" href="classcore__commit__STM__t.html#9b1a733bdca4f9c25ae42966e64ad097">ROB_head</a>,(<span class="keywordtype">void</span>)0);
<a name="l00248"></a>00248       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(uop == &amp;Mop-&gt;<a class="code" href="structMop__t.html#b435acfedb392843bc50658c7650cbdd">uop</a>[Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#2e86bc0a7037dfc0948a3dc895f02735">commit_index</a>],(<span class="keywordtype">void</span>)0);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250       <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#075d4a905368cc1eeb377d2a41bd9c20">BOM</a> &amp;&amp; (uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#7cbb20c576aa6fff6bfcbd39a074528f">timing</a>.<a class="code" href="structMop__t.html#bb62262ae07e9e18cb4869c709e366ad">when_commit_started</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>))
<a name="l00251"></a>00251         uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#7cbb20c576aa6fff6bfcbd39a074528f">timing</a>.<a class="code" href="structMop__t.html#bb62262ae07e9e18cb4869c709e366ad">when_commit_started</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253       <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>)
<a name="l00254"></a>00254         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#9a7d0f033b9eddd6d725fa0477e6d013">LDQ_deallocate</a>(uop);
<a name="l00255"></a>00255       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#eec85d8cffdbdff59e335df7cf38174a">is_sta</a>)
<a name="l00256"></a>00256         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#6f97e052e83526ba786d2f02f82dfd66">STQ_deallocate_sta</a>();
<a name="l00257"></a>00257       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#85d4bc293425ae1bcd322b314414ce1b">is_std</a>) <span class="comment">/* we alloc on STA, dealloc on STD */</span>
<a name="l00258"></a>00258       {
<a name="l00259"></a>00259         <span class="keywordflow">if</span>(!<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#a47688b9de31bdfd1f56cadd6a735a12">STQ_deallocate_std</a>(uop))
<a name="l00260"></a>00260           <span class="keywordflow">break</span>;
<a name="l00261"></a>00261       }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263       <span class="comment">/* any remaining transactions in-flight (only for loads)</span>
<a name="l00264"></a>00264 <span class="comment">         should now be ignored - such load requests may exist, for</span>
<a name="l00265"></a>00265 <span class="comment">         example as a result of a load that completes early due to</span>
<a name="l00266"></a>00266 <span class="comment">         a hit in the STQ while the cache request is still making</span>
<a name="l00267"></a>00267 <span class="comment">         its way through the memory hierarchy. */</span>
<a name="l00268"></a>00268       <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>)
<a name="l00269"></a>00269         uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l00270"></a>00270 
<a name="l00271"></a>00271       <span class="keywordflow">if</span>(uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#be01a5d7b4a12d36d753ca8e295cceb6">EOM</a>)
<a name="l00272"></a>00272         uop-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>-&gt;<a class="code" href="structMop__t.html#7cbb20c576aa6fff6bfcbd39a074528f">timing</a>.<a class="code" href="structMop__t.html#e1bbc6ef1aa73472c028b716fc3c5ef8">when_commit_finished</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274       <span class="comment">/* remove uop from ROB */</span>
<a name="l00275"></a>00275       <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[<a class="code" href="classcore__commit__STM__t.html#9b1a733bdca4f9c25ae42966e64ad097">ROB_head</a>] = NULL;
<a name="l00276"></a>00276       <a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> --;
<a name="l00277"></a>00277       <a class="code" href="classcore__commit__STM__t.html#9b1a733bdca4f9c25ae42966e64ad097">ROB_head</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__commit__STM__t.html#9b1a733bdca4f9c25ae42966e64ad097">ROB_head</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>); <span class="comment">//(ROB_head+1) % knobs-&gt;commit.ROB_size;</span>
<a name="l00278"></a>00278       uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#e66802928ecce35d60f0495dee0a4ae7">ROB_index</a> = -1;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280       <span class="comment">/* this cleans up idep/odep ptrs, register mappings, and</span>
<a name="l00281"></a>00281 <span class="comment">         commit stores to the real (non-spec) memory system */</span>
<a name="l00282"></a>00282       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#ba02df09c524181a44404676f33669a5">commit_uop</a>(uop);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284       <span class="comment">/* mark uop as committed in Mop */</span>
<a name="l00285"></a>00285       Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#2e86bc0a7037dfc0948a3dc895f02735">commit_index</a> += uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#5f5acb91cf98e7630d1fff849c0458be">has_imm</a> ? 3 : 1;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287       <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#2e86bc0a7037dfc0948a3dc895f02735">commit_index</a> &gt;= Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#7718f3555efe88921d86e395fc3fbc74">flow_length</a>)
<a name="l00288"></a>00288       {
<a name="l00289"></a>00289         Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#2e86bc0a7037dfc0948a3dc895f02735">commit_index</a> = -1; <span class="comment">/* The entire Mop has been committed */</span>
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <span class="comment">/* Update stats */</span>
<a name="l00292"></a>00292         <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#b435acfedb392843bc50658c7650cbdd">uop</a>[Mop-&gt;<a class="code" href="structMop__t.html#28058bfb31dd9263c008929f3c4f7f08">decode</a>.<a class="code" href="structMop__t.html#82638df3748d18d1c8c2e3d58d077a49">last_uop_index</a>].<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#be01a5d7b4a12d36d753ca8e295cceb6">EOM</a>)
<a name="l00293"></a>00293         {
<a name="l00294"></a>00294           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a>++;
<a name="l00295"></a>00295           <a class="code" href="zesto-opts_8h.html#171eaf944329f4e388ce310836b483e9">total_commit_insn</a> ++;
<a name="l00296"></a>00296           <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#695be096dc6d4c3ef8dadfb9875a3c38">commit_insn</a>++;)
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <a class="code" href="zesto-opts_8h.html#6c3a3c20b2532043566ce7c55105a880">total_commit_uops</a> += Mop-&gt;<a class="code" href="structMop__t.html#42838437539e18e14b2049aa3ad512c2">stat</a>.<a class="code" href="structMop__t.html#b63d1f53be60fd17e64b2e6fe22e6f3b">num_uops</a>;
<a name="l00300"></a>00300         <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#92a5adf70cb88182f89436f5be116715">commit_uops</a> += Mop-&gt;<a class="code" href="structMop__t.html#42838437539e18e14b2049aa3ad512c2">stat</a>.<a class="code" href="structMop__t.html#b63d1f53be60fd17e64b2e6fe22e6f3b">num_uops</a>;)
<a name="l00301"></a>00301         <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#f7dad952fb9b6af8fa5e7bd24f793c7c">commit_refs</a> += Mop-&gt;<a class="code" href="structMop__t.html#42838437539e18e14b2049aa3ad512c2">stat</a>.<a class="code" href="structMop__t.html#f0c857b3ff34e7bac381f3999036c251">num_refs</a>;)
<a name="l00302"></a>00302         <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#6795007baed703f79069c605b342462c">commit_loads</a> += Mop-&gt;<a class="code" href="structMop__t.html#42838437539e18e14b2049aa3ad512c2">stat</a>.<a class="code" href="structMop__t.html#52274c64edc3d83425766a0f8cdd71df">num_loads</a>;)
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="comment">/* Let the oracle know that we are done with this Mop. */</span>
<a name="l00305"></a>00305         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#5656906c0caee72b39f9d3760341de99">commit</a>(Mop);
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     <span class="keywordflow">else</span>
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311       <span class="keywordflow">if</span>(Mop-&gt;<a class="code" href="structMop__t.html#77cff2eda77d17e84d903d3dedd6d0af">commit</a>.<a class="code" href="structMop__t.html#bf12e6ea4212ed366a436c76d7b72fad">complete_index</a> == 0)
<a name="l00312"></a>00312         stall_reason = <a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cdf5159bda287b766e425d794d1aa66bb4">CSTALL_NOT_READY</a>;
<a name="l00313"></a>00313       <span class="keywordflow">else</span>
<a name="l00314"></a>00314         stall_reason = <a class="code" href="classcore__commit__STM__t.html#568d72a2861bfdfebba6cdc853d031cd2ed2ba1aeb7b2a9d4c1a60aa5e8ac5b5">CSTALL_PARTIAL</a>;
<a name="l00315"></a>00315       <span class="keywordflow">break</span>; <span class="comment">/* oldest Mop not done yet */</span>
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="comment">/*****************/</span>
<a name="l00319"></a>00319     <span class="comment">/* finish early? */</span>
<a name="l00320"></a>00320     <span class="comment">/*****************/</span>
<a name="l00321"></a>00321     <span class="keywordflow">if</span>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#47c204871c8aecc186222de0093d15b9">active</a>)
<a name="l00322"></a>00322     {
<a name="l00323"></a>00323       <span class="keywordflow">if</span> ( ( <a class="code" href="zesto-opts_8h.html#6035d8c1e668819da7877cd4a7563686">max_cycles</a> &amp;&amp; <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> &gt;= <a class="code" href="zesto-opts_8h.html#6035d8c1e668819da7877cd4a7563686">max_cycles</a> ) ||
<a name="l00324"></a>00324            (<a class="code" href="zesto-opts_8h.html#1d6aa8acff6f54b92087f434a3a2b7a9">max_insts</a> &amp;&amp; <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#695be096dc6d4c3ef8dadfb9875a3c38">commit_insn</a> &gt;= <a class="code" href="zesto-opts_8h.html#1d6aa8acff6f54b92087f434a3a2b7a9">max_insts</a>) ||
<a name="l00325"></a>00325            (<a class="code" href="zesto-opts_8h.html#1c19194f53ec4ac28fd2ceb40ea00ef7">max_uops</a> &amp;&amp; <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#92a5adf70cb88182f89436f5be116715">commit_uops</a> &gt;= <a class="code" href="zesto-opts_8h.html#1c19194f53ec4ac28fd2ceb40ea00ef7">max_uops</a>)  )
<a name="l00326"></a>00326       {
<a name="l00327"></a>00327         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#5bdfc20ac509b4f10d9ac1b28f8c5a35">final_sim_cycle</a> = <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a>; <span class="comment">/* make note of when this core stopped simulating */</span>
<a name="l00328"></a>00328         <span class="keywordflow">if</span>(<a class="code" href="zesto-opts_8h.html#6035d8c1e668819da7877cd4a7563686">max_cycles</a> &amp;&amp; <a class="code" href="sim-zesto_8cpp.html#d93be82106e505ae03e3a443a62d7238">sim_cycle</a> &gt;= <a class="code" href="zesto-opts_8h.html#6035d8c1e668819da7877cd4a7563686">max_cycles</a>)
<a name="l00329"></a>00329           fprintf(stderr,<span class="stringliteral">"# Simulation cycle "</span>);
<a name="l00330"></a>00330         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="zesto-opts_8h.html#1d6aa8acff6f54b92087f434a3a2b7a9">max_insts</a> &amp;&amp; <a class="code" href="zesto-opts_8h.html#1c19194f53ec4ac28fd2ceb40ea00ef7">max_uops</a>)
<a name="l00331"></a>00331           fprintf(stderr,<span class="stringliteral">"# Committed instruction/uop "</span>);
<a name="l00332"></a>00332         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="zesto-opts_8h.html#1d6aa8acff6f54b92087f434a3a2b7a9">max_insts</a>)
<a name="l00333"></a>00333           fprintf(stderr,<span class="stringliteral">"# Committed instruction "</span>);
<a name="l00334"></a>00334         <span class="keywordflow">else</span>
<a name="l00335"></a>00335           fprintf(stderr,<span class="stringliteral">"# Committed uop "</span>);
<a name="l00336"></a>00336         fprintf(stderr,<span class="stringliteral">"limit reached for core %d.\n"</span>,<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#96d4de2e7317c46b7f55f1ca2ef6a350">id</a>);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <a class="code" href="sim-zesto_8cpp.html#1b2701dab57f1ffb6459bbde33452d68">simulated_processes_remaining</a>--;
<a name="l00339"></a>00339         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#514a179d7ff004ee9a5c5167d90c2119">current_thread</a>-&gt;<a class="code" href="structthread__t.html#47c204871c8aecc186222de0093d15b9">active</a> = <span class="keyword">false</span>;
<a name="l00340"></a>00340         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#bb3b5f18fa768382f617bcdec3ee7d7e">fetch</a>-&gt;<a class="code" href="classcore__fetch__t.html#0dd5fd2d75f870de5fb95a496e3e6844">bpred</a>-&gt;<a class="code" href="classbpred__t.html#6ccd38354851e9913ad09445cd5bcd5e">freeze_stats</a>();
<a name="l00341"></a>00341         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#2acb90ed74004297268411a80b742794">freeze_stats</a>();
<a name="l00342"></a>00342         <a class="code" href="config_2zesto-cache_8cpp.html#bd1fe8334f2259dc773b85f98c7fbcfa">cache_freeze_stats</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>);
<a name="l00343"></a>00343         <span class="comment">/* start this core over */</span>
<a name="l00344"></a>00344 
<a name="l00345"></a>00345         <span class="keywordflow">if</span>(<a class="code" href="sim-zesto_8cpp.html#1b2701dab57f1ffb6459bbde33452d68">simulated_processes_remaining</a> &lt;= 0)
<a name="l00346"></a>00346           longjmp(<a class="code" href="manifold__fullsim_8cc.html#84727c65b24d2e32fd3d4a7af53aa15a">sim_exit_buf</a>, <span class="comment">/* exitcode + fudge */</span>0 + 1);
<a name="l00347"></a>00347       }
<a name="l00348"></a>00348     }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="comment">/* Reset the trace (eio file input) if we've hit the end of the</span>
<a name="l00351"></a>00351 <span class="comment">       trace.  This is used in multi-core simulation mode to keep</span>
<a name="l00352"></a>00352 <span class="comment">       cores that have reached their simulation limits busy. */</span>
<a name="l00353"></a>00353     <span class="keywordflow">if</span> (<a class="code" href="zesto-opts_8h.html#7f085ab1f80062bcfa4b9086e934c007">trace_limit</a> &amp;&amp; (<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a> &gt;= <a class="code" href="zesto-opts_8h.html#7f085ab1f80062bcfa4b9086e934c007">trace_limit</a>))
<a name="l00354"></a>00354     {
<a name="l00355"></a>00355       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#a41c519bf86d69b41a84c7253bf14276">eio_commit_insn</a> = 0;
<a name="l00356"></a>00356       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#e4ae7e910eea6077916a780537d3210e">oracle</a>-&gt;<a class="code" href="classcore__oracle__t.html#cd307b32aa377a56b3f4dc79b2122038">reset_execution</a>();
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358   }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <a class="code" href="zesto-opts_8h.html#225a9a02a0c5a33775f2743a37dfd8d8">ZESTO_STAT</a>(<a class="code" href="zesto_2stats_8h.html#702503b8068fdcce1dc8712be9791d42">stat_add_sample</a>(<a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd66018e0e0529be576f673452a032df">stat</a>.<a class="code" href="structcore__t_1_1core__stat__t.html#9aa1b782d670256448505543248b88dd">commit_stall</a>, (<span class="keywordtype">int</span>)stall_reason);)
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="comment">/* Walk ROB from youngest uop until we find the requested Mop.</span>
<a name="l00364"></a>00364 <span class="comment">   (NOTE: We stop at any uop belonging to the Mop.  We assume</span>
<a name="l00365"></a>00365 <span class="comment">   that recovery only occurs on Mop boundaries.)</span>
<a name="l00366"></a>00366 <span class="comment">   Release resources (PREGs, RS/ROB/LSQ entries, etc. as we go).</span>
<a name="l00367"></a>00367 <span class="comment">   If Mop == NULL, we're blowing away the entire pipeline. */</span>
<a name="l00368"></a>00368 <span class="keywordtype">void</span>
<a name="l00369"></a><a class="code" href="classcore__commit__STM__t.html#85aa9cf8ff881266aaa410ae47c4289c">00369</a> <a class="code" href="classcore__commit__STM__t.html#c69a979d8af28ac84925b16094498845">core_commit_STM_t::recover</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structMop__t.html">Mop_t</a> * <span class="keyword">const</span> <a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a>)
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371   assert(Mop != NULL);
<a name="l00372"></a>00372   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00373"></a>00373   <span class="keywordflow">if</span>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &gt; 0)
<a name="l00374"></a>00374   {
<a name="l00375"></a>00375     <span class="comment">/* requested uop should always be in the ROB */</span>
<a name="l00376"></a>00376     <span class="keywordtype">int</span> index = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>); <span class="comment">//(ROB_tail-1+knobs-&gt;commit.ROB_size) % knobs-&gt;commit.ROB_size;</span>
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <span class="comment">/* if there's only the one inst in the pipe, then we don't need to drain */</span>
<a name="l00379"></a>00379     <span class="keywordflow">if</span>(knobs-&gt;<a class="code" href="structcore__knobs__t.html#59dbf024a4199a4119773f12776f2e06">alloc</a>.<a class="code" href="structcore__knobs__t.html#e660d28db7f277e66f88c1560fd9da62">drain_flush</a> &amp;&amp; (<a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[index]-&gt;<a class="code" href="structuop__t.html#5752c48ff1454c5c470509db2fa46b7a">Mop</a> != Mop))
<a name="l00380"></a>00380       <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#20394b8c7a44d5ad56a16e9cd635299e">alloc</a>-&gt;<a class="code" href="classcore__alloc__t.html#1b26b1159897c2dc2ca5a04380190632">start_drain</a>();
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="keywordflow">while</span>(<a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[index] &amp;&amp; (<a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[index]-&gt;Mop != Mop))
<a name="l00383"></a>00383     {
<a name="l00384"></a>00384       <span class="keywordtype">int</span> i;
<a name="l00385"></a>00385       <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * dead_uop = <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[index];
<a name="l00386"></a>00386 
<a name="l00387"></a>00387       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &gt; 0,(<span class="keywordtype">void</span>)0);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389       <span class="comment">/* squash this instruction - this invalidates all in-flight actions (e.g., uop execution, cache accesses) */</span>
<a name="l00390"></a>00390       dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l00391"></a>00391 
<a name="l00392"></a>00392       <span class="comment">/* update allocation scoreboard if appropriate */</span>
<a name="l00393"></a>00393       <span class="comment">/* if(uop-&gt;alloc.RS_index != -1) */</span>
<a name="l00394"></a>00394       <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a> &amp;&amp; (dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a> != -1))
<a name="l00395"></a>00395         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#20394b8c7a44d5ad56a16e9cd635299e">alloc</a>-&gt;<a class="code" href="classcore__alloc__t.html#5be5ea812a0a42bf67a1e307acf0dbd8">RS_deallocate</a>(dead_uop);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397       <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> != -1) <span class="comment">/* currently in RS */</span>
<a name="l00398"></a>00398         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#40b90ec949055afd7525ef3fc9592658">RS_deallocate</a>(dead_uop);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00401"></a>00401       <span class="comment">/* In the following, we have to check it the uop has even been allocated yet... this has</span>
<a name="l00402"></a>00402 <span class="comment">         to do with our non-atomic implementation of allocation for fused-uops */</span>
<a name="l00403"></a>00403       <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>)
<a name="l00404"></a>00404       {
<a name="l00405"></a>00405         <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#826f35ba23d6193e5bfb44bddb3dabc9">when_allocated</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00406"></a>00406           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#e89588e67823a1240158658814d3fa9c">LDQ_squash</a>(dead_uop);
<a name="l00407"></a>00407       }
<a name="l00408"></a>00408       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#85d4bc293425ae1bcd322b314414ce1b">is_std</a>) <span class="comment">/* dealloc when we get to the STA */</span>
<a name="l00409"></a>00409       {
<a name="l00410"></a>00410         <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#826f35ba23d6193e5bfb44bddb3dabc9">when_allocated</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00411"></a>00411           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#73339072a45e69a11de1f5e0d58f7b37">STQ_squash_std</a>(dead_uop);
<a name="l00412"></a>00412       }
<a name="l00413"></a>00413       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#eec85d8cffdbdff59e335df7cf38174a">is_sta</a>)
<a name="l00414"></a>00414       {
<a name="l00415"></a>00415         <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#826f35ba23d6193e5bfb44bddb3dabc9">when_allocated</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00416"></a>00416           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#2741e7d8d06e54281c7f5eb3603f8e91">STQ_squash_sta</a>(dead_uop);
<a name="l00417"></a>00417       }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419       <span class="comment">/* clean up idep/odep pointers.  Since we're working our</span>
<a name="l00420"></a>00420 <span class="comment">         way back from the most speculative instruction, we only</span>
<a name="l00421"></a>00421 <span class="comment">         need to clean-up our parent's forward-pointers (odeps)</span>
<a name="l00422"></a>00422 <span class="comment">         and our own back-pointers (our fwd-ptrs would have</span>
<a name="l00423"></a>00423 <span class="comment">         already cleaned-up our own children). */</span>
<a name="l00424"></a>00424       <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;i++)
<a name="l00425"></a>00425       {
<a name="l00426"></a>00426         <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * parent = dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e941cb97551b1b6f4205334d2c23fbc4">idep_uop</a>[i];
<a name="l00427"></a>00427         <span class="keywordflow">if</span>(parent) <span class="comment">/* I have an active parent */</span>
<a name="l00428"></a>00428         {
<a name="l00429"></a>00429           <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * prev, * current;
<a name="l00430"></a>00430           prev = NULL;
<a name="l00431"></a>00431           current = parent-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l00432"></a>00432           <span class="keywordflow">while</span>(current)
<a name="l00433"></a>00433           {
<a name="l00434"></a>00434             <span class="keywordflow">if</span>((current-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a> == dead_uop) &amp;&amp; (current-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a> == i))
<a name="l00435"></a>00435               <span class="keywordflow">break</span>;
<a name="l00436"></a>00436             prev = current;
<a name="l00437"></a>00437             current = current-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l00438"></a>00438           }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(current,(<span class="keywordtype">void</span>)0);
<a name="l00441"></a>00441 
<a name="l00442"></a>00442           <span class="comment">/* remove self from parent's odep list */</span>
<a name="l00443"></a>00443           <span class="keywordflow">if</span>(prev)
<a name="l00444"></a>00444             prev-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a> = current-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l00445"></a>00445           <span class="keywordflow">else</span>
<a name="l00446"></a>00446             parent-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a> = current-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448           <span class="comment">/* eliminate my own idep */</span>
<a name="l00449"></a>00449           dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e941cb97551b1b6f4205334d2c23fbc4">idep_uop</a>[i] = NULL;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451           <span class="comment">/* return the odep struct */</span>
<a name="l00452"></a>00452           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#c76899d81828f8557930f9ab87f4938e">return_odep_link</a>(current);
<a name="l00453"></a>00453         }
<a name="l00454"></a>00454       }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a> == NULL,(<span class="keywordtype">void</span>)0);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458       <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[index] = NULL;
<a name="l00459"></a>00459       <a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a> = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>); <span class="comment">//(ROB_tail-1+knobs-&gt;commit.ROB_size) % knobs-&gt;commit.ROB_size;</span>
<a name="l00460"></a>00460       <a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> --;
<a name="l00461"></a>00461       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463       index = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(index,knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>); <span class="comment">//(index-1+knobs-&gt;commit.ROB_size) % knobs-&gt;commit.ROB_size;</span>
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465   }
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="keywordtype">void</span>
<a name="l00469"></a><a class="code" href="classcore__commit__STM__t.html#c69a979d8af28ac84925b16094498845">00469</a> <a class="code" href="classcore__commit__STM__t.html#c69a979d8af28ac84925b16094498845">core_commit_STM_t::recover</a>(<span class="keywordtype">void</span>)
<a name="l00470"></a>00470 {
<a name="l00471"></a>00471   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00472"></a>00472   <span class="keywordflow">if</span>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &gt; 0)
<a name="l00473"></a>00473   {
<a name="l00474"></a>00474     <span class="comment">/* requested uop should always be in the ROB */</span>
<a name="l00475"></a>00475     <span class="keywordtype">int</span> index = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>); <span class="comment">//(ROB_tail-1+knobs-&gt;commit.ROB_size) % knobs-&gt;commit.ROB_size;</span>
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="keywordflow">while</span>(<a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[index])
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479       <span class="keywordtype">int</span> i;
<a name="l00480"></a>00480       <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * dead_uop = <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[index];
<a name="l00481"></a>00481 
<a name="l00482"></a>00482       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &gt; 0,(<span class="keywordtype">void</span>)0);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484       <span class="comment">/* squash this instruction - this invalidates all in-flight actions (e.g., uop execution, cache accesses) */</span>
<a name="l00485"></a>00485       dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#47dc4af18b603fd6693da3d213ff3298">action_id</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#110f33d959a11c403fb9166326c7e5f3">new_action_id</a>();
<a name="l00486"></a>00486 
<a name="l00487"></a>00487       <span class="comment">/* update allocation scoreboard if appropriate */</span>
<a name="l00488"></a>00488       <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#780ed24e3aa8b3709e7a93c88ff31132">when_issued</a> == <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a> &amp;&amp; (dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#09b2c63be80dd4e8800c1b59d0155b8e">port_assignment</a> != -1))
<a name="l00489"></a>00489         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#20394b8c7a44d5ad56a16e9cd635299e">alloc</a>-&gt;<a class="code" href="classcore__alloc__t.html#5be5ea812a0a42bf67a1e307acf0dbd8">RS_deallocate</a>(dead_uop);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491       <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#8d3f920949e75a969f27530e48001e43">RS_index</a> != -1) <span class="comment">/* currently in RS */</span>
<a name="l00492"></a>00492         <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#40b90ec949055afd7525ef3fc9592658">RS_deallocate</a>(dead_uop);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495       <span class="comment">/* In the following, we have to check it the uop has even</span>
<a name="l00496"></a>00496 <span class="comment">         been allocated yet... this has to do with our non-atomic</span>
<a name="l00497"></a>00497 <span class="comment">         implementation of allocation for fused-uops */</span>
<a name="l00498"></a>00498       <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#fd9cc07575e4452cb5192588691e6814">is_load</a>)
<a name="l00499"></a>00499       {
<a name="l00500"></a>00500         <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#826f35ba23d6193e5bfb44bddb3dabc9">when_allocated</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00501"></a>00501           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#e89588e67823a1240158658814d3fa9c">LDQ_squash</a>(dead_uop);
<a name="l00502"></a>00502       }
<a name="l00503"></a>00503       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#85d4bc293425ae1bcd322b314414ce1b">is_std</a>) <span class="comment">/* dealloc when we get to the STA */</span>
<a name="l00504"></a>00504       {
<a name="l00505"></a>00505         <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#826f35ba23d6193e5bfb44bddb3dabc9">when_allocated</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00506"></a>00506           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#73339072a45e69a11de1f5e0d58f7b37">STQ_squash_std</a>(dead_uop);
<a name="l00507"></a>00507       }
<a name="l00508"></a>00508       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#c42cc8544fd53bb8513c3aabef62c13b">decode</a>.<a class="code" href="structuop__t.html#eec85d8cffdbdff59e335df7cf38174a">is_sta</a>)
<a name="l00509"></a>00509       {
<a name="l00510"></a>00510         <span class="keywordflow">if</span>(dead_uop-&gt;<a class="code" href="structuop__t.html#b61a7ea0dc1ac39e3e55da42e98454f0">timing</a>.<a class="code" href="structuop__t.html#826f35ba23d6193e5bfb44bddb3dabc9">when_allocated</a> != <a class="code" href="host_8h.html#d6479e80718c30aee08a7e9cc5cf9668">TICK_T_MAX</a>)
<a name="l00511"></a>00511           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#2741e7d8d06e54281c7f5eb3603f8e91">STQ_squash_sta</a>(dead_uop);
<a name="l00512"></a>00512       }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514       <span class="comment">/* clean up idep/odep pointers.  Since we're working our</span>
<a name="l00515"></a>00515 <span class="comment">         way back from the most speculative instruction, we only</span>
<a name="l00516"></a>00516 <span class="comment">         need to clean-up our parent's forward-pointers (odeps)</span>
<a name="l00517"></a>00517 <span class="comment">         and our own back-pointers (our fwd-ptrs would have</span>
<a name="l00518"></a>00518 <span class="comment">         already cleaned-up our own children). */</span>
<a name="l00519"></a>00519       <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="zesto-structs_8h.html#dfffbd8f2596b46b6777c263be9e5a23">MAX_IDEPS</a>;i++)
<a name="l00520"></a>00520       {
<a name="l00521"></a>00521         <span class="keyword">struct </span><a class="code" href="structuop__t.html">uop_t</a> * parent = dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e941cb97551b1b6f4205334d2c23fbc4">idep_uop</a>[i];
<a name="l00522"></a>00522         <span class="keywordflow">if</span>(parent) <span class="comment">/* I have an active parent */</span>
<a name="l00523"></a>00523         {
<a name="l00524"></a>00524           <span class="keyword">struct </span><a class="code" href="structodep__t.html">odep_t</a> * prev, * current;
<a name="l00525"></a>00525           prev = NULL;
<a name="l00526"></a>00526           current = parent-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a>;
<a name="l00527"></a>00527           <span class="keywordflow">while</span>(current)
<a name="l00528"></a>00528           {
<a name="l00529"></a>00529             <span class="keywordflow">if</span>((current-&gt;<a class="code" href="structodep__t.html#4870c3718dfdc8a6ac81f2455e8e7b60">uop</a> == dead_uop) &amp;&amp; (current-&gt;<a class="code" href="structodep__t.html#a9047cb0f60d68673900ec2fd18b2263">op_num</a> == i))
<a name="l00530"></a>00530               <span class="keywordflow">break</span>;
<a name="l00531"></a>00531             prev = current;
<a name="l00532"></a>00532             current = current-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l00533"></a>00533           }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535           <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(current,(<span class="keywordtype">void</span>)0);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537           <span class="comment">/* remove self from parent's odep list */</span>
<a name="l00538"></a>00538           <span class="keywordflow">if</span>(prev)
<a name="l00539"></a>00539             prev-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a> = current-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l00540"></a>00540           <span class="keywordflow">else</span>
<a name="l00541"></a>00541             parent-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a> = current-&gt;<a class="code" href="structodep__t.html#a696a50e030a95db3b98795875dcd908">next</a>;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543           <span class="comment">/* eliminate my own idep */</span>
<a name="l00544"></a>00544           dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#e941cb97551b1b6f4205334d2c23fbc4">idep_uop</a>[i] = NULL;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546           <span class="comment">/* return the odep struct */</span>
<a name="l00547"></a>00547           <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#c76899d81828f8557930f9ab87f4938e">return_odep_link</a>(current);
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549       }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(dead_uop-&gt;<a class="code" href="structuop__t.html#effc0bd8baf056d9abde991743af3cc3">exec</a>.<a class="code" href="structuop__t.html#26d4b1db6fdef492b6f61b9624455f7c">odep_uop</a> == NULL,(<span class="keywordtype">void</span>)0);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553       <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[index] = NULL;
<a name="l00554"></a>00554       <a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a> = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(<a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>); <span class="comment">//(ROB_tail-1+knobs-&gt;commit.ROB_size) % knobs-&gt;commit.ROB_size;</span>
<a name="l00555"></a>00555       <a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> --;
<a name="l00556"></a>00556       <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &gt;= 0,(<span class="keywordtype">void</span>)0);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558       index = <a class="code" href="misc_8h.html#e72918bfe3eb9d02e83975f2739a7ab2">moddec</a>(index,knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>); <span class="comment">//(index-1+knobs-&gt;commit.ROB_size) % knobs-&gt;commit.ROB_size;</span>
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560   }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562   <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#fd8831061ddb119a3abe035f7a482b55">exec</a>-&gt;<a class="code" href="classcore__exec__t.html#b8d15b77bc3cb1d7da22b25c864ebab2">recover_check_assertions</a>();
<a name="l00563"></a>00563   <a class="code" href="zesto-oracle_8h.html#4f942292a4c30024a9b7fe4f9b1820a4">zesto_assert</a>(<a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> == 0,(<span class="keywordtype">void</span>)0);
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a><a class="code" href="classcore__commit__STM__t.html#42b0d6ec2c90655ebafefcdf620a4241">00566</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__commit__STM__t.html#42b0d6ec2c90655ebafefcdf620a4241">core_commit_STM_t::ROB_available</a>(<span class="keywordtype">void</span>)
<a name="l00567"></a>00567 {
<a name="l00568"></a>00568   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00569"></a>00569   <span class="keywordflow">return</span> <a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a> &lt; knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>;
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="classcore__commit__STM__t.html#a0ff8613308d681e077fe3033e40f5b5">00572</a> <span class="keywordtype">bool</span> <a class="code" href="classcore__commit__STM__t.html#a0ff8613308d681e077fe3033e40f5b5">core_commit_STM_t::ROB_empty</a>(<span class="keywordtype">void</span>)
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574   <span class="keywordflow">return</span> 0 == <a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a>;
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a><a class="code" href="classcore__commit__STM__t.html#36e6c1d474694d75a35ad7c49bbe7b59">00577</a> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#36e6c1d474694d75a35ad7c49bbe7b59">core_commit_STM_t::ROB_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l00578"></a>00578 {
<a name="l00579"></a>00579   <span class="keyword">struct </span><a class="code" href="structcore__knobs__t.html">core_knobs_t</a> * <a class="code" href="sim-zesto_8cpp.html#89a180011adecec49b08c8ef843388fa">knobs</a> = <a class="code" href="classcore__commit__t.html#d56ace13088d783b83e8ac19744d2064">core</a>-&gt;<a class="code" href="classcore__t.html#a397a3f36f045e3c2a19dafc16dab1c1">knobs</a>;
<a name="l00580"></a>00580   <a class="code" href="classcore__commit__STM__t.html#09054e8743eb8544b07ade02a017366d">ROB</a>[<a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a>] = uop;
<a name="l00581"></a>00581   uop-&gt;<a class="code" href="structuop__t.html#6f62c942e5cb41dfcf20a650a32fcc6b">alloc</a>.<a class="code" href="structuop__t.html#e66802928ecce35d60f0495dee0a4ae7">ROB_index</a> = <a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a>;
<a name="l00582"></a>00582   <a class="code" href="classcore__commit__STM__t.html#783a43e1fbd0eafb1b056ee2cedb0fa1">ROB_num</a>++;
<a name="l00583"></a>00583   <a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a> = <a class="code" href="misc_8h.html#ec0decc56f83415e5cd152f876e5dde1">modinc</a>(<a class="code" href="classcore__commit__STM__t.html#f159d3c8ac89bc67f6ed33f1cb26453f">ROB_tail</a>,knobs-&gt;<a class="code" href="structcore__knobs__t.html#2b7876a4f411b3ae2041c14a7cae699e">commit</a>.<a class="code" href="structcore__knobs__t.html#8648564800ae0fe984ac1f418deace94">ROB_size</a>); <span class="comment">//(ROB_tail+1) % knobs-&gt;commit.ROB_size;</span>
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a><a class="code" href="classcore__commit__STM__t.html#2e2733c421dbec121c10f40a011095f4">00586</a> <span class="keywordtype">void</span> <a class="code" href="classcore__commit__STM__t.html#2e2733c421dbec121c10f40a011095f4">core_commit_STM_t::ROB_fuse_insert</a>(<span class="keyword">struct</span> <a class="code" href="structuop__t.html">uop_t</a> * <span class="keyword">const</span> uop)
<a name="l00587"></a>00587 {
<a name="l00588"></a>00588   <a class="code" href="misc_8h.html#677da14e8c4326bde43622f233f1ead3">fatal</a>(<span class="stringliteral">"fusion not supported in STM commit module"</span>);
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 23 00:20:56 2010 for IRIS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
